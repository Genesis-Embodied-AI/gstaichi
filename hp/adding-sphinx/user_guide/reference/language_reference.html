
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Language Reference &#8212; Taichi 1.8.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=b51e6972"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/reference/language_reference';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Operators" href="operator.html" />
    <link rel="prev" title="Global Settings" href="global_settings.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.8.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Taichi 1.8.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autoapi/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autoapi/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../get-started/hello_world.html">Hello, World!</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/accelerate_python.html">Accelerate Python with Taichi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started/accelerate_pytorch.html">Accelerate PyTorch with Taichi</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Basic</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../basic/field.html">Fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/ndarray.html">Taichi Ndarray</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/layout.html">Fields (advanced)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/offset.html">Coordinate Offsets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/external.html">Interacting with External Arrays</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/sparse.html">Spatially Sparse Data Structures</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Kernels</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../kernels/kernel_function.html">Kernels and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kernels/kernel_sync.html">Synchronization between Kernels and Python Scope</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Math</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../math/linear_solver.html">Linear Solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/math_module.html">Math Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/sparse_matrix.html">Sparse Matrix</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Performance Tuning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../performance_tuning/performance.html">Performance Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../performance_tuning/profiler.html">Profiler</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Advanced</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../advanced/data_oriented_class.html">Data-Oriented Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/dataclass.html">Taichi Dataclass</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/meta.html">Metaprogramming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/quant.html">Use quantized data types</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Differentiable</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../differentiable/differentiable_programming.html">Differentiable Programming</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Type System</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../type_system/type.html">Type System</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="global_settings.html">Global Settings</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Language Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="operator.html">Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="simt.html">SIMT Intrinsics</a></li>
<li class="toctree-l1"><a class="reference internal" href="syntax_sugars.html">Syntax Sugars</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Internals</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../internals/compilation.html">Life of a Taichi Kernel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../internals/internal.html">Internal Designs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">glossary</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../glossary/glossary.html">Glossary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">FAQs</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../faqs/faq.html">Frequently Asked Questions</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../index.html" class="nav-link">User guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Language Reference</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="language-reference">
<h1>Language Reference<a class="headerlink" href="#language-reference" title="Link to this heading">#</a></h1>
<p>This article describes the syntax and semantics of the Taichi programming
language.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Taichi is a domain-specific language embedded in Python.
<a class="reference internal" href="../kernels/kernel_function.html"><span class="std std-doc">Kernels and functions</span></a> clearly defines the boundary between
the Taichi language and the Python language - code in the Taichi scope is
treated as the former, while code in the Python scope is treated as the latter.
It should be emphasized that this article is about <em>the Taichi language</em>.</p>
<p>That said, because Taichi is embedded in Python, the syntax of Taichi is a
subset of that of Python. To make life easier, this article is modeled after
the <a class="reference external" href="https://docs.python.org/3/reference/">Python language reference</a>. The
<a class="reference external" href="https://docs.python.org/3/reference/introduction.html#notation">notation</a> and
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html">lexical analysis</a>
parts exactly follow Python. Please familiarize yourself with them if they seem
new.</p>
</section>
<section id="basic-concepts">
<h2>Basic concepts<a class="headerlink" href="#basic-concepts" title="Link to this heading">#</a></h2>
<p>Before detailing syntax and semantics in the next few chapters, many basic but
important concepts and general evaluation principles specific to Taichi are
listed here.</p>
<section id="values-and-types">
<h3>Values and types<a class="headerlink" href="#values-and-types" title="Link to this heading">#</a></h3>
<p>Like many other programming languages, each expression in Taichi will be
evaluated to a value, and each value has a type. Because Taichi provides easy
interaction with Python and <a class="reference internal" href="../advanced/meta.html"><span class="std std-doc">meta-programming</span></a> support, there
are actually two kinds of evaluation: <em>compile-time evaluation</em> and <em>runtime
evaluation</em>. There are also two kinds of values: <em>Python values</em> and <em>Taichi
values</em>.</p>
<div class="note docutils">
<p>For readers familiar with programming language terms, such behavior is inspired
by <a class="reference external" href="https://en.wikipedia.org/wiki/Multi-stage_programming">multi-stage programming</a>
or <a class="reference external" href="https://en.wikipedia.org/wiki/Partial_evaluation">partial evaluation</a>.</p>
</div>
<p>A Python value is simply a
<a class="reference external" href="https://docs.python.org/3/reference/datamodel.html">Python object</a>,
which directly comes from the following sources:</p>
<ul class="simple">
<li><p>Literals</p></li>
<li><p>Arguments passed via <code class="docutils literal notranslate"><span class="pre">ti.template()</span></code></p></li>
<li><p>Free variables</p></li>
</ul>
<p>Furthermore, as long as all the operands of an operation are Python values,
compile-time evaluation will take place, producing a result Python value. For
meta-programming purposes, Taichi provides an advanced environment for
compile-time evaluation: <code class="docutils literal notranslate"><span class="pre">ti.static()</span></code>, where more operations are supported.</p>
<p>A Python value only exists at compile time. After compile-time evaluation, all
the remaining expressions will be evaluated to Taichi values at runtime.</p>
<p>A Taichi value has a Taichi type, which is one of the following:</p>
<ul class="simple">
<li><p>A primitive type, as described in <a class="reference internal" href="../type_system/type.html"><span class="std std-doc">Type system</span></a></p></li>
<li><p>A compound type, as described in <a class="reference internal" href="../type_system/type.html"><span class="std std-doc">Type system</span></a></p></li>
<li><p>An ndarray type</p></li>
<li><p>A sparse matrix builder type, as introduced in <a class="reference internal" href="../math/sparse_matrix.html"><span class="std std-doc">Sparse
Matrix</span></a></p></li>
</ul>
<div class="note docutils">
<p>An informal quick summary of evaluation rules:</p>
<ul class="simple">
<li><p>Python value + Python value = Python value</p></li>
<li><p>Python value + Taichi value = Taichi value</p></li>
<li><p>Taichi value + Taichi value = Taichi value</p></li>
</ul>
</div>
</section>
<section id="variables-and-scope">
<h3>Variables and scope<a class="headerlink" href="#variables-and-scope" title="Link to this heading">#</a></h3>
<p>A variable contains a <em>name</em>, a <em>type</em> and a <em>value</em>. In Taichi, a variable can
be defined in the following ways:</p>
<ul class="simple">
<li><p>A parameter. The name of the variable is the parameter name. The type of the
variable is the parameter type annotation. The value of the variable is passed
in at runtime.</p></li>
<li><p>An <a class="reference internal" href="#assignment-statements">assignment</a> statement, if the name on the
left-hand side appears for the first time. The name of the variable is the name
on the left-hand side. If there is a type annotation on the left-hand side, the
type of the variable is the type annotation; otherwise, the type of the
variable is inferred from the expression on the right-hand side. The value of
the variable is the evaluation result of the expression on the right-hand side
at runtime.</p></li>
</ul>
<p>Taichi is statically-typed. That is, you cannot change the type of a variable
after its definition. However, you can change the value of a variable if there
is another assignment statement after its definition.</p>
<p>Taichi adopts <a class="reference external" href="https://en.wikipedia.org/wiki/Scope_(computer_science)">lexical scope</a>.
Therefore, if a variable is defined in a <a class="reference internal" href="#compound-statements">block</a>, it is
invisible outside that block.</p>
</section>
<section id="common-rules-of-binary-operations">
<h3>Common rules of binary operations<a class="headerlink" href="#common-rules-of-binary-operations" title="Link to this heading">#</a></h3>
<p>Following the <a class="reference internal" href="#values-and-types">Values and types</a> section, if both operands
of a binary operation are Python values, compile-time evaluation is triggered
and a result Python value is produced. If only one operand is a Python value,
it is first turned into a Taichi value with
<a class="reference internal" href="../type_system/type.html#primitive-types"><span class="std std-ref">default type</span></a>.
Now the only remaining case is that both operands are Taichi values.</p>
<p>Binary operations can happen between Taichi values of either primitive type or
compound type. There are three cases in total:</p>
<ul class="simple">
<li><p>Two primitive type values. The return type is also a primitive type.</p></li>
<li><p>One primitive type value and one compound type value. The primitive type
value is first broadcast into the shape of the compound type value. Now it
belongs to the case of two compound type values.</p></li>
<li><p>Two compound type values. For operators other than matrix multiplication,
both values are required to have the same shape, and the operator is conducted
element-wise, resulting in a compound type value with same shape.</p></li>
</ul>
</section>
</section>
<section id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Link to this heading">#</a></h2>
<p>The section explains the syntax and semantics of expressions in Taichi.</p>
<section id="atoms">
<h3>Atoms<a class="headerlink" href="#atoms" title="Link to this heading">#</a></h3>
<p>Atoms are the most basic elements of expressions. The simplest atoms are
identifiers or literals. Forms enclosed in parentheses, brackets or braces
are also categorized syntactically as atoms.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">atom</span>      <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span> <span class="o">|</span> <span class="n">literal</span> <span class="o">|</span> <span class="n">enclosure</span>
<span class="n">enclosure</span> <span class="p">:</span><span class="o">:=</span> <span class="n">parenth_form</span> <span class="o">|</span> <span class="n">list_display</span> <span class="o">|</span> <span class="n">dict_display</span>
</pre></div>
</div>
<section id="identifiers-names">
<h4>Identifiers (Names)<a class="headerlink" href="#identifiers-names" title="Link to this heading">#</a></h4>
<p>Lexical definition of
<a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#identifiers">identifiers</a>
(also referred to as names) in Taichi follows Python.</p>
<p>There are three cases during evaluation:</p>
<ul class="simple">
<li><p>The name is visible and corresponds to a variable defined in Taichi. Then the
evaluation result is the value of the variable at runtime.</p></li>
<li><p>The name is only visible in Python, i.e., the name binding is outside Taichi.
Then compile-time evaluation is triggered, resulting in the Python value bound
to that name.</p></li>
<li><p>The name is invisible. Then a <code class="docutils literal notranslate"><span class="pre">TaichiNameError</span></code> is thrown.</p></li>
</ul>
</section>
<section id="literals">
<h4>Literals<a class="headerlink" href="#literals" title="Link to this heading">#</a></h4>
<p>Taichi supports <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#integer-literals">integer</a>
and <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#floating-point-literals">floating-point</a>
literals, whose lexical definitions follow Python.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">literal</span> <span class="p">:</span><span class="o">:=</span> <span class="n">integer</span> <span class="o">|</span> <span class="n">floatnumber</span>
</pre></div>
</div>
<p>Literals are evaluated to Python values at compile time.</p>
</section>
<section id="parenthesized-forms">
<h4>Parenthesized forms<a class="headerlink" href="#parenthesized-forms" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parenth_form</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<p>A parenthesized expression list is evaluated to whatever the expression list is
evaluated to. An empty pair of parentheses is evaluated to an empty tuple at
compile time.</p>
</section>
<section id="list-and-dictionary-displays">
<h4>List and dictionary displays<a class="headerlink" href="#list-and-dictionary-displays" title="Link to this heading">#</a></h4>
<p>Taichi supports
<a class="reference external" href="https://docs.python.org/3/reference/expressions.html#displays-for-lists-sets-and-dictionaries">displays</a>
for container (list and dictionary only) construction. Like in Python, a
display is one of:</p>
<ul class="simple">
<li><p>listing the container items explicitly;</p></li>
<li><p>providing a <em>comprehension</em> (a set of looping and filtering instructions) to
compute the container items.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">list_display</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;[&quot;</span> <span class="p">[</span><span class="n">expression_list</span> <span class="o">|</span> <span class="n">list_comprehension</span><span class="p">]</span> <span class="s2">&quot;]&quot;</span>
<span class="n">list_comprehension</span> <span class="p">:</span><span class="o">:=</span> <span class="n">assignment_expression</span> <span class="n">comp_for</span>

<span class="n">dict_display</span>       <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;{&quot;</span> <span class="p">[</span><span class="n">key_datum_list</span> <span class="o">|</span> <span class="n">dict_comprehension</span><span class="p">]</span> <span class="s2">&quot;}&quot;</span>
<span class="n">key_datum_list</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">key_datum</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">key_datum</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">]</span>
<span class="n">key_datum</span>          <span class="p">:</span><span class="o">:=</span> <span class="n">expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">expression</span>
<span class="n">dict_comprehension</span> <span class="p">:</span><span class="o">:=</span> <span class="n">key_datum</span> <span class="n">comp_for</span>

<span class="n">comp_for</span>           <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;for&quot;</span> <span class="n">target_list</span> <span class="s2">&quot;in&quot;</span> <span class="n">or_test</span> <span class="p">[</span><span class="n">comp_iter</span><span class="p">]</span>
<span class="n">comp_iter</span>          <span class="p">:</span><span class="o">:=</span> <span class="n">comp_for</span> <span class="o">|</span> <span class="n">comp_if</span>
<span class="n">comp_if</span>            <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;if&quot;</span> <span class="n">or_test</span> <span class="p">[</span><span class="n">comp_iter</span><span class="p">]</span>
</pre></div>
</div>
<p>The semantics of list and dict displays in Taichi mainly follow Python. Note
that they are evaluated at compile time, so all expressions in <code class="docutils literal notranslate"><span class="pre">comp_for</span></code>,
as well as keys in <code class="docutils literal notranslate"><span class="pre">key_datum</span></code>, are required to be evaluated to Python values.</p>
<p>For example, in the following code snippet, <code class="docutils literal notranslate"><span class="pre">a</span></code> can be successfully defined
while <code class="docutils literal notranslate"><span class="pre">b</span></code> cannot because <code class="docutils literal notranslate"><span class="pre">p</span></code> cannot be evaluated to a Python value at compile
time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">ti</span><span class="o">.</span><span class="n">i32</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>  <span class="c1"># valid</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">i</span> <span class="o">*</span> <span class="n">p</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">)])</span>  <span class="c1"># compile error</span>
</pre></div>
</div>
</section>
</section>
<section id="primaries">
<h3>Primaries<a class="headerlink" href="#primaries" title="Link to this heading">#</a></h3>
<p>Primaries represent the most tightly bound operations.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">primary</span> <span class="p">:</span><span class="o">:=</span> <span class="n">atom</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span> <span class="o">|</span> <span class="n">slicing</span> <span class="o">|</span> <span class="n">call</span>
</pre></div>
</div>
<section id="attribute-references">
<h4>Attribute references<a class="headerlink" href="#attribute-references" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attributeref</span> <span class="p">:</span><span class="o">:=</span> <span class="n">primary</span> <span class="s2">&quot;.&quot;</span> <span class="n">identifier</span>
</pre></div>
</div>
<p>Attribute references are evaluated at compile time. The <code class="docutils literal notranslate"><span class="pre">primary</span></code> must be
evaluated to a Python value with an attribute named <code class="docutils literal notranslate"><span class="pre">identifier</span></code>. Common use
cases in Taichi include metadata queries of
<a class="reference internal" href="../advanced/meta.html#field-metadata"><span class="std std-ref">field</span></a> and
<a class="reference internal" href="../advanced/meta.html#matrix-vector-metadata"><span class="std std-ref">matrices</span></a>.</p>
</section>
<section id="subscriptions">
<h4>Subscriptions<a class="headerlink" href="#subscriptions" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">subscription</span> <span class="p">:</span><span class="o">:=</span> <span class="n">primary</span> <span class="s2">&quot;[&quot;</span> <span class="n">expression_list</span> <span class="s2">&quot;]&quot;</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">primary</span></code> is evaluated to a Python value (e.g., a list or a dictionary),
then all expressions in <code class="docutils literal notranslate"><span class="pre">expression_list</span></code> are required to be evaluated to
Python values, and the subscription is evaluated at compile time following
<a class="reference external" href="https://docs.python.org/3/reference/expressions.html#subscriptions">Python</a>.</p>
<p>Otherwise, <code class="docutils literal notranslate"><span class="pre">primary</span></code> has a Taichi type. All Taichi types excluding primitive
types support subscriptions. You can refer to documentation of these types
for subscription usage.</p>
</section>
<section id="slicings">
<h4>Slicings<a class="headerlink" href="#slicings" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">slicing</span>      <span class="p">:</span><span class="o">:=</span> <span class="n">primary</span> <span class="s2">&quot;[&quot;</span> <span class="n">slice_list</span> <span class="s2">&quot;]&quot;</span>
<span class="n">slice_list</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">slice_item</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">slice_item</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">]</span>
<span class="n">slice_item</span>   <span class="p">:</span><span class="o">:=</span> <span class="n">expression</span> <span class="o">|</span> <span class="n">proper_slice</span>
<span class="n">proper_slice</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="s2">&quot;:&quot;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">[</span> <span class="s2">&quot;:&quot;</span> <span class="p">[</span><span class="n">expression</span><span class="p">]</span> <span class="p">]</span>
</pre></div>
</div>
<p>Currently, slicings are only supported when <code class="docutils literal notranslate"><span class="pre">primary</span></code> has a Taichi matrix type,
and the evaluation happens at compile time.
When <code class="docutils literal notranslate"><span class="pre">slice_item</span></code> is in the form of:</p>
<ul class="simple">
<li><p>a single <code class="docutils literal notranslate"><span class="pre">expression</span></code>: it is required to be evaluated to a Python value
unless <code class="docutils literal notranslate"><span class="pre">ti.init(dynamic_index=True)</span></code> is set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">proper_slice</span></code>: all expressions (the lower bound, the upper bound, and the
stride) inside have to be evaluated to Python values.</p></li>
</ul>
</section>
<section id="calls">
<h4>Calls<a class="headerlink" href="#calls" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">call</span>                 <span class="p">:</span><span class="o">:=</span> <span class="n">primary</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span><span class="n">positional_arguments</span><span class="p">]</span> <span class="s2">&quot;)&quot;</span>
<span class="n">positional_arguments</span> <span class="p">:</span><span class="o">:=</span> <span class="n">positional_item</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">positional_item</span><span class="p">)</span><span class="o">*</span>
<span class="n">positional_item</span>      <span class="p">:</span><span class="o">:=</span> <span class="n">assignment_expression</span> <span class="o">|</span> <span class="s2">&quot;*&quot;</span> <span class="n">expression</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">primary</span></code> must be evaluated to one of:</p>
<ul class="simple">
<li><p>A <a class="reference internal" href="../kernels/kernel_function.html#kernels-and-functions"><span class="std std-ref">Taichi function</span></a>.</p></li>
<li><p>A <a class="reference internal" href="operator.html#other-arithmetic-functions"><span class="std std-ref">Taichi builtin function</span></a>.</p></li>
<li><p>A Taichi primitive type. In this case, the <code class="docutils literal notranslate"><span class="pre">positional_arguments</span></code> must only
contain one item. If the item is evaluated to a Python value, then the
primitive type serves as a type annotation for a literal, and the Python value
will be turned into a Taichi value with that annotated type. Otherwise, the
primitive type serves as a syntax sugar for <code class="docutils literal notranslate"><span class="pre">ti.cast()</span></code>, but the item cannot
have a compound type.</p></li>
<li><p>A Python callable object. If not inside a <a class="reference internal" href="#static-expressions">static expression</a>, a warning is produced.</p></li>
</ul>
</section>
</section>
<section id="the-power-operator">
<h3>The power operator<a class="headerlink" href="#the-power-operator" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">power</span> <span class="p">:</span><span class="o">:=</span> <span class="n">primary</span> <span class="p">[</span><span class="s2">&quot;**&quot;</span> <span class="n">u_expr</span><span class="p">]</span>
</pre></div>
</div>
<p>The power operator has the same semantics as the builtin <code class="docutils literal notranslate"><span class="pre">pow()</span></code> function.</p>
</section>
<section id="unary-arithmetic-and-bitwise-operations">
<h3>Unary arithmetic and bitwise operations<a class="headerlink" href="#unary-arithmetic-and-bitwise-operations" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">u_expr</span> <span class="p">:</span><span class="o">:=</span> <span class="n">power</span> <span class="o">|</span> <span class="s2">&quot;-&quot;</span> <span class="n">power</span> <span class="o">|</span> <span class="s2">&quot;+&quot;</span> <span class="n">power</span> <span class="o">|</span> <span class="s2">&quot;~&quot;</span> <span class="n">power</span>
</pre></div>
</div>
<p>Similar to <a class="reference internal" href="#common-rules-of-binary-operations">rules for binary operations</a>,
if the operand is a Python value, compile-time evaluation is triggered and a
result Python value is produced. Now the remaining case is that the operand is
a Taichi value:</p>
<ul class="simple">
<li><p>If the operand is a primitive type value, the return type is also a primitive
type.</p></li>
<li><p>If the operand is a compound type value, the operator is conducted
element-wise, resulting in a compound type value with same shape.</p></li>
</ul>
<p>See <a class="reference internal" href="operator.html#arithmetic-operators"><span class="std std-ref">arithmetic operators</span></a> and
<a class="reference internal" href="operator.html#bitwise-operators"><span class="std std-ref">bitwise operators</span></a> for operator details.
Note that <code class="docutils literal notranslate"><span class="pre">~</span></code> can only be used with integer type values.</p>
</section>
<section id="binary-arithmetic-operations">
<h3>Binary arithmetic operations<a class="headerlink" href="#binary-arithmetic-operations" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">m_expr</span> <span class="p">:</span><span class="o">:=</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s2">&quot;*&quot;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s2">&quot;@&quot;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s2">&quot;//&quot;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s2">&quot;/&quot;</span> <span class="n">u_expr</span> <span class="o">|</span> <span class="n">m_expr</span> <span class="s2">&quot;%&quot;</span> <span class="n">u_expr</span>
<span class="n">a_expr</span> <span class="p">:</span><span class="o">:=</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s2">&quot;+&quot;</span> <span class="n">m_expr</span> <span class="o">|</span> <span class="n">a_expr</span> <span class="s2">&quot;-&quot;</span> <span class="n">m_expr</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#common-rules-of-binary-operations">common rules for binary operations</a>,
<a class="reference internal" href="../type_system/type.html#implicit-type-casting-in-binary-operations"><span class="std std-ref">implicit type casting in binary operations</span></a>,
and <a class="reference internal" href="operator.html#arithmetic-operators"><span class="std std-ref">arithmetic operators</span></a>. Note that
the <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> operator is for matrix multiplication and only operates on matrix type
arguments.</p>
</section>
<section id="shifting-operations">
<h3>Shifting operations<a class="headerlink" href="#shifting-operations" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">shift_expr</span><span class="p">:</span><span class="o">:=</span> <span class="n">a_expr</span> <span class="o">|</span> <span class="n">shift_expr</span> <span class="p">(</span> <span class="s2">&quot;&lt;&lt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&gt;&gt;&quot;</span> <span class="p">)</span> <span class="n">a_expr</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#common-rules-of-binary-operations">common rules for binary operations</a>,
<a class="reference internal" href="../type_system/type.html#implicit-type-casting-in-binary-operations"><span class="std std-ref">implicit type casting in binary operations</span></a>,
and <a class="reference internal" href="operator.html#bitwise-operators"><span class="std std-ref">bitwise operators</span></a>. Note that both operands
are required to have integer types.</p>
</section>
<section id="binary-bitwise-operations">
<h3>Binary bitwise operations<a class="headerlink" href="#binary-bitwise-operations" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">and_expr</span> <span class="p">:</span><span class="o">:=</span> <span class="n">shift_expr</span> <span class="o">|</span> <span class="n">and_expr</span> <span class="s2">&quot;&amp;&quot;</span> <span class="n">shift_expr</span>
<span class="n">xor_expr</span> <span class="p">:</span><span class="o">:=</span> <span class="n">and_expr</span> <span class="o">|</span> <span class="n">xor_expr</span> <span class="s2">&quot;^&quot;</span> <span class="n">and_expr</span>
<span class="n">or_expr</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">xor_expr</span> <span class="o">|</span> <span class="n">or_expr</span> <span class="s2">&quot;|&quot;</span> <span class="n">xor_expr</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="#common-rules-of-binary-operations">common rules for binary operations</a>,
<a class="reference internal" href="../type_system/type.html#implicit-type-casting-in-binary-operations"><span class="std std-ref">implicit type casting in binary operations</span></a>,
and <a class="reference internal" href="operator.html#bitwise-operators"><span class="std std-ref">bitwise operators</span></a>. Note that both operands
are required to have integer types.</p>
</section>
<section id="comparisons">
<h3>Comparisons<a class="headerlink" href="#comparisons" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">comparison</span>    <span class="p">:</span><span class="o">:=</span> <span class="n">or_expr</span> <span class="p">(</span><span class="n">comp_operator</span> <span class="n">or_expr</span><span class="p">)</span><span class="o">*</span>
<span class="n">comp_operator</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;&lt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;&gt;&quot;</span> <span class="o">|</span> <span class="s2">&quot;==&quot;</span> <span class="o">|</span> <span class="s2">&quot;&gt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;!=&quot;</span> <span class="o">|</span> <span class="p">[</span><span class="s2">&quot;not&quot;</span><span class="p">]</span> <span class="s2">&quot;in&quot;</span>
</pre></div>
</div>
<p>Comparisons can be chained arbitrarily, e.g., <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">&lt;</span> <span class="pre">y</span> <span class="pre">&lt;=</span> <span class="pre">z</span></code> is equivalent to <code class="docutils literal notranslate"><span class="pre">(x</span> <span class="pre">&lt;</span> <span class="pre">y)</span> <span class="pre">&amp;</span> <span class="pre">(y</span> <span class="pre">&lt;=</span> <span class="pre">z)</span></code>.</p>
<section id="value-comparisons">
<h4>Value comparisons<a class="headerlink" href="#value-comparisons" title="Link to this heading">#</a></h4>
<p>See <a class="reference internal" href="#common-rules-of-binary-operations">common rules for binary operations</a>,
<a class="reference internal" href="../type_system/type.html#implicit-type-casting-in-binary-operations"><span class="std std-ref">implicit type casting in binary operations</span></a>,
and <a class="reference internal" href="operator.html#comparison-operators"><span class="std std-ref">comparison operators</span></a>.</p>
</section>
<section id="membership-test-operations">
<h4>Membership test operations<a class="headerlink" href="#membership-test-operations" title="Link to this heading">#</a></h4>
<p>The semantics of membership test operations follow
<a class="reference external" href="https://docs.python.org/3/reference/expressions.html#membership-test-operations">Python</a>,
but they are only supported in <a class="reference internal" href="#static-expressions">static expressions</a>.</p>
</section>
</section>
<section id="boolean-operations">
<h3>Boolean operations<a class="headerlink" href="#boolean-operations" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">or_test</span>  <span class="p">:</span><span class="o">:=</span> <span class="n">and_test</span> <span class="o">|</span> <span class="n">or_test</span> <span class="s2">&quot;or&quot;</span> <span class="n">and_test</span>
<span class="n">and_test</span> <span class="p">:</span><span class="o">:=</span> <span class="n">not_test</span> <span class="o">|</span> <span class="n">and_test</span> <span class="s2">&quot;and&quot;</span> <span class="n">not_test</span>
<span class="n">not_test</span> <span class="p">:</span><span class="o">:=</span> <span class="n">comparison</span> <span class="o">|</span> <span class="s2">&quot;not&quot;</span> <span class="n">not_test</span>
</pre></div>
</div>
<p>When the operator is inside a <a class="reference internal" href="#static-expressions">static expression</a>,
the evaluation rule of the operator follows <a class="reference external" href="https://docs.python.org/3/reference/expressions.html#boolean-operations">Python</a>.
Otherwise, the behavior depends on the <code class="docutils literal notranslate"><span class="pre">short_circuit_operators</span></code> option of <code class="docutils literal notranslate"><span class="pre">ti.init()</span></code>:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">short_circuit_operators</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> (default), a <em>logical and</em> will be
treated as a <em>bitwise AND</em>, and a <em>logical or</em> will be treated as a <em>bitwise
OR</em>. See <a class="reference internal" href="#binary-bitwise-operations">binary bitwise operations</a> for details.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">short_circuit_operators</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code>, the normal short circuiting behavior
is adopted, and the operands are required to be boolean values. Since Taichi
does not have boolean type yet, <code class="docutils literal notranslate"><span class="pre">ti.i32</span></code> is served as a temporary alternative.
A <code class="docutils literal notranslate"><span class="pre">ti.i32</span></code> value is considered <code class="docutils literal notranslate"><span class="pre">False</span></code> if and only if the value is evaluated to 0.</p></li>
</ul>
</section>
<section id="assignment-expressions">
<h3>Assignment expressions<a class="headerlink" href="#assignment-expressions" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assignment_expression</span> <span class="p">:</span><span class="o">:=</span> <span class="p">[</span><span class="n">identifier</span> <span class="s2">&quot;:=&quot;</span><span class="p">]</span> <span class="n">expression</span>
</pre></div>
</div>
<p>An assignment expression assigns an expression to an identifier (see
<a class="reference internal" href="#assignment-statements">assignment statements</a> for more details),
while also returning the value of the expression.</p>
<p>Example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ti</span><span class="o">.</span><span class="n">i32</span><span class="p">:</span>
    <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">:=</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">+=</span> <span class="n">a</span>
    <span class="k">return</span> <span class="n">b</span>
<span class="c1"># the return value should be 12</span>
</pre></div>
</div>
<div class="note docutils">
<p>This operator is supported since Python 3.8.</p>
</div>
</section>
<section id="conditional-expressions">
<h3>Conditional expressions<a class="headerlink" href="#conditional-expressions" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conditional_expression</span> <span class="p">:</span><span class="o">:=</span> <span class="n">or_test</span> <span class="p">[</span><span class="s2">&quot;if&quot;</span> <span class="n">or_test</span> <span class="s2">&quot;else&quot;</span> <span class="n">expression</span><span class="p">]</span>
<span class="n">expression</span>             <span class="p">:</span><span class="o">:=</span> <span class="n">conditional_expression</span>
</pre></div>
</div>
<p>The expression <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">if</span> <span class="pre">C</span> <span class="pre">else</span> <span class="pre">y</span></code> first evaluates the condition, <code class="docutils literal notranslate"><span class="pre">C</span></code> rather than <code class="docutils literal notranslate"><span class="pre">x</span></code>.
If <code class="docutils literal notranslate"><span class="pre">C</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> (the meaning of <code class="docutils literal notranslate"><span class="pre">True</span></code> and <code class="docutils literal notranslate"><span class="pre">False</span></code> has been mentioned at <a class="reference internal" href="#boolean-operations">boolean operations</a>), <code class="docutils literal notranslate"><span class="pre">x</span></code> is evaluated and its value is returned; otherwise,<code class="docutils literal notranslate"><span class="pre">y</span></code> is evaluated and its value is returned.</p>
</section>
<section id="static-expressions">
<h3>Static expressions<a class="headerlink" href="#static-expressions" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">static_expression</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;ti.static(&quot;</span> <span class="n">positional_arguments</span> <span class="s2">&quot;)&quot;</span>
</pre></div>
</div>
<p>Static expressions are expressions that are wrapped by a call to <code class="docutils literal notranslate"><span class="pre">ti.static()</span></code>.
The <code class="docutils literal notranslate"><span class="pre">positional_arguments</span></code> is evaluated at compile time, and the items inside must be evaluated to Python values.</p>
<p><code class="docutils literal notranslate"><span class="pre">ti.static()</span></code> receives one or more arguments.</p>
<ul class="simple">
<li><p>When a single argument is passed in, it returns the argument.</p></li>
<li><p>When multiple arguments are passed in, it returns a tuple containing all the arguments in the same order as they are passed.</p></li>
</ul>
<p>The static expressions work as a mechanism to trigger many metaprogramming functions in Taichi,
such as <a class="reference internal" href="../advanced/meta.html#compile-time-evaluations"><span class="std std-ref">compile-time loop unrolling and compile-time branching</span></a>.</p>
<p>The static expressions can also be used to <a class="reference internal" href="syntax_sugars.html#aliases"><span class="std std-ref">create aliases for Taichi fields and Taichi functions</span></a>.</p>
</section>
<section id="expression-lists">
<h3>Expression lists<a class="headerlink" href="#expression-lists" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression_list</span> <span class="p">:</span><span class="o">:=</span> <span class="n">expression</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">expression</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Except when part of a list display, an expression list containing at least one
comma is evaluated to a tuple at compile time. The component expressions are
evaluated from left to right.</p>
<p>The trailing comma is required only to create a tuple with length 1; it is
optional in all other cases. A single expression without a trailing comma
is evaluated to the value of that expression.</p>
</section>
</section>
<section id="simple-statements">
<h2>Simple statements<a class="headerlink" href="#simple-statements" title="Link to this heading">#</a></h2>
<p>This section explains the syntax and semantics of compound statements in Taichi. A simple statement is comprised within a single logical line. Several simple statements may occur on a single line separated by semicolons.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">simple_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">expression_stmt</span>
                <span class="o">|</span> <span class="n">assert_stmt</span>
                <span class="o">|</span> <span class="n">assignment_stmt</span>
                <span class="o">|</span> <span class="n">augmented_assignment_stmt</span>
                <span class="o">|</span> <span class="n">annotated_assignment_stmt</span>
                <span class="o">|</span> <span class="n">pass_stmt</span>
                <span class="o">|</span> <span class="n">return_stmt</span>
                <span class="o">|</span> <span class="n">break_stmt</span>
                <span class="o">|</span> <span class="n">continue_stmt</span>
</pre></div>
</div>
<section id="expression-statements">
<h3>Expression statements<a class="headerlink" href="#expression-statements" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">expression_stmt</span>    <span class="p">:</span><span class="o">:=</span> <span class="n">expression_list</span>
</pre></div>
</div>
<p>An expression statement evaluates the expression list (which may be a single expression).</p>
</section>
<section id="assignment-statements">
<h3>Assignment statements<a class="headerlink" href="#assignment-statements" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="p">(</span><span class="n">target_list</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span><span class="o">+</span> <span class="n">expression_list</span>
<span class="n">target_list</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">target</span> <span class="p">(</span><span class="s2">&quot;,&quot;</span> <span class="n">target</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span><span class="p">]</span>
<span class="n">target</span>          <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span>
                    <span class="o">|</span> <span class="s2">&quot;(&quot;</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">&quot;)&quot;</span>
                    <span class="o">|</span> <span class="s2">&quot;[&quot;</span> <span class="p">[</span><span class="n">target_list</span><span class="p">]</span> <span class="s2">&quot;]&quot;</span>
                    <span class="o">|</span> <span class="n">attributeref</span>
                    <span class="o">|</span> <span class="n">subscription</span>
</pre></div>
</div>
<p>The recursive definition of an assignment statement basically follows
<a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#assignment-statements">Python</a>,
with the following points to notice:</p>
<ul class="simple">
<li><p>According to the <a class="reference internal" href="#variables-and-scope">Variables and scope</a> section, if a
target is an identifier appearing for the first time, a variable is defined
with that name and inferred type from the corresponding right-hand side
expression. If the expression is evaluated to a Python value, it will be turned
into a Taichi value with <a class="reference internal" href="../type_system/type.html#primitive-types"><span class="std std-ref">default type</span></a>.</p></li>
<li><p>If a target is an existing identifier, the corresponding right-hand side
expression must be evaluated to a Taichi value with the type of the
corresponding variable of that identifier. Otherwise, an implicit cast will
happen.</p></li>
</ul>
<section id="augmented-assignment-statements">
<h4>Augmented assignment statements<a class="headerlink" href="#augmented-assignment-statements" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">augmented_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">augtarget</span> <span class="n">augop</span> <span class="n">expression_list</span>
<span class="n">augtarget</span>                 <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span> <span class="o">|</span> <span class="n">attributeref</span> <span class="o">|</span> <span class="n">subscription</span>
<span class="n">augop</span>                     <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;+=&quot;</span> <span class="o">|</span> <span class="s2">&quot;-=&quot;</span> <span class="o">|</span> <span class="s2">&quot;*=&quot;</span> <span class="o">|</span> <span class="s2">&quot;/=&quot;</span> <span class="o">|</span> <span class="s2">&quot;//=&quot;</span> <span class="o">|</span> <span class="s2">&quot;%=&quot;</span> <span class="o">|</span>
                              <span class="s2">&quot;**=&quot;</span><span class="o">|</span> <span class="s2">&quot;&gt;&gt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&lt;&lt;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;&amp;=&quot;</span> <span class="o">|</span> <span class="s2">&quot;^=&quot;</span> <span class="o">|</span> <span class="s2">&quot;|=&quot;</span>
</pre></div>
</div>
<p>Different from <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#augmented-assignment-statements">Python</a>, some augmented assignments (e.g., <code class="docutils literal notranslate"><span class="pre">x[i]</span> <span class="pre">+=</span> <span class="pre">1</span></code>) are <a class="reference internal" href="operator.html#supported-atomic-operations"><span class="std std-ref">automatically atomic</span></a> in Taichi.</p>
</section>
<section id="annotated-assignment-statements">
<h4>Annotated assignment statements<a class="headerlink" href="#annotated-assignment-statements" title="Link to this heading">#</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">annotated_assignment_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">identifier</span> <span class="s2">&quot;:&quot;</span> <span class="n">expression</span> <span class="s2">&quot;=&quot;</span> <span class="n">expression</span>
</pre></div>
</div>
<p>The differences from normal <a class="reference internal" href="#assignment-statements">assignment statements</a> are:</p>
<ul class="simple">
<li><p>Only single identifier target is allowed.</p></li>
<li><p>If the identifier appears for the first time, a variable is defined
with that name and type annotation (the expression after “:”). The right-hand
side expression is cast to a Taichi value with the annotated type.</p></li>
<li><p>If the identifier already exists, the type annotation must be the same as the
type of the corresponding variable of the identifier.</p></li>
</ul>
</section>
</section>
<section id="the-assert-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement<a class="headerlink" href="#the-assert-statement" title="Link to this heading">#</a></h3>
<p>Assert statements are a convenient way to insert debugging assertions into a program:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">assert_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;assert&quot;</span> <span class="n">expression</span> <span class="p">[</span><span class="s2">&quot;,&quot;</span> <span class="n">expression</span><span class="p">]</span>
</pre></div>
</div>
<p>Assert statements are currently supported on the CPU, CUDA, and Metal backends.</p>
<p>Assert statements only work in debug mode (when <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> is set in the arguments of <code class="docutils literal notranslate"><span class="pre">ti.init()</span></code>),
otherwise they are equivalent to no-op.</p>
<p>The simple form, <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">expression</span></code>, raises <code class="docutils literal notranslate"><span class="pre">TaichiAssertionError</span></code> (which is a subclass of <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>)
when <code class="docutils literal notranslate"><span class="pre">expression</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">False</span></code>, with the code of <code class="docutils literal notranslate"><span class="pre">expression</span></code> as the error message.</p>
<p>The extended form, <code class="docutils literal notranslate"><span class="pre">assert</span> <span class="pre">expression1,</span> <span class="pre">expression2</span></code>, raises <code class="docutils literal notranslate"><span class="pre">TaichiAssertionError</span></code> when <code class="docutils literal notranslate"><span class="pre">expression1</span></code> is equal to <code class="docutils literal notranslate"><span class="pre">False</span></code>,
with <code class="docutils literal notranslate"><span class="pre">expression2</span></code> as the error message. <code class="docutils literal notranslate"><span class="pre">expression2</span></code> must be a constant or a formatted string. The variables in the
formatted string must be scalars.</p>
</section>
<section id="the-pass-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement<a class="headerlink" href="#the-pass-statement" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pass_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;pass&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">pass</span></code> is a null operation — when it is executed, nothing happens.
It is useful as a placeholder when a statement is required syntactically, but no code needs to be executed.</p>
</section>
<section id="the-return-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">return</span></code> statement<a class="headerlink" href="#the-return-statement" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">return_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;return&quot;</span> <span class="p">[</span><span class="n">expression_list</span><span class="p">]</span>
</pre></div>
</div>
<p>The return statement may only occur once in a Taichi kernel or a Taichi function,
and it must be at the bottom of the function body.
Note that this is subject to change, and Taichi might relax it in the future.</p>
<p>If a Taichi kernel or Taichi function has a return type hint,
it must have a return statement that returns a value other than <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>If a Taichi kernel has a return statement that returns a value other than <code class="docutils literal notranslate"><span class="pre">None</span></code>, it must have a return type hint.
The return type hint for Taichi function is optional but recommended.
Note that this is subject to change, and Taichi might enforce it in the future.</p>
<p>A kernel can have at most one return value, which can be a scalar, <code class="docutils literal notranslate"><span class="pre">ti.Matrix</span></code>, or <code class="docutils literal notranslate"><span class="pre">ti.Vector</span></code>,
and the number of elements in the return value must not exceed 30.
Note that this number is an implementation detail, and Taichi might relax it in the future.</p>
<p>A Taichi function can have multiple return values in a return statement,
and the return values can be scalar, <code class="docutils literal notranslate"><span class="pre">ti.Vector</span></code>, <code class="docutils literal notranslate"><span class="pre">ti.Matrix</span></code>, <code class="docutils literal notranslate"><span class="pre">ti.Struct</span></code>, and more.</p>
</section>
<section id="the-break-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">break</span></code> statement<a class="headerlink" href="#the-break-statement" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">break_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;break&quot;</span>
</pre></div>
</div>
<p>The break statement may only occur syntactically nested in a for or while loop, and it terminates the nearest enclosing loop.</p>
<p>Break statement is not allowed when the nearest enclosing loop is a parallel range/ndrange for loop,
a struct for loop, or a mesh for loop.</p>
</section>
<section id="the-continue-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement<a class="headerlink" href="#the-continue-statement" title="Link to this heading">#</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">continue_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;continue&quot;</span>
</pre></div>
</div>
<p>The continue statement may only occur syntactically nested in a for or while loop,
and it continues with the next cycle of the nearest enclosing loop.</p>
</section>
</section>
<section id="compound-statements">
<h2>Compound statements<a class="headerlink" href="#compound-statements" title="Link to this heading">#</a></h2>
<p>This section explains the syntax and semantics of compound statements in Taichi.</p>
<p>A compound statement consists of one or more <em>clauses</em>.
A <em>clause</em> consists of a header and a <em>suite</em>.
The <em>clause headers</em> of a particular compound statement are all at the same indentation level.
Each <em>clause header</em> begins with a uniquely identifying keyword and ends with a colon.
A <em>suite</em> is a group of statements controlled by a <em>clause</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">compound_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="n">if_stmt</span> <span class="o">|</span> <span class="n">while_stmt</span> <span class="o">|</span> <span class="n">for_stmt</span>
<span class="n">suite</span>         <span class="p">:</span><span class="o">:=</span> <span class="n">stmt_list</span> <span class="n">NEWLINE</span> <span class="o">|</span> <span class="n">NEWLINE</span> <span class="n">INDENT</span> <span class="n">statement</span><span class="o">+</span> <span class="n">DEDENT</span>
<span class="n">statement</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">stmt_list</span> <span class="n">NEWLINE</span> <span class="o">|</span> <span class="n">compound_stmt</span>
<span class="n">stmt_list</span>     <span class="p">:</span><span class="o">:=</span> <span class="n">simple_stmt</span> <span class="p">(</span><span class="s2">&quot;;&quot;</span> <span class="n">simple_stmt</span><span class="p">)</span><span class="o">*</span> <span class="p">[</span><span class="s2">&quot;;&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>The difference between the compound statements in Taichi and Python is that Taichi introduces
compile time evaluation. If the expression in the <em>clause header</em> is a static expression,
Taichi replaces the compound statement at compile time according to the evaluation result of the expression.</p>
<section id="the-if-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">if</span></code> statement<a class="headerlink" href="#the-if-statement" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">if</span></code> statement is used for conditional execution:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">if_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;if&quot;</span> <span class="p">(</span><span class="n">static_expression</span> <span class="o">|</span> <span class="n">assignment_expression</span><span class="p">)</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
            <span class="p">(</span><span class="s2">&quot;elif&quot;</span> <span class="p">(</span><span class="n">static_expression</span> <span class="o">|</span> <span class="n">assignment_expression</span><span class="p">)</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span><span class="p">)</span><span class="o">*</span>
            <span class="p">[</span><span class="s2">&quot;else&quot;</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span><span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">elif</span></code> <em>clause</em> is a syntax sugar for a <code class="docutils literal notranslate"><span class="pre">if</span></code> statement inside a <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em>.
For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">cond_a</span><span class="p">:</span>
    <span class="n">body_a</span>
<span class="k">elif</span> <span class="n">cond_b</span><span class="p">:</span>
    <span class="n">body_b</span>
<span class="k">elif</span> <span class="n">cond_c</span><span class="p">:</span>
    <span class="n">body_c</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">body_d</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">cond_a</span><span class="p">:</span>
    <span class="n">body_a</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">cond_b</span><span class="p">:</span>
        <span class="n">body_b</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cond_c</span><span class="p">:</span>
            <span class="n">body_c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">body_d</span>
</pre></div>
</div>
<p>Taichi first transforms <code class="docutils literal notranslate"><span class="pre">elif</span></code> <em>clause</em> as above, and then deal with the <code class="docutils literal notranslate"><span class="pre">if</span></code> statement with only an <code class="docutils literal notranslate"><span class="pre">if</span></code> <em>clause</em> and possibly an <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em> as below.</p>
<p>If the expression of the <code class="docutils literal notranslate"><span class="pre">if</span></code> <em>clause</em> is found to be true (see section <a class="reference internal" href="#boolean-operations">Boolean operations</a> for the definition of true and false),
the <em>suite</em> of the <code class="docutils literal notranslate"><span class="pre">if</span></code> <em>clause</em> is executed. Otherwise, the <em>suite</em> of the <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em>, if present, is executed.</p>
<p>An <code class="docutils literal notranslate"><span class="pre">if</span></code> statement whose expression is a static expression is called a static <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.
The expression of a static <code class="docutils literal notranslate"><span class="pre">if</span></code> <em>clause</em> is evaluated at compile time, and it replaces the compound statement as below at compile time.</p>
<ul class="simple">
<li><p>If the static expression is found to be true, the <em>suite</em> of the <code class="docutils literal notranslate"><span class="pre">if</span></code> <em>clause</em> replaces the static <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p></li>
<li><p>If the static expression is found to be false, and there is an <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em>, the <em>suite</em> of the <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em> replaces the static <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p></li>
<li><p>If the static expression is found to be false, and there is no <code class="docutils literal notranslate"><span class="pre">else</span></code> <em>clause</em>, a <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement replaces the static <code class="docutils literal notranslate"><span class="pre">if</span></code> statement.</p></li>
</ul>
</section>
<section id="the-while-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">while</span></code> statement<a class="headerlink" href="#the-while-statement" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">while</span></code> statement is used for repeated execution as long as an expression is true:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">while_stmt</span> <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;while&quot;</span> <span class="n">assignment_expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
</pre></div>
</div>
<p>This repeatedly tests the expression and, if it is true, executes the <em>suite</em>;
if the expression is false (which may be the first time it is tested) the loop terminates.</p>
<p>A <a class="reference internal" href="#the-break-statement"><code class="docutils literal notranslate"><span class="pre">break</span></code> statement</a> executed in the <em>suite</em> terminates the loop.
A <a class="reference internal" href="#the-continue-statement"><code class="docutils literal notranslate"><span class="pre">continue</span></code> statement</a> executed in the <em>suite</em> skips the rest of the <em>suite</em> and
goes back to testing the expression.</p>
</section>
<section id="the-for-statement">
<h3>The <code class="docutils literal notranslate"><span class="pre">for</span></code> statement<a class="headerlink" href="#the-for-statement" title="Link to this heading">#</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">for</span></code> statement in Taichi is used to iterate over a range of numbers, multidimensional ranges, or the indices of elements in a field.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">for_stmt</span>        <span class="p">:</span><span class="o">:=</span> <span class="s2">&quot;for&quot;</span> <span class="n">target_list</span> <span class="s2">&quot;in&quot;</span> <span class="n">iter_expression</span> <span class="s2">&quot;:&quot;</span> <span class="n">suite</span>
<span class="n">iter_expression</span> <span class="p">:</span><span class="o">:=</span> <span class="n">static_expression</span> <span class="o">|</span> <span class="n">expression</span>
</pre></div>
</div>
<p>Taichi does not support <code class="docutils literal notranslate"><span class="pre">else</span></code> clause in <code class="docutils literal notranslate"><span class="pre">for</span></code> statements.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">for</span></code> loops can iterate in parallel if they are in the outermost scope.
When a <code class="docutils literal notranslate"><span class="pre">for</span></code> loop is parallelized, the order of iteration is not determined,
and it cannot be terminated by <code class="docutils literal notranslate"><span class="pre">break</span></code> statements.</p>
<p>Taichi uses <code class="docutils literal notranslate"><span class="pre">ti.loop_config</span></code> function to set directives for the loop right after it.
You can write <code class="docutils literal notranslate"><span class="pre">ti.loop_config(serialize=True)</span></code> before a range/ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> loop to let it run serially,
then it can be terminated by <code class="docutils literal notranslate"><span class="pre">break</span></code> statements.</p>
<p>There are four kinds of <code class="docutils literal notranslate"><span class="pre">for</span></code> statements:</p>
<ul class="simple">
<li><p>The range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</p></li>
<li><p>The ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</p></li>
<li><p>The struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</p></li>
<li><p>The static <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</p></li>
</ul>
<section id="the-range-for-statement">
<h4>The range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement<a class="headerlink" href="#the-range-for-statement" title="Link to this heading">#</a></h4>
<p>The range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement iterates over a range of numbers.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> of range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be like <code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code> or <code class="docutils literal notranslate"><span class="pre">range(stop)</span></code>,
and they mean the same as <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#range">the Python <code class="docutils literal notranslate"><span class="pre">range</span></code> function</a>,
except that the <code class="docutils literal notranslate"><span class="pre">step</span></code> argument is not supported.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_list</span></code> of range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be an identifier which
is not occupied in the current scope.</p>
<p>The range <code class="docutils literal notranslate"><span class="pre">for</span></code> loops are by default parallelized when the loops are in the outermost scope.</p>
</section>
<section id="the-ndrange-for-statement">
<h4>The ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement<a class="headerlink" href="#the-ndrange-for-statement" title="Link to this heading">#</a></h4>
<p>The ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> iterates over multidimensional ranges.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> of ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be a call to <code class="docutils literal notranslate"><span class="pre">ti.ndrange()</span></code> or a nested call to <code class="docutils literal notranslate"><span class="pre">ti.grouped(ti.ndrange())</span></code>.</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> is a call to <code class="docutils literal notranslate"><span class="pre">ti.range()</span></code>, it is a normal ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> is a call to <code class="docutils literal notranslate"><span class="pre">ti.grouped(ti.range())</span></code>, it is a grouped ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p></li>
</ul>
<p>You can use grouped <code class="docutils literal notranslate"><span class="pre">for</span></code> loops to write <a class="reference internal" href="../advanced/meta.html#dimensionality-independent-programming-using-grouped-indices"><span class="std std-ref">dimensionality-independent programs</span></a>.</p>
<p><code class="docutils literal notranslate"><span class="pre">ti.ndrange</span></code> receives arbitrary numbers of arguments.
The k-th argument represents the iteration range of the k-th dimension,
and the loop iterates over the <a class="reference external" href="https://en.wikipedia.org/wiki/Direct_product">direct product</a> of the iteration range of each dimension.</p>
<p>Every argument must be an integer or a tuple of two integers.</p>
<ul class="simple">
<li><p>If the k-th argument is an integer <code class="docutils literal notranslate"><span class="pre">stop</span></code>, the range of the k-th dimension
is equivalent to the range of <code class="docutils literal notranslate"><span class="pre">range(stop)</span></code> in Python.</p></li>
<li><p>If the k-th argument is a tuple of two integers <code class="docutils literal notranslate"><span class="pre">(start,</span> <span class="pre">stop)</span></code>, the range of the k-th dimension
is equivalent to the range of <code class="docutils literal notranslate"><span class="pre">range(start,</span> <span class="pre">stop)</span></code> in Python.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">target_list</span></code> of an n-dimensional normal ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be n different identifiers which
are not occupied in the current scope, and the k-th identifier is assigned an integer which is the loop variable of the k-th dimension.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_list</span></code> of an n-dimensional grouped ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be one identifier which
is not occupied in the current scope, and the identifier is assigned a <code class="docutils literal notranslate"><span class="pre">ti.Vector</span></code> with length n, which contains the loop variables of all n dimensions.</p>
<p>The ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> loops are by default parallelized when the loops are in the outermost scope.</p>
</section>
<section id="the-struct-for-statement">
<h4>The struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement<a class="headerlink" href="#the-struct-for-statement" title="Link to this heading">#</a></h4>
<p>The struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement iterates over every active elements in a Taichi field.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> of a struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be a Taichi field or a call to <code class="docutils literal notranslate"><span class="pre">ti.grouped(x)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is a Taichi field.</p>
<ul class="simple">
<li><p>If the <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> is a Taichi field, it is a normal struct <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> is a call to <code class="docutils literal notranslate"><span class="pre">ti.grouped(x)</span></code> where <code class="docutils literal notranslate"><span class="pre">x</span></code> is a Taichi field, it is a grouped struct <code class="docutils literal notranslate"><span class="pre">for</span></code>.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">target_list</span></code> of a normal struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement on an n-dimensional field must be n different identifiers which
are not occupied in the current scope, and the k-th identifier is assigned an integer which is the loop variable of the k-th dimension.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_list</span></code> of a grouped struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement on an n-dimensional field must be one identifier which
is not occupied in the current scope, and the identifier is assigned a <code class="docutils literal notranslate"><span class="pre">ti.Vector</span></code> with length n, which contains the loop variables of all n dimensions.</p>
<p>The struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement must be at the outermost scope of the kernel,
and it cannot be terminated by a <code class="docutils literal notranslate"><span class="pre">break</span></code> statement even when it is run serially.</p>
</section>
<section id="the-static-for-statement">
<h4>The static <code class="docutils literal notranslate"><span class="pre">for</span></code> statement<a class="headerlink" href="#the-static-for-statement" title="Link to this heading">#</a></h4>
<p>The static <code class="docutils literal notranslate"><span class="pre">for</span></code> statement unrolls a range/ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> loop at compile time.</p>
<p>If the <code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> of the <code class="docutils literal notranslate"><span class="pre">for</span></code> statement is a <a class="reference internal" href="#static-expressions"><code class="docutils literal notranslate"><span class="pre">static_expression</span></code></a>,
the <code class="docutils literal notranslate"><span class="pre">for</span></code> statement is a static <code class="docutils literal notranslate"><span class="pre">for</span></code> statement.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">positional_arguments</span></code> of the <code class="docutils literal notranslate"><span class="pre">static_expression</span></code> must meet the requirement on
<code class="docutils literal notranslate"><span class="pre">iter_expression</span></code> of the range/ndrange for.</p>
<p>For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ti</span><span class="o">.</span><span class="n">static</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
<p>is unrolled to</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>at compile time.</p>
</section>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="global_settings.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Global Settings</p>
      </div>
    </a>
    <a class="right-next"
       href="operator.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Operators</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-concepts">Basic concepts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#values-and-types">Values and types</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variables-and-scope">Variables and scope</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#common-rules-of-binary-operations">Common rules of binary operations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expressions">Expressions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#atoms">Atoms</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#identifiers-names">Identifiers (Names)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#literals">Literals</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#parenthesized-forms">Parenthesized forms</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#list-and-dictionary-displays">List and dictionary displays</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#primaries">Primaries</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attribute-references">Attribute references</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#subscriptions">Subscriptions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#slicings">Slicings</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calls">Calls</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-power-operator">The power operator</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#unary-arithmetic-and-bitwise-operations">Unary arithmetic and bitwise operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-arithmetic-operations">Binary arithmetic operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#shifting-operations">Shifting operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-bitwise-operations">Binary bitwise operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparisons">Comparisons</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#value-comparisons">Value comparisons</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#membership-test-operations">Membership test operations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#boolean-operations">Boolean operations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assignment-expressions">Assignment expressions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conditional-expressions">Conditional expressions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#static-expressions">Static expressions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expression-lists">Expression lists</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simple-statements">Simple statements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#expression-statements">Expression statements</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assignment-statements">Assignment statements</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#augmented-assignment-statements">Augmented assignment statements</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#annotated-assignment-statements">Annotated assignment statements</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-assert-statement">The <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-pass-statement">The <code class="docutils literal notranslate"><span class="pre">pass</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-return-statement">The <code class="docutils literal notranslate"><span class="pre">return</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-break-statement">The <code class="docutils literal notranslate"><span class="pre">break</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-continue-statement">The <code class="docutils literal notranslate"><span class="pre">continue</span></code> statement</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compound-statements">Compound statements</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-if-statement">The <code class="docutils literal notranslate"><span class="pre">if</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-while-statement">The <code class="docutils literal notranslate"><span class="pre">while</span></code> statement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-for-statement">The <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-range-for-statement">The range <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-ndrange-for-statement">The ndrange <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-struct-for-statement">The struct <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-static-for-statement">The static <code class="docutils literal notranslate"><span class="pre">for</span></code> statement</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/user_guide/reference/language_reference.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023 Taichi Graphics Inc; 2025 Genesis AI Inc.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>