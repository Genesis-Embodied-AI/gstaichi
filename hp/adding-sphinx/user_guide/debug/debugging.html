
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Debugging &#8212; Taichi 1.8.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=b51e6972"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/debug/debugging';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="1.8.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Taichi 1.8.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autoapi/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../autoapi/index.html">
    API Reference
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Debugging</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="debugging">
<h1>Debugging<a class="headerlink" href="#debugging" title="Link to this heading">#</a></h1>
<p>To aid with debugging your parallel programs, Taichi has the following mechanisms:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">print</span></code> in the Taichi scope checks the value of a variable.</p></li>
<li><p>Serialization of your program or a specific parallel for loop.</p></li>
<li><p>Activated with <code class="docutils literal notranslate"><span class="pre">ti.init(debug=True)</span></code>, debug mode detects out-of-bound array accesses.</p></li>
<li><p>Static or non-static <code class="docutils literal notranslate"><span class="pre">assert</span></code> verifies an assertion condition at compile time or runtime respectively.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sys.tracebacklimit</span></code> produces a conciser traceback.</p></li>
</ol>
<section id="runtime-print-in-taichi-scope">
<h2>Runtime <code class="docutils literal notranslate"><span class="pre">print</span></code> in Taichi scope<a class="headerlink" href="#runtime-print-in-taichi-scope" title="Link to this heading">#</a></h2>
<p>One of the most naive ways to debug code is to print particular messages to check how your code runs in different states. You can call <code class="docutils literal notranslate"><span class="pre">print()</span></code> in the Taichi scope to debug your program:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>When passed into a runtime <code class="docutils literal notranslate"><span class="pre">print()</span></code> in the Taichi scope, <code class="docutils literal notranslate"><span class="pre">args</span></code> can take string literal, scalar, vector, and matrix expressions.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">inside_taichi_scope</span><span class="p">():</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="c1">#=&gt; hello 256</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">200</span><span class="p">)</span>
    <span class="c1">#=&gt; hello 712</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1">#=&gt; hello256</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;world&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1">#=&gt; hello256world256</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">]])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m =&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
    <span class="c1">#=&gt; m = [[2, 3, 4], [5, 6, 7]]</span>

    <span class="n">v</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;v =&#39;</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
    <span class="c1">#=&gt; v = [3, 4]</span>

    <span class="n">ray</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Struct</span><span class="p">({</span>
    	<span class="s2">&quot;ori&quot;</span><span class="p">:</span> <span class="n">ti</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
    	<span class="s2">&quot;dir&quot;</span><span class="p">:</span> <span class="n">ti</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]),</span>
    	<span class="s2">&quot;len&quot;</span><span class="p">:</span> <span class="mf">1.0</span>
		<span class="p">})</span>
    <span class="c1"># print(ray)</span>
    <span class="c1"># Print a struct directly in Taichi-scope has not been supported yet</span>
    <span class="c1"># Instead, use:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ray.ori =&#39;</span><span class="p">,</span> <span class="n">ray</span><span class="o">.</span><span class="n">ori</span><span class="p">,</span> <span class="s1">&#39;, ray.dir =&#39;</span><span class="p">,</span> <span class="n">ray</span><span class="o">.</span><span class="n">dir</span><span class="p">,</span> <span class="s1">&#39;, ray.len =&#39;</span><span class="p">,</span> <span class="n">ray</span><span class="o">.</span><span class="n">len</span><span class="p">)</span>
    <span class="c1">#=&gt; ray.ori = [0.0, 0.0, 0.0], ray.dir = [0.0, 0.0, 1.0], ray.len = 1.0</span>
</pre></div>
</div>
<section id="applicable-backends">
<h3>Applicable backends<a class="headerlink" href="#applicable-backends" title="Link to this heading">#</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">print</span></code> in the Taichi scope is supported on the CPU, CUDA, and Vulkan backends only.</p>
<div class="note docutils">
<p>To enable printing on Vulkan, please</p>
<ul class="simple">
<li><p>make sure the validation layer is installed via <a class="reference external" href="https://vulkan.lunarg.com/sdk/home">vulkan sdk</a>.</p></li>
<li><p>turn on debug mode via <code class="docutils literal notranslate"><span class="pre">ti.init(debug=True)</span></code>.</p></li>
</ul>
<p><strong>Printing is not supported on the macOS Vulkan backend.</strong></p>
</div>
</section>
<section id="printing-comma-separated-strings-f-strings-or-formatted-strings">
<h3>Printing comma-separated strings, f-strings, or formatted strings<a class="headerlink" href="#printing-comma-separated-strings-f-strings-or-formatted-strings" title="Link to this heading">#</a></h3>
<p>In Taichi scope, you can print both scalar and matrix values using the <code class="docutils literal notranslate"><span class="pre">print</span></code> function. There are multiple ways to format your output, including comma-separated strings, f-strings, and formatted strings via the <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> method.</p>
<p>For instance, suppose you have a scalar field <code class="docutils literal notranslate"><span class="pre">a</span></code> and want to print its value. Here are some examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>
<span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">f32</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">print_scalar</span><span class="p">():</span>
    <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># comma-separated string</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a[0] =&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># f-string</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a[0] = </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># with format specifier</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a[0] = </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># without conversion</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a[0] = </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># with self-documenting expressions (Python 3.8+)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="si">= :</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># formatted string via `str.format()` method</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a[0] = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># with format specifier</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a[0] = </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># without conversion</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a[0] = </span><span class="si">{:.1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="c1"># with positional arguments</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a[3] = </span><span class="si">{3:.3f}</span><span class="s1">, a[2] = </span><span class="si">{2:.2f}</span><span class="s1">, a[1] = </span><span class="si">{1:.1f}</span><span class="s1">, a[0] = </span><span class="si">{0:.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
</pre></div>
</div>
<p>If you have a matrix field m, you can print it as well. Here are some examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">print_matrix</span><span class="p">():</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([[</span><span class="mf">2e1</span><span class="p">,</span> <span class="mf">3e2</span><span class="p">,</span> <span class="mf">4e3</span><span class="p">],</span> <span class="p">[</span><span class="mf">5e4</span><span class="p">,</span> <span class="mf">6e5</span><span class="p">,</span> <span class="mf">7e6</span><span class="p">]],</span> <span class="n">ti</span><span class="o">.</span><span class="n">f32</span><span class="p">)</span>

    <span class="c1"># comma-separated string</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m =&#39;</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>

    <span class="c1"># f-string</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;m = </span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># with format specifier</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;m = </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># without conversion</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;m = </span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s1">.1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># with self-documenting expressions</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="w"> </span><span class="si">= :</span><span class="s1">g</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># formatted string via `str.format()` method</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="c1"># with format specifier</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m = </span><span class="si">{:e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="c1"># without conversion</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;m = </span><span class="si">{:.1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
</pre></div>
</div>
<div class="note docutils">
<p>Building formatted strings using the % operator is currently <strong>not</strong> supported in Taichi.</p>
</div>
</section>
</section>
<section id="compile-time-ti-static-print">
<h2>Compile-time <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code><a class="headerlink" href="#compile-time-ti-static-print" title="Link to this heading">#</a></h2>
<p>It can be useful to print Python objects and their properties like data types or SNodes in the Taichi scope. Similar to <code class="docutils literal notranslate"><span class="pre">ti.static</span></code>, which makes the compiler evaluate an argument at compile time (see the <a class="reference internal" href="../advanced/meta.html"><span class="std std-doc">Metaprogramming</span></a> for more information), <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code> prints compile-time constants in the Taichi scope:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">f32</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="mi">1</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">inside_taichi_scope</span><span class="p">():</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_print</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="c1"># =&gt; 1</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># =&gt; (2, 3)</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_print</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
    <span class="c1"># =&gt; DataType.float32</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="n">ti</span><span class="o">.</span><span class="n">static_print</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># =&gt; DataType.int32</span>
        <span class="c1"># Only print once</span>
</pre></div>
</div>
<p>In the Taichi scope, <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code> acts similarly to <code class="docutils literal notranslate"><span class="pre">print</span></code>. But unlike <code class="docutils literal notranslate"><span class="pre">print</span></code>, <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code> outputs the expression only once at compile time, incurring no runtime penalty.</p>
</section>
<section id="serial-execution">
<h2>Serial execution<a class="headerlink" href="#serial-execution" title="Link to this heading">#</a></h2>
<p>Because threads are processed in random order, Taichi’s automated parallelization may result in non-deterministic behaviour. Serializing program execution may be advantageous for debugging purposes, such as achieving reproducible results or identifying data races. You have the option of serialising the complete Taichi program or a single for loop.</p>
<section id="serialize-an-entire-taichi-program">
<h3>Serialize an entire Taichi program<a class="headerlink" href="#serialize-an-entire-taichi-program" title="Link to this heading">#</a></h3>
<p>If you choose CPU as the backend, you can set <code class="docutils literal notranslate"><span class="pre">cpu_max_num_threads=1</span></code> when initializing Taichi to serialize the program. Then the program runs on a single thread and its behavior becomes deterministic. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">cpu_max_num_threads</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If your program works well in serial but fails in parallel, check if there are parallelization-related issues, such as <em>data races</em>.</p>
</section>
<section id="serialize-a-specified-parallel-for-loop">
<h3>Serialize a specified parallel for loop<a class="headerlink" href="#serialize-a-specified-parallel-for-loop" title="Link to this heading">#</a></h3>
<p>By default, Taichi automatically parallelizes the for loops at the outermost scope in a Taichi kernel. But some scenarios require serial execution. In this case, you can prevent automatic parallelization with <code class="docutils literal notranslate"><span class="pre">ti.loop_config(serialize=True)</span></code>. Note that only the outermost for loop that immediately follows this line is serialized. To illustrate:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>

<span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">1024</span>
<span class="n">val</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">i32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

<span class="n">val</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">prefix_sum</span><span class="p">():</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">loop_config</span><span class="p">(</span><span class="n">serialize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Serializes the next for loop</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>  <span class="c1"># Parallel for loop</span>
	    <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>

<span class="n">prefix_sum</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
</pre></div>
</div>
<div class="note docutils">
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ti.loop_config</span></code> works only for the <em>range-for</em> loop at the outermost scope.</p></li>
</ul>
</div>
</section>
</section>
<section id="out-of-bound-array-access">
<h2>Out-of-bound array access<a class="headerlink" href="#out-of-bound-array-access" title="Link to this heading">#</a></h2>
<p>The array index out of bounds error occurs frequently. However, Taichi disables bounds checking by default and continues without generating a warning. As a result, a program with such an issue may provide incorrect results or possibly cause segmentation faults, making debugging difficult.</p>
<p>Taichi detects array index out of bound errors in debug mode. You can activate this mode by setting <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> in the <code class="docutils literal notranslate"><span class="pre">ti.init()</span></code> call:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>
<span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">i32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">test</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">ti</span><span class="o">.</span><span class="n">i32</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">73</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">test</span><span class="p">())</span>
</pre></div>
</div>
<p>The code snippet above raises a <code class="docutils literal notranslate"><span class="pre">TaichiAssertionError</span></code> because you are trying to access elements from a field of shape (32, 32) with indices <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">73]</span></code>.</p>
<div class="note docutils">
<p>Automatic bound checks are supported on the CPU and CUDA beckends only.</p>
<p>Your program performance may worsen if you set <code class="docutils literal notranslate"><span class="pre">debug=True</span></code>.</p>
</div>
</section>
<section id="runtime-assert-in-taichi-scope">
<h2>Runtime <code class="docutils literal notranslate"><span class="pre">assert</span></code> in Taichi scope<a class="headerlink" href="#runtime-assert-in-taichi-scope" title="Link to this heading">#</a></h2>
<p>You can use <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements in the Taichi scope to verify the assertion conditions. If an assertion fails, the program throws a <code class="docutils literal notranslate"><span class="pre">TaichiAssertionError</span></code>.</p>
<div class="note docutils">
<p><code class="docutils literal notranslate"><span class="pre">assert</span></code> is currently supported on the CPU, CUDA, and Metal backends.</p>
</div>
<p>Ensure that you activate <code class="docutils literal notranslate"><span class="pre">debug</span></code> mode before using <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements in the Taichi scope:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>
<span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">arch</span><span class="o">=</span><span class="n">ti</span><span class="o">.</span><span class="n">cpu</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">ti</span><span class="o">.</span><span class="n">f32</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
<span class="n">x</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">do_sqrt_all</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">-th element cannot be negative&quot;</span>
        <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ti</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">do_sqrt_all</span><span class="p">()</span>
</pre></div>
</div>
<p>When you are done with debugging, set <code class="docutils literal notranslate"><span class="pre">debug=False</span></code>. Then, the program ignores all <code class="docutils literal notranslate"><span class="pre">assert</span></code> statements in the Taichi scope, which can avoid additional runtime overhead.</p>
</section>
<section id="compile-time-ti-static-assert">
<h2>Compile-time <code class="docutils literal notranslate"><span class="pre">ti.static_assert</span></code><a class="headerlink" href="#compile-time-ti-static-assert" title="Link to this heading">#</a></h2>
<p>Besides <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code>, Taichi also provides a static version of <code class="docutils literal notranslate"><span class="pre">assert</span></code>: <code class="docutils literal notranslate"><span class="pre">ti.static_assert</span></code>, which may be used to create assertions on data types, dimensionality, and shapes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ti</span><span class="o">.</span><span class="n">static_assert</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>It works whether or not <code class="docutils literal notranslate"><span class="pre">debug=True</span></code> is used. A false <code class="docutils literal notranslate"><span class="pre">ti.static_assert</span></code> statement, like a false <code class="docutils literal notranslate"><span class="pre">assert</span></code> statement in the Python scope, causes an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>, as shown below:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">func</span>
<span class="k">def</span><span class="w"> </span><span class="nf">copy</span><span class="p">(</span><span class="n">dst</span><span class="p">:</span> <span class="n">ti</span><span class="o">.</span><span class="n">template</span><span class="p">(),</span> <span class="n">src</span><span class="p">:</span> <span class="n">ti</span><span class="o">.</span><span class="n">template</span><span class="p">()):</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_assert</span><span class="p">(</span><span class="n">dst</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">src</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;copy() needs src and dst fields to be same shape&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">I</span> <span class="ow">in</span> <span class="n">ti</span><span class="o">.</span><span class="n">grouped</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
        <span class="n">dst</span><span class="p">[</span><span class="n">I</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">I</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="conciser-tracebacks-in-taichi-scope">
<h2>Conciser tracebacks in Taichi scope<a class="headerlink" href="#conciser-tracebacks-in-taichi-scope" title="Link to this heading">#</a></h2>
<p>Taichi reports the traceback of an error in the <strong>Taichi scope</strong>. For example, the code snippet below triggers an <code class="docutils literal notranslate"><span class="pre">AssertionError</span></code>, with a lengthy traceback message:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>
<span class="n">ti</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">func</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func3</span><span class="p">():</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_assert</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">func</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func2</span><span class="p">():</span>
    <span class="n">func3</span><span class="p">()</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">func</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func1</span><span class="p">():</span>
    <span class="n">func2</span><span class="p">()</span>

<span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func0</span><span class="p">():</span>
    <span class="n">func1</span><span class="p">()</span>

<span class="n">func0</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">23</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">342</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_Call</span>
    <span class="n">node</span><span class="o">.</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/impl.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">471</span><span class="p">,</span> <span class="ow">in</span> <span class="n">static_assert</span>
    <span class="k">assert</span> <span class="n">cond</span>
<span class="ne">AssertionError</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">):</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">23</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">360</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_Call</span>
    <span class="n">node</span><span class="o">.</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">ptr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">keywords</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/kernel_impl.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">59</span><span class="p">,</span> <span class="ow">in</span> <span class="n">decorated</span>
    <span class="k">return</span> <span class="n">fun</span><span class="o">.</span><span class="fm">__call__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/kernel_impl.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">178</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">transform_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">ctx</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/transform.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">8</span><span class="p">,</span> <span class="ow">in</span> <span class="n">transform_tree</span>
    <span class="n">ASTTransformer</span><span class="p">()(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">raise</span> <span class="n">e</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">23</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">488</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_Module</span>
    <span class="n">build_stmt</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">stmt</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">raise</span> <span class="n">e</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">23</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">451</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_FunctionDef</span>
    <span class="n">build_stmts</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1086</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_stmts</span>
    <span class="n">build_stmt</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">stmt</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">26</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">raise</span> <span class="n">e</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">23</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">964</span><span class="p">,</span> <span class="ow">in</span> <span class="n">build_Expr</span>
    <span class="n">build_stmt</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">&quot;/Users/lanhaidong/taichi/taichi/python/taichi/lang/ast/ast_transformer_utils.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">32</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__call__</span>
    <span class="k">raise</span> <span class="n">TaichiCompilationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="n">taichi</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">TaichiCompilationError</span><span class="p">:</span> <span class="n">File</span> <span class="s2">&quot;misc/demo_traceback.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_assert</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="ne">AssertionError</span><span class="p">:</span>

<span class="o">...</span>
</pre></div>
</div>
<p>It takes time to read through the message. In addition, many stack frames reveal implementation details, which are irrelevant to debugging.</p>
<p>Taichi allows you to access a conciser and more intuitive version of traceback messages via <code class="docutils literal notranslate"><span class="pre">sys.tracebacklimit</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ti</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">tracebacklimit</span><span class="o">=</span><span class="mi">0</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The traceback contains the following information only:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ne">AssertionError</span>

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="n">taichi</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">TaichiCompilationError</span><span class="p">:</span> <span class="n">File</span> <span class="s2">&quot;misc/demo_traceback.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">ti</span><span class="o">.</span><span class="n">static_assert</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
    <span class="o">^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
<span class="ne">AssertionError</span><span class="p">:</span>

<span class="o">...</span>
</pre></div>
</div>
<p>However, always unset <code class="docutils literal notranslate"><span class="pre">sys.tracebacklimit</span></code> and submit the full traceback messages when filing an issue with us.</p>
</section>
<section id="debugging-tips">
<h2>Debugging tips<a class="headerlink" href="#debugging-tips" title="Link to this heading">#</a></h2>
<p>The above built-in tools cannot guarantee a smooth debugging experience, though. Here, we conclude some common bugs that one may encounter in a
Taichi program.</p>
<section id="static-type-system">
<h3>Static type system<a class="headerlink" href="#static-type-system" title="Link to this heading">#</a></h3>
<p>Taichi translates Python code into a statically typed language for high performance. Therefore, code in the Taichi scope may behave differently from native Python code, especially when it comes to variable types.</p>
<p>In the Taichi scope, the type of a variable is <em>determined upon initialization and never changes afterwards</em>.</p>
<p>Although Taichi’s static typing system delivers a better performance, it may lead to unexpected results if you fail to specify the correct types. For example, the code below leads to an unexpected result due to a misuse of Taichi’s static typing system. The Taichi compiler shows a warning::</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">buggy</span><span class="p">():</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># 0 is an integer, so `ret` is typed as int32</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span>  <span class="c1"># i32 += f32, the result is still stored in int32!</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>  <span class="c1"># will show 0</span>

<span class="n">buggy</span><span class="p">()</span>
</pre></div>
</div>
<p>Output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[W 06/27/20 21:43:51.853] [type_check.cpp:visit@66] [$19] Atomic add (float32 to int32) may lose precision.
</pre></div>
</div>
<p>This means that a precision loss occurs when Taichi converts a <code class="docutils literal notranslate"><span class="pre">float32</span></code> result to <code class="docutils literal notranslate"><span class="pre">int32</span></code>. The solution is to initialize <code class="docutils literal notranslate"><span class="pre">ret</span></code> as a floating-point value:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ti</span><span class="o">.</span><span class="n">kernel</span>
<span class="k">def</span><span class="w"> </span><span class="nf">not_buggy</span><span class="p">():</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># 0 is a floating point number, so `ret` is typed as float32</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">+=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span>  <span class="c1"># f32 += f32. OK!</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>  <span class="c1"># will show 0.6</span>

<span class="n">not_buggy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="advanced-optimization">
<h3>Advanced Optimization<a class="headerlink" href="#advanced-optimization" title="Link to this heading">#</a></h3>
<p>By default, Taichi runs a number of advanced IR optimizations to maximize the performance of your Taichi kernels. However, advanced optimizations may occasionally lead to compilation errors, such as:</p>
<p><code class="docutils literal notranslate"><span class="pre">RuntimeError:</span> <span class="pre">[verify.cpp:basic_verify&#64;40]</span> <span class="pre">stmt</span> <span class="pre">8</span> <span class="pre">cannot</span> <span class="pre">have</span> <span class="pre">operand</span> <span class="pre">7.</span></code></p>
<p>You can use the <code class="docutils literal notranslate"><span class="pre">ti.init(advanced_optimization=False)</span></code> setting to turn off advanced optimizations and see if it makes a difference. If this issue persists, feel free to report it on <a class="reference external" href="https://github.com/taichi-dev/taichi/issues/new?labels=potential+bug&amp;amp;template=bug_report.md">GitHub</a>.</p>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-print-in-taichi-scope">Runtime <code class="docutils literal notranslate"><span class="pre">print</span></code> in Taichi scope</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#applicable-backends">Applicable backends</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#printing-comma-separated-strings-f-strings-or-formatted-strings">Printing comma-separated strings, f-strings, or formatted strings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-time-ti-static-print">Compile-time <code class="docutils literal notranslate"><span class="pre">ti.static_print</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#serial-execution">Serial execution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serialize-an-entire-taichi-program">Serialize an entire Taichi program</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#serialize-a-specified-parallel-for-loop">Serialize a specified parallel for loop</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#out-of-bound-array-access">Out-of-bound array access</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#runtime-assert-in-taichi-scope">Runtime <code class="docutils literal notranslate"><span class="pre">assert</span></code> in Taichi scope</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#compile-time-ti-static-assert">Compile-time <code class="docutils literal notranslate"><span class="pre">ti.static_assert</span></code></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conciser-tracebacks-in-taichi-scope">Conciser tracebacks in Taichi scope</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debugging-tips">Debugging tips</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#static-type-system">Static type system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#advanced-optimization">Advanced Optimization</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/user_guide/debug/debugging.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2023 Taichi Graphics Inc; 2025 Genesis AI Inc.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>