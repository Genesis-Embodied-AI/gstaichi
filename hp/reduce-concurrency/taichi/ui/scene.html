<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>taichi.ui.scene API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../ui.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;taichi.ui</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#normals_field_cache">normals_field_cache</a>
            </li>
            <li>
                    <a class="function" href="#get_normals_field">get_normals_field</a>
            </li>
            <li>
                    <a class="function" href="#gen_normals_kernel">gen_normals_kernel</a>
            </li>
            <li>
                    <a class="function" href="#gen_normals_kernel_indexed">gen_normals_kernel_indexed</a>
            </li>
            <li>
                    <a class="function" href="#gen_normals">gen_normals</a>
            </li>
            <li>
                    <a class="class" href="#SceneV2">SceneV2</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SceneV2.__init__">SceneV2</a>
                        </li>
                        <li>
                                <a class="variable" href="#SceneV2.scene">scene</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.set_camera">set_camera</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.lines">lines</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.mesh">mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.mesh_instance">mesh_instance</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.particles">particles</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.point_light">point_light</a>
                        </li>
                        <li>
                                <a class="function" href="#SceneV2.ambient_light">ambient_light</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Scene">Scene</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Scene.scene">scene</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.set_camera">set_camera</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.lines">lines</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.mesh">mesh</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.mesh_instance">mesh_instance</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.particles">particles</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.point_light">point_light</a>
                        </li>
                        <li>
                                <a class="function" href="#Scene.ambient_light">ambient_light</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../taichi.html">taichi</a><wbr>.<a href="./../ui.html">ui</a><wbr>.scene    </h1>

                
                        <input id="mod-scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-scene-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># type: ignore</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">taichi</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.staging_buffer</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a>    <span class="n">copy_all_to_vbo</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>    <span class="n">copy_all_to_vbo_particle</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>    <span class="n">copy_to_vbo_scalar</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="n">copy_to_vbo_vector</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a>    <span class="n">get_indices_field</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>    <span class="n">get_indices_field_v2</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a>    <span class="n">get_transforms_field</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>    <span class="n">get_transforms_field_v2</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>    <span class="n">get_vbo_field</span><span class="p">,</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a>    <span class="n">get_vbo_field_v2</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="p">)</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">check_ggui_availability</span><span class="p">,</span> <span class="n">get_field_info</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi._lib</span><span class="w"> </span><span class="kn">import</span> <span class="n">core</span> <span class="k">as</span> <span class="n">_ti_core</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.lang.impl</span><span class="w"> </span><span class="kn">import</span> <span class="n">field</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.lang.kernel_impl</span><span class="w"> </span><span class="kn">import</span> <span class="n">kernel</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.lang.matrix</span><span class="w"> </span><span class="kn">import</span> <span class="n">Vector</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.lang.ops</span><span class="w"> </span><span class="kn">import</span> <span class="n">atomic_add</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.types.annotations</span><span class="w"> </span><span class="kn">import</span> <span class="n">template</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">taichi.types.primitive_types</span><span class="w"> </span><span class="kn">import</span> <span class="n">f32</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="n">normals_field_cache</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_normals_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="k">if</span> <span class="n">vertices</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normals_field_cache</span><span class="p">:</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>        <span class="n">normals</span> <span class="o">=</span> <span class="n">Vector</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">f32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,))</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="n">normal_weights</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">f32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,))</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>        <span class="n">normals_field_cache</span><span class="p">[</span><span class="n">vertices</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">normal_weights</span><span class="p">)</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">normal_weights</span><span class="p">)</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="k">return</span> <span class="n">normals_field_cache</span><span class="p">[</span><span class="n">vertices</span><span class="p">]</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="nd">@kernel</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals_kernel</span><span class="p">(</span><span class="n">vertices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">normals</span><span class="p">:</span> <span class="n">template</span><span class="p">()):</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="nd">@kernel</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals_kernel_indexed</span><span class="p">(</span><span class="n">vertices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">indices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">normals</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">weights</span><span class="p">:</span> <span class="n">template</span><span class="p">()):</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="n">num_triangles</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="n">num_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vertices</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_triangles</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>        <span class="n">i_a</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">i_b</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">i_c</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_a</span><span class="p">]</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_c</span><span class="p">]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_a</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_b</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_c</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_a</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_b</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_c</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vertices</span><span class="p">):</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>        <span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>            <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>    <span class="n">normals</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">get_normals_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">gen_normals_kernel</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>        <span class="n">gen_normals_kernel_indexed</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>    <span class="k">return</span> <span class="n">normals</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SceneV2</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The new 3D scene class, which can contain meshes, lines and particles,</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    and can be rendered on a canvas.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    An instance of this class can be retrieved using the</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    get_scene() function of a taichi.ui.Window.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="n">check_ggui_availability</span><span class="p">()</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        Args:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="p">):</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="sd">        Args:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>            <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>    <span class="p">):</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">        Args:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">                seen from both sides.</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>        <span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>    <span class="p">):</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        Args:</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">                seen from both sides.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">                of indices to draw.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field_v2</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>        <span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>    <span class="p">):</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Args:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>            <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                <span class="n">vbo</span><span class="p">,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="n">centers</span><span class="p">,</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_radius</span><span class="p">:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>                <span class="n">copy_to_vbo_scalar</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_radius</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">        Args:</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        Example::</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Scene</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The old 3D scene class, which can contain meshes, lines and particles,</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">    and can be rendered on a canvas.</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">    This scene class is to be instantiated directly and is deprecated.</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">    Use the new SceneV2 class instead, which can be retrieved using the</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    get_scene() function of a taichi.ui.Window.</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>        <span class="n">check_ggui_availability</span><span class="p">()</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">_ti_core</span><span class="o">.</span><span class="n">PyScene</span><span class="p">()</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>            <span class="s2">&quot;Instantiating ti.ui.Scene directly is deprecated, use the get_scene() function from a taichi.ui.Window object instead.&quot;</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">        Args:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>    <span class="p">):</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        Args:</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>    <span class="p">):</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="sd">        Args:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a><span class="sd">                seen from both sides.</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>    <span class="p">):</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a><span class="sd">        Args:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a><span class="sd">                seen from both sides.</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a><span class="sd">                within the index buffer.</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a><span class="sd">                of indices to draw.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>        <span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>    <span class="p">):</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a><span class="sd">        Args:</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>        <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a>            <span class="n">vbo</span><span class="p">,</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a>            <span class="n">centers</span><span class="p">,</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>            <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a>            <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a>        <span class="p">)</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a>        <span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a><span class="sd">        Args:</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a><span class="sd">        Example::</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a><span class="sd">            &gt;&gt;&gt; scene = ti.ui.Scene()</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            </section>
                <section id="normals_field_cache">
                    <div class="attr variable">
            <span class="name">normals_field_cache</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#normals_field_cache"></a>
    
    

                </section>
                <section id="get_normals_field">
                            <input id="get_normals_field-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_normals_field</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vertices</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_normals_field-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_normals_field"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_normals_field-31"><a href="#get_normals_field-31"><span class="linenos">31</span></a><span class="k">def</span><span class="w"> </span><span class="nf">get_normals_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
</span><span id="get_normals_field-32"><a href="#get_normals_field-32"><span class="linenos">32</span></a>    <span class="k">if</span> <span class="n">vertices</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">normals_field_cache</span><span class="p">:</span>
</span><span id="get_normals_field-33"><a href="#get_normals_field-33"><span class="linenos">33</span></a>        <span class="n">N</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="get_normals_field-34"><a href="#get_normals_field-34"><span class="linenos">34</span></a>        <span class="n">normals</span> <span class="o">=</span> <span class="n">Vector</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">f32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,))</span>
</span><span id="get_normals_field-35"><a href="#get_normals_field-35"><span class="linenos">35</span></a>        <span class="n">normal_weights</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">f32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,))</span>
</span><span id="get_normals_field-36"><a href="#get_normals_field-36"><span class="linenos">36</span></a>        <span class="n">normals_field_cache</span><span class="p">[</span><span class="n">vertices</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">normal_weights</span><span class="p">)</span>
</span><span id="get_normals_field-37"><a href="#get_normals_field-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">normals</span><span class="p">,</span> <span class="n">normal_weights</span><span class="p">)</span>
</span><span id="get_normals_field-38"><a href="#get_normals_field-38"><span class="linenos">38</span></a>    <span class="k">return</span> <span class="n">normals_field_cache</span><span class="p">[</span><span class="n">vertices</span><span class="p">]</span>
</span></pre></div>


    

                </section>
                <section id="gen_normals_kernel">
                            <input id="gen_normals_kernel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-kernel">@kernel</div>

        <span class="def">def</span>
        <span class="name">gen_normals_kernel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vertices</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">normals</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="gen_normals_kernel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gen_normals_kernel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gen_normals_kernel-41"><a href="#gen_normals_kernel-41"><span class="linenos">41</span></a><span class="nd">@kernel</span>
</span><span id="gen_normals_kernel-42"><a href="#gen_normals_kernel-42"><span class="linenos">42</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals_kernel</span><span class="p">(</span><span class="n">vertices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">normals</span><span class="p">:</span> <span class="n">template</span><span class="p">()):</span>
</span><span id="gen_normals_kernel-43"><a href="#gen_normals_kernel-43"><span class="linenos">43</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="gen_normals_kernel-44"><a href="#gen_normals_kernel-44"><span class="linenos">44</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):</span>
</span><span id="gen_normals_kernel-45"><a href="#gen_normals_kernel-45"><span class="linenos">45</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="gen_normals_kernel-46"><a href="#gen_normals_kernel-46"><span class="linenos">46</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="gen_normals_kernel-47"><a href="#gen_normals_kernel-47"><span class="linenos">47</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="gen_normals_kernel-48"><a href="#gen_normals_kernel-48"><span class="linenos">48</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="gen_normals_kernel-49"><a href="#gen_normals_kernel-49"><span class="linenos">49</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="gen_normals_kernel-50"><a href="#gen_normals_kernel-50"><span class="linenos">50</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span><span id="gen_normals_kernel-51"><a href="#gen_normals_kernel-51"><span class="linenos">51</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
</span></pre></div>


    

                </section>
                <section id="gen_normals_kernel_indexed">
                            <input id="gen_normals_kernel_indexed-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-kernel">@kernel</div>

        <span class="def">def</span>
        <span class="name">gen_normals_kernel_indexed</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">vertices</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">normals</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">weights</span><span class="p">:</span> <span class="o">&lt;</span><span class="n"><a href="../types/annotations.html#Template">taichi.types.annotations.Template</a></span> <span class="nb">object</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="gen_normals_kernel_indexed-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gen_normals_kernel_indexed"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gen_normals_kernel_indexed-54"><a href="#gen_normals_kernel_indexed-54"><span class="linenos">54</span></a><span class="nd">@kernel</span>
</span><span id="gen_normals_kernel_indexed-55"><a href="#gen_normals_kernel_indexed-55"><span class="linenos">55</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals_kernel_indexed</span><span class="p">(</span><span class="n">vertices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">indices</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">normals</span><span class="p">:</span> <span class="n">template</span><span class="p">(),</span> <span class="n">weights</span><span class="p">:</span> <span class="n">template</span><span class="p">()):</span>
</span><span id="gen_normals_kernel_indexed-56"><a href="#gen_normals_kernel_indexed-56"><span class="linenos">56</span></a>    <span class="n">num_triangles</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">3</span>
</span><span id="gen_normals_kernel_indexed-57"><a href="#gen_normals_kernel_indexed-57"><span class="linenos">57</span></a>    <span class="n">num_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-58"><a href="#gen_normals_kernel_indexed-58"><span class="linenos">58</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vertices</span><span class="p">):</span>
</span><span id="gen_normals_kernel_indexed-59"><a href="#gen_normals_kernel_indexed-59"><span class="linenos">59</span></a>        <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vector</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
</span><span id="gen_normals_kernel_indexed-60"><a href="#gen_normals_kernel_indexed-60"><span class="linenos">60</span></a>        <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="gen_normals_kernel_indexed-61"><a href="#gen_normals_kernel_indexed-61"><span class="linenos">61</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_triangles</span><span class="p">):</span>
</span><span id="gen_normals_kernel_indexed-62"><a href="#gen_normals_kernel_indexed-62"><span class="linenos">62</span></a>        <span class="n">i_a</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-63"><a href="#gen_normals_kernel_indexed-63"><span class="linenos">63</span></a>        <span class="n">i_b</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-64"><a href="#gen_normals_kernel_indexed-64"><span class="linenos">64</span></a>        <span class="n">i_c</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-65"><a href="#gen_normals_kernel_indexed-65"><span class="linenos">65</span></a>        <span class="n">a</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_a</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-66"><a href="#gen_normals_kernel_indexed-66"><span class="linenos">66</span></a>        <span class="n">b</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_b</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-67"><a href="#gen_normals_kernel_indexed-67"><span class="linenos">67</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">i_c</span><span class="p">]</span>
</span><span id="gen_normals_kernel_indexed-68"><a href="#gen_normals_kernel_indexed-68"><span class="linenos">68</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">normalized</span><span class="p">()</span>
</span><span id="gen_normals_kernel_indexed-69"><a href="#gen_normals_kernel_indexed-69"><span class="linenos">69</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_a</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-70"><a href="#gen_normals_kernel_indexed-70"><span class="linenos">70</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_b</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-71"><a href="#gen_normals_kernel_indexed-71"><span class="linenos">71</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">normals</span><span class="p">[</span><span class="n">i_c</span><span class="p">],</span> <span class="n">n</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-72"><a href="#gen_normals_kernel_indexed-72"><span class="linenos">72</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_a</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-73"><a href="#gen_normals_kernel_indexed-73"><span class="linenos">73</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_b</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-74"><a href="#gen_normals_kernel_indexed-74"><span class="linenos">74</span></a>        <span class="n">atomic_add</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">i_c</span><span class="p">],</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="gen_normals_kernel_indexed-75"><a href="#gen_normals_kernel_indexed-75"><span class="linenos">75</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vertices</span><span class="p">):</span>
</span><span id="gen_normals_kernel_indexed-76"><a href="#gen_normals_kernel_indexed-76"><span class="linenos">76</span></a>        <span class="k">if</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="gen_normals_kernel_indexed-77"><a href="#gen_normals_kernel_indexed-77"><span class="linenos">77</span></a>            <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">normals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">weights</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span></pre></div>


    

                </section>
                <section id="gen_normals">
                            <input id="gen_normals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_normals</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">vertices</span>, </span><span class="param"><span class="n">indices</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="gen_normals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gen_normals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gen_normals-80"><a href="#gen_normals-80"><span class="linenos">80</span></a><span class="k">def</span><span class="w"> </span><span class="nf">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span>
</span><span id="gen_normals-81"><a href="#gen_normals-81"><span class="linenos">81</span></a>    <span class="n">normals</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="n">get_normals_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="gen_normals-82"><a href="#gen_normals-82"><span class="linenos">82</span></a>    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="gen_normals-83"><a href="#gen_normals-83"><span class="linenos">83</span></a>        <span class="n">gen_normals_kernel</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">)</span>
</span><span id="gen_normals-84"><a href="#gen_normals-84"><span class="linenos">84</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="gen_normals-85"><a href="#gen_normals-85"><span class="linenos">85</span></a>        <span class="n">gen_normals_kernel_indexed</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</span><span id="gen_normals-86"><a href="#gen_normals-86"><span class="linenos">86</span></a>    <span class="k">return</span> <span class="n">normals</span>
</span></pre></div>


    

                </section>
                <section id="SceneV2">
                            <input id="SceneV2-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SceneV2</span>:

                <label class="view-source-button" for="SceneV2-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2-89"><a href="#SceneV2-89"><span class="linenos"> 89</span></a><span class="k">class</span><span class="w"> </span><span class="nc">SceneV2</span><span class="p">:</span>
</span><span id="SceneV2-90"><a href="#SceneV2-90"><span class="linenos"> 90</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The new 3D scene class, which can contain meshes, lines and particles,</span>
</span><span id="SceneV2-91"><a href="#SceneV2-91"><span class="linenos"> 91</span></a><span class="sd">    and can be rendered on a canvas.</span>
</span><span id="SceneV2-92"><a href="#SceneV2-92"><span class="linenos"> 92</span></a><span class="sd">    An instance of this class can be retrieved using the</span>
</span><span id="SceneV2-93"><a href="#SceneV2-93"><span class="linenos"> 93</span></a><span class="sd">    get_scene() function of a taichi.ui.Window.</span>
</span><span id="SceneV2-94"><a href="#SceneV2-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SceneV2-95"><a href="#SceneV2-95"><span class="linenos"> 95</span></a>
</span><span id="SceneV2-96"><a href="#SceneV2-96"><span class="linenos"> 96</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-97"><a href="#SceneV2-97"><span class="linenos"> 97</span></a>        <span class="n">check_ggui_availability</span><span class="p">()</span>
</span><span id="SceneV2-98"><a href="#SceneV2-98"><span class="linenos"> 98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
</span><span id="SceneV2-99"><a href="#SceneV2-99"><span class="linenos"> 99</span></a>
</span><span id="SceneV2-100"><a href="#SceneV2-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="SceneV2-101"><a href="#SceneV2-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="SceneV2-102"><a href="#SceneV2-102"><span class="linenos">102</span></a>
</span><span id="SceneV2-103"><a href="#SceneV2-103"><span class="linenos">103</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-104"><a href="#SceneV2-104"><span class="linenos">104</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="SceneV2-105"><a href="#SceneV2-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-106"><a href="#SceneV2-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span><span id="SceneV2-107"><a href="#SceneV2-107"><span class="linenos">107</span></a>
</span><span id="SceneV2-108"><a href="#SceneV2-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="SceneV2-109"><a href="#SceneV2-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2-110"><a href="#SceneV2-110"><span class="linenos">110</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2-111"><a href="#SceneV2-111"><span class="linenos">111</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="SceneV2-112"><a href="#SceneV2-112"><span class="linenos">112</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-113"><a href="#SceneV2-113"><span class="linenos">113</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2-114"><a href="#SceneV2-114"><span class="linenos">114</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-115"><a href="#SceneV2-115"><span class="linenos">115</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-116"><a href="#SceneV2-116"><span class="linenos">116</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-117"><a href="#SceneV2-117"><span class="linenos">117</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-118"><a href="#SceneV2-118"><span class="linenos">118</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-119"><a href="#SceneV2-119"><span class="linenos">119</span></a>    <span class="p">):</span>
</span><span id="SceneV2-120"><a href="#SceneV2-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="SceneV2-121"><a href="#SceneV2-121"><span class="linenos">121</span></a>
</span><span id="SceneV2-122"><a href="#SceneV2-122"><span class="linenos">122</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="SceneV2-123"><a href="#SceneV2-123"><span class="linenos">123</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="SceneV2-124"><a href="#SceneV2-124"><span class="linenos">124</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="SceneV2-125"><a href="#SceneV2-125"><span class="linenos">125</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="SceneV2-126"><a href="#SceneV2-126"><span class="linenos">126</span></a>
</span><span id="SceneV2-127"><a href="#SceneV2-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-128"><a href="#SceneV2-128"><span class="linenos">128</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-129"><a href="#SceneV2-129"><span class="linenos">129</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="SceneV2-130"><a href="#SceneV2-130"><span class="linenos">130</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="SceneV2-131"><a href="#SceneV2-131"><span class="linenos">131</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="SceneV2-132"><a href="#SceneV2-132"><span class="linenos">132</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="SceneV2-133"><a href="#SceneV2-133"><span class="linenos">133</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="SceneV2-134"><a href="#SceneV2-134"><span class="linenos">134</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2-135"><a href="#SceneV2-135"><span class="linenos">135</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2-136"><a href="#SceneV2-136"><span class="linenos">136</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2-137"><a href="#SceneV2-137"><span class="linenos">137</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="SceneV2-138"><a href="#SceneV2-138"><span class="linenos">138</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2-139"><a href="#SceneV2-139"><span class="linenos">139</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2-140"><a href="#SceneV2-140"><span class="linenos">140</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2-141"><a href="#SceneV2-141"><span class="linenos">141</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2-142"><a href="#SceneV2-142"><span class="linenos">142</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2-143"><a href="#SceneV2-143"><span class="linenos">143</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2-144"><a href="#SceneV2-144"><span class="linenos">144</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="SceneV2-145"><a href="#SceneV2-145"><span class="linenos">145</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="SceneV2-146"><a href="#SceneV2-146"><span class="linenos">146</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="SceneV2-147"><a href="#SceneV2-147"><span class="linenos">147</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="SceneV2-148"><a href="#SceneV2-148"><span class="linenos">148</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="SceneV2-149"><a href="#SceneV2-149"><span class="linenos">149</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2-150"><a href="#SceneV2-150"><span class="linenos">150</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2-151"><a href="#SceneV2-151"><span class="linenos">151</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2-152"><a href="#SceneV2-152"><span class="linenos">152</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2-153"><a href="#SceneV2-153"><span class="linenos">153</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="SceneV2-154"><a href="#SceneV2-154"><span class="linenos">154</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2-155"><a href="#SceneV2-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-156"><a href="#SceneV2-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-157"><a href="#SceneV2-157"><span class="linenos">157</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-158"><a href="#SceneV2-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-159"><a href="#SceneV2-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-160"><a href="#SceneV2-160"><span class="linenos">160</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="SceneV2-161"><a href="#SceneV2-161"><span class="linenos">161</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-162"><a href="#SceneV2-162"><span class="linenos">162</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-163"><a href="#SceneV2-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SceneV2-164"><a href="#SceneV2-164"><span class="linenos">164</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="SceneV2-165"><a href="#SceneV2-165"><span class="linenos">165</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SceneV2-166"><a href="#SceneV2-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SceneV2-167"><a href="#SceneV2-167"><span class="linenos">167</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="SceneV2-168"><a href="#SceneV2-168"><span class="linenos">168</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="SceneV2-169"><a href="#SceneV2-169"><span class="linenos">169</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="SceneV2-170"><a href="#SceneV2-170"><span class="linenos">170</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2-171"><a href="#SceneV2-171"><span class="linenos">171</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2-172"><a href="#SceneV2-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="SceneV2-173"><a href="#SceneV2-173"><span class="linenos">173</span></a>            <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2-174"><a href="#SceneV2-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-175"><a href="#SceneV2-175"><span class="linenos">175</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="SceneV2-176"><a href="#SceneV2-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="SceneV2-177"><a href="#SceneV2-177"><span class="linenos">177</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SceneV2-178"><a href="#SceneV2-178"><span class="linenos">178</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2-179"><a href="#SceneV2-179"><span class="linenos">179</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2-180"><a href="#SceneV2-180"><span class="linenos">180</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2-181"><a href="#SceneV2-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="SceneV2-182"><a href="#SceneV2-182"><span class="linenos">182</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2-183"><a href="#SceneV2-183"><span class="linenos">183</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2-184"><a href="#SceneV2-184"><span class="linenos">184</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2-185"><a href="#SceneV2-185"><span class="linenos">185</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2-186"><a href="#SceneV2-186"><span class="linenos">186</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="SceneV2-187"><a href="#SceneV2-187"><span class="linenos">187</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2-188"><a href="#SceneV2-188"><span class="linenos">188</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2-189"><a href="#SceneV2-189"><span class="linenos">189</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2-190"><a href="#SceneV2-190"><span class="linenos">190</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2-191"><a href="#SceneV2-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span><span id="SceneV2-192"><a href="#SceneV2-192"><span class="linenos">192</span></a>
</span><span id="SceneV2-193"><a href="#SceneV2-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="SceneV2-194"><a href="#SceneV2-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2-195"><a href="#SceneV2-195"><span class="linenos">195</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2-196"><a href="#SceneV2-196"><span class="linenos">196</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-197"><a href="#SceneV2-197"><span class="linenos">197</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-198"><a href="#SceneV2-198"><span class="linenos">198</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2-199"><a href="#SceneV2-199"><span class="linenos">199</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-200"><a href="#SceneV2-200"><span class="linenos">200</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2-201"><a href="#SceneV2-201"><span class="linenos">201</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-202"><a href="#SceneV2-202"><span class="linenos">202</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-203"><a href="#SceneV2-203"><span class="linenos">203</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-204"><a href="#SceneV2-204"><span class="linenos">204</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-205"><a href="#SceneV2-205"><span class="linenos">205</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2-206"><a href="#SceneV2-206"><span class="linenos">206</span></a>    <span class="p">):</span>
</span><span id="SceneV2-207"><a href="#SceneV2-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="SceneV2-208"><a href="#SceneV2-208"><span class="linenos">208</span></a>
</span><span id="SceneV2-209"><a href="#SceneV2-209"><span class="linenos">209</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="SceneV2-210"><a href="#SceneV2-210"><span class="linenos">210</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="SceneV2-211"><a href="#SceneV2-211"><span class="linenos">211</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="SceneV2-212"><a href="#SceneV2-212"><span class="linenos">212</span></a>
</span><span id="SceneV2-213"><a href="#SceneV2-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-214"><a href="#SceneV2-214"><span class="linenos">214</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-215"><a href="#SceneV2-215"><span class="linenos">215</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="SceneV2-216"><a href="#SceneV2-216"><span class="linenos">216</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="SceneV2-217"><a href="#SceneV2-217"><span class="linenos">217</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="SceneV2-218"><a href="#SceneV2-218"><span class="linenos">218</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="SceneV2-219"><a href="#SceneV2-219"><span class="linenos">219</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-220"><a href="#SceneV2-220"><span class="linenos">220</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="SceneV2-221"><a href="#SceneV2-221"><span class="linenos">221</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="SceneV2-222"><a href="#SceneV2-222"><span class="linenos">222</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2-223"><a href="#SceneV2-223"><span class="linenos">223</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2-224"><a href="#SceneV2-224"><span class="linenos">224</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2-225"><a href="#SceneV2-225"><span class="linenos">225</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="SceneV2-226"><a href="#SceneV2-226"><span class="linenos">226</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="SceneV2-227"><a href="#SceneV2-227"><span class="linenos">227</span></a><span class="sd">                seen from both sides.</span>
</span><span id="SceneV2-228"><a href="#SceneV2-228"><span class="linenos">228</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2-229"><a href="#SceneV2-229"><span class="linenos">229</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2-230"><a href="#SceneV2-230"><span class="linenos">230</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2-231"><a href="#SceneV2-231"><span class="linenos">231</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2-232"><a href="#SceneV2-232"><span class="linenos">232</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2-233"><a href="#SceneV2-233"><span class="linenos">233</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2-234"><a href="#SceneV2-234"><span class="linenos">234</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2-235"><a href="#SceneV2-235"><span class="linenos">235</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2-236"><a href="#SceneV2-236"><span class="linenos">236</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2-237"><a href="#SceneV2-237"><span class="linenos">237</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2-238"><a href="#SceneV2-238"><span class="linenos">238</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2-239"><a href="#SceneV2-239"><span class="linenos">239</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="SceneV2-240"><a href="#SceneV2-240"><span class="linenos">240</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2-241"><a href="#SceneV2-241"><span class="linenos">241</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="SceneV2-242"><a href="#SceneV2-242"><span class="linenos">242</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="SceneV2-243"><a href="#SceneV2-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-244"><a href="#SceneV2-244"><span class="linenos">244</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2-245"><a href="#SceneV2-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-246"><a href="#SceneV2-246"><span class="linenos">246</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="SceneV2-247"><a href="#SceneV2-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-248"><a href="#SceneV2-248"><span class="linenos">248</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-249"><a href="#SceneV2-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-250"><a href="#SceneV2-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-251"><a href="#SceneV2-251"><span class="linenos">251</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="SceneV2-252"><a href="#SceneV2-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-253"><a href="#SceneV2-253"><span class="linenos">253</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-254"><a href="#SceneV2-254"><span class="linenos">254</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2-255"><a href="#SceneV2-255"><span class="linenos">255</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2-256"><a href="#SceneV2-256"><span class="linenos">256</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2-257"><a href="#SceneV2-257"><span class="linenos">257</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2-258"><a href="#SceneV2-258"><span class="linenos">258</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2-259"><a href="#SceneV2-259"><span class="linenos">259</span></a>
</span><span id="SceneV2-260"><a href="#SceneV2-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="SceneV2-261"><a href="#SceneV2-261"><span class="linenos">261</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2-262"><a href="#SceneV2-262"><span class="linenos">262</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2-263"><a href="#SceneV2-263"><span class="linenos">263</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2-264"><a href="#SceneV2-264"><span class="linenos">264</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2-265"><a href="#SceneV2-265"><span class="linenos">265</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="SceneV2-266"><a href="#SceneV2-266"><span class="linenos">266</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2-267"><a href="#SceneV2-267"><span class="linenos">267</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2-268"><a href="#SceneV2-268"><span class="linenos">268</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2-269"><a href="#SceneV2-269"><span class="linenos">269</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2-270"><a href="#SceneV2-270"><span class="linenos">270</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="SceneV2-271"><a href="#SceneV2-271"><span class="linenos">271</span></a>        <span class="p">)</span>
</span><span id="SceneV2-272"><a href="#SceneV2-272"><span class="linenos">272</span></a>
</span><span id="SceneV2-273"><a href="#SceneV2-273"><span class="linenos">273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="SceneV2-274"><a href="#SceneV2-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2-275"><a href="#SceneV2-275"><span class="linenos">275</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2-276"><a href="#SceneV2-276"><span class="linenos">276</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-277"><a href="#SceneV2-277"><span class="linenos">277</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-278"><a href="#SceneV2-278"><span class="linenos">278</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2-279"><a href="#SceneV2-279"><span class="linenos">279</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-280"><a href="#SceneV2-280"><span class="linenos">280</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2-281"><a href="#SceneV2-281"><span class="linenos">281</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-282"><a href="#SceneV2-282"><span class="linenos">282</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-283"><a href="#SceneV2-283"><span class="linenos">283</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-284"><a href="#SceneV2-284"><span class="linenos">284</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-285"><a href="#SceneV2-285"><span class="linenos">285</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-286"><a href="#SceneV2-286"><span class="linenos">286</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-287"><a href="#SceneV2-287"><span class="linenos">287</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-288"><a href="#SceneV2-288"><span class="linenos">288</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2-289"><a href="#SceneV2-289"><span class="linenos">289</span></a>    <span class="p">):</span>
</span><span id="SceneV2-290"><a href="#SceneV2-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="SceneV2-291"><a href="#SceneV2-291"><span class="linenos">291</span></a>
</span><span id="SceneV2-292"><a href="#SceneV2-292"><span class="linenos">292</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="SceneV2-293"><a href="#SceneV2-293"><span class="linenos">293</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="SceneV2-294"><a href="#SceneV2-294"><span class="linenos">294</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="SceneV2-295"><a href="#SceneV2-295"><span class="linenos">295</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="SceneV2-296"><a href="#SceneV2-296"><span class="linenos">296</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="SceneV2-297"><a href="#SceneV2-297"><span class="linenos">297</span></a>
</span><span id="SceneV2-298"><a href="#SceneV2-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-299"><a href="#SceneV2-299"><span class="linenos">299</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-300"><a href="#SceneV2-300"><span class="linenos">300</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="SceneV2-301"><a href="#SceneV2-301"><span class="linenos">301</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="SceneV2-302"><a href="#SceneV2-302"><span class="linenos">302</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="SceneV2-303"><a href="#SceneV2-303"><span class="linenos">303</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="SceneV2-304"><a href="#SceneV2-304"><span class="linenos">304</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-305"><a href="#SceneV2-305"><span class="linenos">305</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="SceneV2-306"><a href="#SceneV2-306"><span class="linenos">306</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="SceneV2-307"><a href="#SceneV2-307"><span class="linenos">307</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2-308"><a href="#SceneV2-308"><span class="linenos">308</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2-309"><a href="#SceneV2-309"><span class="linenos">309</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2-310"><a href="#SceneV2-310"><span class="linenos">310</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="SceneV2-311"><a href="#SceneV2-311"><span class="linenos">311</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="SceneV2-312"><a href="#SceneV2-312"><span class="linenos">312</span></a><span class="sd">                seen from both sides.</span>
</span><span id="SceneV2-313"><a href="#SceneV2-313"><span class="linenos">313</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="SceneV2-314"><a href="#SceneV2-314"><span class="linenos">314</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="SceneV2-315"><a href="#SceneV2-315"><span class="linenos">315</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="SceneV2-316"><a href="#SceneV2-316"><span class="linenos">316</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="SceneV2-317"><a href="#SceneV2-317"><span class="linenos">317</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="SceneV2-318"><a href="#SceneV2-318"><span class="linenos">318</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="SceneV2-319"><a href="#SceneV2-319"><span class="linenos">319</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="SceneV2-320"><a href="#SceneV2-320"><span class="linenos">320</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="SceneV2-321"><a href="#SceneV2-321"><span class="linenos">321</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2-322"><a href="#SceneV2-322"><span class="linenos">322</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2-323"><a href="#SceneV2-323"><span class="linenos">323</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2-324"><a href="#SceneV2-324"><span class="linenos">324</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2-325"><a href="#SceneV2-325"><span class="linenos">325</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2-326"><a href="#SceneV2-326"><span class="linenos">326</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2-327"><a href="#SceneV2-327"><span class="linenos">327</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2-328"><a href="#SceneV2-328"><span class="linenos">328</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2-329"><a href="#SceneV2-329"><span class="linenos">329</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2-330"><a href="#SceneV2-330"><span class="linenos">330</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2-331"><a href="#SceneV2-331"><span class="linenos">331</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2-332"><a href="#SceneV2-332"><span class="linenos">332</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="SceneV2-333"><a href="#SceneV2-333"><span class="linenos">333</span></a><span class="sd">                of indices to draw.</span>
</span><span id="SceneV2-334"><a href="#SceneV2-334"><span class="linenos">334</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="SceneV2-335"><a href="#SceneV2-335"><span class="linenos">335</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="SceneV2-336"><a href="#SceneV2-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-337"><a href="#SceneV2-337"><span class="linenos">337</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2-338"><a href="#SceneV2-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-339"><a href="#SceneV2-339"><span class="linenos">339</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="SceneV2-340"><a href="#SceneV2-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-341"><a href="#SceneV2-341"><span class="linenos">341</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-342"><a href="#SceneV2-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-343"><a href="#SceneV2-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-344"><a href="#SceneV2-344"><span class="linenos">344</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="SceneV2-345"><a href="#SceneV2-345"><span class="linenos">345</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-346"><a href="#SceneV2-346"><span class="linenos">346</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-347"><a href="#SceneV2-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="SceneV2-348"><a href="#SceneV2-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="SceneV2-349"><a href="#SceneV2-349"><span class="linenos">349</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="SceneV2-350"><a href="#SceneV2-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-351"><a href="#SceneV2-351"><span class="linenos">351</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-352"><a href="#SceneV2-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-353"><a href="#SceneV2-353"><span class="linenos">353</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SceneV2-354"><a href="#SceneV2-354"><span class="linenos">354</span></a>
</span><span id="SceneV2-355"><a href="#SceneV2-355"><span class="linenos">355</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2-356"><a href="#SceneV2-356"><span class="linenos">356</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2-357"><a href="#SceneV2-357"><span class="linenos">357</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2-358"><a href="#SceneV2-358"><span class="linenos">358</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2-359"><a href="#SceneV2-359"><span class="linenos">359</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2-360"><a href="#SceneV2-360"><span class="linenos">360</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field_v2</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2-361"><a href="#SceneV2-361"><span class="linenos">361</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="SceneV2-362"><a href="#SceneV2-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="SceneV2-363"><a href="#SceneV2-363"><span class="linenos">363</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2-364"><a href="#SceneV2-364"><span class="linenos">364</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2-365"><a href="#SceneV2-365"><span class="linenos">365</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2-366"><a href="#SceneV2-366"><span class="linenos">366</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2-367"><a href="#SceneV2-367"><span class="linenos">367</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="SceneV2-368"><a href="#SceneV2-368"><span class="linenos">368</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="SceneV2-369"><a href="#SceneV2-369"><span class="linenos">369</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="SceneV2-370"><a href="#SceneV2-370"><span class="linenos">370</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="SceneV2-371"><a href="#SceneV2-371"><span class="linenos">371</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2-372"><a href="#SceneV2-372"><span class="linenos">372</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2-373"><a href="#SceneV2-373"><span class="linenos">373</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2-374"><a href="#SceneV2-374"><span class="linenos">374</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2-375"><a href="#SceneV2-375"><span class="linenos">375</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="SceneV2-376"><a href="#SceneV2-376"><span class="linenos">376</span></a>        <span class="p">)</span>
</span><span id="SceneV2-377"><a href="#SceneV2-377"><span class="linenos">377</span></a>
</span><span id="SceneV2-378"><a href="#SceneV2-378"><span class="linenos">378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="SceneV2-379"><a href="#SceneV2-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2-380"><a href="#SceneV2-380"><span class="linenos">380</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="SceneV2-381"><a href="#SceneV2-381"><span class="linenos">381</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="SceneV2-382"><a href="#SceneV2-382"><span class="linenos">382</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2-383"><a href="#SceneV2-383"><span class="linenos">383</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-384"><a href="#SceneV2-384"><span class="linenos">384</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-385"><a href="#SceneV2-385"><span class="linenos">385</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-386"><a href="#SceneV2-386"><span class="linenos">386</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2-387"><a href="#SceneV2-387"><span class="linenos">387</span></a>    <span class="p">):</span>
</span><span id="SceneV2-388"><a href="#SceneV2-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="SceneV2-389"><a href="#SceneV2-389"><span class="linenos">389</span></a>
</span><span id="SceneV2-390"><a href="#SceneV2-390"><span class="linenos">390</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-391"><a href="#SceneV2-391"><span class="linenos">391</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2-392"><a href="#SceneV2-392"><span class="linenos">392</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="SceneV2-393"><a href="#SceneV2-393"><span class="linenos">393</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="SceneV2-394"><a href="#SceneV2-394"><span class="linenos">394</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2-395"><a href="#SceneV2-395"><span class="linenos">395</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="SceneV2-396"><a href="#SceneV2-396"><span class="linenos">396</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="SceneV2-397"><a href="#SceneV2-397"><span class="linenos">397</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="SceneV2-398"><a href="#SceneV2-398"><span class="linenos">398</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="SceneV2-399"><a href="#SceneV2-399"><span class="linenos">399</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="SceneV2-400"><a href="#SceneV2-400"><span class="linenos">400</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="SceneV2-401"><a href="#SceneV2-401"><span class="linenos">401</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2-402"><a href="#SceneV2-402"><span class="linenos">402</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="SceneV2-403"><a href="#SceneV2-403"><span class="linenos">403</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2-404"><a href="#SceneV2-404"><span class="linenos">404</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="SceneV2-405"><a href="#SceneV2-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-406"><a href="#SceneV2-406"><span class="linenos">406</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2-407"><a href="#SceneV2-407"><span class="linenos">407</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2-408"><a href="#SceneV2-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2-409"><a href="#SceneV2-409"><span class="linenos">409</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2-410"><a href="#SceneV2-410"><span class="linenos">410</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="SceneV2-411"><a href="#SceneV2-411"><span class="linenos">411</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="SceneV2-412"><a href="#SceneV2-412"><span class="linenos">412</span></a>
</span><span id="SceneV2-413"><a href="#SceneV2-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="SceneV2-414"><a href="#SceneV2-414"><span class="linenos">414</span></a>            <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="SceneV2-415"><a href="#SceneV2-415"><span class="linenos">415</span></a>                <span class="n">vbo</span><span class="p">,</span>
</span><span id="SceneV2-416"><a href="#SceneV2-416"><span class="linenos">416</span></a>                <span class="n">centers</span><span class="p">,</span>
</span><span id="SceneV2-417"><a href="#SceneV2-417"><span class="linenos">417</span></a>                <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-418"><a href="#SceneV2-418"><span class="linenos">418</span></a>                <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2-419"><a href="#SceneV2-419"><span class="linenos">419</span></a>            <span class="p">)</span>
</span><span id="SceneV2-420"><a href="#SceneV2-420"><span class="linenos">420</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2-421"><a href="#SceneV2-421"><span class="linenos">421</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="SceneV2-422"><a href="#SceneV2-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_radius</span><span class="p">:</span>
</span><span id="SceneV2-423"><a href="#SceneV2-423"><span class="linenos">423</span></a>                <span class="n">copy_to_vbo_scalar</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_radius</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="SceneV2-424"><a href="#SceneV2-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="SceneV2-425"><a href="#SceneV2-425"><span class="linenos">425</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SceneV2-426"><a href="#SceneV2-426"><span class="linenos">426</span></a>
</span><span id="SceneV2-427"><a href="#SceneV2-427"><span class="linenos">427</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2-428"><a href="#SceneV2-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="SceneV2-429"><a href="#SceneV2-429"><span class="linenos">429</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="SceneV2-430"><a href="#SceneV2-430"><span class="linenos">430</span></a>        <span class="p">)</span>
</span><span id="SceneV2-431"><a href="#SceneV2-431"><span class="linenos">431</span></a>
</span><span id="SceneV2-432"><a href="#SceneV2-432"><span class="linenos">432</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="SceneV2-433"><a href="#SceneV2-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="SceneV2-434"><a href="#SceneV2-434"><span class="linenos">434</span></a>
</span><span id="SceneV2-435"><a href="#SceneV2-435"><span class="linenos">435</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2-436"><a href="#SceneV2-436"><span class="linenos">436</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="SceneV2-437"><a href="#SceneV2-437"><span class="linenos">437</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="SceneV2-438"><a href="#SceneV2-438"><span class="linenos">438</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="SceneV2-439"><a href="#SceneV2-439"><span class="linenos">439</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="SceneV2-440"><a href="#SceneV2-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-441"><a href="#SceneV2-441"><span class="linenos">441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span><span id="SceneV2-442"><a href="#SceneV2-442"><span class="linenos">442</span></a>
</span><span id="SceneV2-443"><a href="#SceneV2-443"><span class="linenos">443</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="SceneV2-444"><a href="#SceneV2-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="SceneV2-445"><a href="#SceneV2-445"><span class="linenos">445</span></a>
</span><span id="SceneV2-446"><a href="#SceneV2-446"><span class="linenos">446</span></a><span class="sd">        Example::</span>
</span><span id="SceneV2-447"><a href="#SceneV2-447"><span class="linenos">447</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="SceneV2-448"><a href="#SceneV2-448"><span class="linenos">448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2-449"><a href="#SceneV2-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>The new 3D scene class, which can contain meshes, lines and particles,
and can be rendered on a canvas.
An instance of this class can be retrieved using the
get_scene() function of a taichi.ui.Window.</p>
</div>


                            <div id="SceneV2.__init__" class="classattr">
                                        <input id="SceneV2.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SceneV2</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">scene</span></span>)</span>

                <label class="view-source-button" for="SceneV2.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.__init__-96"><a href="#SceneV2.__init__-96"><span class="linenos">96</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.__init__-97"><a href="#SceneV2.__init__-97"><span class="linenos">97</span></a>        <span class="n">check_ggui_availability</span><span class="p">()</span>
</span><span id="SceneV2.__init__-98"><a href="#SceneV2.__init__-98"><span class="linenos">98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
</span></pre></div>


    

                            </div>
                            <div id="SceneV2.scene" class="classattr">
                                <div class="attr variable">
            <span class="name">scene</span>

        
    </div>
    <a class="headerlink" href="#SceneV2.scene"></a>
    
    

                            </div>
                            <div id="SceneV2.set_camera" class="classattr">
                                        <input id="SceneV2.set_camera-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_camera</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">camera</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.set_camera-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.set_camera"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.set_camera-100"><a href="#SceneV2.set_camera-100"><span class="linenos">100</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="SceneV2.set_camera-101"><a href="#SceneV2.set_camera-101"><span class="linenos">101</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="SceneV2.set_camera-102"><a href="#SceneV2.set_camera-102"><span class="linenos">102</span></a>
</span><span id="SceneV2.set_camera-103"><a href="#SceneV2.set_camera-103"><span class="linenos">103</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.set_camera-104"><a href="#SceneV2.set_camera-104"><span class="linenos">104</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="SceneV2.set_camera-105"><a href="#SceneV2.set_camera-105"><span class="linenos">105</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.set_camera-106"><a href="#SceneV2.set_camera-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the camera for this scene.</p>

<p>Args:
    camera (<code>~taichi.ui.Camera</code>): A camera instance.</p>
</div>


                            </div>
                            <div id="SceneV2.lines" class="classattr">
                                        <input id="SceneV2.lines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lines</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">width</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.lines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.lines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.lines-108"><a href="#SceneV2.lines-108"><span class="linenos">108</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="SceneV2.lines-109"><a href="#SceneV2.lines-109"><span class="linenos">109</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2.lines-110"><a href="#SceneV2.lines-110"><span class="linenos">110</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2.lines-111"><a href="#SceneV2.lines-111"><span class="linenos">111</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="SceneV2.lines-112"><a href="#SceneV2.lines-112"><span class="linenos">112</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.lines-113"><a href="#SceneV2.lines-113"><span class="linenos">113</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2.lines-114"><a href="#SceneV2.lines-114"><span class="linenos">114</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.lines-115"><a href="#SceneV2.lines-115"><span class="linenos">115</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.lines-116"><a href="#SceneV2.lines-116"><span class="linenos">116</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.lines-117"><a href="#SceneV2.lines-117"><span class="linenos">117</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.lines-118"><a href="#SceneV2.lines-118"><span class="linenos">118</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.lines-119"><a href="#SceneV2.lines-119"><span class="linenos">119</span></a>    <span class="p">):</span>
</span><span id="SceneV2.lines-120"><a href="#SceneV2.lines-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="SceneV2.lines-121"><a href="#SceneV2.lines-121"><span class="linenos">121</span></a>
</span><span id="SceneV2.lines-122"><a href="#SceneV2.lines-122"><span class="linenos">122</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="SceneV2.lines-123"><a href="#SceneV2.lines-123"><span class="linenos">123</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="SceneV2.lines-124"><a href="#SceneV2.lines-124"><span class="linenos">124</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="SceneV2.lines-125"><a href="#SceneV2.lines-125"><span class="linenos">125</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="SceneV2.lines-126"><a href="#SceneV2.lines-126"><span class="linenos">126</span></a>
</span><span id="SceneV2.lines-127"><a href="#SceneV2.lines-127"><span class="linenos">127</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.lines-128"><a href="#SceneV2.lines-128"><span class="linenos">128</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.lines-129"><a href="#SceneV2.lines-129"><span class="linenos">129</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="SceneV2.lines-130"><a href="#SceneV2.lines-130"><span class="linenos">130</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="SceneV2.lines-131"><a href="#SceneV2.lines-131"><span class="linenos">131</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="SceneV2.lines-132"><a href="#SceneV2.lines-132"><span class="linenos">132</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="SceneV2.lines-133"><a href="#SceneV2.lines-133"><span class="linenos">133</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="SceneV2.lines-134"><a href="#SceneV2.lines-134"><span class="linenos">134</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2.lines-135"><a href="#SceneV2.lines-135"><span class="linenos">135</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2.lines-136"><a href="#SceneV2.lines-136"><span class="linenos">136</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2.lines-137"><a href="#SceneV2.lines-137"><span class="linenos">137</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="SceneV2.lines-138"><a href="#SceneV2.lines-138"><span class="linenos">138</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2.lines-139"><a href="#SceneV2.lines-139"><span class="linenos">139</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2.lines-140"><a href="#SceneV2.lines-140"><span class="linenos">140</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2.lines-141"><a href="#SceneV2.lines-141"><span class="linenos">141</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2.lines-142"><a href="#SceneV2.lines-142"><span class="linenos">142</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2.lines-143"><a href="#SceneV2.lines-143"><span class="linenos">143</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2.lines-144"><a href="#SceneV2.lines-144"><span class="linenos">144</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="SceneV2.lines-145"><a href="#SceneV2.lines-145"><span class="linenos">145</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="SceneV2.lines-146"><a href="#SceneV2.lines-146"><span class="linenos">146</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="SceneV2.lines-147"><a href="#SceneV2.lines-147"><span class="linenos">147</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="SceneV2.lines-148"><a href="#SceneV2.lines-148"><span class="linenos">148</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="SceneV2.lines-149"><a href="#SceneV2.lines-149"><span class="linenos">149</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2.lines-150"><a href="#SceneV2.lines-150"><span class="linenos">150</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2.lines-151"><a href="#SceneV2.lines-151"><span class="linenos">151</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2.lines-152"><a href="#SceneV2.lines-152"><span class="linenos">152</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2.lines-153"><a href="#SceneV2.lines-153"><span class="linenos">153</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="SceneV2.lines-154"><a href="#SceneV2.lines-154"><span class="linenos">154</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2.lines-155"><a href="#SceneV2.lines-155"><span class="linenos">155</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.lines-156"><a href="#SceneV2.lines-156"><span class="linenos">156</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.lines-157"><a href="#SceneV2.lines-157"><span class="linenos">157</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.lines-158"><a href="#SceneV2.lines-158"><span class="linenos">158</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.lines-159"><a href="#SceneV2.lines-159"><span class="linenos">159</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.lines-160"><a href="#SceneV2.lines-160"><span class="linenos">160</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="SceneV2.lines-161"><a href="#SceneV2.lines-161"><span class="linenos">161</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.lines-162"><a href="#SceneV2.lines-162"><span class="linenos">162</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.lines-163"><a href="#SceneV2.lines-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="SceneV2.lines-164"><a href="#SceneV2.lines-164"><span class="linenos">164</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="SceneV2.lines-165"><a href="#SceneV2.lines-165"><span class="linenos">165</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="SceneV2.lines-166"><a href="#SceneV2.lines-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="SceneV2.lines-167"><a href="#SceneV2.lines-167"><span class="linenos">167</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="SceneV2.lines-168"><a href="#SceneV2.lines-168"><span class="linenos">168</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="SceneV2.lines-169"><a href="#SceneV2.lines-169"><span class="linenos">169</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="SceneV2.lines-170"><a href="#SceneV2.lines-170"><span class="linenos">170</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2.lines-171"><a href="#SceneV2.lines-171"><span class="linenos">171</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2.lines-172"><a href="#SceneV2.lines-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="SceneV2.lines-173"><a href="#SceneV2.lines-173"><span class="linenos">173</span></a>            <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2.lines-174"><a href="#SceneV2.lines-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.lines-175"><a href="#SceneV2.lines-175"><span class="linenos">175</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="SceneV2.lines-176"><a href="#SceneV2.lines-176"><span class="linenos">176</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="SceneV2.lines-177"><a href="#SceneV2.lines-177"><span class="linenos">177</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SceneV2.lines-178"><a href="#SceneV2.lines-178"><span class="linenos">178</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2.lines-179"><a href="#SceneV2.lines-179"><span class="linenos">179</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2.lines-180"><a href="#SceneV2.lines-180"><span class="linenos">180</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2.lines-181"><a href="#SceneV2.lines-181"><span class="linenos">181</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="SceneV2.lines-182"><a href="#SceneV2.lines-182"><span class="linenos">182</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2.lines-183"><a href="#SceneV2.lines-183"><span class="linenos">183</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2.lines-184"><a href="#SceneV2.lines-184"><span class="linenos">184</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2.lines-185"><a href="#SceneV2.lines-185"><span class="linenos">185</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2.lines-186"><a href="#SceneV2.lines-186"><span class="linenos">186</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="SceneV2.lines-187"><a href="#SceneV2.lines-187"><span class="linenos">187</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2.lines-188"><a href="#SceneV2.lines-188"><span class="linenos">188</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2.lines-189"><a href="#SceneV2.lines-189"><span class="linenos">189</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2.lines-190"><a href="#SceneV2.lines-190"><span class="linenos">190</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2.lines-191"><a href="#SceneV2.lines-191"><span class="linenos">191</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare multi-lines inside the scene.</p>

<p>Note that under current situation, for example, there you have 4 vertices,
vertices.shape[0] is 4. So there will be 2 lines, the first line's two points
are vertices[0] and vertices[1], and the second line's two points are
vertices[2] and vertices[3].</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of points of lines.
    width: the line width (maybe different on different systems).
    indices: a taichi int field of shape (2 * #points), which indicate
        the points indices of the lines. If this is None, then it is
        assumed that the points are already arranged in lines order.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of the line.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw. There are 2 cases that we will change your
        <code>vertex_count</code>. [1] If the <code>vertex_count</code> is an odd number, then we
        will change it to <code>vertex_count</code> - 1. [2] If <code>vertex_offset</code> plus
        <code>vertex_count</code> greater than vertices.shape[0], then we will reduce
        <code>vertex_count</code> to no more than vertices.shape[0].
    index_offset (int, optional):
        Only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        Only available when <code>indices</code> is provided, which is the number
        of vertices to draw.</p>
</div>


                            </div>
                            <div id="SceneV2.mesh" class="classattr">
                                        <input id="SceneV2.mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normals</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.mesh-193"><a href="#SceneV2.mesh-193"><span class="linenos">193</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="SceneV2.mesh-194"><a href="#SceneV2.mesh-194"><span class="linenos">194</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2.mesh-195"><a href="#SceneV2.mesh-195"><span class="linenos">195</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2.mesh-196"><a href="#SceneV2.mesh-196"><span class="linenos">196</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh-197"><a href="#SceneV2.mesh-197"><span class="linenos">197</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh-198"><a href="#SceneV2.mesh-198"><span class="linenos">198</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2.mesh-199"><a href="#SceneV2.mesh-199"><span class="linenos">199</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh-200"><a href="#SceneV2.mesh-200"><span class="linenos">200</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2.mesh-201"><a href="#SceneV2.mesh-201"><span class="linenos">201</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.mesh-202"><a href="#SceneV2.mesh-202"><span class="linenos">202</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh-203"><a href="#SceneV2.mesh-203"><span class="linenos">203</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.mesh-204"><a href="#SceneV2.mesh-204"><span class="linenos">204</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh-205"><a href="#SceneV2.mesh-205"><span class="linenos">205</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2.mesh-206"><a href="#SceneV2.mesh-206"><span class="linenos">206</span></a>    <span class="p">):</span>
</span><span id="SceneV2.mesh-207"><a href="#SceneV2.mesh-207"><span class="linenos">207</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="SceneV2.mesh-208"><a href="#SceneV2.mesh-208"><span class="linenos">208</span></a>
</span><span id="SceneV2.mesh-209"><a href="#SceneV2.mesh-209"><span class="linenos">209</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="SceneV2.mesh-210"><a href="#SceneV2.mesh-210"><span class="linenos">210</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="SceneV2.mesh-211"><a href="#SceneV2.mesh-211"><span class="linenos">211</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="SceneV2.mesh-212"><a href="#SceneV2.mesh-212"><span class="linenos">212</span></a>
</span><span id="SceneV2.mesh-213"><a href="#SceneV2.mesh-213"><span class="linenos">213</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.mesh-214"><a href="#SceneV2.mesh-214"><span class="linenos">214</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.mesh-215"><a href="#SceneV2.mesh-215"><span class="linenos">215</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="SceneV2.mesh-216"><a href="#SceneV2.mesh-216"><span class="linenos">216</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="SceneV2.mesh-217"><a href="#SceneV2.mesh-217"><span class="linenos">217</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="SceneV2.mesh-218"><a href="#SceneV2.mesh-218"><span class="linenos">218</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="SceneV2.mesh-219"><a href="#SceneV2.mesh-219"><span class="linenos">219</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.mesh-220"><a href="#SceneV2.mesh-220"><span class="linenos">220</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="SceneV2.mesh-221"><a href="#SceneV2.mesh-221"><span class="linenos">221</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="SceneV2.mesh-222"><a href="#SceneV2.mesh-222"><span class="linenos">222</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2.mesh-223"><a href="#SceneV2.mesh-223"><span class="linenos">223</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2.mesh-224"><a href="#SceneV2.mesh-224"><span class="linenos">224</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2.mesh-225"><a href="#SceneV2.mesh-225"><span class="linenos">225</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="SceneV2.mesh-226"><a href="#SceneV2.mesh-226"><span class="linenos">226</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="SceneV2.mesh-227"><a href="#SceneV2.mesh-227"><span class="linenos">227</span></a><span class="sd">                seen from both sides.</span>
</span><span id="SceneV2.mesh-228"><a href="#SceneV2.mesh-228"><span class="linenos">228</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2.mesh-229"><a href="#SceneV2.mesh-229"><span class="linenos">229</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2.mesh-230"><a href="#SceneV2.mesh-230"><span class="linenos">230</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2.mesh-231"><a href="#SceneV2.mesh-231"><span class="linenos">231</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2.mesh-232"><a href="#SceneV2.mesh-232"><span class="linenos">232</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2.mesh-233"><a href="#SceneV2.mesh-233"><span class="linenos">233</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2.mesh-234"><a href="#SceneV2.mesh-234"><span class="linenos">234</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2.mesh-235"><a href="#SceneV2.mesh-235"><span class="linenos">235</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2.mesh-236"><a href="#SceneV2.mesh-236"><span class="linenos">236</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2.mesh-237"><a href="#SceneV2.mesh-237"><span class="linenos">237</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2.mesh-238"><a href="#SceneV2.mesh-238"><span class="linenos">238</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2.mesh-239"><a href="#SceneV2.mesh-239"><span class="linenos">239</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="SceneV2.mesh-240"><a href="#SceneV2.mesh-240"><span class="linenos">240</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2.mesh-241"><a href="#SceneV2.mesh-241"><span class="linenos">241</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="SceneV2.mesh-242"><a href="#SceneV2.mesh-242"><span class="linenos">242</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="SceneV2.mesh-243"><a href="#SceneV2.mesh-243"><span class="linenos">243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.mesh-244"><a href="#SceneV2.mesh-244"><span class="linenos">244</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2.mesh-245"><a href="#SceneV2.mesh-245"><span class="linenos">245</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh-246"><a href="#SceneV2.mesh-246"><span class="linenos">246</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="SceneV2.mesh-247"><a href="#SceneV2.mesh-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh-248"><a href="#SceneV2.mesh-248"><span class="linenos">248</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.mesh-249"><a href="#SceneV2.mesh-249"><span class="linenos">249</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh-250"><a href="#SceneV2.mesh-250"><span class="linenos">250</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh-251"><a href="#SceneV2.mesh-251"><span class="linenos">251</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="SceneV2.mesh-252"><a href="#SceneV2.mesh-252"><span class="linenos">252</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.mesh-253"><a href="#SceneV2.mesh-253"><span class="linenos">253</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.mesh-254"><a href="#SceneV2.mesh-254"><span class="linenos">254</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2.mesh-255"><a href="#SceneV2.mesh-255"><span class="linenos">255</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2.mesh-256"><a href="#SceneV2.mesh-256"><span class="linenos">256</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2.mesh-257"><a href="#SceneV2.mesh-257"><span class="linenos">257</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2.mesh-258"><a href="#SceneV2.mesh-258"><span class="linenos">258</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2.mesh-259"><a href="#SceneV2.mesh-259"><span class="linenos">259</span></a>
</span><span id="SceneV2.mesh-260"><a href="#SceneV2.mesh-260"><span class="linenos">260</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="SceneV2.mesh-261"><a href="#SceneV2.mesh-261"><span class="linenos">261</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2.mesh-262"><a href="#SceneV2.mesh-262"><span class="linenos">262</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2.mesh-263"><a href="#SceneV2.mesh-263"><span class="linenos">263</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2.mesh-264"><a href="#SceneV2.mesh-264"><span class="linenos">264</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2.mesh-265"><a href="#SceneV2.mesh-265"><span class="linenos">265</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="SceneV2.mesh-266"><a href="#SceneV2.mesh-266"><span class="linenos">266</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2.mesh-267"><a href="#SceneV2.mesh-267"><span class="linenos">267</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2.mesh-268"><a href="#SceneV2.mesh-268"><span class="linenos">268</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2.mesh-269"><a href="#SceneV2.mesh-269"><span class="linenos">269</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2.mesh-270"><a href="#SceneV2.mesh-270"><span class="linenos">270</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="SceneV2.mesh-271"><a href="#SceneV2.mesh-271"><span class="linenos">271</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare a mesh inside the scene.</p>

<p>if you indicate the index_offset and index_count, the normals will also
be sliced by the args, and the shading resultes will not be affected.
(It is equal to make a part of the mesh visible)</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of a vertex.
    indices: a taichi int field of shape (3 * #triangles), which indicate
        the vertex indices of the triangles. If this is None, then it is
        assumed that the vertices are already arranged in triangles order.
    normals: a taichi 3D Vector field, where each element indicate the
        normal of a vertex. If this is none, normals will be automatically
        inferred from vertex positions.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of a vertex.
    two_sided (bool): whether or not the triangles should be able to be
        seen from both sides.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw.
    index_offset (int, optional):
        only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        only available when <code>indices</code> is provided, which is the the number
        of vertices to draw.
    show_wireframe (bool, optional):
        turn on/off WareFrame mode.</p>
</div>


                            </div>
                            <div id="SceneV2.mesh_instance" class="classattr">
                                        <input id="SceneV2.mesh_instance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mesh_instance</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normals</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">transforms</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.mesh_instance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.mesh_instance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.mesh_instance-273"><a href="#SceneV2.mesh_instance-273"><span class="linenos">273</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="SceneV2.mesh_instance-274"><a href="#SceneV2.mesh_instance-274"><span class="linenos">274</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-275"><a href="#SceneV2.mesh_instance-275"><span class="linenos">275</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-276"><a href="#SceneV2.mesh_instance-276"><span class="linenos">276</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-277"><a href="#SceneV2.mesh_instance-277"><span class="linenos">277</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-278"><a href="#SceneV2.mesh_instance-278"><span class="linenos">278</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2.mesh_instance-279"><a href="#SceneV2.mesh_instance-279"><span class="linenos">279</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-280"><a href="#SceneV2.mesh_instance-280"><span class="linenos">280</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-281"><a href="#SceneV2.mesh_instance-281"><span class="linenos">281</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-282"><a href="#SceneV2.mesh_instance-282"><span class="linenos">282</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-283"><a href="#SceneV2.mesh_instance-283"><span class="linenos">283</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-284"><a href="#SceneV2.mesh_instance-284"><span class="linenos">284</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-285"><a href="#SceneV2.mesh_instance-285"><span class="linenos">285</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-286"><a href="#SceneV2.mesh_instance-286"><span class="linenos">286</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-287"><a href="#SceneV2.mesh_instance-287"><span class="linenos">287</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-288"><a href="#SceneV2.mesh_instance-288"><span class="linenos">288</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-289"><a href="#SceneV2.mesh_instance-289"><span class="linenos">289</span></a>    <span class="p">):</span>
</span><span id="SceneV2.mesh_instance-290"><a href="#SceneV2.mesh_instance-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="SceneV2.mesh_instance-291"><a href="#SceneV2.mesh_instance-291"><span class="linenos">291</span></a>
</span><span id="SceneV2.mesh_instance-292"><a href="#SceneV2.mesh_instance-292"><span class="linenos">292</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="SceneV2.mesh_instance-293"><a href="#SceneV2.mesh_instance-293"><span class="linenos">293</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="SceneV2.mesh_instance-294"><a href="#SceneV2.mesh_instance-294"><span class="linenos">294</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="SceneV2.mesh_instance-295"><a href="#SceneV2.mesh_instance-295"><span class="linenos">295</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="SceneV2.mesh_instance-296"><a href="#SceneV2.mesh_instance-296"><span class="linenos">296</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="SceneV2.mesh_instance-297"><a href="#SceneV2.mesh_instance-297"><span class="linenos">297</span></a>
</span><span id="SceneV2.mesh_instance-298"><a href="#SceneV2.mesh_instance-298"><span class="linenos">298</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.mesh_instance-299"><a href="#SceneV2.mesh_instance-299"><span class="linenos">299</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.mesh_instance-300"><a href="#SceneV2.mesh_instance-300"><span class="linenos">300</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="SceneV2.mesh_instance-301"><a href="#SceneV2.mesh_instance-301"><span class="linenos">301</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="SceneV2.mesh_instance-302"><a href="#SceneV2.mesh_instance-302"><span class="linenos">302</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="SceneV2.mesh_instance-303"><a href="#SceneV2.mesh_instance-303"><span class="linenos">303</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="SceneV2.mesh_instance-304"><a href="#SceneV2.mesh_instance-304"><span class="linenos">304</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.mesh_instance-305"><a href="#SceneV2.mesh_instance-305"><span class="linenos">305</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="SceneV2.mesh_instance-306"><a href="#SceneV2.mesh_instance-306"><span class="linenos">306</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="SceneV2.mesh_instance-307"><a href="#SceneV2.mesh_instance-307"><span class="linenos">307</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="SceneV2.mesh_instance-308"><a href="#SceneV2.mesh_instance-308"><span class="linenos">308</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2.mesh_instance-309"><a href="#SceneV2.mesh_instance-309"><span class="linenos">309</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="SceneV2.mesh_instance-310"><a href="#SceneV2.mesh_instance-310"><span class="linenos">310</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="SceneV2.mesh_instance-311"><a href="#SceneV2.mesh_instance-311"><span class="linenos">311</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="SceneV2.mesh_instance-312"><a href="#SceneV2.mesh_instance-312"><span class="linenos">312</span></a><span class="sd">                seen from both sides.</span>
</span><span id="SceneV2.mesh_instance-313"><a href="#SceneV2.mesh_instance-313"><span class="linenos">313</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="SceneV2.mesh_instance-314"><a href="#SceneV2.mesh_instance-314"><span class="linenos">314</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="SceneV2.mesh_instance-315"><a href="#SceneV2.mesh_instance-315"><span class="linenos">315</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="SceneV2.mesh_instance-316"><a href="#SceneV2.mesh_instance-316"><span class="linenos">316</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="SceneV2.mesh_instance-317"><a href="#SceneV2.mesh_instance-317"><span class="linenos">317</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="SceneV2.mesh_instance-318"><a href="#SceneV2.mesh_instance-318"><span class="linenos">318</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="SceneV2.mesh_instance-319"><a href="#SceneV2.mesh_instance-319"><span class="linenos">319</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="SceneV2.mesh_instance-320"><a href="#SceneV2.mesh_instance-320"><span class="linenos">320</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="SceneV2.mesh_instance-321"><a href="#SceneV2.mesh_instance-321"><span class="linenos">321</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="SceneV2.mesh_instance-322"><a href="#SceneV2.mesh_instance-322"><span class="linenos">322</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="SceneV2.mesh_instance-323"><a href="#SceneV2.mesh_instance-323"><span class="linenos">323</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="SceneV2.mesh_instance-324"><a href="#SceneV2.mesh_instance-324"><span class="linenos">324</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="SceneV2.mesh_instance-325"><a href="#SceneV2.mesh_instance-325"><span class="linenos">325</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="SceneV2.mesh_instance-326"><a href="#SceneV2.mesh_instance-326"><span class="linenos">326</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="SceneV2.mesh_instance-327"><a href="#SceneV2.mesh_instance-327"><span class="linenos">327</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="SceneV2.mesh_instance-328"><a href="#SceneV2.mesh_instance-328"><span class="linenos">328</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2.mesh_instance-329"><a href="#SceneV2.mesh_instance-329"><span class="linenos">329</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="SceneV2.mesh_instance-330"><a href="#SceneV2.mesh_instance-330"><span class="linenos">330</span></a><span class="sd">                within the index buffer.</span>
</span><span id="SceneV2.mesh_instance-331"><a href="#SceneV2.mesh_instance-331"><span class="linenos">331</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2.mesh_instance-332"><a href="#SceneV2.mesh_instance-332"><span class="linenos">332</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="SceneV2.mesh_instance-333"><a href="#SceneV2.mesh_instance-333"><span class="linenos">333</span></a><span class="sd">                of indices to draw.</span>
</span><span id="SceneV2.mesh_instance-334"><a href="#SceneV2.mesh_instance-334"><span class="linenos">334</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="SceneV2.mesh_instance-335"><a href="#SceneV2.mesh_instance-335"><span class="linenos">335</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="SceneV2.mesh_instance-336"><a href="#SceneV2.mesh_instance-336"><span class="linenos">336</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.mesh_instance-337"><a href="#SceneV2.mesh_instance-337"><span class="linenos">337</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2.mesh_instance-338"><a href="#SceneV2.mesh_instance-338"><span class="linenos">338</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-339"><a href="#SceneV2.mesh_instance-339"><span class="linenos">339</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-340"><a href="#SceneV2.mesh_instance-340"><span class="linenos">340</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-341"><a href="#SceneV2.mesh_instance-341"><span class="linenos">341</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.mesh_instance-342"><a href="#SceneV2.mesh_instance-342"><span class="linenos">342</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-343"><a href="#SceneV2.mesh_instance-343"><span class="linenos">343</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-344"><a href="#SceneV2.mesh_instance-344"><span class="linenos">344</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="SceneV2.mesh_instance-345"><a href="#SceneV2.mesh_instance-345"><span class="linenos">345</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-346"><a href="#SceneV2.mesh_instance-346"><span class="linenos">346</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.mesh_instance-347"><a href="#SceneV2.mesh_instance-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-348"><a href="#SceneV2.mesh_instance-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-349"><a href="#SceneV2.mesh_instance-349"><span class="linenos">349</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-350"><a href="#SceneV2.mesh_instance-350"><span class="linenos">350</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-351"><a href="#SceneV2.mesh_instance-351"><span class="linenos">351</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.mesh_instance-352"><a href="#SceneV2.mesh_instance-352"><span class="linenos">352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.mesh_instance-353"><a href="#SceneV2.mesh_instance-353"><span class="linenos">353</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="SceneV2.mesh_instance-354"><a href="#SceneV2.mesh_instance-354"><span class="linenos">354</span></a>
</span><span id="SceneV2.mesh_instance-355"><a href="#SceneV2.mesh_instance-355"><span class="linenos">355</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-356"><a href="#SceneV2.mesh_instance-356"><span class="linenos">356</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-357"><a href="#SceneV2.mesh_instance-357"><span class="linenos">357</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-358"><a href="#SceneV2.mesh_instance-358"><span class="linenos">358</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field_v2</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2.mesh_instance-359"><a href="#SceneV2.mesh_instance-359"><span class="linenos">359</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-360"><a href="#SceneV2.mesh_instance-360"><span class="linenos">360</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field_v2</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="SceneV2.mesh_instance-361"><a href="#SceneV2.mesh_instance-361"><span class="linenos">361</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="SceneV2.mesh_instance-362"><a href="#SceneV2.mesh_instance-362"><span class="linenos">362</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="SceneV2.mesh_instance-363"><a href="#SceneV2.mesh_instance-363"><span class="linenos">363</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-364"><a href="#SceneV2.mesh_instance-364"><span class="linenos">364</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-365"><a href="#SceneV2.mesh_instance-365"><span class="linenos">365</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-366"><a href="#SceneV2.mesh_instance-366"><span class="linenos">366</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-367"><a href="#SceneV2.mesh_instance-367"><span class="linenos">367</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-368"><a href="#SceneV2.mesh_instance-368"><span class="linenos">368</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-369"><a href="#SceneV2.mesh_instance-369"><span class="linenos">369</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-370"><a href="#SceneV2.mesh_instance-370"><span class="linenos">370</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-371"><a href="#SceneV2.mesh_instance-371"><span class="linenos">371</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-372"><a href="#SceneV2.mesh_instance-372"><span class="linenos">372</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-373"><a href="#SceneV2.mesh_instance-373"><span class="linenos">373</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-374"><a href="#SceneV2.mesh_instance-374"><span class="linenos">374</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-375"><a href="#SceneV2.mesh_instance-375"><span class="linenos">375</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="SceneV2.mesh_instance-376"><a href="#SceneV2.mesh_instance-376"><span class="linenos">376</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare mesh instances inside the scene.</p>

<p>If transforms is given, then according to the shape of transforms, it will
draw mesh instances based on the transforms, and you can indicate which instance
to draw first. If you indicate the index_offset and index_count, the normals will also
be sliced by the args, and the shading resultes will not be affected.
(It is equal to make a part of the mesh visible)</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of a vertex.
    indices: a taichi int field of shape (3 * #triangles), which indicate
        the vertex indices of the triangles. If this is None, then it is
        assumed that the vertices are already arranged in triangles order.
    normals: a taichi 3D Vector field, where each element indicate the
        normal of a vertex. If this is none, normals will be automatically
        inferred from vertex positions.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of a vertex.
    two_sided (bool): whether or not the triangles should be able to be
        seen from both sides.
    transforms (ti.Matrix.field, optional):
        The Matrix must be 4x4 size with N instances, and data type should
        be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).
    instance_offset (int, optional):
        Default value is 0 which means no offset to show mesh instances. Otherwise,
        the mesh instances will show from the <code>instance_offset</code>.
    instance_count (int, optional):
        The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw.
    index_offset (int, optional):
        only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        only available when <code>indices</code> is provided, which is the the number
        of indices to draw.
    show_wireframe (bool, optional):
        turn on/off WareFrame mode.</p>
</div>


                            </div>
                            <div id="SceneV2.particles" class="classattr">
                                        <input id="SceneV2.particles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">particles</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">centers</span>,</span><span class="param">	<span class="n">radius</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.particles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.particles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.particles-378"><a href="#SceneV2.particles-378"><span class="linenos">378</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="SceneV2.particles-379"><a href="#SceneV2.particles-379"><span class="linenos">379</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SceneV2.particles-380"><a href="#SceneV2.particles-380"><span class="linenos">380</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="SceneV2.particles-381"><a href="#SceneV2.particles-381"><span class="linenos">381</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="SceneV2.particles-382"><a href="#SceneV2.particles-382"><span class="linenos">382</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="SceneV2.particles-383"><a href="#SceneV2.particles-383"><span class="linenos">383</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.particles-384"><a href="#SceneV2.particles-384"><span class="linenos">384</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.particles-385"><a href="#SceneV2.particles-385"><span class="linenos">385</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.particles-386"><a href="#SceneV2.particles-386"><span class="linenos">386</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SceneV2.particles-387"><a href="#SceneV2.particles-387"><span class="linenos">387</span></a>    <span class="p">):</span>
</span><span id="SceneV2.particles-388"><a href="#SceneV2.particles-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="SceneV2.particles-389"><a href="#SceneV2.particles-389"><span class="linenos">389</span></a>
</span><span id="SceneV2.particles-390"><a href="#SceneV2.particles-390"><span class="linenos">390</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.particles-391"><a href="#SceneV2.particles-391"><span class="linenos">391</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="SceneV2.particles-392"><a href="#SceneV2.particles-392"><span class="linenos">392</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="SceneV2.particles-393"><a href="#SceneV2.particles-393"><span class="linenos">393</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="SceneV2.particles-394"><a href="#SceneV2.particles-394"><span class="linenos">394</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="SceneV2.particles-395"><a href="#SceneV2.particles-395"><span class="linenos">395</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="SceneV2.particles-396"><a href="#SceneV2.particles-396"><span class="linenos">396</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="SceneV2.particles-397"><a href="#SceneV2.particles-397"><span class="linenos">397</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="SceneV2.particles-398"><a href="#SceneV2.particles-398"><span class="linenos">398</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="SceneV2.particles-399"><a href="#SceneV2.particles-399"><span class="linenos">399</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="SceneV2.particles-400"><a href="#SceneV2.particles-400"><span class="linenos">400</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="SceneV2.particles-401"><a href="#SceneV2.particles-401"><span class="linenos">401</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="SceneV2.particles-402"><a href="#SceneV2.particles-402"><span class="linenos">402</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="SceneV2.particles-403"><a href="#SceneV2.particles-403"><span class="linenos">403</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="SceneV2.particles-404"><a href="#SceneV2.particles-404"><span class="linenos">404</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="SceneV2.particles-405"><a href="#SceneV2.particles-405"><span class="linenos">405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.particles-406"><a href="#SceneV2.particles-406"><span class="linenos">406</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2.particles-407"><a href="#SceneV2.particles-407"><span class="linenos">407</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="SceneV2.particles-408"><a href="#SceneV2.particles-408"><span class="linenos">408</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SceneV2.particles-409"><a href="#SceneV2.particles-409"><span class="linenos">409</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SceneV2.particles-410"><a href="#SceneV2.particles-410"><span class="linenos">410</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="SceneV2.particles-411"><a href="#SceneV2.particles-411"><span class="linenos">411</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field_v2</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="SceneV2.particles-412"><a href="#SceneV2.particles-412"><span class="linenos">412</span></a>
</span><span id="SceneV2.particles-413"><a href="#SceneV2.particles-413"><span class="linenos">413</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">centers</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
</span><span id="SceneV2.particles-414"><a href="#SceneV2.particles-414"><span class="linenos">414</span></a>            <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="SceneV2.particles-415"><a href="#SceneV2.particles-415"><span class="linenos">415</span></a>                <span class="n">vbo</span><span class="p">,</span>
</span><span id="SceneV2.particles-416"><a href="#SceneV2.particles-416"><span class="linenos">416</span></a>                <span class="n">centers</span><span class="p">,</span>
</span><span id="SceneV2.particles-417"><a href="#SceneV2.particles-417"><span class="linenos">417</span></a>                <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.particles-418"><a href="#SceneV2.particles-418"><span class="linenos">418</span></a>                <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="SceneV2.particles-419"><a href="#SceneV2.particles-419"><span class="linenos">419</span></a>            <span class="p">)</span>
</span><span id="SceneV2.particles-420"><a href="#SceneV2.particles-420"><span class="linenos">420</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SceneV2.particles-421"><a href="#SceneV2.particles-421"><span class="linenos">421</span></a>            <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">centers</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
</span><span id="SceneV2.particles-422"><a href="#SceneV2.particles-422"><span class="linenos">422</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_radius</span><span class="p">:</span>
</span><span id="SceneV2.particles-423"><a href="#SceneV2.particles-423"><span class="linenos">423</span></a>                <span class="n">copy_to_vbo_scalar</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_radius</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="SceneV2.particles-424"><a href="#SceneV2.particles-424"><span class="linenos">424</span></a>            <span class="k">if</span> <span class="n">has_per_vertex_color</span><span class="p">:</span>
</span><span id="SceneV2.particles-425"><a href="#SceneV2.particles-425"><span class="linenos">425</span></a>                <span class="n">copy_to_vbo_vector</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">per_vertex_color</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">taichi</span><span class="o">.</span><span class="n">Vector</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="SceneV2.particles-426"><a href="#SceneV2.particles-426"><span class="linenos">426</span></a>
</span><span id="SceneV2.particles-427"><a href="#SceneV2.particles-427"><span class="linenos">427</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="SceneV2.particles-428"><a href="#SceneV2.particles-428"><span class="linenos">428</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="SceneV2.particles-429"><a href="#SceneV2.particles-429"><span class="linenos">429</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="SceneV2.particles-430"><a href="#SceneV2.particles-430"><span class="linenos">430</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare a set of particles within the scene.</p>

<p>Args:
    centers: a taichi 3D Vector field, where each element indicate the
        3D location of the center of a particle.
    color: a global color for the particles as 3 floats representing RGB
        values. If <code>per_vertex_color</code> is provided, this is ignored.
    radius: a global radius for the particles as a float.
        If 'per_vertex_radius' is provided, this is ignored.
    per_vertex_color: a taichi 3D vector field, where each
        element indicates the RGB color of a particle.
    per_vertex_radius: a taichi float field, where each
        element indicates the radius of a particle.
    index_offset (int, optional):
        the index of the first vertex to draw.
    index_count (int, optional):
        the number of vertices to draw.</p>
</div>


                            </div>
                            <div id="SceneV2.point_light" class="classattr">
                                        <input id="SceneV2.point_light-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">point_light</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pos</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.point_light-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.point_light"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.point_light-432"><a href="#SceneV2.point_light-432"><span class="linenos">432</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="SceneV2.point_light-433"><a href="#SceneV2.point_light-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="SceneV2.point_light-434"><a href="#SceneV2.point_light-434"><span class="linenos">434</span></a>
</span><span id="SceneV2.point_light-435"><a href="#SceneV2.point_light-435"><span class="linenos">435</span></a><span class="sd">        Args:</span>
</span><span id="SceneV2.point_light-436"><a href="#SceneV2.point_light-436"><span class="linenos">436</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="SceneV2.point_light-437"><a href="#SceneV2.point_light-437"><span class="linenos">437</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="SceneV2.point_light-438"><a href="#SceneV2.point_light-438"><span class="linenos">438</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="SceneV2.point_light-439"><a href="#SceneV2.point_light-439"><span class="linenos">439</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="SceneV2.point_light-440"><a href="#SceneV2.point_light-440"><span class="linenos">440</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.point_light-441"><a href="#SceneV2.point_light-441"><span class="linenos">441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Set a point light in this scene.</p>

<p>Args:
    pos (list, tuple, <code>~taichi.types.vector(3, float)</code>):
        3D vector for light position.
    color (list, tuple, <code>~taichi.types.vector(3, float)</code>):
        (r, g, b) triple for the color of the light, in the range [0, 1].</p>
</div>


                            </div>
                            <div id="SceneV2.ambient_light" class="classattr">
                                        <input id="SceneV2.ambient_light-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ambient_light</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="SceneV2.ambient_light-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SceneV2.ambient_light"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SceneV2.ambient_light-443"><a href="#SceneV2.ambient_light-443"><span class="linenos">443</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="SceneV2.ambient_light-444"><a href="#SceneV2.ambient_light-444"><span class="linenos">444</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="SceneV2.ambient_light-445"><a href="#SceneV2.ambient_light-445"><span class="linenos">445</span></a>
</span><span id="SceneV2.ambient_light-446"><a href="#SceneV2.ambient_light-446"><span class="linenos">446</span></a><span class="sd">        Example::</span>
</span><span id="SceneV2.ambient_light-447"><a href="#SceneV2.ambient_light-447"><span class="linenos">447</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="SceneV2.ambient_light-448"><a href="#SceneV2.ambient_light-448"><span class="linenos">448</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SceneV2.ambient_light-449"><a href="#SceneV2.ambient_light-449"><span class="linenos">449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Set the ambient color of this scene.</p>

<p>Example::</p>

<blockquote>
  <blockquote>
    <blockquote>
      <p>scene.ambient_light([0.2, 0.2, 0.2])</p>
    </blockquote>
  </blockquote>
</blockquote>
</div>


                            </div>
                </section>
                <section id="Scene">
                            <input id="Scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Scene</span>:

                <label class="view-source-button" for="Scene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene-452"><a href="#Scene-452"><span class="linenos">452</span></a><span class="k">class</span><span class="w"> </span><span class="nc">Scene</span><span class="p">:</span>
</span><span id="Scene-453"><a href="#Scene-453"><span class="linenos">453</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The old 3D scene class, which can contain meshes, lines and particles,</span>
</span><span id="Scene-454"><a href="#Scene-454"><span class="linenos">454</span></a><span class="sd">    and can be rendered on a canvas.</span>
</span><span id="Scene-455"><a href="#Scene-455"><span class="linenos">455</span></a><span class="sd">    This scene class is to be instantiated directly and is deprecated.</span>
</span><span id="Scene-456"><a href="#Scene-456"><span class="linenos">456</span></a><span class="sd">    Use the new SceneV2 class instead, which can be retrieved using the</span>
</span><span id="Scene-457"><a href="#Scene-457"><span class="linenos">457</span></a><span class="sd">    get_scene() function of a taichi.ui.Window.</span>
</span><span id="Scene-458"><a href="#Scene-458"><span class="linenos">458</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Scene-459"><a href="#Scene-459"><span class="linenos">459</span></a>
</span><span id="Scene-460"><a href="#Scene-460"><span class="linenos">460</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Scene-461"><a href="#Scene-461"><span class="linenos">461</span></a>        <span class="n">check_ggui_availability</span><span class="p">()</span>
</span><span id="Scene-462"><a href="#Scene-462"><span class="linenos">462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">_ti_core</span><span class="o">.</span><span class="n">PyScene</span><span class="p">()</span>
</span><span id="Scene-463"><a href="#Scene-463"><span class="linenos">463</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="Scene-464"><a href="#Scene-464"><span class="linenos">464</span></a>            <span class="s2">&quot;Instantiating ti.ui.Scene directly is deprecated, use the get_scene() function from a taichi.ui.Window object instead.&quot;</span><span class="p">,</span>
</span><span id="Scene-465"><a href="#Scene-465"><span class="linenos">465</span></a>            <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="Scene-466"><a href="#Scene-466"><span class="linenos">466</span></a>        <span class="p">)</span>
</span><span id="Scene-467"><a href="#Scene-467"><span class="linenos">467</span></a>
</span><span id="Scene-468"><a href="#Scene-468"><span class="linenos">468</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="Scene-469"><a href="#Scene-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="Scene-470"><a href="#Scene-470"><span class="linenos">470</span></a>
</span><span id="Scene-471"><a href="#Scene-471"><span class="linenos">471</span></a><span class="sd">        Args:</span>
</span><span id="Scene-472"><a href="#Scene-472"><span class="linenos">472</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="Scene-473"><a href="#Scene-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-474"><a href="#Scene-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span><span id="Scene-475"><a href="#Scene-475"><span class="linenos">475</span></a>
</span><span id="Scene-476"><a href="#Scene-476"><span class="linenos">476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="Scene-477"><a href="#Scene-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene-478"><a href="#Scene-478"><span class="linenos">478</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene-479"><a href="#Scene-479"><span class="linenos">479</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="Scene-480"><a href="#Scene-480"><span class="linenos">480</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-481"><a href="#Scene-481"><span class="linenos">481</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene-482"><a href="#Scene-482"><span class="linenos">482</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-483"><a href="#Scene-483"><span class="linenos">483</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-484"><a href="#Scene-484"><span class="linenos">484</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-485"><a href="#Scene-485"><span class="linenos">485</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-486"><a href="#Scene-486"><span class="linenos">486</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-487"><a href="#Scene-487"><span class="linenos">487</span></a>    <span class="p">):</span>
</span><span id="Scene-488"><a href="#Scene-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="Scene-489"><a href="#Scene-489"><span class="linenos">489</span></a>
</span><span id="Scene-490"><a href="#Scene-490"><span class="linenos">490</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="Scene-491"><a href="#Scene-491"><span class="linenos">491</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="Scene-492"><a href="#Scene-492"><span class="linenos">492</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="Scene-493"><a href="#Scene-493"><span class="linenos">493</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="Scene-494"><a href="#Scene-494"><span class="linenos">494</span></a>
</span><span id="Scene-495"><a href="#Scene-495"><span class="linenos">495</span></a><span class="sd">        Args:</span>
</span><span id="Scene-496"><a href="#Scene-496"><span class="linenos">496</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-497"><a href="#Scene-497"><span class="linenos">497</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="Scene-498"><a href="#Scene-498"><span class="linenos">498</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="Scene-499"><a href="#Scene-499"><span class="linenos">499</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="Scene-500"><a href="#Scene-500"><span class="linenos">500</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="Scene-501"><a href="#Scene-501"><span class="linenos">501</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="Scene-502"><a href="#Scene-502"><span class="linenos">502</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene-503"><a href="#Scene-503"><span class="linenos">503</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene-504"><a href="#Scene-504"><span class="linenos">504</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene-505"><a href="#Scene-505"><span class="linenos">505</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="Scene-506"><a href="#Scene-506"><span class="linenos">506</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene-507"><a href="#Scene-507"><span class="linenos">507</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene-508"><a href="#Scene-508"><span class="linenos">508</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene-509"><a href="#Scene-509"><span class="linenos">509</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene-510"><a href="#Scene-510"><span class="linenos">510</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene-511"><a href="#Scene-511"><span class="linenos">511</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene-512"><a href="#Scene-512"><span class="linenos">512</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="Scene-513"><a href="#Scene-513"><span class="linenos">513</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="Scene-514"><a href="#Scene-514"><span class="linenos">514</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="Scene-515"><a href="#Scene-515"><span class="linenos">515</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="Scene-516"><a href="#Scene-516"><span class="linenos">516</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="Scene-517"><a href="#Scene-517"><span class="linenos">517</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene-518"><a href="#Scene-518"><span class="linenos">518</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="Scene-519"><a href="#Scene-519"><span class="linenos">519</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene-520"><a href="#Scene-520"><span class="linenos">520</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene-521"><a href="#Scene-521"><span class="linenos">521</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="Scene-522"><a href="#Scene-522"><span class="linenos">522</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene-523"><a href="#Scene-523"><span class="linenos">523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-524"><a href="#Scene-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-525"><a href="#Scene-525"><span class="linenos">525</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-526"><a href="#Scene-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-527"><a href="#Scene-527"><span class="linenos">527</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-528"><a href="#Scene-528"><span class="linenos">528</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="Scene-529"><a href="#Scene-529"><span class="linenos">529</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene-530"><a href="#Scene-530"><span class="linenos">530</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-531"><a href="#Scene-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Scene-532"><a href="#Scene-532"><span class="linenos">532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="Scene-533"><a href="#Scene-533"><span class="linenos">533</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Scene-534"><a href="#Scene-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Scene-535"><a href="#Scene-535"><span class="linenos">535</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="Scene-536"><a href="#Scene-536"><span class="linenos">536</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="Scene-537"><a href="#Scene-537"><span class="linenos">537</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="Scene-538"><a href="#Scene-538"><span class="linenos">538</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene-539"><a href="#Scene-539"><span class="linenos">539</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene-540"><a href="#Scene-540"><span class="linenos">540</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene-541"><a href="#Scene-541"><span class="linenos">541</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene-542"><a href="#Scene-542"><span class="linenos">542</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene-543"><a href="#Scene-543"><span class="linenos">543</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene-544"><a href="#Scene-544"><span class="linenos">544</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="Scene-545"><a href="#Scene-545"><span class="linenos">545</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene-546"><a href="#Scene-546"><span class="linenos">546</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene-547"><a href="#Scene-547"><span class="linenos">547</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene-548"><a href="#Scene-548"><span class="linenos">548</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene-549"><a href="#Scene-549"><span class="linenos">549</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="Scene-550"><a href="#Scene-550"><span class="linenos">550</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene-551"><a href="#Scene-551"><span class="linenos">551</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene-552"><a href="#Scene-552"><span class="linenos">552</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene-553"><a href="#Scene-553"><span class="linenos">553</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene-554"><a href="#Scene-554"><span class="linenos">554</span></a>        <span class="p">)</span>
</span><span id="Scene-555"><a href="#Scene-555"><span class="linenos">555</span></a>
</span><span id="Scene-556"><a href="#Scene-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="Scene-557"><a href="#Scene-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene-558"><a href="#Scene-558"><span class="linenos">558</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene-559"><a href="#Scene-559"><span class="linenos">559</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-560"><a href="#Scene-560"><span class="linenos">560</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-561"><a href="#Scene-561"><span class="linenos">561</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene-562"><a href="#Scene-562"><span class="linenos">562</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-563"><a href="#Scene-563"><span class="linenos">563</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Scene-564"><a href="#Scene-564"><span class="linenos">564</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-565"><a href="#Scene-565"><span class="linenos">565</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-566"><a href="#Scene-566"><span class="linenos">566</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-567"><a href="#Scene-567"><span class="linenos">567</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-568"><a href="#Scene-568"><span class="linenos">568</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Scene-569"><a href="#Scene-569"><span class="linenos">569</span></a>    <span class="p">):</span>
</span><span id="Scene-570"><a href="#Scene-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="Scene-571"><a href="#Scene-571"><span class="linenos">571</span></a>
</span><span id="Scene-572"><a href="#Scene-572"><span class="linenos">572</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="Scene-573"><a href="#Scene-573"><span class="linenos">573</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="Scene-574"><a href="#Scene-574"><span class="linenos">574</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="Scene-575"><a href="#Scene-575"><span class="linenos">575</span></a>
</span><span id="Scene-576"><a href="#Scene-576"><span class="linenos">576</span></a><span class="sd">        Args:</span>
</span><span id="Scene-577"><a href="#Scene-577"><span class="linenos">577</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-578"><a href="#Scene-578"><span class="linenos">578</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="Scene-579"><a href="#Scene-579"><span class="linenos">579</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="Scene-580"><a href="#Scene-580"><span class="linenos">580</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="Scene-581"><a href="#Scene-581"><span class="linenos">581</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="Scene-582"><a href="#Scene-582"><span class="linenos">582</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-583"><a href="#Scene-583"><span class="linenos">583</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="Scene-584"><a href="#Scene-584"><span class="linenos">584</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="Scene-585"><a href="#Scene-585"><span class="linenos">585</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene-586"><a href="#Scene-586"><span class="linenos">586</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene-587"><a href="#Scene-587"><span class="linenos">587</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene-588"><a href="#Scene-588"><span class="linenos">588</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="Scene-589"><a href="#Scene-589"><span class="linenos">589</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="Scene-590"><a href="#Scene-590"><span class="linenos">590</span></a><span class="sd">                seen from both sides.</span>
</span><span id="Scene-591"><a href="#Scene-591"><span class="linenos">591</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene-592"><a href="#Scene-592"><span class="linenos">592</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene-593"><a href="#Scene-593"><span class="linenos">593</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene-594"><a href="#Scene-594"><span class="linenos">594</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene-595"><a href="#Scene-595"><span class="linenos">595</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene-596"><a href="#Scene-596"><span class="linenos">596</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene-597"><a href="#Scene-597"><span class="linenos">597</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene-598"><a href="#Scene-598"><span class="linenos">598</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene-599"><a href="#Scene-599"><span class="linenos">599</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="Scene-600"><a href="#Scene-600"><span class="linenos">600</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene-601"><a href="#Scene-601"><span class="linenos">601</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene-602"><a href="#Scene-602"><span class="linenos">602</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="Scene-603"><a href="#Scene-603"><span class="linenos">603</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene-604"><a href="#Scene-604"><span class="linenos">604</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="Scene-605"><a href="#Scene-605"><span class="linenos">605</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="Scene-606"><a href="#Scene-606"><span class="linenos">606</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-607"><a href="#Scene-607"><span class="linenos">607</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene-608"><a href="#Scene-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-609"><a href="#Scene-609"><span class="linenos">609</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="Scene-610"><a href="#Scene-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-611"><a href="#Scene-611"><span class="linenos">611</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-612"><a href="#Scene-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-613"><a href="#Scene-613"><span class="linenos">613</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-614"><a href="#Scene-614"><span class="linenos">614</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="Scene-615"><a href="#Scene-615"><span class="linenos">615</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene-616"><a href="#Scene-616"><span class="linenos">616</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-617"><a href="#Scene-617"><span class="linenos">617</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene-618"><a href="#Scene-618"><span class="linenos">618</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene-619"><a href="#Scene-619"><span class="linenos">619</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene-620"><a href="#Scene-620"><span class="linenos">620</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene-621"><a href="#Scene-621"><span class="linenos">621</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene-622"><a href="#Scene-622"><span class="linenos">622</span></a>
</span><span id="Scene-623"><a href="#Scene-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="Scene-624"><a href="#Scene-624"><span class="linenos">624</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene-625"><a href="#Scene-625"><span class="linenos">625</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene-626"><a href="#Scene-626"><span class="linenos">626</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene-627"><a href="#Scene-627"><span class="linenos">627</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene-628"><a href="#Scene-628"><span class="linenos">628</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="Scene-629"><a href="#Scene-629"><span class="linenos">629</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene-630"><a href="#Scene-630"><span class="linenos">630</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene-631"><a href="#Scene-631"><span class="linenos">631</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene-632"><a href="#Scene-632"><span class="linenos">632</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene-633"><a href="#Scene-633"><span class="linenos">633</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="Scene-634"><a href="#Scene-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span><span id="Scene-635"><a href="#Scene-635"><span class="linenos">635</span></a>
</span><span id="Scene-636"><a href="#Scene-636"><span class="linenos">636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="Scene-637"><a href="#Scene-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene-638"><a href="#Scene-638"><span class="linenos">638</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene-639"><a href="#Scene-639"><span class="linenos">639</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-640"><a href="#Scene-640"><span class="linenos">640</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-641"><a href="#Scene-641"><span class="linenos">641</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene-642"><a href="#Scene-642"><span class="linenos">642</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-643"><a href="#Scene-643"><span class="linenos">643</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Scene-644"><a href="#Scene-644"><span class="linenos">644</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-645"><a href="#Scene-645"><span class="linenos">645</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-646"><a href="#Scene-646"><span class="linenos">646</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-647"><a href="#Scene-647"><span class="linenos">647</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-648"><a href="#Scene-648"><span class="linenos">648</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-649"><a href="#Scene-649"><span class="linenos">649</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-650"><a href="#Scene-650"><span class="linenos">650</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-651"><a href="#Scene-651"><span class="linenos">651</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Scene-652"><a href="#Scene-652"><span class="linenos">652</span></a>    <span class="p">):</span>
</span><span id="Scene-653"><a href="#Scene-653"><span class="linenos">653</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="Scene-654"><a href="#Scene-654"><span class="linenos">654</span></a>
</span><span id="Scene-655"><a href="#Scene-655"><span class="linenos">655</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="Scene-656"><a href="#Scene-656"><span class="linenos">656</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="Scene-657"><a href="#Scene-657"><span class="linenos">657</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="Scene-658"><a href="#Scene-658"><span class="linenos">658</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="Scene-659"><a href="#Scene-659"><span class="linenos">659</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="Scene-660"><a href="#Scene-660"><span class="linenos">660</span></a>
</span><span id="Scene-661"><a href="#Scene-661"><span class="linenos">661</span></a><span class="sd">        Args:</span>
</span><span id="Scene-662"><a href="#Scene-662"><span class="linenos">662</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-663"><a href="#Scene-663"><span class="linenos">663</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="Scene-664"><a href="#Scene-664"><span class="linenos">664</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="Scene-665"><a href="#Scene-665"><span class="linenos">665</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="Scene-666"><a href="#Scene-666"><span class="linenos">666</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="Scene-667"><a href="#Scene-667"><span class="linenos">667</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-668"><a href="#Scene-668"><span class="linenos">668</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="Scene-669"><a href="#Scene-669"><span class="linenos">669</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="Scene-670"><a href="#Scene-670"><span class="linenos">670</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene-671"><a href="#Scene-671"><span class="linenos">671</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene-672"><a href="#Scene-672"><span class="linenos">672</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene-673"><a href="#Scene-673"><span class="linenos">673</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="Scene-674"><a href="#Scene-674"><span class="linenos">674</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="Scene-675"><a href="#Scene-675"><span class="linenos">675</span></a><span class="sd">                seen from both sides.</span>
</span><span id="Scene-676"><a href="#Scene-676"><span class="linenos">676</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="Scene-677"><a href="#Scene-677"><span class="linenos">677</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="Scene-678"><a href="#Scene-678"><span class="linenos">678</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="Scene-679"><a href="#Scene-679"><span class="linenos">679</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="Scene-680"><a href="#Scene-680"><span class="linenos">680</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="Scene-681"><a href="#Scene-681"><span class="linenos">681</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="Scene-682"><a href="#Scene-682"><span class="linenos">682</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="Scene-683"><a href="#Scene-683"><span class="linenos">683</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="Scene-684"><a href="#Scene-684"><span class="linenos">684</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene-685"><a href="#Scene-685"><span class="linenos">685</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene-686"><a href="#Scene-686"><span class="linenos">686</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene-687"><a href="#Scene-687"><span class="linenos">687</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene-688"><a href="#Scene-688"><span class="linenos">688</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene-689"><a href="#Scene-689"><span class="linenos">689</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene-690"><a href="#Scene-690"><span class="linenos">690</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene-691"><a href="#Scene-691"><span class="linenos">691</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene-692"><a href="#Scene-692"><span class="linenos">692</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="Scene-693"><a href="#Scene-693"><span class="linenos">693</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene-694"><a href="#Scene-694"><span class="linenos">694</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene-695"><a href="#Scene-695"><span class="linenos">695</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="Scene-696"><a href="#Scene-696"><span class="linenos">696</span></a><span class="sd">                of indices to draw.</span>
</span><span id="Scene-697"><a href="#Scene-697"><span class="linenos">697</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="Scene-698"><a href="#Scene-698"><span class="linenos">698</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="Scene-699"><a href="#Scene-699"><span class="linenos">699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-700"><a href="#Scene-700"><span class="linenos">700</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene-701"><a href="#Scene-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-702"><a href="#Scene-702"><span class="linenos">702</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="Scene-703"><a href="#Scene-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-704"><a href="#Scene-704"><span class="linenos">704</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-705"><a href="#Scene-705"><span class="linenos">705</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-706"><a href="#Scene-706"><span class="linenos">706</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-707"><a href="#Scene-707"><span class="linenos">707</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="Scene-708"><a href="#Scene-708"><span class="linenos">708</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene-709"><a href="#Scene-709"><span class="linenos">709</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-710"><a href="#Scene-710"><span class="linenos">710</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="Scene-711"><a href="#Scene-711"><span class="linenos">711</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Scene-712"><a href="#Scene-712"><span class="linenos">712</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="Scene-713"><a href="#Scene-713"><span class="linenos">713</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-714"><a href="#Scene-714"><span class="linenos">714</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-715"><a href="#Scene-715"><span class="linenos">715</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Scene-716"><a href="#Scene-716"><span class="linenos">716</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Scene-717"><a href="#Scene-717"><span class="linenos">717</span></a>
</span><span id="Scene-718"><a href="#Scene-718"><span class="linenos">718</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene-719"><a href="#Scene-719"><span class="linenos">719</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene-720"><a href="#Scene-720"><span class="linenos">720</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene-721"><a href="#Scene-721"><span class="linenos">721</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene-722"><a href="#Scene-722"><span class="linenos">722</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene-723"><a href="#Scene-723"><span class="linenos">723</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene-724"><a href="#Scene-724"><span class="linenos">724</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="Scene-725"><a href="#Scene-725"><span class="linenos">725</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="Scene-726"><a href="#Scene-726"><span class="linenos">726</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene-727"><a href="#Scene-727"><span class="linenos">727</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene-728"><a href="#Scene-728"><span class="linenos">728</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene-729"><a href="#Scene-729"><span class="linenos">729</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene-730"><a href="#Scene-730"><span class="linenos">730</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="Scene-731"><a href="#Scene-731"><span class="linenos">731</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="Scene-732"><a href="#Scene-732"><span class="linenos">732</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="Scene-733"><a href="#Scene-733"><span class="linenos">733</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="Scene-734"><a href="#Scene-734"><span class="linenos">734</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene-735"><a href="#Scene-735"><span class="linenos">735</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene-736"><a href="#Scene-736"><span class="linenos">736</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene-737"><a href="#Scene-737"><span class="linenos">737</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene-738"><a href="#Scene-738"><span class="linenos">738</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="Scene-739"><a href="#Scene-739"><span class="linenos">739</span></a>        <span class="p">)</span>
</span><span id="Scene-740"><a href="#Scene-740"><span class="linenos">740</span></a>
</span><span id="Scene-741"><a href="#Scene-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="Scene-742"><a href="#Scene-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene-743"><a href="#Scene-743"><span class="linenos">743</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="Scene-744"><a href="#Scene-744"><span class="linenos">744</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="Scene-745"><a href="#Scene-745"><span class="linenos">745</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene-746"><a href="#Scene-746"><span class="linenos">746</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-747"><a href="#Scene-747"><span class="linenos">747</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-748"><a href="#Scene-748"><span class="linenos">748</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-749"><a href="#Scene-749"><span class="linenos">749</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene-750"><a href="#Scene-750"><span class="linenos">750</span></a>    <span class="p">):</span>
</span><span id="Scene-751"><a href="#Scene-751"><span class="linenos">751</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="Scene-752"><a href="#Scene-752"><span class="linenos">752</span></a>
</span><span id="Scene-753"><a href="#Scene-753"><span class="linenos">753</span></a><span class="sd">        Args:</span>
</span><span id="Scene-754"><a href="#Scene-754"><span class="linenos">754</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene-755"><a href="#Scene-755"><span class="linenos">755</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="Scene-756"><a href="#Scene-756"><span class="linenos">756</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="Scene-757"><a href="#Scene-757"><span class="linenos">757</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene-758"><a href="#Scene-758"><span class="linenos">758</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="Scene-759"><a href="#Scene-759"><span class="linenos">759</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="Scene-760"><a href="#Scene-760"><span class="linenos">760</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="Scene-761"><a href="#Scene-761"><span class="linenos">761</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="Scene-762"><a href="#Scene-762"><span class="linenos">762</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="Scene-763"><a href="#Scene-763"><span class="linenos">763</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="Scene-764"><a href="#Scene-764"><span class="linenos">764</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene-765"><a href="#Scene-765"><span class="linenos">765</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="Scene-766"><a href="#Scene-766"><span class="linenos">766</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene-767"><a href="#Scene-767"><span class="linenos">767</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="Scene-768"><a href="#Scene-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-769"><a href="#Scene-769"><span class="linenos">769</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene-770"><a href="#Scene-770"><span class="linenos">770</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene-771"><a href="#Scene-771"><span class="linenos">771</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene-772"><a href="#Scene-772"><span class="linenos">772</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene-773"><a href="#Scene-773"><span class="linenos">773</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="Scene-774"><a href="#Scene-774"><span class="linenos">774</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="Scene-775"><a href="#Scene-775"><span class="linenos">775</span></a>        <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="Scene-776"><a href="#Scene-776"><span class="linenos">776</span></a>            <span class="n">vbo</span><span class="p">,</span>
</span><span id="Scene-777"><a href="#Scene-777"><span class="linenos">777</span></a>            <span class="n">centers</span><span class="p">,</span>
</span><span id="Scene-778"><a href="#Scene-778"><span class="linenos">778</span></a>            <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-779"><a href="#Scene-779"><span class="linenos">779</span></a>            <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene-780"><a href="#Scene-780"><span class="linenos">780</span></a>        <span class="p">)</span>
</span><span id="Scene-781"><a href="#Scene-781"><span class="linenos">781</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene-782"><a href="#Scene-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="Scene-783"><a href="#Scene-783"><span class="linenos">783</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="Scene-784"><a href="#Scene-784"><span class="linenos">784</span></a>        <span class="p">)</span>
</span><span id="Scene-785"><a href="#Scene-785"><span class="linenos">785</span></a>
</span><span id="Scene-786"><a href="#Scene-786"><span class="linenos">786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="Scene-787"><a href="#Scene-787"><span class="linenos">787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="Scene-788"><a href="#Scene-788"><span class="linenos">788</span></a>
</span><span id="Scene-789"><a href="#Scene-789"><span class="linenos">789</span></a><span class="sd">        Args:</span>
</span><span id="Scene-790"><a href="#Scene-790"><span class="linenos">790</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="Scene-791"><a href="#Scene-791"><span class="linenos">791</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="Scene-792"><a href="#Scene-792"><span class="linenos">792</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="Scene-793"><a href="#Scene-793"><span class="linenos">793</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="Scene-794"><a href="#Scene-794"><span class="linenos">794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-795"><a href="#Scene-795"><span class="linenos">795</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span><span id="Scene-796"><a href="#Scene-796"><span class="linenos">796</span></a>
</span><span id="Scene-797"><a href="#Scene-797"><span class="linenos">797</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Scene-798"><a href="#Scene-798"><span class="linenos">798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="Scene-799"><a href="#Scene-799"><span class="linenos">799</span></a>
</span><span id="Scene-800"><a href="#Scene-800"><span class="linenos">800</span></a><span class="sd">        Example::</span>
</span><span id="Scene-801"><a href="#Scene-801"><span class="linenos">801</span></a>
</span><span id="Scene-802"><a href="#Scene-802"><span class="linenos">802</span></a><span class="sd">            &gt;&gt;&gt; scene = ti.ui.Scene()</span>
</span><span id="Scene-803"><a href="#Scene-803"><span class="linenos">803</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="Scene-804"><a href="#Scene-804"><span class="linenos">804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene-805"><a href="#Scene-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>The old 3D scene class, which can contain meshes, lines and particles,
and can be rendered on a canvas.
This scene class is to be instantiated directly and is deprecated.
Use the new SceneV2 class instead, which can be retrieved using the
get_scene() function of a taichi.ui.Window.</p>
</div>


                            <div id="Scene.scene" class="classattr">
                                <div class="attr variable">
            <span class="name">scene</span>

        
    </div>
    <a class="headerlink" href="#Scene.scene"></a>
    
    

                            </div>
                            <div id="Scene.set_camera" class="classattr">
                                        <input id="Scene.set_camera-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_camera</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">camera</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.set_camera-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.set_camera"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.set_camera-468"><a href="#Scene.set_camera-468"><span class="linenos">468</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">set_camera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">camera</span><span class="p">):</span>
</span><span id="Scene.set_camera-469"><a href="#Scene.set_camera-469"><span class="linenos">469</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the camera for this scene.</span>
</span><span id="Scene.set_camera-470"><a href="#Scene.set_camera-470"><span class="linenos">470</span></a>
</span><span id="Scene.set_camera-471"><a href="#Scene.set_camera-471"><span class="linenos">471</span></a><span class="sd">        Args:</span>
</span><span id="Scene.set_camera-472"><a href="#Scene.set_camera-472"><span class="linenos">472</span></a><span class="sd">            camera (:class:`~taichi.ui.Camera`): A camera instance.</span>
</span><span id="Scene.set_camera-473"><a href="#Scene.set_camera-473"><span class="linenos">473</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.set_camera-474"><a href="#Scene.set_camera-474"><span class="linenos">474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">set_camera</span><span class="p">(</span><span class="n">camera</span><span class="o">.</span><span class="n">ptr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the camera for this scene.</p>

<p>Args:
    camera (<code>~taichi.ui.Camera</code>): A camera instance.</p>
</div>


                            </div>
                            <div id="Scene.lines" class="classattr">
                                        <input id="Scene.lines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lines</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">width</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.lines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.lines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.lines-476"><a href="#Scene.lines-476"><span class="linenos">476</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">lines</span><span class="p">(</span>
</span><span id="Scene.lines-477"><a href="#Scene.lines-477"><span class="linenos">477</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene.lines-478"><a href="#Scene.lines-478"><span class="linenos">478</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene.lines-479"><a href="#Scene.lines-479"><span class="linenos">479</span></a>        <span class="n">width</span><span class="p">,</span>
</span><span id="Scene.lines-480"><a href="#Scene.lines-480"><span class="linenos">480</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.lines-481"><a href="#Scene.lines-481"><span class="linenos">481</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene.lines-482"><a href="#Scene.lines-482"><span class="linenos">482</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.lines-483"><a href="#Scene.lines-483"><span class="linenos">483</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.lines-484"><a href="#Scene.lines-484"><span class="linenos">484</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.lines-485"><a href="#Scene.lines-485"><span class="linenos">485</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.lines-486"><a href="#Scene.lines-486"><span class="linenos">486</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.lines-487"><a href="#Scene.lines-487"><span class="linenos">487</span></a>    <span class="p">):</span>
</span><span id="Scene.lines-488"><a href="#Scene.lines-488"><span class="linenos">488</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare multi-lines inside the scene.</span>
</span><span id="Scene.lines-489"><a href="#Scene.lines-489"><span class="linenos">489</span></a>
</span><span id="Scene.lines-490"><a href="#Scene.lines-490"><span class="linenos">490</span></a><span class="sd">        Note that under current situation, for example, there you have 4 vertices,</span>
</span><span id="Scene.lines-491"><a href="#Scene.lines-491"><span class="linenos">491</span></a><span class="sd">        vertices.shape[0] is 4. So there will be 2 lines, the first line&#39;s two points</span>
</span><span id="Scene.lines-492"><a href="#Scene.lines-492"><span class="linenos">492</span></a><span class="sd">        are vertices[0] and vertices[1], and the second line&#39;s two points are</span>
</span><span id="Scene.lines-493"><a href="#Scene.lines-493"><span class="linenos">493</span></a><span class="sd">        vertices[2] and vertices[3].</span>
</span><span id="Scene.lines-494"><a href="#Scene.lines-494"><span class="linenos">494</span></a>
</span><span id="Scene.lines-495"><a href="#Scene.lines-495"><span class="linenos">495</span></a><span class="sd">        Args:</span>
</span><span id="Scene.lines-496"><a href="#Scene.lines-496"><span class="linenos">496</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.lines-497"><a href="#Scene.lines-497"><span class="linenos">497</span></a><span class="sd">                3D location of points of lines.</span>
</span><span id="Scene.lines-498"><a href="#Scene.lines-498"><span class="linenos">498</span></a><span class="sd">            width: the line width (maybe different on different systems).</span>
</span><span id="Scene.lines-499"><a href="#Scene.lines-499"><span class="linenos">499</span></a><span class="sd">            indices: a taichi int field of shape (2 * #points), which indicate</span>
</span><span id="Scene.lines-500"><a href="#Scene.lines-500"><span class="linenos">500</span></a><span class="sd">                the points indices of the lines. If this is None, then it is</span>
</span><span id="Scene.lines-501"><a href="#Scene.lines-501"><span class="linenos">501</span></a><span class="sd">                assumed that the points are already arranged in lines order.</span>
</span><span id="Scene.lines-502"><a href="#Scene.lines-502"><span class="linenos">502</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene.lines-503"><a href="#Scene.lines-503"><span class="linenos">503</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene.lines-504"><a href="#Scene.lines-504"><span class="linenos">504</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene.lines-505"><a href="#Scene.lines-505"><span class="linenos">505</span></a><span class="sd">                element indicate the RGB color of the line.</span>
</span><span id="Scene.lines-506"><a href="#Scene.lines-506"><span class="linenos">506</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene.lines-507"><a href="#Scene.lines-507"><span class="linenos">507</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene.lines-508"><a href="#Scene.lines-508"><span class="linenos">508</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene.lines-509"><a href="#Scene.lines-509"><span class="linenos">509</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene.lines-510"><a href="#Scene.lines-510"><span class="linenos">510</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene.lines-511"><a href="#Scene.lines-511"><span class="linenos">511</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene.lines-512"><a href="#Scene.lines-512"><span class="linenos">512</span></a><span class="sd">                of vertices to draw. There are 2 cases that we will change your</span>
</span><span id="Scene.lines-513"><a href="#Scene.lines-513"><span class="linenos">513</span></a><span class="sd">                `vertex_count`. [1] If the `vertex_count` is an odd number, then we</span>
</span><span id="Scene.lines-514"><a href="#Scene.lines-514"><span class="linenos">514</span></a><span class="sd">                will change it to `vertex_count` - 1. [2] If `vertex_offset` plus</span>
</span><span id="Scene.lines-515"><a href="#Scene.lines-515"><span class="linenos">515</span></a><span class="sd">                `vertex_count` greater than vertices.shape[0], then we will reduce</span>
</span><span id="Scene.lines-516"><a href="#Scene.lines-516"><span class="linenos">516</span></a><span class="sd">                `vertex_count` to no more than vertices.shape[0].</span>
</span><span id="Scene.lines-517"><a href="#Scene.lines-517"><span class="linenos">517</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene.lines-518"><a href="#Scene.lines-518"><span class="linenos">518</span></a><span class="sd">                Only available when `indices` is provided, which is the base index</span>
</span><span id="Scene.lines-519"><a href="#Scene.lines-519"><span class="linenos">519</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene.lines-520"><a href="#Scene.lines-520"><span class="linenos">520</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene.lines-521"><a href="#Scene.lines-521"><span class="linenos">521</span></a><span class="sd">                Only available when `indices` is provided, which is the number</span>
</span><span id="Scene.lines-522"><a href="#Scene.lines-522"><span class="linenos">522</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene.lines-523"><a href="#Scene.lines-523"><span class="linenos">523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.lines-524"><a href="#Scene.lines-524"><span class="linenos">524</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.lines-525"><a href="#Scene.lines-525"><span class="linenos">525</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.lines-526"><a href="#Scene.lines-526"><span class="linenos">526</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.lines-527"><a href="#Scene.lines-527"><span class="linenos">527</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.lines-528"><a href="#Scene.lines-528"><span class="linenos">528</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="Scene.lines-529"><a href="#Scene.lines-529"><span class="linenos">529</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene.lines-530"><a href="#Scene.lines-530"><span class="linenos">530</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.lines-531"><a href="#Scene.lines-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Scene.lines-532"><a href="#Scene.lines-532"><span class="linenos">532</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Odd drawing count will be cut to neast even number&quot;</span><span class="p">)</span>
</span><span id="Scene.lines-533"><a href="#Scene.lines-533"><span class="linenos">533</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="Scene.lines-534"><a href="#Scene.lines-534"><span class="linenos">534</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="o">+</span> <span class="n">vertex_offset</span> <span class="o">&gt;</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="Scene.lines-535"><a href="#Scene.lines-535"><span class="linenos">535</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning! Drawing count greater than shape will be cut&quot;</span><span class="p">)</span>
</span><span id="Scene.lines-536"><a href="#Scene.lines-536"><span class="linenos">536</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">vertex_offset</span>
</span><span id="Scene.lines-537"><a href="#Scene.lines-537"><span class="linenos">537</span></a>            <span class="n">vertex_count</span> <span class="o">-=</span> <span class="n">vertex_count</span> <span class="o">%</span> <span class="mi">2</span>
</span><span id="Scene.lines-538"><a href="#Scene.lines-538"><span class="linenos">538</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene.lines-539"><a href="#Scene.lines-539"><span class="linenos">539</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene.lines-540"><a href="#Scene.lines-540"><span class="linenos">540</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene.lines-541"><a href="#Scene.lines-541"><span class="linenos">541</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene.lines-542"><a href="#Scene.lines-542"><span class="linenos">542</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene.lines-543"><a href="#Scene.lines-543"><span class="linenos">543</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene.lines-544"><a href="#Scene.lines-544"><span class="linenos">544</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">lines</span><span class="p">(</span>
</span><span id="Scene.lines-545"><a href="#Scene.lines-545"><span class="linenos">545</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene.lines-546"><a href="#Scene.lines-546"><span class="linenos">546</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene.lines-547"><a href="#Scene.lines-547"><span class="linenos">547</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene.lines-548"><a href="#Scene.lines-548"><span class="linenos">548</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene.lines-549"><a href="#Scene.lines-549"><span class="linenos">549</span></a>            <span class="n">width</span><span class="p">,</span>
</span><span id="Scene.lines-550"><a href="#Scene.lines-550"><span class="linenos">550</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene.lines-551"><a href="#Scene.lines-551"><span class="linenos">551</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene.lines-552"><a href="#Scene.lines-552"><span class="linenos">552</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene.lines-553"><a href="#Scene.lines-553"><span class="linenos">553</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene.lines-554"><a href="#Scene.lines-554"><span class="linenos">554</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare multi-lines inside the scene.</p>

<p>Note that under current situation, for example, there you have 4 vertices,
vertices.shape[0] is 4. So there will be 2 lines, the first line's two points
are vertices[0] and vertices[1], and the second line's two points are
vertices[2] and vertices[3].</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of points of lines.
    width: the line width (maybe different on different systems).
    indices: a taichi int field of shape (2 * #points), which indicate
        the points indices of the lines. If this is None, then it is
        assumed that the points are already arranged in lines order.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of the line.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw. There are 2 cases that we will change your
        <code>vertex_count</code>. [1] If the <code>vertex_count</code> is an odd number, then we
        will change it to <code>vertex_count</code> - 1. [2] If <code>vertex_offset</code> plus
        <code>vertex_count</code> greater than vertices.shape[0], then we will reduce
        <code>vertex_count</code> to no more than vertices.shape[0].
    index_offset (int, optional):
        Only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        Only available when <code>indices</code> is provided, which is the number
        of vertices to draw.</p>
</div>


                            </div>
                            <div id="Scene.mesh" class="classattr">
                                        <input id="Scene.mesh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mesh</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normals</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.mesh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.mesh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.mesh-556"><a href="#Scene.mesh-556"><span class="linenos">556</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span>
</span><span id="Scene.mesh-557"><a href="#Scene.mesh-557"><span class="linenos">557</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene.mesh-558"><a href="#Scene.mesh-558"><span class="linenos">558</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene.mesh-559"><a href="#Scene.mesh-559"><span class="linenos">559</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh-560"><a href="#Scene.mesh-560"><span class="linenos">560</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh-561"><a href="#Scene.mesh-561"><span class="linenos">561</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene.mesh-562"><a href="#Scene.mesh-562"><span class="linenos">562</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh-563"><a href="#Scene.mesh-563"><span class="linenos">563</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Scene.mesh-564"><a href="#Scene.mesh-564"><span class="linenos">564</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.mesh-565"><a href="#Scene.mesh-565"><span class="linenos">565</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh-566"><a href="#Scene.mesh-566"><span class="linenos">566</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.mesh-567"><a href="#Scene.mesh-567"><span class="linenos">567</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh-568"><a href="#Scene.mesh-568"><span class="linenos">568</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Scene.mesh-569"><a href="#Scene.mesh-569"><span class="linenos">569</span></a>    <span class="p">):</span>
</span><span id="Scene.mesh-570"><a href="#Scene.mesh-570"><span class="linenos">570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a mesh inside the scene.</span>
</span><span id="Scene.mesh-571"><a href="#Scene.mesh-571"><span class="linenos">571</span></a>
</span><span id="Scene.mesh-572"><a href="#Scene.mesh-572"><span class="linenos">572</span></a><span class="sd">        if you indicate the index_offset and index_count, the normals will also</span>
</span><span id="Scene.mesh-573"><a href="#Scene.mesh-573"><span class="linenos">573</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="Scene.mesh-574"><a href="#Scene.mesh-574"><span class="linenos">574</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="Scene.mesh-575"><a href="#Scene.mesh-575"><span class="linenos">575</span></a>
</span><span id="Scene.mesh-576"><a href="#Scene.mesh-576"><span class="linenos">576</span></a><span class="sd">        Args:</span>
</span><span id="Scene.mesh-577"><a href="#Scene.mesh-577"><span class="linenos">577</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.mesh-578"><a href="#Scene.mesh-578"><span class="linenos">578</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="Scene.mesh-579"><a href="#Scene.mesh-579"><span class="linenos">579</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="Scene.mesh-580"><a href="#Scene.mesh-580"><span class="linenos">580</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="Scene.mesh-581"><a href="#Scene.mesh-581"><span class="linenos">581</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="Scene.mesh-582"><a href="#Scene.mesh-582"><span class="linenos">582</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.mesh-583"><a href="#Scene.mesh-583"><span class="linenos">583</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="Scene.mesh-584"><a href="#Scene.mesh-584"><span class="linenos">584</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="Scene.mesh-585"><a href="#Scene.mesh-585"><span class="linenos">585</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene.mesh-586"><a href="#Scene.mesh-586"><span class="linenos">586</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene.mesh-587"><a href="#Scene.mesh-587"><span class="linenos">587</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene.mesh-588"><a href="#Scene.mesh-588"><span class="linenos">588</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="Scene.mesh-589"><a href="#Scene.mesh-589"><span class="linenos">589</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="Scene.mesh-590"><a href="#Scene.mesh-590"><span class="linenos">590</span></a><span class="sd">                seen from both sides.</span>
</span><span id="Scene.mesh-591"><a href="#Scene.mesh-591"><span class="linenos">591</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene.mesh-592"><a href="#Scene.mesh-592"><span class="linenos">592</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene.mesh-593"><a href="#Scene.mesh-593"><span class="linenos">593</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene.mesh-594"><a href="#Scene.mesh-594"><span class="linenos">594</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene.mesh-595"><a href="#Scene.mesh-595"><span class="linenos">595</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene.mesh-596"><a href="#Scene.mesh-596"><span class="linenos">596</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene.mesh-597"><a href="#Scene.mesh-597"><span class="linenos">597</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene.mesh-598"><a href="#Scene.mesh-598"><span class="linenos">598</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene.mesh-599"><a href="#Scene.mesh-599"><span class="linenos">599</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="Scene.mesh-600"><a href="#Scene.mesh-600"><span class="linenos">600</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene.mesh-601"><a href="#Scene.mesh-601"><span class="linenos">601</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene.mesh-602"><a href="#Scene.mesh-602"><span class="linenos">602</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="Scene.mesh-603"><a href="#Scene.mesh-603"><span class="linenos">603</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene.mesh-604"><a href="#Scene.mesh-604"><span class="linenos">604</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="Scene.mesh-605"><a href="#Scene.mesh-605"><span class="linenos">605</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="Scene.mesh-606"><a href="#Scene.mesh-606"><span class="linenos">606</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.mesh-607"><a href="#Scene.mesh-607"><span class="linenos">607</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene.mesh-608"><a href="#Scene.mesh-608"><span class="linenos">608</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh-609"><a href="#Scene.mesh-609"><span class="linenos">609</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="Scene.mesh-610"><a href="#Scene.mesh-610"><span class="linenos">610</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh-611"><a href="#Scene.mesh-611"><span class="linenos">611</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.mesh-612"><a href="#Scene.mesh-612"><span class="linenos">612</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh-613"><a href="#Scene.mesh-613"><span class="linenos">613</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh-614"><a href="#Scene.mesh-614"><span class="linenos">614</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>  <span class="c1"># FIXME : Need to confirm</span>
</span><span id="Scene.mesh-615"><a href="#Scene.mesh-615"><span class="linenos">615</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene.mesh-616"><a href="#Scene.mesh-616"><span class="linenos">616</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.mesh-617"><a href="#Scene.mesh-617"><span class="linenos">617</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene.mesh-618"><a href="#Scene.mesh-618"><span class="linenos">618</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene.mesh-619"><a href="#Scene.mesh-619"><span class="linenos">619</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene.mesh-620"><a href="#Scene.mesh-620"><span class="linenos">620</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene.mesh-621"><a href="#Scene.mesh-621"><span class="linenos">621</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene.mesh-622"><a href="#Scene.mesh-622"><span class="linenos">622</span></a>
</span><span id="Scene.mesh-623"><a href="#Scene.mesh-623"><span class="linenos">623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span>
</span><span id="Scene.mesh-624"><a href="#Scene.mesh-624"><span class="linenos">624</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene.mesh-625"><a href="#Scene.mesh-625"><span class="linenos">625</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene.mesh-626"><a href="#Scene.mesh-626"><span class="linenos">626</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene.mesh-627"><a href="#Scene.mesh-627"><span class="linenos">627</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene.mesh-628"><a href="#Scene.mesh-628"><span class="linenos">628</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="Scene.mesh-629"><a href="#Scene.mesh-629"><span class="linenos">629</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene.mesh-630"><a href="#Scene.mesh-630"><span class="linenos">630</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene.mesh-631"><a href="#Scene.mesh-631"><span class="linenos">631</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene.mesh-632"><a href="#Scene.mesh-632"><span class="linenos">632</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene.mesh-633"><a href="#Scene.mesh-633"><span class="linenos">633</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="Scene.mesh-634"><a href="#Scene.mesh-634"><span class="linenos">634</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare a mesh inside the scene.</p>

<p>if you indicate the index_offset and index_count, the normals will also
be sliced by the args, and the shading resultes will not be affected.
(It is equal to make a part of the mesh visible)</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of a vertex.
    indices: a taichi int field of shape (3 * #triangles), which indicate
        the vertex indices of the triangles. If this is None, then it is
        assumed that the vertices are already arranged in triangles order.
    normals: a taichi 3D Vector field, where each element indicate the
        normal of a vertex. If this is none, normals will be automatically
        inferred from vertex positions.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of a vertex.
    two_sided (bool): whether or not the triangles should be able to be
        seen from both sides.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw.
    index_offset (int, optional):
        only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        only available when <code>indices</code> is provided, which is the the number
        of vertices to draw.
    show_wireframe (bool, optional):
        turn on/off WareFrame mode.</p>
</div>


                            </div>
                            <div id="Scene.mesh_instance" class="classattr">
                                        <input id="Scene.mesh_instance-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mesh_instance</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">vertices</span>,</span><span class="param">	<span class="n">indices</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">normals</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">transforms</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.mesh_instance-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.mesh_instance"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.mesh_instance-636"><a href="#Scene.mesh_instance-636"><span class="linenos">636</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">mesh_instance</span><span class="p">(</span>
</span><span id="Scene.mesh_instance-637"><a href="#Scene.mesh_instance-637"><span class="linenos">637</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-638"><a href="#Scene.mesh_instance-638"><span class="linenos">638</span></a>        <span class="n">vertices</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-639"><a href="#Scene.mesh_instance-639"><span class="linenos">639</span></a>        <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-640"><a href="#Scene.mesh_instance-640"><span class="linenos">640</span></a>        <span class="n">normals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-641"><a href="#Scene.mesh_instance-641"><span class="linenos">641</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene.mesh_instance-642"><a href="#Scene.mesh_instance-642"><span class="linenos">642</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-643"><a href="#Scene.mesh_instance-643"><span class="linenos">643</span></a>        <span class="n">two_sided</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-644"><a href="#Scene.mesh_instance-644"><span class="linenos">644</span></a>        <span class="n">transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-645"><a href="#Scene.mesh_instance-645"><span class="linenos">645</span></a>        <span class="n">instance_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-646"><a href="#Scene.mesh_instance-646"><span class="linenos">646</span></a>        <span class="n">instance_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-647"><a href="#Scene.mesh_instance-647"><span class="linenos">647</span></a>        <span class="n">vertex_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-648"><a href="#Scene.mesh_instance-648"><span class="linenos">648</span></a>        <span class="n">vertex_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-649"><a href="#Scene.mesh_instance-649"><span class="linenos">649</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-650"><a href="#Scene.mesh_instance-650"><span class="linenos">650</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-651"><a href="#Scene.mesh_instance-651"><span class="linenos">651</span></a>        <span class="n">show_wireframe</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-652"><a href="#Scene.mesh_instance-652"><span class="linenos">652</span></a>    <span class="p">):</span>
</span><span id="Scene.mesh_instance-653"><a href="#Scene.mesh_instance-653"><span class="linenos">653</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare mesh instances inside the scene.</span>
</span><span id="Scene.mesh_instance-654"><a href="#Scene.mesh_instance-654"><span class="linenos">654</span></a>
</span><span id="Scene.mesh_instance-655"><a href="#Scene.mesh_instance-655"><span class="linenos">655</span></a><span class="sd">        If transforms is given, then according to the shape of transforms, it will</span>
</span><span id="Scene.mesh_instance-656"><a href="#Scene.mesh_instance-656"><span class="linenos">656</span></a><span class="sd">        draw mesh instances based on the transforms, and you can indicate which instance</span>
</span><span id="Scene.mesh_instance-657"><a href="#Scene.mesh_instance-657"><span class="linenos">657</span></a><span class="sd">        to draw first. If you indicate the index_offset and index_count, the normals will also</span>
</span><span id="Scene.mesh_instance-658"><a href="#Scene.mesh_instance-658"><span class="linenos">658</span></a><span class="sd">        be sliced by the args, and the shading resultes will not be affected.</span>
</span><span id="Scene.mesh_instance-659"><a href="#Scene.mesh_instance-659"><span class="linenos">659</span></a><span class="sd">        (It is equal to make a part of the mesh visible)</span>
</span><span id="Scene.mesh_instance-660"><a href="#Scene.mesh_instance-660"><span class="linenos">660</span></a>
</span><span id="Scene.mesh_instance-661"><a href="#Scene.mesh_instance-661"><span class="linenos">661</span></a><span class="sd">        Args:</span>
</span><span id="Scene.mesh_instance-662"><a href="#Scene.mesh_instance-662"><span class="linenos">662</span></a><span class="sd">            vertices: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.mesh_instance-663"><a href="#Scene.mesh_instance-663"><span class="linenos">663</span></a><span class="sd">                3D location of a vertex.</span>
</span><span id="Scene.mesh_instance-664"><a href="#Scene.mesh_instance-664"><span class="linenos">664</span></a><span class="sd">            indices: a taichi int field of shape (3 * #triangles), which indicate</span>
</span><span id="Scene.mesh_instance-665"><a href="#Scene.mesh_instance-665"><span class="linenos">665</span></a><span class="sd">                the vertex indices of the triangles. If this is None, then it is</span>
</span><span id="Scene.mesh_instance-666"><a href="#Scene.mesh_instance-666"><span class="linenos">666</span></a><span class="sd">                assumed that the vertices are already arranged in triangles order.</span>
</span><span id="Scene.mesh_instance-667"><a href="#Scene.mesh_instance-667"><span class="linenos">667</span></a><span class="sd">            normals: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.mesh_instance-668"><a href="#Scene.mesh_instance-668"><span class="linenos">668</span></a><span class="sd">                normal of a vertex. If this is none, normals will be automatically</span>
</span><span id="Scene.mesh_instance-669"><a href="#Scene.mesh_instance-669"><span class="linenos">669</span></a><span class="sd">                inferred from vertex positions.</span>
</span><span id="Scene.mesh_instance-670"><a href="#Scene.mesh_instance-670"><span class="linenos">670</span></a><span class="sd">            color: a global color of the mesh as 3 floats representing RGB values.</span>
</span><span id="Scene.mesh_instance-671"><a href="#Scene.mesh_instance-671"><span class="linenos">671</span></a><span class="sd">                If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene.mesh_instance-672"><a href="#Scene.mesh_instance-672"><span class="linenos">672</span></a><span class="sd">            per_vertex_color (Tuple[float]): a taichi 3D vector field, where each</span>
</span><span id="Scene.mesh_instance-673"><a href="#Scene.mesh_instance-673"><span class="linenos">673</span></a><span class="sd">                element indicate the RGB color of a vertex.</span>
</span><span id="Scene.mesh_instance-674"><a href="#Scene.mesh_instance-674"><span class="linenos">674</span></a><span class="sd">            two_sided (bool): whether or not the triangles should be able to be</span>
</span><span id="Scene.mesh_instance-675"><a href="#Scene.mesh_instance-675"><span class="linenos">675</span></a><span class="sd">                seen from both sides.</span>
</span><span id="Scene.mesh_instance-676"><a href="#Scene.mesh_instance-676"><span class="linenos">676</span></a><span class="sd">            transforms (ti.Matrix.field, optional):</span>
</span><span id="Scene.mesh_instance-677"><a href="#Scene.mesh_instance-677"><span class="linenos">677</span></a><span class="sd">                The Matrix must be 4x4 size with N instances, and data type should</span>
</span><span id="Scene.mesh_instance-678"><a href="#Scene.mesh_instance-678"><span class="linenos">678</span></a><span class="sd">                be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).</span>
</span><span id="Scene.mesh_instance-679"><a href="#Scene.mesh_instance-679"><span class="linenos">679</span></a><span class="sd">            instance_offset (int, optional):</span>
</span><span id="Scene.mesh_instance-680"><a href="#Scene.mesh_instance-680"><span class="linenos">680</span></a><span class="sd">                Default value is 0 which means no offset to show mesh instances. Otherwise,</span>
</span><span id="Scene.mesh_instance-681"><a href="#Scene.mesh_instance-681"><span class="linenos">681</span></a><span class="sd">                the mesh instances will show from the `instance_offset`.</span>
</span><span id="Scene.mesh_instance-682"><a href="#Scene.mesh_instance-682"><span class="linenos">682</span></a><span class="sd">            instance_count (int, optional):</span>
</span><span id="Scene.mesh_instance-683"><a href="#Scene.mesh_instance-683"><span class="linenos">683</span></a><span class="sd">                The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.</span>
</span><span id="Scene.mesh_instance-684"><a href="#Scene.mesh_instance-684"><span class="linenos">684</span></a><span class="sd">            vertex_offset (int, optional):</span>
</span><span id="Scene.mesh_instance-685"><a href="#Scene.mesh_instance-685"><span class="linenos">685</span></a><span class="sd">                if &#39;indices&#39; is provided, this refers to the value added to the vertex</span>
</span><span id="Scene.mesh_instance-686"><a href="#Scene.mesh_instance-686"><span class="linenos">686</span></a><span class="sd">                index before indexing into the vertex buffer, else this refers to the</span>
</span><span id="Scene.mesh_instance-687"><a href="#Scene.mesh_instance-687"><span class="linenos">687</span></a><span class="sd">                index of the first vertex to draw.</span>
</span><span id="Scene.mesh_instance-688"><a href="#Scene.mesh_instance-688"><span class="linenos">688</span></a><span class="sd">            vertex_count (int, optional):</span>
</span><span id="Scene.mesh_instance-689"><a href="#Scene.mesh_instance-689"><span class="linenos">689</span></a><span class="sd">                only available when `indices` is not provided, which is the number</span>
</span><span id="Scene.mesh_instance-690"><a href="#Scene.mesh_instance-690"><span class="linenos">690</span></a><span class="sd">                of vertices to draw.</span>
</span><span id="Scene.mesh_instance-691"><a href="#Scene.mesh_instance-691"><span class="linenos">691</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene.mesh_instance-692"><a href="#Scene.mesh_instance-692"><span class="linenos">692</span></a><span class="sd">                only available when `indices` is provided, which is the base index</span>
</span><span id="Scene.mesh_instance-693"><a href="#Scene.mesh_instance-693"><span class="linenos">693</span></a><span class="sd">                within the index buffer.</span>
</span><span id="Scene.mesh_instance-694"><a href="#Scene.mesh_instance-694"><span class="linenos">694</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene.mesh_instance-695"><a href="#Scene.mesh_instance-695"><span class="linenos">695</span></a><span class="sd">                only available when `indices` is provided, which is the the number</span>
</span><span id="Scene.mesh_instance-696"><a href="#Scene.mesh_instance-696"><span class="linenos">696</span></a><span class="sd">                of indices to draw.</span>
</span><span id="Scene.mesh_instance-697"><a href="#Scene.mesh_instance-697"><span class="linenos">697</span></a><span class="sd">            show_wireframe (bool, optional):</span>
</span><span id="Scene.mesh_instance-698"><a href="#Scene.mesh_instance-698"><span class="linenos">698</span></a><span class="sd">                turn on/off WareFrame mode.</span>
</span><span id="Scene.mesh_instance-699"><a href="#Scene.mesh_instance-699"><span class="linenos">699</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.mesh_instance-700"><a href="#Scene.mesh_instance-700"><span class="linenos">700</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene.mesh_instance-701"><a href="#Scene.mesh_instance-701"><span class="linenos">701</span></a>        <span class="k">if</span> <span class="n">normals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-702"><a href="#Scene.mesh_instance-702"><span class="linenos">702</span></a>            <span class="n">normals</span> <span class="o">=</span> <span class="n">gen_normals</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-703"><a href="#Scene.mesh_instance-703"><span class="linenos">703</span></a>        <span class="k">if</span> <span class="n">vertex_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-704"><a href="#Scene.mesh_instance-704"><span class="linenos">704</span></a>            <span class="n">vertex_count</span> <span class="o">=</span> <span class="n">vertices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.mesh_instance-705"><a href="#Scene.mesh_instance-705"><span class="linenos">705</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-706"><a href="#Scene.mesh_instance-706"><span class="linenos">706</span></a>            <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-707"><a href="#Scene.mesh_instance-707"><span class="linenos">707</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">vertex_count</span>
</span><span id="Scene.mesh_instance-708"><a href="#Scene.mesh_instance-708"><span class="linenos">708</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-709"><a href="#Scene.mesh_instance-709"><span class="linenos">709</span></a>                <span class="n">index_count</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.mesh_instance-710"><a href="#Scene.mesh_instance-710"><span class="linenos">710</span></a>        <span class="k">if</span> <span class="n">transforms</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-711"><a href="#Scene.mesh_instance-711"><span class="linenos">711</span></a>            <span class="k">if</span> <span class="n">transforms</span><span class="o">.</span><span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">transforms</span><span class="o">.</span><span class="n">n</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-712"><a href="#Scene.mesh_instance-712"><span class="linenos">712</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error! Transform matrix must be 4x4 shape&quot;</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-713"><a href="#Scene.mesh_instance-713"><span class="linenos">713</span></a>            <span class="k">if</span> <span class="n">instance_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-714"><a href="#Scene.mesh_instance-714"><span class="linenos">714</span></a>                <span class="n">instance_count</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.mesh_instance-715"><a href="#Scene.mesh_instance-715"><span class="linenos">715</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Scene.mesh_instance-716"><a href="#Scene.mesh_instance-716"><span class="linenos">716</span></a>            <span class="n">instance_count</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Scene.mesh_instance-717"><a href="#Scene.mesh_instance-717"><span class="linenos">717</span></a>
</span><span id="Scene.mesh_instance-718"><a href="#Scene.mesh_instance-718"><span class="linenos">718</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-719"><a href="#Scene.mesh_instance-719"><span class="linenos">719</span></a>        <span class="n">copy_all_to_vbo</span><span class="p">(</span><span class="n">vbo</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">normals</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-720"><a href="#Scene.mesh_instance-720"><span class="linenos">720</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-721"><a href="#Scene.mesh_instance-721"><span class="linenos">721</span></a>        <span class="n">indices_ndarray</span> <span class="o">=</span> <span class="n">get_indices_field</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="k">if</span> <span class="n">indices</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene.mesh_instance-722"><a href="#Scene.mesh_instance-722"><span class="linenos">722</span></a>        <span class="n">indices_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">indices_ndarray</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-723"><a href="#Scene.mesh_instance-723"><span class="linenos">723</span></a>        <span class="n">transforms_ndarray</span> <span class="o">=</span> <span class="n">get_transforms_field</span><span class="p">(</span><span class="n">transforms</span><span class="p">)</span> <span class="k">if</span> <span class="n">transforms</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="Scene.mesh_instance-724"><a href="#Scene.mesh_instance-724"><span class="linenos">724</span></a>        <span class="n">transform_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">transforms_ndarray</span><span class="p">)</span>
</span><span id="Scene.mesh_instance-725"><a href="#Scene.mesh_instance-725"><span class="linenos">725</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">mesh_instance</span><span class="p">(</span>
</span><span id="Scene.mesh_instance-726"><a href="#Scene.mesh_instance-726"><span class="linenos">726</span></a>            <span class="n">vbo_info</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-727"><a href="#Scene.mesh_instance-727"><span class="linenos">727</span></a>            <span class="n">has_per_vertex_color</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-728"><a href="#Scene.mesh_instance-728"><span class="linenos">728</span></a>            <span class="n">indices_info</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-729"><a href="#Scene.mesh_instance-729"><span class="linenos">729</span></a>            <span class="n">color</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-730"><a href="#Scene.mesh_instance-730"><span class="linenos">730</span></a>            <span class="n">two_sided</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-731"><a href="#Scene.mesh_instance-731"><span class="linenos">731</span></a>            <span class="n">transform_info</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-732"><a href="#Scene.mesh_instance-732"><span class="linenos">732</span></a>            <span class="n">instance_count</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-733"><a href="#Scene.mesh_instance-733"><span class="linenos">733</span></a>            <span class="n">instance_offset</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-734"><a href="#Scene.mesh_instance-734"><span class="linenos">734</span></a>            <span class="n">index_count</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-735"><a href="#Scene.mesh_instance-735"><span class="linenos">735</span></a>            <span class="n">index_offset</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-736"><a href="#Scene.mesh_instance-736"><span class="linenos">736</span></a>            <span class="n">vertex_count</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-737"><a href="#Scene.mesh_instance-737"><span class="linenos">737</span></a>            <span class="n">vertex_offset</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-738"><a href="#Scene.mesh_instance-738"><span class="linenos">738</span></a>            <span class="n">show_wireframe</span><span class="p">,</span>
</span><span id="Scene.mesh_instance-739"><a href="#Scene.mesh_instance-739"><span class="linenos">739</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare mesh instances inside the scene.</p>

<p>If transforms is given, then according to the shape of transforms, it will
draw mesh instances based on the transforms, and you can indicate which instance
to draw first. If you indicate the index_offset and index_count, the normals will also
be sliced by the args, and the shading resultes will not be affected.
(It is equal to make a part of the mesh visible)</p>

<p>Args:
    vertices: a taichi 3D Vector field, where each element indicate the
        3D location of a vertex.
    indices: a taichi int field of shape (3 * #triangles), which indicate
        the vertex indices of the triangles. If this is None, then it is
        assumed that the vertices are already arranged in triangles order.
    normals: a taichi 3D Vector field, where each element indicate the
        normal of a vertex. If this is none, normals will be automatically
        inferred from vertex positions.
    color: a global color of the mesh as 3 floats representing RGB values.
        If <code>per_vertex_color</code> is provided, this is ignored.
    per_vertex_color (Tuple[float]): a taichi 3D vector field, where each
        element indicate the RGB color of a vertex.
    two_sided (bool): whether or not the triangles should be able to be
        seen from both sides.
    transforms (ti.Matrix.field, optional):
        The Matrix must be 4x4 size with N instances, and data type should
        be ti.f32, ti.i32, ti.u32. If None, then it behaves like raw mesh (no copy).
    instance_offset (int, optional):
        Default value is 0 which means no offset to show mesh instances. Otherwise,
        the mesh instances will show from the <code>instance_offset</code>.
    instance_count (int, optional):
        The default value is None. If this parameter is not provided, instance_count = transforms.shape[0] - instance_offset.
    vertex_offset (int, optional):
        if 'indices' is provided, this refers to the value added to the vertex
        index before indexing into the vertex buffer, else this refers to the
        index of the first vertex to draw.
    vertex_count (int, optional):
        only available when <code>indices</code> is not provided, which is the number
        of vertices to draw.
    index_offset (int, optional):
        only available when <code>indices</code> is provided, which is the base index
        within the index buffer.
    index_count (int, optional):
        only available when <code>indices</code> is provided, which is the the number
        of indices to draw.
    show_wireframe (bool, optional):
        turn on/off WareFrame mode.</p>
</div>


                            </div>
                            <div id="Scene.particles" class="classattr">
                                        <input id="Scene.particles-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">particles</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">centers</span>,</span><span class="param">	<span class="n">radius</span>,</span><span class="param">	<span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>,</span><span class="param">	<span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.particles-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.particles"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.particles-741"><a href="#Scene.particles-741"><span class="linenos">741</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">particles</span><span class="p">(</span>
</span><span id="Scene.particles-742"><a href="#Scene.particles-742"><span class="linenos">742</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Scene.particles-743"><a href="#Scene.particles-743"><span class="linenos">743</span></a>        <span class="n">centers</span><span class="p">,</span>
</span><span id="Scene.particles-744"><a href="#Scene.particles-744"><span class="linenos">744</span></a>        <span class="n">radius</span><span class="p">,</span>
</span><span id="Scene.particles-745"><a href="#Scene.particles-745"><span class="linenos">745</span></a>        <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>
</span><span id="Scene.particles-746"><a href="#Scene.particles-746"><span class="linenos">746</span></a>        <span class="n">per_vertex_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.particles-747"><a href="#Scene.particles-747"><span class="linenos">747</span></a>        <span class="n">per_vertex_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.particles-748"><a href="#Scene.particles-748"><span class="linenos">748</span></a>        <span class="n">index_offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.particles-749"><a href="#Scene.particles-749"><span class="linenos">749</span></a>        <span class="n">index_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Scene.particles-750"><a href="#Scene.particles-750"><span class="linenos">750</span></a>    <span class="p">):</span>
</span><span id="Scene.particles-751"><a href="#Scene.particles-751"><span class="linenos">751</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Declare a set of particles within the scene.</span>
</span><span id="Scene.particles-752"><a href="#Scene.particles-752"><span class="linenos">752</span></a>
</span><span id="Scene.particles-753"><a href="#Scene.particles-753"><span class="linenos">753</span></a><span class="sd">        Args:</span>
</span><span id="Scene.particles-754"><a href="#Scene.particles-754"><span class="linenos">754</span></a><span class="sd">            centers: a taichi 3D Vector field, where each element indicate the</span>
</span><span id="Scene.particles-755"><a href="#Scene.particles-755"><span class="linenos">755</span></a><span class="sd">                3D location of the center of a particle.</span>
</span><span id="Scene.particles-756"><a href="#Scene.particles-756"><span class="linenos">756</span></a><span class="sd">            color: a global color for the particles as 3 floats representing RGB</span>
</span><span id="Scene.particles-757"><a href="#Scene.particles-757"><span class="linenos">757</span></a><span class="sd">                values. If `per_vertex_color` is provided, this is ignored.</span>
</span><span id="Scene.particles-758"><a href="#Scene.particles-758"><span class="linenos">758</span></a><span class="sd">            radius: a global radius for the particles as a float.</span>
</span><span id="Scene.particles-759"><a href="#Scene.particles-759"><span class="linenos">759</span></a><span class="sd">                If &#39;per_vertex_radius&#39; is provided, this is ignored.</span>
</span><span id="Scene.particles-760"><a href="#Scene.particles-760"><span class="linenos">760</span></a><span class="sd">            per_vertex_color: a taichi 3D vector field, where each</span>
</span><span id="Scene.particles-761"><a href="#Scene.particles-761"><span class="linenos">761</span></a><span class="sd">                element indicates the RGB color of a particle.</span>
</span><span id="Scene.particles-762"><a href="#Scene.particles-762"><span class="linenos">762</span></a><span class="sd">            per_vertex_radius: a taichi float field, where each</span>
</span><span id="Scene.particles-763"><a href="#Scene.particles-763"><span class="linenos">763</span></a><span class="sd">                element indicates the radius of a particle.</span>
</span><span id="Scene.particles-764"><a href="#Scene.particles-764"><span class="linenos">764</span></a><span class="sd">            index_offset (int, optional):</span>
</span><span id="Scene.particles-765"><a href="#Scene.particles-765"><span class="linenos">765</span></a><span class="sd">                the index of the first vertex to draw.</span>
</span><span id="Scene.particles-766"><a href="#Scene.particles-766"><span class="linenos">766</span></a><span class="sd">            index_count (int, optional):</span>
</span><span id="Scene.particles-767"><a href="#Scene.particles-767"><span class="linenos">767</span></a><span class="sd">                the number of vertices to draw.</span>
</span><span id="Scene.particles-768"><a href="#Scene.particles-768"><span class="linenos">768</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.particles-769"><a href="#Scene.particles-769"><span class="linenos">769</span></a>        <span class="n">has_per_vertex_color</span> <span class="o">=</span> <span class="n">per_vertex_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene.particles-770"><a href="#Scene.particles-770"><span class="linenos">770</span></a>        <span class="n">has_per_vertex_radius</span> <span class="o">=</span> <span class="n">per_vertex_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="Scene.particles-771"><a href="#Scene.particles-771"><span class="linenos">771</span></a>        <span class="k">if</span> <span class="n">index_count</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Scene.particles-772"><a href="#Scene.particles-772"><span class="linenos">772</span></a>            <span class="n">index_count</span> <span class="o">=</span> <span class="n">centers</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Scene.particles-773"><a href="#Scene.particles-773"><span class="linenos">773</span></a>            <span class="c1"># per_vertex_radius_vec3[i] = Vector([per_vertex_radius[i], 0., 0.])</span>
</span><span id="Scene.particles-774"><a href="#Scene.particles-774"><span class="linenos">774</span></a>        <span class="n">vbo</span> <span class="o">=</span> <span class="n">get_vbo_field</span><span class="p">(</span><span class="n">centers</span><span class="p">)</span>
</span><span id="Scene.particles-775"><a href="#Scene.particles-775"><span class="linenos">775</span></a>        <span class="n">copy_all_to_vbo_particle</span><span class="p">(</span>
</span><span id="Scene.particles-776"><a href="#Scene.particles-776"><span class="linenos">776</span></a>            <span class="n">vbo</span><span class="p">,</span>
</span><span id="Scene.particles-777"><a href="#Scene.particles-777"><span class="linenos">777</span></a>            <span class="n">centers</span><span class="p">,</span>
</span><span id="Scene.particles-778"><a href="#Scene.particles-778"><span class="linenos">778</span></a>            <span class="n">per_vertex_radius</span> <span class="k">if</span> <span class="n">has_per_vertex_radius</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.particles-779"><a href="#Scene.particles-779"><span class="linenos">779</span></a>            <span class="n">per_vertex_color</span> <span class="k">if</span> <span class="n">has_per_vertex_color</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Scene.particles-780"><a href="#Scene.particles-780"><span class="linenos">780</span></a>        <span class="p">)</span>
</span><span id="Scene.particles-781"><a href="#Scene.particles-781"><span class="linenos">781</span></a>        <span class="n">vbo_info</span> <span class="o">=</span> <span class="n">get_field_info</span><span class="p">(</span><span class="n">vbo</span><span class="p">)</span>
</span><span id="Scene.particles-782"><a href="#Scene.particles-782"><span class="linenos">782</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">particles</span><span class="p">(</span>
</span><span id="Scene.particles-783"><a href="#Scene.particles-783"><span class="linenos">783</span></a>            <span class="n">vbo_info</span><span class="p">,</span> <span class="n">has_per_vertex_color</span><span class="p">,</span> <span class="n">has_per_vertex_radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">index_count</span><span class="p">,</span> <span class="n">index_offset</span>
</span><span id="Scene.particles-784"><a href="#Scene.particles-784"><span class="linenos">784</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Declare a set of particles within the scene.</p>

<p>Args:
    centers: a taichi 3D Vector field, where each element indicate the
        3D location of the center of a particle.
    color: a global color for the particles as 3 floats representing RGB
        values. If <code>per_vertex_color</code> is provided, this is ignored.
    radius: a global radius for the particles as a float.
        If 'per_vertex_radius' is provided, this is ignored.
    per_vertex_color: a taichi 3D vector field, where each
        element indicates the RGB color of a particle.
    per_vertex_radius: a taichi float field, where each
        element indicates the radius of a particle.
    index_offset (int, optional):
        the index of the first vertex to draw.
    index_count (int, optional):
        the number of vertices to draw.</p>
</div>


                            </div>
                            <div id="Scene.point_light" class="classattr">
                                        <input id="Scene.point_light-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">point_light</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">pos</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.point_light-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.point_light"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.point_light-786"><a href="#Scene.point_light-786"><span class="linenos">786</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>  <span class="c1"># pylint: disable=W0235</span>
</span><span id="Scene.point_light-787"><a href="#Scene.point_light-787"><span class="linenos">787</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a point light in this scene.</span>
</span><span id="Scene.point_light-788"><a href="#Scene.point_light-788"><span class="linenos">788</span></a>
</span><span id="Scene.point_light-789"><a href="#Scene.point_light-789"><span class="linenos">789</span></a><span class="sd">        Args:</span>
</span><span id="Scene.point_light-790"><a href="#Scene.point_light-790"><span class="linenos">790</span></a><span class="sd">            pos (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="Scene.point_light-791"><a href="#Scene.point_light-791"><span class="linenos">791</span></a><span class="sd">                3D vector for light position.</span>
</span><span id="Scene.point_light-792"><a href="#Scene.point_light-792"><span class="linenos">792</span></a><span class="sd">            color (list, tuple, :class:`~taichi.types.vector(3, float)`):</span>
</span><span id="Scene.point_light-793"><a href="#Scene.point_light-793"><span class="linenos">793</span></a><span class="sd">                (r, g, b) triple for the color of the light, in the range [0, 1].</span>
</span><span id="Scene.point_light-794"><a href="#Scene.point_light-794"><span class="linenos">794</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.point_light-795"><a href="#Scene.point_light-795"><span class="linenos">795</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">point_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">pos</span><span class="p">),</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Set a point light in this scene.</p>

<p>Args:
    pos (list, tuple, <code>~taichi.types.vector(3, float)</code>):
        3D vector for light position.
    color (list, tuple, <code>~taichi.types.vector(3, float)</code>):
        (r, g, b) triple for the color of the light, in the range [0, 1].</p>
</div>


                            </div>
                            <div id="Scene.ambient_light" class="classattr">
                                        <input id="Scene.ambient_light-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ambient_light</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">color</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Scene.ambient_light-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Scene.ambient_light"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Scene.ambient_light-797"><a href="#Scene.ambient_light-797"><span class="linenos">797</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ambient_light</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
</span><span id="Scene.ambient_light-798"><a href="#Scene.ambient_light-798"><span class="linenos">798</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the ambient color of this scene.</span>
</span><span id="Scene.ambient_light-799"><a href="#Scene.ambient_light-799"><span class="linenos">799</span></a>
</span><span id="Scene.ambient_light-800"><a href="#Scene.ambient_light-800"><span class="linenos">800</span></a><span class="sd">        Example::</span>
</span><span id="Scene.ambient_light-801"><a href="#Scene.ambient_light-801"><span class="linenos">801</span></a>
</span><span id="Scene.ambient_light-802"><a href="#Scene.ambient_light-802"><span class="linenos">802</span></a><span class="sd">            &gt;&gt;&gt; scene = ti.ui.Scene()</span>
</span><span id="Scene.ambient_light-803"><a href="#Scene.ambient_light-803"><span class="linenos">803</span></a><span class="sd">            &gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])</span>
</span><span id="Scene.ambient_light-804"><a href="#Scene.ambient_light-804"><span class="linenos">804</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Scene.ambient_light-805"><a href="#Scene.ambient_light-805"><span class="linenos">805</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">ambient_light</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Set the ambient color of this scene.</p>

<p>Example::</p>

<pre><code>&gt;&gt;&gt; scene = ti.ui.Scene()
&gt;&gt;&gt; scene.ambient_light([0.2, 0.2, 0.2])
</code></pre>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>