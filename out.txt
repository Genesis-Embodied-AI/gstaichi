fd46a563b [bug] Fix missing taichi_common symbol in gfx_runtime (#8362)
 taichi/runtime/gfx/CMakeLists.txt | 1 +
 1 file changed, 1 insertion(+)
8c864839f [aot] Fix 140 convention to match master (#8306)
 python/taichi/aot/conventions/gfxruntime140/dr.py | 25 ++++++++++++-----------
 1 file changed, 13 insertions(+), 12 deletions(-)
de1942d4f [bug] Fix dataclass support for struct with matrix (#8251)
 python/taichi/lang/struct.py |  2 +-
 tests/python/test_struct.py  | 34 ++++++++++++++++++++++++++++++++++
 2 files changed, 35 insertions(+), 1 deletion(-)
a4d246ba8 [bug] Fix failed IR verification after ndarray clamp (#8181)
 taichi/transforms/handle_external_ptr_boundary.cpp |  3 +--
 tests/python/test_ndarray.py                       | 16 ++++++++++++++++
 2 files changed, 17 insertions(+), 2 deletions(-)
06c580879 [lang] Include argument name in error message (#8180)
 python/taichi/lang/ast/ast_transformer.py |  2 +-
 python/taichi/lang/kernel_impl.py         | 46 ++++++++++++++++---------------
 python/taichi/types/ndarray_type.py       | 10 +++----
 tests/python/test_function.py             |  2 +-
 tests/python/test_kernel_arg_errors.py    |  4 +--
 tests/python/test_ndarray.py              | 18 ++++++------
 tests/python/test_numpy.py                |  8 +++---
 tests/python/test_texture.py              |  6 ++--
 8 files changed, 49 insertions(+), 47 deletions(-)
892c56508 [aot] Fix unused args in cppgen (#8154)
 python/taichi/aot/conventions/gfxruntime140/dr.py |  2 ++
 python/taichi/aot/conventions/gfxruntime140/sr.py | 39 ++++++++++++++++++++---
 taichi/codegen/spirv/kernel_utils.cpp             |  2 +-
 taichi/codegen/spirv/kernel_utils.h               |  4 ++-
 taichi/inc/constants.h                            |  9 ++++++
 taichi/program/callable.cpp                       |  4 +++
 taichi/program/callable.h                         | 13 ++++++--
 tests/python/test_aot.py                          |  2 ++
 8 files changed, 65 insertions(+), 10 deletions(-)
373e2f06b [lang] Support clamp type hint for ndarrays (#8136)
 python/taichi/lang/ast/ast_transformer.py          |   1 +
 python/taichi/lang/enums.py                        |   9 ++
 python/taichi/lang/kernel_arguments.py             |   4 +-
 python/taichi/lang/kernel_impl.py                  |   4 +-
 python/taichi/types/ndarray_type.py                |   4 +-
 taichi/inc/constants.h                             |   2 +
 taichi/ir/frontend_ir.cpp                          |   6 +-
 taichi/ir/frontend_ir.h                            |  15 ++-
 taichi/ir/statements.cpp                           |  13 ++-
 taichi/ir/statements.h                             |   7 +-
 taichi/ir/transforms.h                             |   1 +
 taichi/python/export_lang.cpp                      |   8 +-
 taichi/transforms/compile_to_offloads.cpp          |   3 +
 taichi/transforms/handle_external_ptr_boundary.cpp | 115 +++++++++++++++++++++
 tests/python/test_ndarray.py                       |  40 +++++++
 15 files changed, 213 insertions(+), 19 deletions(-)
0b661e9de [lang] Enforce dtype check for numpy arrays (#8141)
 docs/lang/articles/basic/ndarray.md |  2 +-
 python/taichi/lang/kernel_impl.py   |  8 +++++++-
 tests/python/test_numpy.py          | 12 ++++++++++++
 3 files changed, 20 insertions(+), 2 deletions(-)
7ec71d5ef [metal] Support i64 with MSL2.3.0 (#8140)
 taichi/rhi/metal/metal_device.mm |  5 +++++
 tests/python/test_numpy.py       | 11 +++++++++++
 2 files changed, 16 insertions(+)
5f8b5db41 [aot] Misc fixes for cppgen (#8106)
 python/taichi/aot/conventions/gfxruntime140/dr.py |  2 --
 python/taichi/aot/utils.py                        | 15 ++++++++-------
 taichi/codegen/spirv/kernel_utils.cpp             | 16 ++++++++++++++++
 taichi/program/callable.h                         | 14 ++++++++++----
 tests/python/test_aot.py                          | 14 +++++++++++++-
 5 files changed, 47 insertions(+), 14 deletions(-)
1a15c63c9 [aot] Make generated tcm deterministic hash-wise (#8088)
 python/taichi/aot/module.py |  5 +++++
 tests/python/test_aot.py    | 11 +++++++++++
 2 files changed, 16 insertions(+)
dd16a447e [refactor] Get rid of unnecessary element_dim in ExternalPtrStmt
 taichi/codegen/llvm/codegen_llvm.cpp     |  5 +----
 taichi/codegen/spirv/spirv_codegen.cpp   |  6 +-----
 taichi/ir/frontend_ir.cpp                |  6 +++---
 taichi/ir/ir_builder.cpp                 |  4 ++--
 taichi/ir/statements.cpp                 |  2 --
 taichi/ir/statements.h                   |  4 ----
 taichi/transforms/auto_diff.cpp          | 13 +++++--------
 taichi/transforms/check_out_of_bound.cpp |  2 --
 taichi/transforms/ir_printer.cpp         |  3 +--
 taichi/transforms/scalarize.cpp          |  3 +--
 10 files changed, 14 insertions(+), 34 deletions(-)
f7e9d7eb7 [refactor] Get rid of unnecessary element_dim in ExternalTensorExpression
 taichi/analysis/gen_offline_cache_key.cpp |  1 -
 taichi/ir/expression_printer.h            |  5 ++---
 taichi/ir/frontend_ir.cpp                 | 15 +++++----------
 taichi/ir/frontend_ir.h                   |  7 -------
 taichi/python/export_lang.cpp             |  6 +++++-
 5 files changed, 12 insertions(+), 22 deletions(-)
61baee764 [refactor] Rename dim to ndim for consistency in ExternalTensorExpression
 taichi/analysis/gen_offline_cache_key.cpp |  2 +-
 taichi/ir/expression_printer.h            |  2 +-
 taichi/ir/frontend_ir.cpp                 |  8 ++++----
 taichi/ir/frontend_ir.h                   | 12 ++++++------
 taichi/python/export_lang.cpp             |  2 +-
 taichi/transforms/lower_ast.cpp           |  2 +-
 6 files changed, 14 insertions(+), 14 deletions(-)
d56f7b1ea [refactor] Simplify ndarray arg declaration
 python/taichi/lang/ast/ast_transformer.py |  3 +--
 python/taichi/lang/kernel_arguments.py    |  8 +-------
 python/taichi/lang/kernel_impl.py         | 10 ++++++++--
 taichi/ir/type.cpp                        |  7 +++++++
 4 files changed, 17 insertions(+), 11 deletions(-)
99d52c43f [refactor] Simplify ndarray impl by separating ndim and element_shape in IR
 python/taichi/lang/any_array.py           |  6 +-----
 python/taichi/lang/ast/ast_transformer.py |  3 +--
 python/taichi/lang/kernel_arguments.py    | 13 ++++++------
 python/taichi/lang/kernel_impl.py         |  4 ++--
 taichi/ir/frontend_ir.cpp                 |  9 ++++----
 taichi/ir/frontend_ir.h                   | 35 +++++++------------------------
 taichi/program/callable.cpp               | 19 +++++++++++------
 taichi/program/callable.h                 |  3 +--
 taichi/python/export_lang.cpp             |  3 +--
 taichi/transforms/lower_ast.cpp           |  2 +-
 tests/cpp/ir/ir_builder_test.cpp          |  4 ++--
 tests/cpp/ir/ndarray_kernel.cpp           |  4 ++--
 12 files changed, 44 insertions(+), 61 deletions(-)
d41d5c202 [bug] Fix vector/matrix ndarray zero fill (#8068)
 python/taichi/lang/matrix.py |  8 ++++++--
 tests/python/test_ndarray.py | 20 ++++++++++++++++++++
 2 files changed, 26 insertions(+), 2 deletions(-)
fdb9becfb [refactor] Get rid of element shape in runtime struct type of ndarray
 taichi/ir/frontend_ir.cpp   | 16 +++++++---------
 taichi/ir/ir_builder.cpp    |  5 ++---
 taichi/ir/type_factory.cpp  |  6 +++---
 taichi/ir/type_factory.h    |  2 +-
 taichi/program/callable.cpp |  2 +-
 5 files changed, 14 insertions(+), 17 deletions(-)
8460ea5f5 [refactor] Simplify ndarray type formation in llvm codegen
 taichi/codegen/llvm/codegen_llvm.cpp | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)
f2d33161a [refactor] Simplify ndarray type formation in scalarize pass
 taichi/transforms/scalarize.cpp | 9 +++------
 1 file changed, 3 insertions(+), 6 deletions(-)
f1b9508c0 [aot] [bug] Fix cached kernel name lookup (#8035)
 taichi/runtime/gfx/aot_module_loader_impl.cpp | 5 +----
 tests/cpp/aot/gfx_utils.cpp                   | 2 +-
 2 files changed, 2 insertions(+), 5 deletions(-)
09df9f1db [lang] Support ti.types.vector and matrix as type annotation
 python/taichi/lang/matrix.py          |  6 ++++--
 python/taichi/types/compound_types.py |  4 ++--
 tests/python/test_ndarray.py          | 40 +++++++++++++++++++++++++++++++++++
 3 files changed, 46 insertions(+), 4 deletions(-)
87ebc1b39 [aot] Remove redundant copy of libtaichi_c_api.so to build (#8014)
 .github/workflows/scripts/aot-demo.sh         |  3 ++-
 .github/workflows/scripts/ti_build/android.py |  3 ++-
 cmake/TaichiCAPI.cmake                        | 21 ---------------------
 3 files changed, 4 insertions(+), 23 deletions(-)
4ce4fd53f [refactor] Simplify ndarray dtype check_match logic
 python/taichi/lang/matrix.py        | 13 +++++++++++++
 python/taichi/types/ndarray_type.py | 22 ++++------------------
 tests/python/test_ndarray.py        | 24 +++++++++++++++++++++---
 3 files changed, 38 insertions(+), 21 deletions(-)
f29ed4495 [refactor] Remove redundant TensorType class in python scope
 python/taichi/lang/_ndarray.py        |  3 +--
 python/taichi/lang/matrix.py          | 16 ++++++++++------
 python/taichi/lang/struct.py          |  2 +-
 python/taichi/types/compound_types.py | 14 --------------
 python/taichi/types/ndarray_type.py   | 16 +++-------------
 tests/python/test_ndarray.py          |  6 +++---
 6 files changed, 18 insertions(+), 39 deletions(-)
d51f6fe5a [refactor] Simplify arg_features logic for ndarray (#7974)
 python/taichi/lang/kernel_impl.py | 70 ++++++++++++++++++---------------------
 1 file changed, 32 insertions(+), 38 deletions(-)
9a963807c [autodiff] Support passing vector/matrix args in autodiff kernel (#7973)
 taichi/transforms/auto_diff.cpp |  4 ++++
 tests/python/test_ad_ndarray.py | 28 ++++++++++++++++++++++++++++
 2 files changed, 32 insertions(+)
89db415fd [autodiff] Support passing requires_grad=True tensor to an arg with needs_grad=False (#7970)
 python/taichi/lang/kernel_impl.py   | 79 +++++++++++++++++++------------------
 python/taichi/types/ndarray_type.py |  3 +-
 tests/python/test_ad_ndarray.py     | 47 ++++++++++++++++++++++
 3 files changed, 89 insertions(+), 40 deletions(-)
e88d32d87 [autodiff] Support grad tensor in primal kernel (#7962)
 python/taichi/lang/any_array.py |  6 ++++++
 taichi/ir/frontend_ir.cpp       |  3 ++-
 taichi/ir/frontend_ir.h         |  7 ++++---
 taichi/python/export_lang.cpp   |  3 +++
 taichi/transforms/auto_diff.cpp | 13 ++++++++++++-
 tests/python/test_ad_ndarray.py | 20 ++++++++++++++++++++
 6 files changed, 47 insertions(+), 5 deletions(-)
477a0c74e [lang] Improve misc error report related to passing ndarray to a kernel (#7966)
 python/taichi/types/compound_types.py |  3 +++
 python/taichi/types/ndarray_type.py   |  2 +-
 tests/python/test_ndarray.py          | 43 ++++++++++++++++++++++++++++++++++-
 3 files changed, 46 insertions(+), 2 deletions(-)
e21fce2ae [autodiff] Support ExternalTensorShapeAlongAxis in autodiff (#7963)
 taichi/transforms/auto_diff.cpp |  4 ++++
 tests/python/test_ad_ndarray.py | 25 +++++++++++++++++++++++++
 2 files changed, 29 insertions(+)
5ac2756a6 [windows] Workaround C++ mangling special chars (#7964)
 taichi/runtime/cuda/jit_cuda.cpp | 16 +++++++++-------
 1 file changed, 9 insertions(+), 7 deletions(-)
bf79aac8f [bug] Fix vector/matrix dtype created in the python scope (#7948)
 python/taichi/lang/matrix.py | 6 ++++--
 tests/python/test_matrix.py  | 9 +++++++++
 2 files changed, 13 insertions(+), 2 deletions(-)
975941dbf [Opt] Make merging casts int(int(x)) less aggressive (#7944)
 taichi/transforms/alg_simp.cpp    |  6 ++++--
 tests/python/test_optimization.py | 10 ++++++++++
 2 files changed, 14 insertions(+), 2 deletions(-)
f6ebff34a [Opt] Fix redundant clone of stmts across offloaded tasks (#7927)
 taichi/transforms/offload.cpp      | 44 +++++++++++++++++++-------------------
 tests/python/test_offload_cross.py | 21 ++++++++++++++++++
 2 files changed, 43 insertions(+), 22 deletions(-)
e2dd30b8f [cuda] Only set CU_LIMIT_STACK_SIZE when necessary (#7906)
 taichi/program/compile_config.h               | 2 +-
 taichi/runtime/cuda/kernel_launcher.cpp       | 2 --
 taichi/runtime/llvm/llvm_runtime_executor.cpp | 4 ++++
 tests/python/test_function.py                 | 2 +-
 tests/python/test_offline_cache.py            | 1 +
 5 files changed, 7 insertions(+), 4 deletions(-)
bbb8a023d [autodiff] Fix missing grad with using torch tensor with tape (#7898)
 python/taichi/ad/_ad.py         |  7 +++++--
 tests/python/test_ad_ndarray.py | 25 +++++++++++++++++++++++++
 2 files changed, 30 insertions(+), 2 deletions(-)
f9c24571c [autodiff] Enfore strict check for ndarrays when used in ti.ad.Tape
 python/taichi/ad/_ad.py         | 12 +++++++++
 tests/python/test_ad_ndarray.py | 58 +++++++++++++++++++++++++++++++++++++++++
 2 files changed, 70 insertions(+)
f0bdda534 [refactor] Get rid of has_grad in LaunchContextBuilder
 taichi/program/launch_context_builder.cpp |  8 ++------
 taichi/program/launch_context_builder.h   |  2 --
 taichi/runtime/cpu/kernel_launcher.cpp    | 15 ++++++---------
 3 files changed, 8 insertions(+), 17 deletions(-)
292fb1c27 [refactor] Rename get_num_elements in StructType to get_flattened_num_elements
 taichi/codegen/llvm/codegen_llvm.cpp   | 2 +-
 taichi/codegen/spirv/spirv_codegen.cpp | 2 +-
 taichi/ir/frontend_ir.cpp              | 2 +-
 taichi/ir/type.h                       | 4 ++--
 4 files changed, 5 insertions(+), 5 deletions(-)
dcd6f0dfd [autodiff] Support autodiff for torch Tensor and taichi ndarray on CPU and CUDA
 python/taichi/ad/_ad.py                   |   47 +-
 python/taichi/lang/_ndarray.py            |    2 +-
 python/taichi/lang/any_array.py           |    4 +-
 python/taichi/lang/ast/ast_transformer.py |    1 +
 python/taichi/lang/impl.py                |   26 +-
 python/taichi/lang/kernel_arguments.py    |    6 +-
 python/taichi/lang/kernel_impl.py         |   15 +-
 python/taichi/types/ndarray_type.py       |   13 +-
 taichi/analysis/alias_analysis.cpp        |    2 +
 taichi/analysis/gen_offline_cache_key.cpp |    2 +-
 taichi/codegen/llvm/codegen_llvm.cpp      |    6 +-
 taichi/ir/expression_printer.h            |    3 +-
 taichi/ir/frontend_ir.cpp                 |    3 +-
 taichi/ir/frontend_ir.h                   |   20 +-
 taichi/ir/type_factory.cpp                |    8 +-
 taichi/ir/type_factory.h                  |    4 +-
 taichi/program/callable.cpp               |   10 +-
 taichi/program/callable.h                 |   12 +-
 taichi/program/launch_context_builder.cpp |    4 +-
 taichi/python/export_lang.cpp             |    7 +-
 taichi/runtime/cuda/kernel_launcher.cpp   |   33 +-
 taichi/transforms/auto_diff.cpp           |  139 +++-
 taichi/transforms/scalarize.cpp           |    7 +-
 tests/python/test_ad_external_array.py    |   35 -
 tests/python/test_ad_ndarray.py           | 1225 +++++++++++++++++++++++++++++
 tests/test_utils.py                       |   40 +
 26 files changed, 1529 insertions(+), 145 deletions(-)
c6763019f [Bug] Fix wrong datatype size when writing to ndarray from Python scope
 taichi/program/ndarray.cpp   | 15 +++++++--------
 taichi/program/ndarray.h     |  3 +--
 tests/python/test_ndarray.py | 12 ++++++++++++
 3 files changed, 20 insertions(+), 10 deletions(-)
07dd100cc [lang] Support 0 dim ndarray read & write in python scope
 taichi/program/ndarray.cpp   | 13 ++++---------
 tests/python/test_ndarray.py | 29 +++++++++++++++++++++++++++++
 2 files changed, 33 insertions(+), 9 deletions(-)
fbd83c8bd [refactor] Improve CUDA kernel launch logic for external arrays and ndarrays
 taichi/runtime/cuda/kernel_launcher.cpp | 117 +++++++++++++++++---------------
 taichi/runtime/cuda/kernel_launcher.h   |   1 +
 2 files changed, 65 insertions(+), 53 deletions(-)
f6941e54f [lang] Add grad_ptr into ndarray struct
 python/taichi/lang/kernel_impl.py              | 16 +++------
 taichi/analysis/alias_analysis.cpp             |  2 +-
 taichi/codegen/llvm/codegen_llvm.cpp           |  7 ++--
 taichi/ir/ir_builder.cpp                       |  7 ++--
 taichi/ir/ir_builder.h                         |  3 +-
 taichi/ir/statements.cpp                       | 10 +++---
 taichi/ir/statements.h                         | 11 ++++--
 taichi/ir/type_factory.cpp                     |  4 ++-
 taichi/ir/type_factory.h                       |  3 ++
 taichi/program/context.h                       |  1 -
 taichi/program/launch_context_builder.cpp      | 48 ++++++++++++--------------
 taichi/program/launch_context_builder.h        | 11 +++---
 taichi/runtime/amdgpu/kernel_launcher.cpp      | 11 ++++--
 taichi/runtime/cpu/kernel_launcher.cpp         | 17 +++++----
 taichi/runtime/cuda/kernel_launcher.cpp        | 12 ++++---
 taichi/runtime/gfx/runtime.cpp                 | 20 ++++++++---
 taichi/runtime/llvm/runtime_module/runtime.cpp |  1 -
 taichi/transforms/ir_printer.cpp               |  2 +-
 taichi/transforms/scalarize.cpp                |  1 +
 tests/cpp/analysis/alias_analysis_test.cpp     |  6 ++--
 20 files changed, 108 insertions(+), 85 deletions(-)
2903a6d7c [refactor] Get rid of unused is_grad in ArgLoadStmt
 python/taichi/lang/any_array.py                   |  6 ------
 taichi/analysis/alias_analysis.cpp                |  2 +-
 taichi/analysis/same_statements.cpp               |  9 ---------
 taichi/codegen/llvm/codegen_llvm.cpp              | 19 +------------------
 taichi/ir/frontend_ir.cpp                         | 11 +++++------
 taichi/ir/ir_builder.cpp                          |  8 ++++----
 taichi/ir/statements.h                            | 13 ++-----------
 taichi/python/export_lang.cpp                     |  3 ---
 taichi/transforms/ir_printer.cpp                  | 12 +++---------
 taichi/transforms/scalarize.cpp                   |  2 +-
 tests/cpp/analysis/alias_analysis_test.cpp        |  4 +---
 tests/cpp/transforms/half2_vectorization_test.cpp |  6 +++---
 tests/cpp/transforms/scalarize_test.cpp           |  4 ++--
 13 files changed, 23 insertions(+), 76 deletions(-)
a9b1d20e9 [autodiff] Remove redundant autodiff mode in kernel name (#7829)
 python/taichi/lang/kernel_impl.py | 11 ++---------
 taichi/program/kernel.cpp         |  4 ++++
 2 files changed, 6 insertions(+), 9 deletions(-)
552af9086 [bug] Fix imgui_context in destroying multiple GGUI windows (#7812)
 taichi/ui/backends/vulkan/gui.cpp | 4 ++--
 taichi/ui/backends/vulkan/gui.h   | 5 +++--
 tests/python/test_ggui.py         | 7 +++++++
 3 files changed, 12 insertions(+), 4 deletions(-)
7b520945c [lang] Support frexp on spirv-based backends (#7770)
 taichi/codegen/cuda/codegen_cuda.cpp    | 17 ++++++++++++++---
 taichi/codegen/spirv/spirv_codegen.cpp  | 28 +++++++++++++++++++++++++++-
 taichi/codegen/spirv/spirv_ir_builder.h |  7 +++++++
 taichi/ir/frontend_ir.cpp               |  8 ++++----
 tests/python/test_unary_ops.py          |  2 +-
 5 files changed, 53 insertions(+), 9 deletions(-)
a533779dc [lang] Support vector and matrix dtypes in ti.field (#7761)
 python/taichi/lang/impl.py | 97 ++++++++++++++++++++++++++--------------------
 tests/python/test_field.py | 30 ++++++++------
 2 files changed, 72 insertions(+), 55 deletions(-)
ea8002e3b [ir] Remove unnecessary field_dims_ in ArgLoadStmt (#7755)
 taichi/ir/frontend_ir.cpp              |  3 ---
 taichi/ir/statements.h                 | 10 +---------
 taichi/transforms/lower_matrix_ptr.cpp |  5 ++++-
 taichi/transforms/type_check.cpp       | 13 +------------
 4 files changed, 6 insertions(+), 25 deletions(-)
564a8801b [lang] Transform bit_shr to bit_sar for uint (#7757)
 taichi/transforms/demote_operations.cpp | 10 +++++-----
 tests/python/test_bit_operations.py     |  9 +++++++++
 2 files changed, 14 insertions(+), 5 deletions(-)
5679ee282 [lang] Improve error message for mismatched index for ndarrays in python scope (#7737)
 python/taichi/lang/_ndarray.py |  6 +++++-
 tests/python/test_ndarray.py   | 13 +++++++++++++
 2 files changed, 18 insertions(+), 1 deletion(-)
345d6f64b [misc] Update pull_request_template.md (#7738)
 .github/pull_request_template.md | 6 ++++++
 1 file changed, 6 insertions(+)
a718716ce [misc] Remove TI_WARN for cuda in memory_pool.cpp (#7734)
 taichi/system/memory_pool.cpp | 1 -
 1 file changed, 1 deletion(-)
c2c1b7d44 [lang] Support frexp on cuda backend (#7721)
 python/taichi/lang/ast/ast_transformer.py |  5 +++++
 python/taichi/lang/expr.py                |  3 +++
 python/taichi/lang/ops.py                 |  6 +++++-
 taichi/codegen/cuda/codegen_cuda.cpp      | 10 ++++++++++
 taichi/inc/unary_op.inc.h                 |  1 +
 taichi/ir/expression_ops.h                |  1 +
 taichi/ir/frontend_ir.cpp                 | 24 +++++++++++++++++++++++-
 taichi/ir/statements.h                    |  2 +-
 taichi/python/export_lang.cpp             |  3 +++
 taichi/transforms/type_check.cpp          |  5 +++++
 tests/python/test_api.py                  |  2 +-
 tests/python/test_unary_ops.py            | 17 +++++++++++++++++
 12 files changed, 75 insertions(+), 4 deletions(-)
ccadca89b [opt] Cleanup unncessary options in constant fold pass (#7661)
 taichi/ir/transforms.h                           |  4 +---
 taichi/transforms/constant_fold.cpp              | 23 ++++-------------------
 taichi/transforms/simplify.cpp                   |  5 ++---
 tests/cpp/transforms/alg_simp_test.cpp           |  3 +--
 tests/cpp/transforms/binary_op_simplify_test.cpp |  4 ++--
 tests/cpp/transforms/constant_fold_test.cpp      |  7 +------
 tests/cpp/transforms/simplify_test.cpp           |  3 +--
 7 files changed, 12 insertions(+), 37 deletions(-)
034963af6 [opt] Move binary jit evaluator to host
 taichi/transforms/constant_fold.cpp | 172 ++++++++++++++++++++----------------
 1 file changed, 94 insertions(+), 78 deletions(-)
fb3201828 [test] Update C++ constant fold tests to test operator one by one
 tests/cpp/transforms/constant_fold_test.cpp | 644 +++++++++++++++++++++++-----
 1 file changed, 540 insertions(+), 104 deletions(-)
cc4ca1107 [bug] Fix logical comparison returns -1 (#7641)
 taichi/codegen/llvm/codegen_llvm.cpp        |  2 +-
 taichi/codegen/spirv/spirv_codegen.cpp      |  9 ++++-----
 taichi/transforms/demote_operations.cpp     |  2 +-
 tests/cpp/transforms/constant_fold_test.cpp | 25 +++++++++++++++++++++++++
 4 files changed, 31 insertions(+), 7 deletions(-)
fc1467437 [bug] Type check for logical not op with real type inputs (#7600)
 taichi/ir/frontend_ir.cpp       |  3 ++-
 tests/python/test_type_check.py | 10 +++++-----
 tests/python/test_unary_ops.py  | 10 ++++++++++
 3 files changed, 17 insertions(+), 6 deletions(-)
d1f78c17e [opt] Constant folding for unary ops on host (#7573)
 taichi/transforms/constant_fold.cpp               | 115 +++++++++++++---------
 tests/cpp/transforms/half2_vectorization_test.cpp |  70 ++++++-------
 2 files changed, 97 insertions(+), 88 deletions(-)
edda631b3 [bug] Type check for bit_not op with real type inputs (#7592)
 taichi/ir/frontend_ir.cpp      |  6 ++++++
 tests/python/test_unary_ops.py | 11 +++++++++++
 2 files changed, 17 insertions(+)
f1f4694f0 [bug] Fix struct members registered to StructField class (#7574)
 python/taichi/lang/struct.py | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)
b64670f42 [test] Add cpp tests for constant folding pass (#7566)
 taichi/ir/ir_builder.cpp                    |   9 +++
 taichi/ir/ir_builder.h                      |   3 +
 taichi/transforms/constant_fold.cpp         |  24 +++---
 tests/cpp/transforms/constant_fold_test.cpp | 112 ++++++++++++++++++++++++++++
 4 files changed, 135 insertions(+), 13 deletions(-)
4e236103e [build] Fix build failure without nvcc (#7521)
 taichi/runtime/llvm/runtime_module/CMakeLists.txt | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)
b7f8c4ad8 [ci] Fix duplicated names in aot tests (#7471)
 .github/workflows/testing.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
d81b4a785 [misc] Add out of bound check for ndarray (#7458)
 taichi/transforms/check_out_of_bound.cpp | 53 +++++++++++++++++++++++++++++++
 tests/python/test_ndarray.py             | 54 ++++++++++++++++++++++++++++++++
 2 files changed, 107 insertions(+)
3d3aa5327 [misc] Add an explicit error in cc backend codegen for dynamic indexing (#7449)
 taichi/codegen/cc/codegen_cc.cpp | 6 ++++++
 1 file changed, 6 insertions(+)
fadedc649 [aot] Add test for shared array (#7387)
 c_api/tests/c_api_aot_test.cpp                     | 49 ++++++++++++++++++
 .../aot/python_scripts/shared_array_aot_test.py    | 60 ++++++++++++++++++++++
 tests/test_config.json                             |  8 +++
 3 files changed, 117 insertions(+)
c94dea8ed [misc] Remove deprecated kwarg in rw_texture type annotations (#7267)
 .github/workflows/scripts/aot-demo.sh |  4 +--
 python/taichi/types/texture_type.py   | 22 ++----------
 tests/python/test_deprecation.py      | 63 -----------------------------------
 3 files changed, 4 insertions(+), 85 deletions(-)
800ff2b61 [aot] Fix ndarray aot with information from type hints (#7214)
 python/taichi/aot/utils.py                     | 71 ++++++++++++++------------
 python/taichi/lang/matrix.py                   |  4 ++
 tests/cpp/aot/python_scripts/graph_aot_test.py | 17 +++---
 tests/python/test_aot.py                       | 23 +++++++++
 4 files changed, 71 insertions(+), 44 deletions(-)
b13b28cdb [doc] Fix netlify build command (#7217)
 netlify.toml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
e84b2d0e0 [metal] Disable a kernel test in offline cache to unblock CI (#7154)
 tests/python/test_offline_cache.py | 18 ++++++++++--------
 1 file changed, 10 insertions(+), 8 deletions(-)
c2d20bad5 [mac] Use ObjectLinkingLayer instead of RTDyldObjectLinkingLayer for aarch64 mac (#7201)
 taichi/runtime/cpu/jit_cpu.cpp | 16 +++++++++++++++-
 1 file changed, 15 insertions(+), 1 deletion(-)
06ce2b7bd [mac] Add .dylib and .cmake to built wheel (#7156)
 setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
d5eae11a3 [cpu] Reuse VirtualMemoryAllocator for CPU ndarray memory allocation (#7128)
 taichi/rhi/cpu/cpu_device.cpp | 12 +-----------
 tests/python/test_ndarray.py  |  3 +--
 2 files changed, 2 insertions(+), 13 deletions(-)
8c5aaafc3 [lang] Free ndarray memory when it's GC-ed in Python (#7072)
 python/taichi/lang/_ndarray.py                     |  5 +++++
 taichi/program/program.cpp                         | 23 ++++++++++++++++++++--
 taichi/program/program.h                           |  5 ++++-
 taichi/program/program_impl.h                      |  4 ++++
 taichi/python/export_lang.cpp                      |  1 +
 taichi/runtime/gfx/runtime.cpp                     |  2 ++
 taichi/runtime/gfx/runtime.h                       | 10 ++++++++++
 taichi/runtime/program_impls/metal/metal_program.h |  4 ++++
 .../runtime/program_impls/opengl/opengl_program.h  |  5 +++++
 .../runtime/program_impls/vulkan/vulkan_program.h  |  3 +++
 tests/python/test_ndarray.py                       | 20 +++++++++++++++++++
 11 files changed, 79 insertions(+), 3 deletions(-)
042c1e1f4 [Lang] Remove filename kwarg in aot Module save() (#7085)
 .github/workflows/scripts/aot-demo.sh                |  4 ++--
 python/taichi/aot/module.py                          |  9 ++-------
 tests/cpp/aot/python_scripts/bitmasked_aot_test.py   |  2 +-
 tests/cpp/aot/python_scripts/comet_aot.py            |  2 +-
 tests/cpp/aot/python_scripts/dense_field_aot_test.py |  2 +-
 tests/cpp/aot/python_scripts/dynamic_aot_test.py     |  2 +-
 tests/cpp/aot/python_scripts/field_aot_test.py       |  4 ++--
 tests/cpp/aot/python_scripts/graph_aot_test.py       |  2 +-
 tests/cpp/aot/python_scripts/kernel_aot_test1.py     |  2 +-
 tests/cpp/aot/python_scripts/kernel_aot_test2.py     |  2 +-
 tests/cpp/aot/python_scripts/mpm88_graph_aot.py      |  4 ++--
 tests/cpp/aot/python_scripts/sph_aot.py              |  2 +-
 tests/cpp/aot/python_scripts/taichi_sparse_test.py   |  2 +-
 tests/cpp/aot/python_scripts/texture_aot_test.py     |  2 +-
 tests/python/test_aot.py                             |  2 +-
 tests/python/test_deprecation.py                     | 16 +---------------
 16 files changed, 20 insertions(+), 39 deletions(-)
b9b5f1a9f [lang] Make sure ndarrays created in python frontend are initialized as zero (#7060)
 python/taichi/lang/_ndarray.py |  6 ++++--
 taichi/program/program.cpp     | 21 +++++++++++++++++++--
 taichi/program/program.h       |  3 ++-
 taichi/python/export_lang.cpp  |  8 ++++----
 tests/python/test_ndarray.py   |  7 +++++++
 5 files changed, 36 insertions(+), 9 deletions(-)
7d1e2877e [opengl] Enable more gles tests in CI (#7031)
 .github/workflows/scripts/unix_test.sh | 6 ++++++
 1 file changed, 6 insertions(+)
f3dd60c63 Revert "[opengl] Enable more gles tests in CI" (#7029)
 .github/workflows/scripts/unix_test.sh | 1 -
 .github/workflows/testing.yml          | 4 ++--
 2 files changed, 2 insertions(+), 3 deletions(-)
1fbd529bd [opengl] Enable more gles tests in CI (#7010)
 .github/workflows/scripts/unix_test.sh | 1 +
 .github/workflows/testing.yml          | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)
c1844bd48 [opengl] Fix tests running both on opengl and vulkan (#7006)
 taichi/rhi/opengl/opengl_api.cpp | 1 +
 1 file changed, 1 insertion(+)
44c19a70e [opengl] Add ti.gles arch and enable tests (#6988)
 docs/lang/articles/deployment/ndarray_android.md |  4 ++--
 python/taichi/lang/impl.py                       |  3 ++-
 python/taichi/lang/misc.py                       | 25 +++++++++++----------
 taichi/analysis/offline_cache_util.cpp           |  3 +--
 taichi/aot/module_loader.cpp                     |  4 ++++
 taichi/inc/archs.inc.h                           |  1 +
 taichi/program/compile_config.h                  |  1 -
 taichi/program/extension.cpp                     |  1 +
 taichi/program/program.cpp                       | 10 ++++++++-
 taichi/python/export_lang.cpp                    |  1 -
 taichi/transforms/offload.cpp                    |  6 +++--
 taichi/util/offline_cache.cpp                    |  3 ++-
 tests/python/test_ad_grad_check.py               |  4 ++--
 tests/python/test_aot.py                         |  6 ++---
 tests/python/test_api.py                         | 28 ++++++++++++------------
 tests/python/test_arg_alignment.py               |  4 ++--
 tests/python/test_argument.py                    |  2 +-
 tests/python/test_cast.py                        |  4 ++--
 tests/python/test_cli.py                         |  2 +-
 tests/python/test_fields_builder.py              |  2 +-
 tests/python/test_internal_func.py               | 15 ++++++++-----
 tests/python/test_linalg.py                      |  2 +-
 tests/python/test_parallel_range_for.py          |  4 ++--
 tests/python/test_pow.py                         |  4 ++--
 tests/python/test_reduction.py                   |  5 +++--
 tests/python/test_return.py                      |  4 ++--
 tests/python/test_scalar_op.py                   |  2 +-
 tests/python/test_struct_for_dynamic.py          |  4 ++--
 tests/python/test_torch_ad.py                    |  2 +-
 tests/python/test_types.py                       | 16 +++++++-------
 tests/python/test_unary_ops.py                   |  3 +--
 tests/test_utils.py                              |  7 +++---
 32 files changed, 101 insertions(+), 81 deletions(-)
59149713b [opengl] Reset opengl context when taichi program resets (#6987)
 taichi/program/program.cpp                         |  2 ++
 taichi/program/program.h                           |  4 ++++
 taichi/python/export_lang.cpp                      |  3 +--
 taichi/rhi/opengl/opengl_api.cpp                   |  9 ++++++--
 taichi/rhi/opengl/opengl_api.h                     |  1 +
 taichi/rhi/opengl/opengl_device.cpp                | 24 ++++++----------------
 .../program_impls/opengl/opengl_program.cpp        | 10 +++++++++
 .../runtime/program_impls/opengl/opengl_program.h  |  4 ++++
 8 files changed, 35 insertions(+), 22 deletions(-)
28b818d48 [bug] Fix taichi_ngp starting from ti example (#6973)
 python/taichi/examples/rendering/taichi_ngp.py | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)
a078e3e20 [ci] Revert "Fix missing c_api.so in linux nightly" (#6974)
 .github/workflows/release.yml | 1 -
 1 file changed, 1 deletion(-)
42a7fde91 [aot] Fix rwtexture with template_args (#6960)
 python/taichi/aot/utils.py |  4 ++++
 tests/python/test_aot.py   | 24 ++++++++++++++++++++++++
 2 files changed, 28 insertions(+)
f636aac2c [ci] Fix missing c_api.so in linux nightly (#6962)
 .github/workflows/release.yml | 1 +
 1 file changed, 1 insertion(+)
ec0620945 [test] Avoid constant folding in overflow tests (#6835)
 tests/python/test_overflow.py | 46 +++++++++++++++++++++----------------------
 1 file changed, 23 insertions(+), 23 deletions(-)
69c37b685 [opt] Re-enable constant folding when debug=True (#6824)
 taichi/transforms/constant_fold.cpp |  9 ---------
 tests/python/test_assert.py         | 13 +++++++++++++
 2 files changed, 13 insertions(+), 9 deletions(-)
f37718fc0 [test] Remove unnecessary duplicated python runtime test runs (#6808)
 tests/python/test_runtime.py | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)
54a652903 [refactor] Remove unnecessary checks in program (#6802)
 taichi/program/program.cpp | 14 +-------------
 1 file changed, 1 insertion(+), 13 deletions(-)
9d6877065 [vulkan] Support texture type args in aot add_kernel (#6796)
 python/taichi/aot/utils.py | 22 ++++++----------------
 tests/python/test_aot.py   | 17 +++++++++++++++++
 2 files changed, 23 insertions(+), 16 deletions(-)
8bd91a733 [misc] Remove usage of deprecated num_channels/channel_format type hint in rw_texture in codebase (#6791)
 python/taichi/_kernels.py                          | 7 +++----
 python/taichi/examples/graph/texture_graph.py      | 3 +--
 python/taichi/examples/rendering/simple_texture.py | 3 +--
 3 files changed, 5 insertions(+), 8 deletions(-)
fa2433d44 [vulkan] Support rw_texture in aot add_kernel (#6789)
 python/taichi/aot/utils.py          |  6 +++++-
 python/taichi/types/texture_type.py | 15 +++++++++++--
 tests/python/test_aot.py            | 15 +++++++++++++
 tests/python/test_deprecation.py    | 42 +++++++++++++++++++++++++++++++++++++
 4 files changed, 75 insertions(+), 3 deletions(-)
e9e374afc [vulkan] Deprecate num_channels and channel_format args in rw_texture type annotation (#6782)
 python/taichi/lang/_texture.py                   | 48 ++---------------
 python/taichi/types/texture_type.py              | 65 ++++++++++++++++++++++--
 tests/cpp/aot/python_scripts/texture_aot_test.py |  6 +--
 tests/python/test_deprecation.py                 | 20 ++++++++
 tests/python/test_ggui.py                        |  3 +-
 tests/python/test_graph.py                       |  6 +--
 tests/python/test_texture.py                     | 12 ++---
 7 files changed, 93 insertions(+), 67 deletions(-)
1d66b94e1 [misc] Remove the default potential_bug label on bug report issues (#6784)
 .github/ISSUE_TEMPLATE/bug_report.md | 1 -
 1 file changed, 1 deletion(-)
300d902e1 [vulkan] Make sure kernel recompiles when texture dtype changes (#6774)
 python/taichi/lang/kernel_impl.py |  2 +-
 tests/python/test_texture.py      | 11 +++++++++--
 2 files changed, 10 insertions(+), 3 deletions(-)
ea402e035 [doc] Update dev install about clang version (#6759)
 .github/workflows/testing.yml                  |   8 ++
 docs/lang/articles/contribution/dev_install.md | 106 ++-----------------------
 2 files changed, 15 insertions(+), 99 deletions(-)
afc857a27 [build] Use a separate prebuilt llvm15 binary for manylinux environment (#6732)
 .github/workflows/scripts/unix-build.sh | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)
50de9bc01 [build] Delete all llvm10 code and TI_LLVM_15 macro (#6685)
 .github/workflows/scripts/win_build.ps1    |   1 -
 CMakeLists.txt                             |   6 -
 ci/windows/win_build_test.ps1              |   1 -
 cmake/TaichiCore.cmake                     |   7 -
 taichi/codegen/cpu/codegen_cpu.cpp         |   8 --
 taichi/codegen/cuda/codegen_cuda.cpp       | 172 +-----------------------
 taichi/codegen/dx12/codegen_dx12.cpp       |  17 +--
 taichi/codegen/llvm/codegen_llvm.cpp       | 206 ++++++-----------------------
 taichi/codegen/llvm/llvm_codegen_utils.h   |   4 -
 taichi/codegen/llvm/struct_llvm.cpp        |  11 --
 taichi/codegen/wasm/codegen_wasm.cpp       |   4 -
 taichi/runtime/cpu/jit_cpu.cpp             |  59 ---------
 taichi/runtime/cuda/jit_cuda.cpp           |   8 --
 taichi/runtime/cuda/jit_cuda.h             |   4 -
 taichi/runtime/llvm/llvm_context.cpp       |  40 +-----
 tests/cpp/llvm/llvm_offline_cache_test.cpp |   2 -
 16 files changed, 56 insertions(+), 494 deletions(-)
fc5b4989f [build] Support any 13<clang<=15 as CLANG_EXECUTABLE on macOS (#6682)
 CMakeLists.txt         | 6 +++---
 external/SPIRV-Headers | 2 +-
 external/SPIRV-Tools   | 2 +-
 3 files changed, 5 insertions(+), 5 deletions(-)
c18e0e669 [build] Support any clang<=15 as CLANG_EXECUTABLE (#6678)
 CMakeLists.txt             | 86 +++++++++++++++++++---------------------------
 cmake/TaichiCXXFlags.cmake | 11 ++++++
 external/SPIRV-Tools       |  2 +-
 3 files changed, 48 insertions(+), 51 deletions(-)
4e4d97050 Revert "[ci] Install unzip in manylinux build" (#6680)
 .github/workflows/scripts/unix-build.sh | 4 ----
 1 file changed, 4 deletions(-)
d7cc6b5ad [ci] Install unzip in manylinux build (#6658)
 .github/workflows/scripts/unix-build.sh | 4 ++++
 1 file changed, 4 insertions(+)
df8984141 [build] Turn TI_LLVM_15 on by default (#6649)
 .github/workflows/release.yml                 |  8 +----
 .github/workflows/scripts/check_clang_tidy.sh |  9 ++++--
 .github/workflows/scripts/unix-build.sh       | 43 +++++++++++++++++----------
 .github/workflows/testing.yml                 |  3 --
 cmake/TaichiCore.cmake                        |  2 +-
 misc/ci_download.py                           | 24 ---------------
 6 files changed, 36 insertions(+), 53 deletions(-)
04418640a [doc] Update prebuilt llvm15 links in dev install doc (#6648)
 .github/workflows/testing.yml                  |  1 +
 docs/lang/articles/contribution/dev_install.md | 35 +++++++++++++-------------
 2 files changed, 18 insertions(+), 18 deletions(-)
bc087737a [build] Restore installed c_api headers in the python wheel (#6647)
 setup.py | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)
9c320cf1c [ci] Move macos10.15 job to build with LLVM 15 (#6634)
 .github/workflows/scripts/unix-build.sh | 7 ++++++-
 .github/workflows/testing.yml           | 2 +-
 2 files changed, 7 insertions(+), 2 deletions(-)
1fba52f2f [ci] Delete windows llvm10 ci job (#6639)
 .github/workflows/testing.yml | 4 ----
 1 file changed, 4 deletions(-)
4f0ede1ec [refactor] Simplify callback logic for torch & paddle args (#6626)
 python/taichi/lang/kernel_impl.py | 108 ++++++++++++++++----------------------
 1 file changed, 46 insertions(+), 62 deletions(-)
ede76d22a [ci] Move m1 job to use build with LLVM 15 (#6483)
 .github/workflows/scripts/unix-build.sh | 9 ++++++++-
 .github/workflows/testing.yml           | 2 ++
 CMakeLists.txt                          | 2 +-
 taichi/runtime/cpu/jit_cpu.cpp          | 3 ++-
 4 files changed, 13 insertions(+), 3 deletions(-)
175b6fba0 [doc] Add faq about how to use code completion in vscode (#6621)
 docs/lang/articles/faqs/faq.md | 11 +++++++++++
 1 file changed, 11 insertions(+)
73a08acdc [misc] Cleanup unused files in root dir (#6619)
 build.ps1   | 173 ------------------------------------------------------------
 codecov.yml |  14 -----
 2 files changed, 187 deletions(-)
018e3de54 [ci] Remove automatic version bump PR (#6617)
 .github/workflows/release.yml | 17 -----------------
 1 file changed, 17 deletions(-)
5c6c46098 [ci] Relax timeout for gpu jobs and memory limit (#6601)
 .github/workflows/testing.yml | 2 +-
 tests/python/test_memory.py   | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)
3f866d294 [aot] Make arch an optional argument in ti.aot.Module (#6574)
 python/taichi/aot/module.py                        | 14 ++++++--
 tests/cpp/aot/python_scripts/bitmasked_aot_test.py |  2 +-
 tests/cpp/aot/python_scripts/comet_aot.py          |  2 +-
 .../cpp/aot/python_scripts/dense_field_aot_test.py |  2 +-
 tests/cpp/aot/python_scripts/dynamic_aot_test.py   |  2 +-
 tests/cpp/aot/python_scripts/field_aot_test.py     |  4 +--
 tests/cpp/aot/python_scripts/graph_aot_test.py     |  2 +-
 tests/cpp/aot/python_scripts/kernel_aot_test1.py   |  2 +-
 tests/cpp/aot/python_scripts/kernel_aot_test2.py   |  2 +-
 tests/cpp/aot/python_scripts/mpm88_graph_aot.py    |  4 +--
 tests/cpp/aot/python_scripts/sph_aot.py            |  2 +-
 tests/cpp/aot/python_scripts/taichi_sparse_test.py |  2 +-
 tests/cpp/aot/python_scripts/texture_aot_test.py   |  2 +-
 tests/python/test_aot.py                           | 38 +++++++++++++---------
 tests/python/test_deprecation.py                   |  2 +-
 15 files changed, 48 insertions(+), 34 deletions(-)
25f40b30c [aot] [ci] Change taichi-aot-demo branch back to master (#6567)
 .github/workflows/scripts/aot-demo.sh | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)
3c7d8f616 [aot] Switch aot tests to use a script in taichi-aot-demo (#6559)
 .github/workflows/scripts/aot-demo.sh | 64 +++++++++++++----------------------
 1 file changed, 24 insertions(+), 40 deletions(-)
957d424de [aot] Deprecate filename arg in ti.aot.Module.save() (#6554)
 python/taichi/aot/module.py      |  9 +++++++--
 tests/python/test_aot.py         | 18 +++++++++---------
 tests/python/test_deprecation.py | 21 +++++++++++++++++++++
 3 files changed, 37 insertions(+), 11 deletions(-)
942a5095b [aot] Enable aot tutorial demo in CI (#6543)
 .github/workflows/scripts/aot-demo.sh | 17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)
4b51af642 [bug] [aot] Fix texture struct for with cgraph (#6536)
 taichi/aot/graph_data.cpp  | 14 ++++++++++----
 tests/python/test_graph.py | 38 ++++++++++++++++++++++++++++++++++++++
 2 files changed, 48 insertions(+), 4 deletions(-)
699ee53e0 [ci] Update slack message to include workflow_url instead of head commit (#6526)
 .github/workflows/notify_on_failure.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
90d9619c0 Revert "[Misc] Improve gif output compression rate" (#6517)
 python/taichi/tools/video.py | 32 ++++++++++++++++++++------------
 1 file changed, 20 insertions(+), 12 deletions(-)
9ce5db6cb [refactor] Simplify logic in get_function_body. (#6503)
 python/taichi/lang/kernel_impl.py      | 52 +++++++++++-----------------------
 tests/python/test_kernel_arg_errors.py | 28 ++++++++++++++++++
 2 files changed, 45 insertions(+), 35 deletions(-)
b6b431764 [ci] Add taichi bot to send message to slack on master failure (#6501)
 .github/workflows/notify_on_failure.yml | 42 +++++++++++++++++++++++++++++++++
 1 file changed, 42 insertions(+)
4ab9f1b4f [refactor] Remove unused has_external_arrays flag (#6497)
 python/taichi/lang/kernel_impl.py | 14 +++-----------
 1 file changed, 3 insertions(+), 11 deletions(-)
b1b7fc83d [ci] Switch linux gpu job to use LLVM 15 (#6465)
 .github/workflows/testing.yml | 1 +
 1 file changed, 1 insertion(+)
a593b7546 [ci] Move implicit fem android demo to master branch (#6463)
 .github/workflows/scripts/aot-demo.sh | 7 +------
 1 file changed, 1 insertion(+), 6 deletions(-)
10b4844fa [llvm] Fix broken llvm module on CUDA backend when TI_LLVM_15 is on (#6458)
 taichi/codegen/cuda/codegen_cuda.cpp | 6 ------
 taichi/codegen/llvm/codegen_llvm.cpp | 9 +++++++++
 taichi/runtime/cuda/jit_cuda.cpp     | 2 +-
 3 files changed, 10 insertions(+), 7 deletions(-)
87d66a13c Revert "[ci] Add unix end-to-end CI tests for meshtaichi" (#6460)
 .github/workflows/scripts/unix_test.sh | 12 ------------
 1 file changed, 12 deletions(-)
6b225f517 [ci] Swtich CPU jobs to use prebuilt LLVM15 (#6435)
 .github/workflows/scripts/common-utils.sh  | 1 +
 .github/workflows/scripts/unix-build.sh    | 6 ++++++
 .github/workflows/testing.yml              | 1 +
 tests/cpp/llvm/llvm_offline_cache_test.cpp | 3 +++
 4 files changed, 11 insertions(+)
9f96e514a [vulkan] Disable NoSignedWrap decoration on vulkan backend (#6440)
 taichi/codegen/spirv/spirv_codegen.cpp      | 6 ++++--
 taichi/codegen/spirv/spirv_ir_builder.cpp   | 6 ++++++
 taichi/inc/rhi_constants.inc.h              | 1 +
 taichi/rhi/vulkan/vulkan_device_creator.cpp | 1 +
 4 files changed, 12 insertions(+), 2 deletions(-)
ecc7e8d82 [aot] Support push_arg for Kernel in C++ wrapper (#6419)
 c_api/include/taichi/cpp/taichi.hpp | 22 ++++++++++++++++------
 c_api/tests/c_api_aot_test.cpp      | 10 +++++++---
 2 files changed, 23 insertions(+), 9 deletions(-)
5adc361af [bug] [lang] Fix copyback for fortran contiguous numpy arrays" (#6390)
 misc/ci_check_pr_title.py         |  8 ++++++--
 python/taichi/lang/kernel_impl.py | 28 ++++++++++++++++++++++------
 tests/python/test_numpy.py        | 17 ++++++++++++++++-
 3 files changed, 44 insertions(+), 9 deletions(-)
e34311a14 [lang] Fix from_numpy() for vector field with a non-contiguous array
 docs/lang/articles/basic/external.md |  4 +++-
 python/taichi/lang/_ndarray.py       |  8 ++++----
 python/taichi/lang/field.py          | 21 +++++++++++++++------
 python/taichi/lang/matrix.py         | 25 ++++++++++++++++---------
 tests/python/test_numpy_io.py        | 17 +++++++++++++++++
 5 files changed, 55 insertions(+), 20 deletions(-)
d6322f029 [spirv] Fix duplicated interface id for global_tmp buffers (#6392)
 taichi/codegen/spirv/spirv_codegen.cpp | 15 ++++++++++++---
 tests/python/test_ndarray.py           | 30 ++++++++++++++++++++++++++++++
 2 files changed, 42 insertions(+), 3 deletions(-)
00ca1cf43 Revert "[bug] [lang] Fix copyback for fortran contiguous numpy arrays" (#6390)
 python/taichi/lang/kernel_impl.py | 28 ++++++----------------------
 tests/python/test_numpy.py        | 17 +----------------
 2 files changed, 7 insertions(+), 38 deletions(-)
ffb53eb1d [bug] [lang] Fix copyback for fortran contiguous numpy arrays (#6376)
 python/taichi/lang/kernel_impl.py | 28 ++++++++++++++++++++++------
 tests/python/test_numpy.py        | 17 ++++++++++++++++-
 2 files changed, 38 insertions(+), 7 deletions(-)
9b990d612 [doc] Update doc about how to use vulkan print (#6359)
 docs/lang/articles/debug/debugging.md | 8 ++++++++
 1 file changed, 8 insertions(+)
2efd198fc [opengl] Fix with_opengl when TI_WITH_OPENGL is off (#6353)
 taichi/python/export_misc.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
7c44a4b87 [Doc] Add instructions about running clang-tidy checks locally
 .../articles/contribution/contributor_guide.md     | 51 ++++++++--------------
 1 file changed, 19 insertions(+), 32 deletions(-)
6090acb17 [build] Enable readability-redundant-member-init in clang-tidy check
 .clang-tidy                              | 4 +++-
 taichi/transforms/alg_simp.cpp           | 3 +--
 taichi/transforms/binary_op_simplify.cpp | 2 +-
 taichi/transforms/check_out_of_bound.cpp | 2 +-
 taichi/transforms/constant_fold.cpp      | 3 +--
 taichi/transforms/demote_atomics.cpp     | 2 +-
 taichi/transforms/demote_operations.cpp  | 2 +-
 taichi/transforms/detect_read_only.cpp   | 2 +-
 taichi/transforms/inlining.cpp           | 2 +-
 9 files changed, 11 insertions(+), 11 deletions(-)
767ede81f [build] Enable TI_WITH_VULKAN and TI_WITH_OPENGL for clang-tidy checks
 .github/workflows/testing.yml                      |  5 +--
 taichi/common/ref_counted_pool.h                   |  8 ++---
 taichi/python/export_ggui.cpp                      |  6 ++--
 taichi/rhi/opengl/opengl_device.h                  |  4 +--
 taichi/rhi/vulkan/vulkan_device.cpp                | 12 +++----
 taichi/rhi/vulkan/vulkan_device.h                  | 23 +++++++------
 taichi/rhi/vulkan/vulkan_device_creator.cpp        | 12 +++----
 taichi/rhi/vulkan/vulkan_loader.cpp                | 12 +++----
 taichi/rhi/vulkan/vulkan_loader.h                  |  2 +-
 taichi/rhi/vulkan/vulkan_utils.h                   |  2 +-
 .../runtime/program_impls/vulkan/vulkan_program.h  |  4 +--
 taichi/ui/backends/vulkan/canvas.h                 | 16 ++++-----
 taichi/ui/backends/vulkan/gui.h                    | 39 +++++++++++-----------
 taichi/ui/backends/vulkan/renderables/circles.h    |  2 +-
 taichi/ui/backends/vulkan/renderables/lines.h      |  6 ++--
 taichi/ui/backends/vulkan/renderables/mesh.h       |  6 ++--
 taichi/ui/backends/vulkan/renderables/particles.h  |  2 +-
 .../ui/backends/vulkan/renderables/scene_lines.h   |  6 ++--
 .../ui/backends/vulkan/renderables/set_image.cpp   |  8 ++---
 taichi/ui/backends/vulkan/renderables/set_image.h  |  8 ++---
 taichi/ui/backends/vulkan/renderables/triangles.h  |  2 +-
 taichi/ui/backends/vulkan/renderer.cpp             |  4 +--
 taichi/ui/backends/vulkan/swap_chain.cpp           |  4 +--
 taichi/ui/backends/vulkan/window.cpp               |  2 +-
 taichi/ui/backends/vulkan/window.h                 |  8 ++---
 taichi/ui/common/window_base.cpp                   |  2 +-
 taichi/ui/common/window_base.h                     |  4 +--
 27 files changed, 105 insertions(+), 104 deletions(-)
90770c474 [build] Enable a few modernize checks in clang-tidy
 .clang-tidy                                |  8 +++++
 taichi/common/exceptions.h                 |  2 +-
 taichi/program/sparse_solver.cpp           | 58 +++++++++++++++---------------
 taichi/python/exception.h                  |  2 +-
 taichi/runtime/gfx/runtime.cpp             |  2 +-
 taichi/runtime/metal/shaders/print.metal.h |  2 +-
 taichi/system/demangling.cpp               |  2 +-
 taichi/system/memory_pool.cpp              |  2 +-
 taichi/system/traceback.cpp                |  3 +-
 taichi/transforms/lower_matrix_ptr.cpp     |  6 ++--
 10 files changed, 48 insertions(+), 39 deletions(-)
f076dbee4 [test] Adjust rtol for sparse_linear_solver tests (#6352)
 tests/python/test_sparse_linear_solver.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
a34ac4e92 [build] Enable a few modernize checks in clang-tidy
 .clang-tidy               | 3 +++
 taichi/math/svd.h         | 5 +++--
 taichi/program/kernel.cpp | 3 ++-
 3 files changed, 8 insertions(+), 3 deletions(-)
c96af2e8e [build] Enable google-explicit-constructor check in clang-tidy
 .clang-tidy                                        |  1 +
 taichi/analysis/constexpr_propagation.cpp          |  2 +-
 taichi/analysis/detect_fors_with_break.cpp         |  2 +-
 taichi/analysis/gather_deactivations.cpp           |  2 +-
 taichi/analysis/gather_statements.cpp              |  2 +-
 taichi/analysis/gen_offline_cache_key.cpp          |  2 +-
 taichi/analysis/mesh_bls_analyzer.h                |  2 +-
 taichi/aot/module_loader.h                         |  2 +-
 taichi/cache/gfx/cache_manager.h                   |  2 +-
 taichi/cache/metal/cache_manager.h                 |  2 +-
 taichi/codegen/cc/cc_layout.h                      |  3 ++-
 taichi/codegen/cpu/codegen_cpu.h                   |  2 +-
 taichi/codegen/cuda/codegen_cuda.cpp               |  2 +-
 taichi/codegen/cuda/codegen_cuda.h                 |  2 +-
 taichi/codegen/llvm/codegen_llvm.h                 |  6 ++---
 taichi/codegen/llvm/llvm_compiled_data.h           |  6 ++---
 taichi/codegen/spirv/kernel_utils.h                |  1 +
 taichi/codegen/spirv/spirv_ir_builder.h            |  2 +-
 taichi/codegen/spirv/spirv_types.cpp               |  2 +-
 taichi/codegen/spirv/spirv_types.h                 |  6 ++---
 taichi/codegen/wasm/codegen_wasm.h                 |  2 +-
 taichi/common/core.h                               |  2 +-
 taichi/common/exceptions.h                         |  2 +-
 taichi/common/interface.h                          |  2 +-
 taichi/ir/expr.h                                   |  3 ++-
 taichi/ir/expression.h                             |  6 ++---
 taichi/ir/expression_printer.h                     |  2 +-
 taichi/ir/frontend_ir.cpp                          |  2 +-
 taichi/ir/frontend_ir.h                            | 24 +++++++++----------
 taichi/ir/ir.h                                     |  7 ++++--
 taichi/ir/mesh.h                                   |  2 +-
 taichi/ir/scratch_pad.h                            |  2 +-
 taichi/ir/snode.h                                  |  6 ++---
 taichi/ir/statements.h                             | 17 +++++++-------
 taichi/ir/type.h                                   | 27 ++++++++++++----------
 taichi/math/array_2d.h                             |  8 +++----
 taichi/math/linalg.h                               |  6 ++---
 taichi/program/kernel_profiler.h                   |  2 +-
 taichi/program/program_impl.h                      |  2 +-
 taichi/program/sparse_matrix.h                     |  4 ++--
 taichi/python/exception.h                          |  2 +-
 taichi/python/export_lang.cpp                      |  2 +-
 taichi/python/interfaces_registry.cpp              |  2 +-
 taichi/rhi/cuda/cuda_caching_allocator.h           |  2 +-
 taichi/rhi/cuda/cuda_context.h                     |  2 +-
 taichi/rhi/cuda/cuda_profiler.h                    |  2 +-
 taichi/rhi/device.h                                |  3 ++-
 taichi/runtime/gfx/runtime.h                       |  2 +-
 taichi/runtime/llvm/llvm_context.h                 |  2 +-
 taichi/runtime/llvm/snode_tree_buffer_manager.h    |  2 +-
 taichi/runtime/program_impls/metal/metal_program.h |  2 +-
 .../runtime/program_impls/opengl/opengl_program.h  |  2 +-
 taichi/system/profiler.cpp                         |  2 +-
 taichi/system/profiler.h                           |  2 +-
 taichi/system/threading.h                          |  2 +-
 taichi/system/timeline.h                           |  2 +-
 taichi/system/timer.h                              |  4 ++--
 taichi/transforms/auto_diff.cpp                    | 14 ++++++-----
 taichi/transforms/demote_mesh_statements.cpp       |  2 +-
 taichi/transforms/demote_operations.cpp            |  3 ++-
 taichi/transforms/detect_read_only.cpp             |  3 ++-
 taichi/transforms/die.cpp                          |  2 +-
 taichi/transforms/flag_access.cpp                  |  4 ++--
 taichi/transforms/inlining.cpp                     |  4 ++--
 taichi/transforms/ir_printer.cpp                   |  4 ++--
 taichi/transforms/scalarize.cpp                    |  4 ++--
 taichi/ui/gui/gui.h                                |  6 ++---
 taichi/util/bit.h                                  |  4 ++--
 .../cpp/transforms/scalar_pointer_lowerer_test.cpp |  4 ++--
 69 files changed, 143 insertions(+), 127 deletions(-)
9f7efef32 [build] Enable google-build-explicit-make-pair check in clang-tidy
 .clang-tidy           |  1 +
 taichi/rhi/device.cpp | 80 +++++++++++++++++++++++++--------------------------
 2 files changed, 41 insertions(+), 40 deletions(-)
17114ddf6 [build] Enable a few bugprone related rules in clang-tidy
 .clang-tidy                            | 10 +++++++++-
 .github/workflows/testing.yml          |  2 +-
 taichi/codegen/llvm/codegen_llvm.cpp   |  2 +-
 taichi/codegen/spirv/spirv_codegen.cpp |  7 ++++---
 taichi/program/kernel.cpp              |  2 +-
 taichi/program/sparse_matrix.h         |  2 +-
 taichi/python/export_lang.cpp          |  9 +++++----
 taichi/python/export_misc.cpp          |  2 +-
 8 files changed, 23 insertions(+), 13 deletions(-)
ea50b12da [build] Enable modernize-use-override in clang-tidy
 .clang-tidy                        | 1 +
 taichi/codegen/spirv/lib_tiny_ir.h | 8 ++++----
 taichi/program/sparse_matrix.h     | 2 +-
 3 files changed, 6 insertions(+), 5 deletions(-)
464e86da5 [ci] Use .clang-tidy for check_static_analyzer job
 .clang-tidy                                   |  5 ++++-
 .github/workflows/scripts/check_clang_tidy.sh |  2 +-
 scripts/run_clang_tidy.sh                     | 11 -----------
 3 files changed, 5 insertions(+), 13 deletions(-)
7319935e6 [lang] Throw proper error message if calling ti.append with vector/matrix (#6322)
 python/taichi/lang/snode.py  |  4 +++-
 tests/python/test_dynamic.py | 20 ++++++++++++++++++++
 2 files changed, 23 insertions(+), 1 deletion(-)
217f7633f [build] Allow building test when LLVM is off (#6327)
 cmake/TaichiTests.cmake | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)
3e0c41b3c [aot] Support setting vector/matrix argument in C++ wrapper of C-API (#6298)
 c_api/include/taichi/cpp/taichi.hpp              | 11 +++++++++++
 c_api/tests/c_api_aot_test.cpp                   |  5 ++++-
 tests/cpp/aot/gfx_utils.cpp                      |  8 +++++++-
 tests/cpp/aot/llvm/kernel_aot_test.cpp           | 12 ++++++++++--
 tests/cpp/aot/python_scripts/kernel_aot_test1.py |  4 ++--
 5 files changed, 34 insertions(+), 6 deletions(-)
4e1a733db [refactor] Move setting visible device to vulkan instance initialization
 python/taichi/lang/misc.py          | 5 -----
 taichi/rhi/vulkan/vulkan_loader.cpp | 4 ++++
 2 files changed, 4 insertions(+), 5 deletions(-)
ed1281332 [lang] Set ret_type for AtomicOpStmt (#6213)
 taichi/ir/frontend_ir.cpp        |  1 +
 tests/cpp/ir/ir_builder_test.cpp | 26 ++++++++++++++++++++++++++
 2 files changed, 27 insertions(+)
849be97ed [bug] Relax dependent Pillow version (#6170)
 python/taichi/lang/_texture.py | 5 +++--
 requirements_test.txt          | 2 +-
 2 files changed, 4 insertions(+), 3 deletions(-)
6abada404 Revert "[LLVM] Add runtime overflow detection on LLVM-based backends" (#6177)
 taichi/codegen/llvm/codegen_llvm.cpp           |  36 ----
 taichi/program/program.h                       |   4 +-
 taichi/runtime/llvm/llvm_runtime_executor.cpp  |   2 -
 taichi/runtime/llvm/runtime_module/runtime.cpp |  61 ------
 taichi/transforms/alg_simp.cpp                 |   2 -
 taichi/transforms/constant_fold.cpp            |   3 -
 tests/python/test_overflow.py                  | 245 -------------------------
 7 files changed, 1 insertion(+), 352 deletions(-)
38d095fb2 [bug] [vulkan] Only enable non_semantic_info cap when validation layer is on (#6129)
 taichi/rhi/vulkan/vulkan_device_creator.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)
a4b24d152 [opengl] Fix GLES support (#6121)
 taichi/rhi/opengl/opengl_api.cpp    |  9 ++++++--
 taichi/rhi/opengl/opengl_device.cpp | 42 ++++++++++++++++++++++++++++++++-----
 tests/python/test_aot.py            |  4 +++-
 3 files changed, 47 insertions(+), 8 deletions(-)
5414b26bb [vulkan] Instruct users to install vulkan sdk if they want to use validation layer (#6098)
 taichi/rhi/vulkan/vulkan_device_creator.cpp | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)
18c946ea6 [spirv] [refactor] Rename debug_ segment to names_ (#6094)
 taichi/codegen/spirv/spirv_codegen.cpp    | 12 +++++-----
 taichi/codegen/spirv/spirv_ir_builder.cpp | 40 +++++++++++++++----------------
 taichi/codegen/spirv/spirv_ir_builder.h   | 23 +++++++++++-------
 3 files changed, 41 insertions(+), 34 deletions(-)
1d70030c3 [vulkan] Support printing in debug mode on vulkan backend (#6075)
 taichi/codegen/spirv/spirv_codegen.cpp             | 25 ++++++++++++++--
 taichi/codegen/spirv/spirv_ir_builder.cpp          | 17 +++++++++++
 taichi/codegen/spirv/spirv_ir_builder.h            | 20 +++++++++++++
 taichi/inc/rhi_constants.inc.h                     |  1 +
 taichi/rhi/vulkan/vulkan_device_creator.cpp        | 34 ++++++++++++++++++++--
 .../program_impls/vulkan/vulkan_program.cpp        |  5 ++++
 tests/python/test_print.py                         | 28 +++++++++---------
 7 files changed, 110 insertions(+), 20 deletions(-)
2469127b6 [misc] Simplify PR template (#6063)
 .github/pull_request_template.md | 18 ++----------------
 1 file changed, 2 insertions(+), 16 deletions(-)
56b762fa3 [refactor] Turn on torch_io tests for opengl, vulkan and dx11 backend (#5997)
 python/taichi/lang/kernel_impl.py | 13 -------------
 tests/python/test_torch_ad.py     |  3 ++-
 tests/python/test_torch_io.py     | 24 ++++++++++++------------
 3 files changed, 14 insertions(+), 26 deletions(-)
59484e66b [build] Add option to generate dependency graph of cmake targets (#5966)
 CMakeLists.txt                   | 13 +++++++++++++
 cmake/CMakeGraphVizOptions.cmake |  8 ++++++++
 2 files changed, 21 insertions(+)
5b18fc828 [aot] [opengl] Add GL interop so that we can export GL memory (#5956)
 c_api/include/taichi/taichi.h        |  4 ++++
 c_api/include/taichi/taichi_opengl.h | 23 +++++++++++++++++++++++
 c_api/src/taichi_opengl_impl.cpp     | 14 ++++++++++++++
 c_api/src/taichi_opengl_impl.h       |  4 ++++
 cmake/TaichiCAPITests.cmake          |  1 +
 taichi/rhi/opengl/opengl_device.cpp  | 10 ++++++++++
 taichi/rhi/opengl/opengl_device.h    |  2 ++
 7 files changed, 58 insertions(+)
40decbcd6 [aot] Support i8/u8 args in cgraph (#5961)
 taichi/python/export_lang.cpp |  6 ++++++
 tests/python/test_aot.py      | 24 ++++++++++++++++++++++++
 tests/python/test_graph.py    |  6 +++---
 3 files changed, 33 insertions(+), 3 deletions(-)
39010ef0c [aot] [test] Fix c api aot tests for vulkan and opengl backend
 c_api/tests/c_api_aot_test.cpp    | 18 +++++++++++++++++-
 c_api/tests/c_api_cgraph_test.cpp | 17 ++++++++++++++++-
 taichi/rhi/cuda/cuda_device.cpp   |  4 +---
 tests/test_utils.py               | 16 ++++++++++++++++
 4 files changed, 50 insertions(+), 5 deletions(-)
bf23d61a1 [aot] Add C API for opengl backend
 c_api/src/c_api_test_utils.cpp          | 12 ++++++++
 c_api/src/c_api_test_utils.h            |  1 +
 c_api/src/taichi_core_impl.cpp          |  6 ++++
 c_api/src/taichi_gfx_impl.cpp           | 49 ++++++++++++++++++++++++++++++
 c_api/src/taichi_gfx_impl.h             | 28 +++++++++++++++++
 c_api/src/taichi_llvm_impl.cpp          |  4 ---
 c_api/src/taichi_llvm_impl.h            |  3 --
 c_api/src/taichi_opengl_impl.cpp        | 16 ++++++++++
 c_api/src/taichi_opengl_impl.h          | 14 +++++++++
 c_api/src/taichi_vulkan_impl.cpp        | 53 +--------------------------------
 c_api/src/taichi_vulkan_impl.h          | 26 ++--------------
 c_api/tests/c_api_interface_test.cpp    | 38 +++++++++++++++++++++++
 c_api/tests/mpm88_test.cpp              | 13 ++++++++
 c_api/tests/sph.cpp                     | 11 +++++++
 cmake/TaichiCAPI.cmake                  | 25 ++++++++++++++--
 cmake/TaichiExamples.cmake              |  8 +++++
 tests/cpp/aot/python_scripts/sph_aot.py |  2 ++
 tests/run_tests.py                      | 10 +++----
 tests/test_utils.py                     | 12 ++++++++
 19 files changed, 240 insertions(+), 91 deletions(-)
fee023466 [bug] [ggui] Fix cpu vulkan interop build (#5865)
 taichi/rhi/interop/CMakeLists.txt | 8 ++++++--
 tests/python/test_ggui.py         | 1 +
 2 files changed, 7 insertions(+), 2 deletions(-)
be56908cd [refactor] Separate texture args from scalar arg declaration (#5878)
 cpp_examples/autograd.cpp              |  6 +++---
 cpp_examples/run_snode.cpp             |  2 +-
 python/taichi/lang/kernel_arguments.py | 10 ++++++----
 taichi/program/callable.cpp            | 11 +++++++++--
 taichi/program/callable.h              |  3 ++-
 taichi/program/program.cpp             |  6 +++---
 taichi/python/export_lang.cpp          | 10 +++++++---
 taichi/transforms/constant_fold.cpp    |  4 ++--
 tests/cpp/ir/ir_builder_test.cpp       |  2 +-
 tests/cpp/ir/ndarray_kernel.cpp        |  6 +++---
 tests/cpp/transforms/inlining_test.cpp |  2 +-
 11 files changed, 38 insertions(+), 24 deletions(-)
2b6e75340 [aot] Workaround build structure to export GGUI symbols in libtaichi_export_core.so (#5870)
 cmake/TaichiExportCore.cmake | 6 ++++++
 1 file changed, 6 insertions(+)
6eed490c6 [misc] Bump version to v1.1.3 (#5823)
 version.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
6894ddc2c [test] Refactor opengl and vulkan cpp aot tests (#5812)
 cmake/TaichiCore.cmake                             |   6 +-
 cmake/TaichiTests.cmake                            |  30 +-
 taichi/rhi/opengl/opengl_api.cpp                   |   5 +
 tests/cpp/aot/gfx/device_test.cpp                  |  76 -----
 tests/cpp/aot/gfx/kernel_aot_test.cpp              | 296 ----------------
 tests/cpp/aot/gfx/utils.h                          |  25 --
 .../aot/{gfx/graph_aot_test.cpp => gfx_utils.cpp}  | 378 ++++++++++++++-------
 tests/cpp/aot/gfx_utils.h                          |  36 ++
 tests/cpp/aot/opengl/device_test.cpp               |  16 +
 tests/cpp/aot/opengl/graph_aot_test.cpp            |  33 ++
 tests/cpp/aot/opengl/kernel_aot_test.cpp           |  36 ++
 tests/cpp/aot/vulkan/device_test.cpp               |  27 ++
 tests/cpp/aot/vulkan/graph_aot_test.cpp            |  62 ++++
 tests/cpp/aot/vulkan/kernel_aot_test.cpp           |  57 ++++
 14 files changed, 556 insertions(+), 527 deletions(-)
5eed85828 [test] Add a cgraph test with template args in ti.func (#5803)
 tests/python/test_graph.py | 35 +++++++++++++++++++++++++++++++++++
 1 file changed, 35 insertions(+)
1884cc0be [test] Enable llvm aot tests for vulkan and opengl backend (#5795)
 taichi/aot/module_loader.cpp                       |   4 +
 tests/cpp/aot/gfx/graph_aot_test.cpp               | 257 +++++++++++++++------
 tests/cpp/aot/gfx/kernel_aot_test.cpp              | 224 +++++++++++++-----
 .../cpp/aot/python_scripts/dense_field_aot_test.py |   2 +
 tests/cpp/aot/python_scripts/graph_aot_test.py     |   7 +
 .../{kernel_aot_test.py => kernel_aot_test1.py}    |  13 +-
 tests/cpp/aot/python_scripts/kernel_aot_test2.py   |  59 +++++
 tests/cpp/aot/python_scripts/mpm88_graph_aot.py    |   2 +
 .../aot/python_scripts/ndarray_kernel_aot_test.py  |  40 ----
 tests/test_utils.py                                |  54 ++++-
 10 files changed, 474 insertions(+), 188 deletions(-)
9c4392477 [test] Get rid of utils.py in aot python scripts (#5785)
 tests/cpp/aot/python_scripts/bitmasked_aot_test.py |  77 ++++-
 tests/cpp/aot/python_scripts/dynamic_aot_test.py   |  80 ++++-
 tests/cpp/aot/python_scripts/field_aot_test.py     | 138 ++++++++-
 tests/cpp/aot/python_scripts/graph_aot_test.py     |  56 +++-
 tests/cpp/aot/python_scripts/kernel_aot_test.py    |  28 +-
 tests/cpp/aot/python_scripts/utils.py              | 331 ---------------------
 6 files changed, 353 insertions(+), 357 deletions(-)
6dc12b374 [refactor] Refactor C++ aot test to accommodate multiple backends
 .../runtime_test.cpp => gfx/device_test.cpp}       |  67 +--
 tests/cpp/aot/gfx/graph_aot_test.cpp               | 250 ++++++++++
 tests/cpp/aot/gfx/kernel_aot_test.cpp              | 188 ++++++++
 tests/cpp/aot/gfx/utils.h                          |  25 +
 .../{llvm => python_scripts}/bitmasked_aot_test.py |   0
 tests/cpp/aot/{ => python_scripts}/comet_aot.py    |   0
 .../cpp/aot/python_scripts/dense_field_aot_test.py |  52 ++
 .../{llvm => python_scripts}/dynamic_aot_test.py   |   0
 .../aot/{llvm => python_scripts}/field_aot_test.py |   0
 .../aot/{llvm => python_scripts}/graph_aot_test.py |   0
 .../{llvm => python_scripts}/kernel_aot_test.py    |   0
 .../aot/{ => python_scripts}/mpm88_graph_aot.py    |   0
 .../aot/python_scripts/ndarray_kernel_aot_test.py  |  40 ++
 tests/cpp/aot/{ => python_scripts}/sph_aot.py      |   0
 .../{llvm => python_scripts}/taichi_sparse_test.py |   0
 tests/cpp/aot/{llvm => python_scripts}/utils.py    |   0
 tests/cpp/aot/vulkan/aot_save_load_test.cpp        | 530 ---------------------
 tests/test_utils.py                                | 154 ++++--
 18 files changed, 694 insertions(+), 612 deletions(-)
52adaad42 [test] Expand python aot test coverage for opengl backend
 tests/python/test_aot.py   |  8 +++----
 tests/python/test_graph.py | 59 ++++++++++++++++++++++++++++++++--------------
 2 files changed, 45 insertions(+), 22 deletions(-)
9adfd3040 [opengl] Fix target device for opengl aot
 taichi/aot/module_loader.h             | 2 +-
 taichi/codegen/spirv/spirv_codegen.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)
4b2ab4b2c [bug] Support indexing via np.integer for field (#5712)
 python/taichi/lang/field.py  |  3 ++-
 python/taichi/lang/matrix.py |  2 +-
 tests/python/test_field.py   | 22 ++++++++++++++++++++++
 3 files changed, 25 insertions(+), 2 deletions(-)
6dd26ac66 [vulkan] Relax number of array args for each kernel (#5689)
 docs/lang/articles/kernels/syntax.md |  4 +--
 python/taichi/lang/kernel_impl.py    | 10 +++----
 taichi/inc/constants.h               |  4 +--
 tests/python/test_aot.py             | 34 -----------------------
 tests/python/test_argument.py        | 53 +++++++++++++++++++++++++++++++++++-
 5 files changed, 60 insertions(+), 45 deletions(-)
8ad94fc35 [bug] Fix ndarray arg with shape=(1,) in cgraph (#5666)
 python/taichi/aot/utils.py  |  3 ++-
 tests/cpp/aot/llvm/utils.py |  6 +++---
 tests/python/test_graph.py  | 17 +++++++++++++++++
 3 files changed, 22 insertions(+), 4 deletions(-)
8cbdc43d8 [spirv] [bug] Fix invalid CFG error when simulated atomic is present (#5678)
 taichi/codegen/spirv/spirv_ir_builder.cpp |  4 ++--
 tests/python/test_basics.py               | 14 ++++++++++++++
 2 files changed, 16 insertions(+), 2 deletions(-)
bee0e63a5 [ci] Drop py36 in nightly and release (#5640)
 .github/workflows/release.yml                       | 4 ++--
 docs/lang/articles/contribution/dev_install.md      | 4 ++--
 docs/lang/articles/contribution/development_tips.md | 4 ++--
 docs/lang/articles/faqs/faq.md                      | 2 +-
 docs/lang/articles/faqs/install.md                  | 4 ++--
 docs/lang/articles/get-started/index.md             | 2 +-
 6 files changed, 10 insertions(+), 10 deletions(-)
694bc3fee [misc] Explicitly specify base tag commit when running make_changelog.py (#5632)
 .github/workflows/scripts/unix_build.sh |  4 ++--
 misc/make_changelog.py                  | 34 +++++++++++++++++++++++++--------
 2 files changed, 28 insertions(+), 10 deletions(-)
4dcd60908 [doc] Add docstrings for texture related apis
 python/taichi/lang/_texture.py      | 26 +++++++++++++++++++++++++-
 python/taichi/types/texture_type.py |  9 +++++++++
 tests/python/test_api.py            |  5 +----
 3 files changed, 35 insertions(+), 5 deletions(-)
20b4b43e3 [Lang] Support from/to_image for textures and add tests
 python/taichi/_kernels.py                          |  29 +++-
 python/taichi/examples/rendering/simple_texture.py |  24 ++--
 python/taichi/lang/_texture.py                     |  36 ++++-
 requirements_test.txt                              |   1 +
 tests/python/test_api.py                           |   5 +-
 tests/python/test_texture.py                       | 152 +++++++++++++++++++++
 6 files changed, 226 insertions(+), 21 deletions(-)
525fb20d0 [refactor] Unify ways to set external array args (#5565)
 cpp_examples/autograd.cpp            | 12 ++++++------
 cpp_examples/run_snode.cpp           |  3 ++-
 taichi/codegen/cuda/codegen_cuda.cpp |  4 ++--
 taichi/program/context.h             | 10 ++++++++--
 taichi/program/kernel.cpp            | 22 +++-------------------
 taichi/program/kernel.h              |  5 -----
 taichi/python/export_lang.cpp        |  2 --
 tests/cpp/ir/ir_builder_test.cpp     | 12 ++++--------
 8 files changed, 25 insertions(+), 45 deletions(-)
15c6ab8c7 [bug] Fix android build for taichi-aot-demo (#5560)
 taichi/rhi/vulkan/vulkan_device.cpp | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)
db71d0c87 [refactor] Unify ways to set ndarray args (#5559)
 c_api/src/taichi_core_impl.cpp              | 21 +------------------
 taichi/aot/graph_data.cpp                   |  5 ++++-
 taichi/codegen/cuda/codegen_cuda.cpp        | 27 ++----------------------
 taichi/program/context.h                    | 32 ++++++++++++-----------------
 taichi/program/kernel.cpp                   |  7 +------
 taichi/program/ndarray.cpp                  | 14 -------------
 taichi/program/ndarray.h                    |  3 ---
 tests/cpp/aot/llvm/kernel_aot_test.cpp      | 10 +++++----
 tests/cpp/aot/vulkan/aot_save_load_test.cpp |  3 ++-
 9 files changed, 29 insertions(+), 93 deletions(-)
679a165ad [aot] Support texture and rwtexture in cgraph (#5528)
 python/taichi/aot/utils.py                     | 12 ++++
 python/taichi/examples/graph/texture_graph.py  | 93 ++++++++++++++++++++++++++
 python/taichi/graph/_graph.py                  | 22 +++++-
 taichi/aot/graph_data.cpp                      |  7 ++
 taichi/aot/graph_data.h                        | 36 +++++++---
 taichi/aot/module_data.h                       | 19 +++++-
 taichi/codegen/spirv/kernel_utils.h            |  3 +
 taichi/program/context.h                       |  8 +--
 taichi/python/export_lang.cpp                  | 17 ++++-
 taichi/rhi/device.h                            |  8 +--
 taichi/runtime/gfx/aot_module_builder_impl.cpp |  5 ++
 tests/python/test_graph.py                     | 66 ++++++++++++++++++
 12 files changed, 275 insertions(+), 21 deletions(-)
233123d51 [error] Throw proper error message when an Ndarray is passed in via ti.template (#5457)
 python/taichi/lang/kernel_impl.py |  4 ++++
 tests/python/test_ndarray.py      | 14 ++++++++++++++
 2 files changed, 18 insertions(+)
13983c783 [aot] Support specifying vk_api_version in CompileConfig (#5419)
 c_api/src/taichi_vulkan_impl.cpp                   |  2 +-
 taichi/program/compile_config.h                    |  1 +
 taichi/python/export_lang.cpp                      |  4 +-
 taichi/rhi/vulkan/vulkan_device_creator.cpp        | 72 ++++++++++++++--------
 taichi/rhi/vulkan/vulkan_device_creator.h          |  8 ++-
 .../program_impls/vulkan/vulkan_program.cpp        | 15 ++++-
 taichi/ui/backends/vulkan/app_context.cpp          |  2 +-
 tests/cpp/aot/mpm88_graph_aot.py                   |  2 +-
 tests/cpp/aot/vulkan/aot_save_load_test.cpp        | 12 ++--
 tests/cpp/aot/vulkan/runtime_test.cpp              |  3 +-
 10 files changed, 76 insertions(+), 45 deletions(-)
392420bb9 [bug] Simplify scalar handling in cgraph and relax field_dim check (#5411)
 python/taichi/aot/utils.py    | 11 +++----
 python/taichi/graph/_graph.py | 27 ++++-----------
 taichi/python/export_lang.cpp | 77 +++++++++++++++++++++----------------------
 tests/python/test_graph.py    | 19 +++++++++++
 tests/python/test_ndarray.py  | 24 ++++++++++++++
 5 files changed, 92 insertions(+), 66 deletions(-)
7f97f9c43 [refactor] Default dtype of ndarray type should be None instead of f32 (#5391)
 python/taichi/aot/utils.py          |  2 +-
 python/taichi/types/ndarray_type.py | 16 ++++++----------
 tests/python/test_graph.py          |  2 +-
 3 files changed, 8 insertions(+), 12 deletions(-)
31bcb0a97 [bug] Cast scalar to right type before converting to uint64
 python/taichi/graph/_graph.py    |  2 +-
 taichi/aot/graph_data.h          |  1 +
 taichi/program/graph_builder.cpp |  2 +-
 taichi/python/export_lang.cpp    | 42 ++++++++++++++++++++++++++-------
 tests/python/test_graph.py       | 51 ++++++++++++++++++++++++++++++++++++++++
 5 files changed, 88 insertions(+), 10 deletions(-)
922c02b37 [refactor] Check dtype mismatch in cgraph compilation and runtime
 python/taichi/aot/utils.py          | 14 ++++++++-
 python/taichi/types/ndarray_type.py | 13 ++++----
 taichi/aot/graph_data.cpp           |  5 +++
 tests/python/test_graph.py          | 61 +++++++++++++++++++++++++++++++++++--
 4 files changed, 83 insertions(+), 10 deletions(-)
a5eaf9e25 [refactor] Check field_dim mismatch in cgraph compilation and runtime
 python/taichi/aot/utils.py                         |  7 +++
 python/taichi/examples/graph/mpm88_graph.py        | 14 +++++-
 python/taichi/examples/graph/stable_fluid_graph.py | 24 ++++++---
 python/taichi/graph/_graph.py                      |  6 +--
 taichi/aot/graph_data.cpp                          |  5 ++
 taichi/aot/graph_data.h                            | 22 ++++++--
 taichi/python/export_lang.cpp                      |  6 ++-
 tests/cpp/aot/mpm88_graph_aot.py                   |  7 +++
 tests/cpp/aot/vulkan/aot_save_load_test.cpp        |  2 +-
 tests/cpp/program/graph_test.cpp                   |  2 +-
 tests/python/test_graph.py                         | 58 ++++++++++++++++++++--
 11 files changed, 129 insertions(+), 24 deletions(-)
dca12bb81 [test] Check repeated arg names in cgraph
 taichi/aot/graph_data.h          |  9 +++++++++
 taichi/program/graph_builder.cpp |  8 ++++++++
 taichi/program/graph_builder.h   |  1 +
 tests/python/test_graph.py       | 24 ++++++++++++++++++++++++
 4 files changed, 42 insertions(+)
4aec8ac60 [refactor] Turn off stack traceback info by default (#5347)
 python/taichi/lang/misc.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
88468c0d2 [refactor] Synchronize should always be called in non-async mode (#5302)
 taichi/program/program.cpp                           | 15 +++++++--------
 taichi/runtime/program_impls/vulkan/vulkan_program.h |  4 +++-
 tests/cpp/program/graph_test.cpp                     |  5 +----
 3 files changed, 11 insertions(+), 13 deletions(-)
34601b132 [refactor] Get rid ndarray host accessor kernels
 taichi/program/ndarray.cpp                   |   3 +-
 taichi/program/ndarray.h                     |   2 -
 taichi/program/ndarray_rw_accessors_bank.cpp | 118 ---------------------------
 taichi/program/ndarray_rw_accessors_bank.h   |  89 --------------------
 taichi/program/program.cpp                   |  55 +------------
 taichi/program/program.h                     |  10 ---
 6 files changed, 2 insertions(+), 275 deletions(-)
125521276 [refactor] Use device api for CPU/CUDA ndarray
 taichi/program/ndarray.cpp         | 20 --------------------
 taichi/rhi/cpu/cpu_device.cpp      | 17 +++++++++++++++++
 taichi/rhi/cpu/cpu_device.h        |  7 +++----
 taichi/rhi/cuda/cuda_device.cpp    | 25 +++++++++++++++++++++++++
 taichi/rhi/cuda/cuda_device.h      |  8 ++++----
 tests/python/test_offline_cache.py | 36 ------------------------------------
 6 files changed, 49 insertions(+), 64 deletions(-)
45bbb02be [refactor] Switch to using staging buffer for metal/vulkan/opengl ndarray host accesses
 taichi/program/ndarray.cpp       | 100 ++++++++++++++++++++++++++++++++++++---
 taichi/program/ndarray.h         |   4 ++
 taichi/program/program.cpp       |   2 +-
 tests/cpp/program/graph_test.cpp |   4 ++
 tests/python/test_matrix.py      |   2 +-
 5 files changed, 104 insertions(+), 8 deletions(-)
a843c3fdd test (#5292)
 taichi/runtime/metal/kernel_manager.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
0a87f90e6 [metal] Support memcpy_internal via buffer_copy (#5268)
 taichi/backends/metal/device.cpp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)
a21cbee19 [gui] Fix the device memory leak when GGUI terminates
 taichi/backends/vulkan/vulkan_device.cpp | 19 +++++++++++++++++++
 taichi/runtime/gfx/runtime.cpp           |  1 +
 2 files changed, 20 insertions(+)
63c69d8ce [gui] Let gui and renderer manage the resource they own
 taichi/ui/backends/vulkan/gui.cpp      | 3 +++
 taichi/ui/backends/vulkan/gui.h        | 1 +
 taichi/ui/backends/vulkan/renderer.cpp | 4 ++++
 taichi/ui/backends/vulkan/renderer.h   | 1 +
 taichi/ui/backends/vulkan/window.cpp   | 4 ++--
 5 files changed, 11 insertions(+), 2 deletions(-)
5753c51a5 [wip] Enable full wheel build when TI_EXPORT_CORE is on (#5211)
 .github/workflows/scripts/unix_build.sh | 15 +++------------
 .github/workflows/testing.yml           |  3 +--
 2 files changed, 4 insertions(+), 14 deletions(-)
fee38add0 Move spdlog include to profiler.cpp (#5210)
 taichi/system/profiler.cpp | 1 +
 taichi/system/profiler.h   | 1 -
 2 files changed, 1 insertion(+), 1 deletion(-)
69f545832 [lang] Improve error message when literal val is out of range of default dtype (#5191)
 python/taichi/lang/expr.py   | 39 ++++++++++++++++++++++-----------------
 tests/python/test_literal.py | 22 ++++++++++++++++++++++
 2 files changed, 44 insertions(+), 17 deletions(-)
aba2871e6 [ci] Enable yapf and isort on example files (#5140)
 .pre-commit-config.yaml                            |   3 +-
 python/taichi/examples/algorithm/mciso_advanced.py |   3 +-
 .../taichi/examples/autodiff/diff_sph/diff_sph.py  | 268 ++++++++++++++-------
 python/taichi/examples/features/io/export_mesh.py  |   4 +-
 .../examples/ggui_examples/mass_spring_3d_ggui.py  |   8 +-
 python/taichi/examples/graph/mpm88_graph.py        |  30 ++-
 python/taichi/examples/graph/stable_fluid_graph.py |  48 ++--
 tests/python/examples/__init__.py                  |   1 -
 tests/python/examples/autodiff/__init__.py         |   1 -
 9 files changed, 239 insertions(+), 127 deletions(-)
31ec9c3ea [aot][bug] Use cached compiled kernel pointer when it's added to graph (#5122)
 python/taichi/examples/graph/stable_fluid_graph.py | 340 +++++++++++++++++++++
 python/taichi/graph/_graph.py                      |   6 +-
 python/taichi/lang/kernel_impl.py                  |   4 +
 taichi/program/graph_builder.cpp                   |   6 +-
 taichi/program/graph_builder.h                     |   1 -
 taichi/program/kernel.cpp                          |   4 +-
 taichi/program/kernel.h                            |  11 +-
 7 files changed, 362 insertions(+), 10 deletions(-)
66cc85267 [test] Save mpm88 graph in python and load in C++ test. (#5104)
 tests/cpp/aot/aot_save_load_test.cpp | 129 ++++++++++++++++++++++++++
 tests/cpp/aot/mpm88_graph_aot.py     | 169 +++++++++++++++++++++++++++++++++++
 tests/python/test_aot.py             | 147 ------------------------------
 tests/test_utils.py                  |   2 +
 4 files changed, 300 insertions(+), 147 deletions(-)
3d9539636 [refactor] Update Ndarray constructor used in AOT runtime. (#5095)
 taichi/program/ndarray.cpp     | 26 +++++++++++++--
 taichi/program/ndarray.h       |  9 ++++--
 tests/cpp/aot/runtime_test.cpp | 72 ++++++++++++++++++++++++++++++++++++++++++
 3 files changed, 103 insertions(+), 4 deletions(-)
45870ecf1 [bug] Minor fix for ndarray element_shape in graph mode (#5093)
 taichi/aot/graph_data.cpp | 5 +----
 1 file changed, 1 insertion(+), 4 deletions(-)
4c42fc991 [refactor] Make sure Ndarray shape is field shape (#5085)
 python/taichi/lang/_ndarray.py               | 12 ++++++----
 python/taichi/lang/matrix.py                 |  4 ++--
 taichi/program/kernel.cpp                    | 13 ++++++++--
 taichi/program/ndarray.cpp                   | 16 ++++++-------
 taichi/program/ndarray.h                     |  6 ++++-
 taichi/program/ndarray_rw_accessors_bank.cpp | 36 +++++++++++++++-------------
 taichi/program/ndarray_rw_accessors_bank.h   |  2 +-
 taichi/program/program.cpp                   |  4 ++--
 taichi/python/export_lang.cpp                |  1 +
 tests/python/test_ndarray.py                 |  4 ++--
 10 files changed, 57 insertions(+), 41 deletions(-)
4b0ea28a1 [refactor] Correctly set ndarray element_size and nelement (#5080)
 python/taichi/lang/matrix.py          |  6 ++----
 python/taichi/linalg/sparse_matrix.py |  6 +++++-
 taichi/program/ndarray.cpp            | 15 ++++++++++-----
 taichi/program/program.cpp            |  5 +++--
 taichi/program/sparse_matrix.cpp      |  2 +-
 taichi/python/export_lang.cpp         |  1 +
 tests/python/test_ndarray.py          |  4 ++--
 7 files changed, 24 insertions(+), 15 deletions(-)
a2a9b44bd [doc] Fix broken link for github action status badge (#5076)
 README.md | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
e36019143 [refactor] Resolve comments from #5065 (#5074)
 python/taichi/lang/_ndarray.py      | 5 ++---
 python/taichi/lang/kernel_impl.py   | 6 +++---
 python/taichi/types/ndarray_type.py | 4 ++--
 3 files changed, 7 insertions(+), 8 deletions(-)
e6cb2885a [refactor] Split GraphBuilder out of Graph class (#5064)
 python/taichi/examples/graph/mpm88_graph.py | 14 +++++++-------
 python/taichi/graph/_graph.py               | 12 ++++++++----
 tests/python/test_aot.py                    | 14 +++++++-------
 tests/python/test_graph.py                  |  6 +++---
 4 files changed, 25 insertions(+), 21 deletions(-)
8966069d5 [bug] Ndarray type should include primitive dtype as well (#5052)
 python/taichi/aot/utils.py                  | 14 ++++++------
 python/taichi/examples/graph/mpm88_graph.py | 12 +++++------
 python/taichi/types/ndarray_type.py         |  5 +++++
 taichi/aot/graph_data.h                     | 33 +++++++++++++++++++++++++++--
 taichi/python/export_lang.cpp               |  9 ++++----
 tests/cpp/aot/aot_save_load_test.cpp        |  8 +++----
 tests/cpp/program/graph_test.cpp            |  5 ++---
 tests/python/test_aot.py                    | 12 +++++------
 tests/python/test_graph.py                  | 23 ++++++++++++++++++++
 9 files changed, 88 insertions(+), 33 deletions(-)
e8a9732fc Set host_write to false for opengl ndarray (#5038)
 taichi/backends/opengl/opengl_program.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
9fd390b6f [aot] Bind graph APIs to python and add mpm88 example (#5034)
 python/taichi/__init__.py                   |   2 +-
 python/taichi/aot/module.py                 |  65 ++---------
 python/taichi/aot/utils.py                  |  68 +++++++++++
 python/taichi/examples/graph/mpm88_graph.py | 168 ++++++++++++++++++++++++++++
 python/taichi/graph/__init__.py             |   1 +
 python/taichi/graph/_graph.py               |  68 +++++++++++
 taichi/aot/graph_data.h                     |   4 +-
 taichi/program/ndarray.h                    |   2 +-
 taichi/python/export_lang.cpp               |  50 +++++++++
 tests/python/test_aot.py                    | 147 ++++++++++++++++++++++++
 tests/python/test_api.py                    |   6 +-
 11 files changed, 520 insertions(+), 61 deletions(-)
eba326f03 [bug] Revert freeing ndarray memory when python GC triggers (#5019)
 python/taichi/lang/_ndarray.py | 13 -------------
 python/taichi/lang/impl.py     |  4 ----
 taichi/program/program.cpp     | 14 ++------------
 taichi/program/program.h       |  4 +---
 taichi/python/export_lang.cpp  |  1 -
 tests/python/test_ndarray.py   | 22 ----------------------
 6 files changed, 3 insertions(+), 55 deletions(-)
963b1c3b0 [aot] Build and run graph without serialization
 taichi/aot/graph_data.h                           |  92 ++++++++++++++++++
 taichi/aot/module_loader.h                        |  22 +----
 taichi/backends/vulkan/aot_module_loader_impl.cpp |  21 +---
 taichi/backends/vulkan/aot_module_loader_impl.h   |  16 +++
 taichi/backends/vulkan/vulkan_program.cpp         |  11 +++
 taichi/backends/vulkan/vulkan_program.h           |   2 +
 taichi/program/graph.cpp                          | 101 +++++++++++++++++++
 taichi/program/graph.h                            | 113 ++++++++++++++++++++++
 taichi/program/kernel.cpp                         |   4 +
 taichi/program/kernel.h                           |   2 +
 taichi/program/ndarray.cpp                        |   6 +-
 taichi/program/ndarray.h                          |   3 +-
 taichi/program/program.h                          |   4 +
 taichi/program/program_impl.h                     |   8 ++
 tests/cpp/aot/aot_save_load_test.cpp              |   3 +-
 tests/cpp/program/graph_test.cpp                  |  52 ++++++++++
 16 files changed, 412 insertions(+), 48 deletions(-)
15b278a26 [test] Unify kernel setup for ndarray related tests
 tests/cpp/aot/aot_save_load_test.cpp | 39 +++--------------------------
 tests/cpp/ir/ir_builder_test.cpp     | 37 +++------------------------
 tests/cpp/ir/ndarray_kernel.cpp      | 48 ++++++++++++++++++++++++++++++++++++
 tests/cpp/ir/ndarray_kernel.h        | 14 +++++++++++
 4 files changed, 68 insertions(+), 70 deletions(-)
b42a09fc3 [refactor] Get rid of data_ptr_ in Ndarray
 python/taichi/lang/_ndarray.py |  9 ---------
 taichi/program/ndarray.cpp     | 13 -------------
 taichi/program/ndarray.h       |  3 ---
 taichi/python/export_lang.cpp  |  1 -
 4 files changed, 26 deletions(-)
9606e037a [refactor] Move ndarray fast fill methods to Program
 python/taichi/lang/_ndarray.py |  6 +++---
 taichi/program/ndarray.cpp     | 23 -----------------------
 taichi/program/ndarray.h       |  6 ------
 taichi/program/program.cpp     | 11 +++++++++++
 taichi/program/program.h       |  4 ++++
 taichi/python/export_lang.cpp  | 17 ++++++++++++++---
 6 files changed, 32 insertions(+), 35 deletions(-)
058f43620 [refactor] Free ndarray's memory when python GC triggers
 python/taichi/lang/_ndarray.py | 13 +++++++++++++
 python/taichi/lang/impl.py     |  4 ++++
 taichi/program/program.cpp     | 14 ++++++++++++--
 taichi/program/program.h       |  3 ++-
 taichi/python/export_lang.cpp  |  1 +
 tests/python/test_ndarray.py   | 22 ++++++++++++++++++++++
 6 files changed, 54 insertions(+), 3 deletions(-)
62332fcee [refactor] Construct ndarray from existing DeviceAllocation.
 taichi/program/ndarray.cpp           | 21 +++++++++++++++++++++
 taichi/program/ndarray.h             | 16 +++++++++++++++-
 tests/cpp/aot/aot_save_load_test.cpp |  3 ++-
 3 files changed, 38 insertions(+), 2 deletions(-)
237dcd15f [test] Add test for Ndarray from DeviceAllocation
 tests/cpp/aot/aot_save_load_test.cpp | 155 +++++++++++++++++++++++++++++++++++
 1 file changed, 155 insertions(+)
2c7c1cc63 [refactor] Program owns allocated ndarrays.
 python/taichi/lang/_ndarray.py                 |  4 ++--
 taichi/backends/opengl/opengl_program.cpp      |  4 ----
 taichi/backends/opengl/opengl_program.h        |  2 --
 taichi/backends/vulkan/vulkan_program.cpp      |  9 +++------
 taichi/backends/vulkan/vulkan_program.h        |  3 ---
 taichi/llvm/llvm_program.cpp                   |  4 ----
 taichi/llvm/llvm_program.h                     |  2 --
 taichi/program/ndarray.cpp                     |  6 +++---
 taichi/program/ndarray.h                       | 13 +++++--------
 taichi/program/program.cpp                     |  6 ++++++
 taichi/program/program.h                       |  6 ++----
 taichi/program/program_impl.h                  |  4 ----
 taichi/python/export_lang.cpp                  |  8 +++++++-
 taichi/runtime/opengl/opengl_api.cpp           |  2 +-
 taichi/runtime/opengl/opengl_kernel_launcher.h |  2 +-
 tests/python/test_torch_io.py                  |  2 +-
 16 files changed, 31 insertions(+), 46 deletions(-)
101590d6c [test] Fix a few mis-configured ndarray tests (#5000)
 tests/python/test_ndarray.py | 12 +++++++++---
 1 file changed, 9 insertions(+), 3 deletions(-)
9959ee3d9 [test] Add an ndarray test in C++. (#4972)
 tests/cpp/ir/ir_builder_test.cpp   | 72 ++++++++++++++++++++++++++++++++++++++
 tests/cpp/program/test_program.cpp |  4 +--
 tests/cpp/program/test_program.h   |  2 +-
 3 files changed, 75 insertions(+), 3 deletions(-)
0abd24b0d [Doc] Add limitation about TLS optimization (#4877)
 docs/lang/articles/advanced/performance.md | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)
477c996e8 [ci] Add libtaichi_export_core build for desktop in CI (#4871)
 .github/workflows/scripts/unix_build.sh | 19 +++++++++---
 .github/workflows/testing.yml           | 54 +++++++++++++++++++++++++++++++++
 cmake/TaichiExportCore.cmake            |  1 -
 3 files changed, 68 insertions(+), 6 deletions(-)
648f3332f [gui] Only call ImGui_ImplVulkan_Shutdown if it's initialized (#4827)
 taichi/ui/backends/vulkan/gui.cpp | 4 +++-
 tests/python/test_ggui.py         | 6 ++++++
 2 files changed, 9 insertions(+), 1 deletion(-)
53a5c6c72 Expose VboHelpers class (#4773)
 taichi/ui/backends/vulkan/vertex.h | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)
61bec614f [aot] Provide a convenient API to set devallocation as argument (#4762)
 taichi/program/context.h | 30 +++++++++++++++++++++++++++++-
 1 file changed, 29 insertions(+), 1 deletion(-)
b2cbde548 [build] Simplify build command for android (#4752)
 CMakeLists.txt         |  4 ++++
 cmake/TaichiCore.cmake | 11 +++++++++++
 2 files changed, 15 insertions(+)
bc5000017 [mac] Fix external_func test failures on arm backend (#4733)
 CMakeLists.txt                     | 2 +-
 tests/python/test_external_func.py | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)
8e0113300 [spirv] Ext arr name should include arg id (#4727)
 taichi/codegen/spirv/spirv_codegen.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
f2f79d62d [aot] Support return in vulkan aot (#4593)
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 32 ++--------------------
 taichi/backends/vulkan/aot_module_builder_impl.h   |  2 --
 taichi/backends/vulkan/runtime.cpp                 | 22 +++++++--------
 taichi/codegen/spirv/kernel_utils.cpp              | 25 +++++++++++------
 taichi/codegen/spirv/kernel_utils.h                | 10 +++++--
 taichi/codegen/spirv/spirv_codegen.cpp             | 14 ++++++----
 taichi/program/context.h                           |  5 ++++
 tests/cpp/aot/aot_save_load_test.cpp               | 29 +++++++++++++++++++-
 8 files changed, 79 insertions(+), 60 deletions(-)
463cbea49 [aot] Remove redundant module_path argument (#4573)
 taichi/aot/module_loader.cpp         | 4 +---
 taichi/aot/module_loader.h           | 4 +---
 tests/cpp/aot/aot_save_load_test.cpp | 2 +-
 3 files changed, 3 insertions(+), 7 deletions(-)
2137dbe6d [build] Guard llvm usage inside TI_WITH_LLVM (#4570)
 taichi/ir/ir.h | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)
2a369d1c3 [aot] Add binding_id of root/gtmp/rets/args bufs to CompiledOffloadedTask (#4522)
 python/taichi/aot/module.py                        |  5 ++---
 taichi/aot/module_data.h                           | 20 ++++++++++++++++-
 taichi/backends/opengl/aot_module_builder_impl.cpp | 21 ++++++++++++++---
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 19 ++++++++++++++++
 tests/python/test_aot.py                           | 26 ++++++++++++++++++++++
 5 files changed, 84 insertions(+), 7 deletions(-)
dd27e56c7 [vulkan] Relax a few test precisions for vulkan (#4524)
 tests/python/test_element_wise.py | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)
1981bdd6b [build] Guard dx lib search with TI_WITH_DX11 (#4505)
 taichi/backends/dx/dx_api.h | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)
437cf6544 [vulkan] Support templated kernel in aot module (#4417)
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 8 +++++++-
 tests/python/test_aot.py                           | 2 +-
 2 files changed, 8 insertions(+), 2 deletions(-)
32663243b [build] Build with Apple clang-13 (#4370)
 CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
248565a74 [ci] Run vulkan and metal separately on M1 (#4367)
 .github/workflows/release.yml          |  1 +
 .github/workflows/scripts/unix_test.sh | 10 +++++++---
 .github/workflows/testing.yml          |  1 +
 3 files changed, 9 insertions(+), 3 deletions(-)
2977fa9ce [misc] Version bump: v0.9.0->v0.9.1 (#4363)
 setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
d15224828 [bug] Update children_offsets & stride info to align as elem_stride (#4345)
 taichi/backends/opengl/struct_opengl.cpp | 77 +++++++++++++++++---------------
 taichi/backends/opengl/struct_opengl.h   |  7 +--
 2 files changed, 44 insertions(+), 40 deletions(-)
e9e23892c [gui] Update GGUI examples to use vulkan backend if available (#4353)
 python/taichi/examples/ggui_examples/fem128_ggui.py           | 3 ++-
 python/taichi/examples/ggui_examples/fractal3d_ggui.py        | 3 ++-
 python/taichi/examples/ggui_examples/mass_spring_3d_ggui.py   | 3 ++-
 python/taichi/examples/ggui_examples/mass_spring_game_ggui.py | 3 ++-
 python/taichi/examples/ggui_examples/mpm128_ggui.py           | 3 ++-
 python/taichi/examples/ggui_examples/mpm3d_ggui.py            | 3 ++-
 python/taichi/examples/ggui_examples/stable_fluid_ggui.py     | 3 ++-
 7 files changed, 14 insertions(+), 7 deletions(-)
16e6e194d [ci] Use conda python for m1 jobs (#4351)
 .github/workflows/testing.yml | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)
b8a75690b [opengl] Remove support for dynamic snode
 taichi/backends/opengl/codegen_opengl.cpp  | 56 +-----------------------------
 taichi/backends/opengl/opengl_data_types.h |  8 -----
 taichi/backends/opengl/struct_opengl.cpp   |  9 ++---
 3 files changed, 3 insertions(+), 70 deletions(-)
2a7125881 [ci] Fix generate_example_videos.py (#4347)
 misc/generate_example_videos.py                     | 5 ++++-
 tests/python/examples/autodiff/test_minimization.py | 5 +++--
 2 files changed, 7 insertions(+), 3 deletions(-)
142b4737e [lang] Move sparse_matrix_builder from taichi.linalg to taichi.types (#4301)
 python/taichi/__init__.py                 |  2 +-
 python/taichi/lang/ast/ast_transformer.py |  4 +--
 python/taichi/lang/kernel_impl.py         |  4 +--
 python/taichi/linalg/__init__.py          |  3 +-
 python/taichi/linalg/sparse_matrix.py     | 14 +++++++--
 python/taichi/types/annotations.py        |  7 ++++-
 tests/python/test_ast_refactor.py         |  2 +-
 tests/python/test_sparse_linear_solver.py |  2 +-
 tests/python/test_sparse_matrix.py        | 49 +++++++++++++++++++++----------
 tests/python/test_spmv.py                 |  6 ++--
 10 files changed, 60 insertions(+), 33 deletions(-)
b4214e4ce [lang] Make ti.cfg an alias of runtime cfg (#4264)
 python/taichi/__init__.py                  |  5 +++++
 python/taichi/lang/misc.py                 | 36 +++++-------------------------
 tests/python/test_ad_basics.py             |  8 ++++---
 tests/python/test_aot.py                   | 12 +++++-----
 tests/python/test_dynamic.py               |  2 +-
 tests/python/test_global_store_grad.py     |  2 +-
 tests/python/test_reduction.py             |  4 ++--
 tests/python/test_runtime.py               | 10 ++++-----
 tests/python/test_svd.py                   |  2 +-
 tests/python/test_tensor_dimensionality.py |  2 +-
 tests/python/test_test.py                  | 24 ++++++++++----------
 tests/python/test_unary_ops.py             | 11 +++++----
 tests/test_utils.py                        |  2 +-
 13 files changed, 53 insertions(+), 67 deletions(-)
c4f92f2f6 [lang] Remove CompoundType from taichi.types (#4291)
 python/taichi/lang/matrix.py          | 3 ++-
 python/taichi/lang/mesh.py            | 3 ++-
 python/taichi/lang/struct.py          | 3 ++-
 python/taichi/types/__init__.py       | 2 +-
 python/taichi/types/compound_types.py | 3 +++
 5 files changed, 10 insertions(+), 4 deletions(-)
e342409fd [lang] Hide get_addr and type_assert in api docs (#4290)
 python/taichi/lang/kernel_impl.py     | 2 +-
 python/taichi/linalg/sparse_matrix.py | 2 +-
 python/taichi/linalg/sparse_solver.py | 8 ++++----
 3 files changed, 6 insertions(+), 6 deletions(-)
c231aa3b4 [lang] Only expose start_recording/stop_recording for now (#4289)
 python/taichi/aot/record.py | 4 ----
 1 file changed, 4 deletions(-)
21635964d [docs] Hide unnessary methods in annotation classes (#4287)
 python/taichi/lang/kernel_impl.py  | 22 +++++++++++-----------
 python/taichi/types/annotations.py |  8 ++++----
 2 files changed, 15 insertions(+), 15 deletions(-)
a7f09f279 [lang] Expose mesh_patch_idx at top level (#4260)
 python/taichi/lang/misc.py | 2 +-
 tests/python/test_mesh.py  | 3 +--
 2 files changed, 2 insertions(+), 3 deletions(-)
973c04d6b [Bug] Only ban passing non contiguous torch tensors to taichi kernels. (#4258)
 python/taichi/lang/kernel_impl.py | 4 ++--
 tests/python/test_torch_io.py     | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)
3df5cb9d7 [misc] Update master version to 0.9.0 (#4248)
 setup.py | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
e8ed9b4c4 [misc] Use test_utils.approx directly (#4252)
 tests/python/bls_test_template.py   |   1 -
 tests/python/fuse_test_template.py  |   1 -
 tests/python/test_ad_atomic.py      |   5 +-
 tests/python/test_ad_basics.py      |   9 +--
 tests/python/test_ast_refactor.py   |   9 +--
 tests/python/test_ast_resolver.py   |   2 -
 tests/python/test_atomic.py         |   6 +-
 tests/python/test_binding.py        |   1 -
 tests/python/test_bit_operations.py |   1 -
 tests/python/test_cli.py            |   1 -
 tests/python/test_element_wise.py   | 150 ++++++++++++++++++------------------
 tests/python/test_f16.py            |  23 +++---
 tests/python/test_gui.py            |   3 +-
 tests/python/test_image_io.py       |   7 +-
 tests/python/test_linalg.py         |  31 ++++----
 tests/python/test_matrix.py         |  14 ++--
 tests/python/test_mpm88.py          |   7 +-
 tests/python/test_random.py         |  12 +--
 tests/python/test_return.py         |   5 +-
 tests/python/test_scalar_op.py      |  13 ++--
 tests/python/test_ssa.py            |   5 +-
 tests/python/test_svd.py            |   7 +-
 22 files changed, 146 insertions(+), 167 deletions(-)
5680b8468 [ci] Move _testing.py into tests folder (#4247)
 python/taichi/__init__.py                          |   1 -
 tests/__init__.py                                  |   1 +
 tests/python/bls_test_template.py                  |   1 +
 tests/python/examples/__init__.py                  |   1 +
 tests/python/examples/autodiff/__init__.py         |   1 +
 .../python/examples/autodiff/test_minimization.py  |   3 +-
 tests/python/fuse_test_template.py                 |   1 +
 tests/python/test_abs.py                           |   3 +-
 tests/python/test_ad_atomic.py                     |   6 +-
 tests/python/test_ad_basics.py                     |  41 ++++----
 tests/python/test_ad_demote_dense.py               |   3 +-
 tests/python/test_ad_for.py                        |  63 ++++++++-----
 tests/python/test_ad_if.py                         |  23 ++---
 tests/python/test_ad_offload.py                    |   3 +-
 tests/python/test_aot.py                           |  27 +++---
 tests/python/test_arg_alignment.py                 |   5 +-
 tests/python/test_arg_check.py                     |   3 +-
 tests/python/test_arg_load.py                      |   7 +-
 tests/python/test_assert.py                        |  19 ++--
 tests/python/test_assign.py                        |  15 +--
 tests/python/test_ast_refactor.py                  | 105 +++++++++++----------
 tests/python/test_ast_resolver.py                  |   2 +
 tests/python/test_async.py                         |   7 +-
 tests/python/test_atomic.py                        |  34 +++----
 tests/python/test_basics.py                        |  15 +--
 tests/python/test_binding.py                       |   1 +
 tests/python/test_bit_array.py                     |   5 +-
 tests/python/test_bit_array_vectorization.py       |   9 +-
 tests/python/test_bit_operations.py                |   9 +-
 tests/python/test_bit_struct.py                    |  12 ++-
 tests/python/test_bitmasked.py                     |  27 +++---
 tests/python/test_bls.py                           |  25 ++---
 tests/python/test_bls_assume_in_range.py           |  11 ++-
 tests/python/test_bool_op.py                       |  13 +--
 tests/python/test_callable_template_mapper.py      |   5 +-
 tests/python/test_cast.py                          |  17 ++--
 tests/python/test_classfunc.py                     |   3 +-
 tests/python/test_clear_all_gradients.py           |   3 +-
 tests/python/test_cli.py                           |   1 +
 tests/python/test_compare.py                       |  15 +--
 tests/python/test_complex_struct.py                |   5 +-
 tests/python/test_constant_fold.py                 |   3 +-
 tests/python/test_continue.py                      |  15 +--
 tests/python/test_copy_from.py                     |   3 +-
 tests/python/test_cuda_internals.py                |   7 +-
 tests/python/test_custom_float.py                  |   9 +-
 tests/python/test_custom_float_exponents.py        |  11 ++-
 tests/python/test_custom_float_shared_exp.py       |   9 +-
 tests/python/test_custom_float_time_integration.py |   3 +-
 tests/python/test_custom_int.py                    |   3 +-
 tests/python/test_custom_struct.py                 |  23 ++---
 tests/python/test_custom_type_atomics.py           |  10 +-
 tests/python/test_customized_grad.py               |  15 +--
 tests/python/test_debug.py                         |  21 +++--
 tests/python/test_div.py                           |   9 +-
 tests/python/test_dynamic.py                       |  19 ++--
 tests/python/test_eig.py                           |  15 +--
 tests/python/test_element_wise.py                  |  15 +--
 tests/python/test_empty.py                         |   5 +-
 tests/python/test_exception.py                     |  11 ++-
 tests/python/test_expr_dict.py                     |  11 ++-
 tests/python/test_expr_list.py                     |   7 +-
 tests/python/test_external_func.py                 |   5 +-
 tests/python/test_f16.py                           |  39 ++++----
 tests/python/test_field.py                         |  21 +++--
 tests/python/test_fields_builder.py                |   9 +-
 tests/python/test_fill.py                          |   7 +-
 tests/python/test_for_break.py                     |   9 +-
 tests/python/test_for_group_mismatch.py            |  15 +--
 tests/python/test_fp_flush_to_zero.py              |   5 +-
 tests/python/test_function.py                      |  21 +++--
 tests/python/test_function_parameter_by_value.py   |   3 +-
 tests/python/test_fuse_dense.py                    |   7 +-
 tests/python/test_fuse_dynamic.py                  |   5 +-
 tests/python/test_gc.py                            |  17 ++--
 tests/python/test_get_external_tensor_shape.py     |   9 +-
 tests/python/test_ggui.py                          |   9 +-
 tests/python/test_global_buffer_misalined.py       |   3 +-
 tests/python/test_global_thread_idx.py             |   3 +-
 tests/python/test_grouped.py                       |  17 ++--
 tests/python/test_gui.py                           |   5 +-
 tests/python/test_image_io.py                      |  13 +--
 tests/python/test_immediate_layout.py              |   3 +-
 tests/python/test_indices.py                       |   5 +-
 tests/python/test_indices_assert.py                |   3 +-
 tests/python/test_internal_func.py                 |  13 +--
 tests/python/test_kernel_arg_errors.py             |   3 +-
 tests/python/test_kernel_templates.py              |   9 +-
 tests/python/test_lang.py                          |  17 ++--
 tests/python/test_lexical_scope.py                 |   3 +-
 tests/python/test_linalg.py                        |  38 ++++----
 tests/python/test_listgen.py                       |   5 +-
 tests/python/test_local_atomic_opt.py              |   5 +-
 tests/python/test_local_atomics.py                 |  25 ++---
 tests/python/test_loop_grad.py                     |   5 +-
 tests/python/test_loop_unique.py                   |  11 ++-
 tests/python/test_loops.py                         |  17 ++--
 tests/python/test_materialize_check.py             |   5 +-
 tests/python/test_matrix.py                        |  53 ++++++-----
 tests/python/test_matrix_arg.py                    |   5 +-
 tests/python/test_matrix_different_type.py         |   7 +-
 tests/python/test_memory.py                        |   3 +-
 tests/python/test_mesh.py                          |  27 +++---
 tests/python/test_mod.py                           |   7 +-
 tests/python/test_module_import.py                 |   3 +-
 tests/python/test_mpm88.py                         |  11 ++-
 tests/python/test_mpm_particle_list.py             |  13 ++-
 tests/python/test_name_error.py                    |   3 +-
 tests/python/test_native_functions.py              |   7 +-
 tests/python/test_ndarray.py                       |  71 +++++++-------
 tests/python/test_ndrange.py                       |  25 ++---
 tests/python/test_nested_kernel_error.py           |   3 +-
 tests/python/test_new_allocator.py                 |   9 +-
 tests/python/test_no_activate.py                   |   3 +-
 tests/python/test_no_grad.py                       |   5 +-
 tests/python/test_non_taichi_types_in_kernel.py    |   3 +-
 tests/python/test_numpy.py                         |  25 ++---
 tests/python/test_numpy_io.py                      |  15 +--
 tests/python/test_offload.py                       |   7 +-
 tests/python/test_offload_cross.py                 |  17 ++--
 tests/python/test_offset.py                        |  19 ++--
 tests/python/test_oop.py                           |  17 ++--
 tests/python/test_optimization.py                  |  13 +--
 tests/python/test_packed_size.py                   |   3 +-
 tests/python/test_parallel_range_for.py            |   3 +-
 tests/python/test_pow.py                           |   9 +-
 tests/python/test_print.py                         |  21 +++--
 tests/python/test_ptr_assign.py                    |  13 +--
 tests/python/test_random.py                        |  20 ++--
 tests/python/test_reduction.py                     |  17 ++--
 tests/python/test_rescale.py                       |   3 +-
 tests/python/test_return.py                        |  19 ++--
 tests/python/test_runtime.py                       |   7 +-
 tests/python/test_scalar_op.py                     |  11 ++-
 tests/python/test_scope_errors.py                  |   7 +-
 tests/python/test_serial_execution.py              |   5 +-
 tests/python/test_sfg.py                           |  13 +--
 tests/python/test_snode_layout_inspection.py       |   5 +-
 tests/python/test_sort.py                          |   3 +-
 tests/python/test_sparse_activate.py               |   5 +-
 tests/python/test_sparse_basics.py                 |  12 ++-
 tests/python/test_sparse_deactivate.py             |  11 ++-
 tests/python/test_sparse_linear_solver.py          |   5 +-
 tests/python/test_sparse_matrix.py                 |  23 ++---
 tests/python/test_sparse_multi_tree.py             |   3 +-
 tests/python/test_sparse_parallel.py               |   7 +-
 tests/python/test_spmv.py                          |   7 +-
 tests/python/test_ssa.py                           |  11 ++-
 tests/python/test_static.py                        |  11 ++-
 tests/python/test_stencils.py                      |   3 +-
 tests/python/test_stop_grad.py                     |   7 +-
 tests/python/test_struct.py                        |   9 +-
 tests/python/test_struct_for.py                    |  29 +++---
 tests/python/test_struct_for_dynamic.py            |   5 +-
 tests/python/test_struct_for_intermediate.py       |  21 +++--
 tests/python/test_struct_for_non_pot.py            |   9 +-
 tests/python/test_svd.py                           |  14 +--
 tests/python/test_sync.py                          |   3 +-
 tests/python/test_syntax_errors.py                 |  47 ++++-----
 tests/python/test_tensor_dimensionality.py         |   3 +-
 tests/python/test_tensor_reflection.py             |  11 ++-
 tests/python/test_test.py                          |  52 +++++-----
 tests/python/test_threading.py                     |   3 +-
 tests/python/test_torch_ad.py                      |   5 +-
 tests/python/test_torch_io.py                      |  27 +++---
 tests/python/test_tuple_assign.py                  |  29 +++---
 tests/python/test_type_check.py                    |  13 +--
 tests/python/test_types.py                         |  19 ++--
 tests/python/test_unary_ops.py                     |   6 +-
 tests/python/test_while.py                         |   5 +-
 tests/python38/__init__.py                         |   1 +
 tests/python38/test_ast_refactor.py                |   3 +-
 python/taichi/_testing.py => tests/test_utils.py   |   0
 173 files changed, 1157 insertions(+), 956 deletions(-)
a6763b641 [ci] Disable Vulkan backend for mac1015 release. (#4245)
 .github/workflows/release.yml | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)
67d9c6c49 [ci] Disable Vulkan backend for mac1014 release. (#4241)
 .github/workflows/release.yml | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)
8bdb4ab7a [lang] Annotate constants with dtype without casting. (#4224)
 python/taichi/lang/ast/ast_transformer.py |  5 ++-
 python/taichi/lang/expr.py                |  9 ++---
 python/taichi/lang/impl.py                | 64 +++++++++++++------------------
 taichi/ir/expr.cpp                        |  8 ++--
 taichi/ir/frontend_ir.h                   |  4 ++
 taichi/python/export_lang.cpp             | 14 ++++---
 tests/python/test_binding.py              |  4 +-
 7 files changed, 51 insertions(+), 57 deletions(-)
35a5cc189 [Bug] Ban passing torch view tensors into taichi kernel (#4225)
 python/taichi/lang/kernel_impl.py |  4 ++++
 tests/python/test_torch_io.py     | 16 ++++++++++++++++
 2 files changed, 20 insertions(+)
fe0ae9afa [misc] Test unified doc & api preview. (#4186)
 netlify.toml | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)
1d14b2dfa [bug] [opengl] Process child nodes to compute alignment (#4191)
 taichi/backends/opengl/struct_opengl.cpp           | 22 +++++++++++++++++++---
 .../python/examples/autodiff/test_minimization.py  |  2 +-
 tests/python/test_aot.py                           |  7 +++++--
 3 files changed, 25 insertions(+), 6 deletions(-)
2f7a9bb88 [refactor] Remove is_signed/is_integral from top level. (#4182)
 python/taichi/types/__init__.py        | 1 +
 python/taichi/types/primitive_types.py | 6 ------
 python/taichi/types/utils.py           | 7 +++++++
 3 files changed, 8 insertions(+), 6 deletions(-)
b54d720b8 [refactor] Move version_check out of taichi.lang. (#4178)
 python/taichi/_version_check.py | 100 ++++++++++++++++++++++++++++++++++++++++
 python/taichi/lang/misc.py      |  97 +-------------------------------------
 2 files changed, 102 insertions(+), 95 deletions(-)
f8e5563d1 [refactor] Remove locale_encode from top level. (#4179)
 python/taichi/lang/__init__.py | 1 -
 1 file changed, 1 deletion(-)
2c03cc6f6 [refactor] Remove bit_vectorize from top level. (#4158)
 python/taichi/lang/misc.py                   | 1 -
 tests/python/test_bit_array_vectorization.py | 7 +++----
 2 files changed, 3 insertions(+), 5 deletions(-)
8a6ccd30b [refactor] Remove critical/debug/error/trace/warn/info/is_logging_effective from top level (#4133)
 python/taichi/_logging.py    | 3 +--
 python/taichi/main.py        | 8 ++++----
 tests/python/test_runtime.py | 2 +-
 tests/run_tests.py           | 6 +++---
 4 files changed, 9 insertions(+), 10 deletions(-)
1d605fdf4 [ci] Fix approx in autodiff example test (#4132)
 tests/python/examples/autodiff/test_minimization.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
10d80fb5d [test] Remove allclose at top level.
 python/taichi/_testing.py           |  1 -
 tests/python/test_bit_operations.py |  2 +-
 tests/python/test_element_wise.py   |  2 +-
 tests/python/test_scalar_op.py      |  2 +-
 tests/python/test_test.py           | 11 +++++++----
 5 files changed, 10 insertions(+), 8 deletions(-)
e9e4cd6d8 [test] Remove approx at top level.
 misc/test_poly_timed.py                   |  2 +-
 python/taichi/_testing.py                 |  1 -
 tests/python/test_ad_atomic.py            |  3 ++-
 tests/python/test_ad_basics.py            |  2 +-
 tests/python/test_ast_refactor.py         |  2 +-
 tests/python/test_atomic.py               |  3 ++-
 tests/python/test_expr_dict.py            |  4 ++--
 tests/python/test_expr_list.py            |  2 +-
 tests/python/test_f16.py                  |  2 +-
 tests/python/test_image_io.py             |  2 +-
 tests/python/test_linalg.py               |  2 +-
 tests/python/test_matrix.py               |  2 +-
 tests/python/test_mpm88.py                |  2 +-
 tests/python/test_random.py               |  3 ++-
 tests/python/test_return.py               |  2 +-
 tests/python/test_sfg.py                  |  4 ++--
 tests/python/test_sparse_linear_solver.py |  2 +-
 tests/python/test_ssa.py                  |  2 +-
 tests/python/test_svd.py                  |  2 +-
 tests/python/test_test.py                 | 14 +++++++-------
 20 files changed, 30 insertions(+), 28 deletions(-)
033a1181a [test] Remove get_rel_eps() at top level.
 python/taichi/_testing.py | 1 -
 tests/python/test_test.py | 6 +++---
 2 files changed, 3 insertions(+), 4 deletions(-)
a1fb2913a [test] Replace make_temp_file with tempfile
 python/taichi/_testing.py     | 1 -
 tests/python/test_gui.py      | 2 +-
 tests/python/test_image_io.py | 2 +-
 3 files changed, 2 insertions(+), 3 deletions(-)
2b9435551 [build] Handle empty TAICHI_EMBIND_SOURCE (#4127)
 cmake/TaichiCore.cmake | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)
bf6cd4190 [misc] Version bump: v0.8.11 -> v0.8.12 (#4125)
 setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
fa0d6655c [opengl] Use element_size as alignment in root buffer. (#4095)
 taichi/backends/opengl/aot_module_builder_impl.cpp | 18 +++++----------
 taichi/backends/opengl/aot_module_builder_impl.h   |  2 --
 taichi/backends/opengl/codegen_opengl.cpp          | 26 +++++-----------------
 taichi/backends/opengl/opengl_kernel_launcher.h    |  1 +
 taichi/backends/opengl/struct_opengl.cpp           | 25 ++++++++++++++++-----
 taichi/program/aot_module.cpp                      |  9 --------
 taichi/program/aot_module.h                        |  2 --
 tests/python/test_aot.py                           | 18 +++++++++++++++
 8 files changed, 49 insertions(+), 52 deletions(-)
1a8784a41 [aot] [vulkan] Provide range_hint for range_for offloaded tasks in vulkan backend.
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 6 ++++++
 tests/python/test_aot.py                           | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)
a1e9b8f45 [aot] [opengl] Provide range_hint for range_for offloaded tasks in opengl backend.
 taichi/aot/module_data.h                           |  3 +-
 taichi/backends/opengl/aot_module_builder_impl.cpp |  1 +
 taichi/backends/opengl/codegen_opengl.cpp          | 11 +++---
 taichi/backends/opengl/opengl_api.cpp              |  4 ++-
 taichi/backends/opengl/opengl_api.h                |  2 ++
 taichi/ir/statements.cpp                           |  6 ++--
 taichi/ir/statements.h                             |  5 ++-
 taichi/transforms/lower_ast.cpp                    |  3 +-
 taichi/transforms/offload.cpp                      |  1 +
 tests/python/test_aot.py                           | 41 ++++++++++++++++++++++
 10 files changed, 67 insertions(+), 10 deletions(-)
cae94fad1 [opengl] Make sure ndarray arg bind indices are sorted. (#4069)
 taichi/backends/opengl/codegen_opengl.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
3b5b3efd9 [test] [example] Add test and video generator for cornell box. (#4045)
 python/taichi/examples/rendering/cornell_box.py    | 35 ++++++++++--------
 .../python/examples/rendering/test_cornell_box.py  | 43 ++++++++++++++++++++++
 2 files changed, 63 insertions(+), 15 deletions(-)
4e3bf947e [aot] Use element_shape instead of row_num & column_num for CompiledFieldData.
 taichi/aot/module_data.h                           | 6 ++----
 taichi/backends/opengl/aot_module_builder_impl.cpp | 6 +++++-
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 5 +++--
 3 files changed, 10 insertions(+), 7 deletions(-)
2d28fa495 [vulkan] [aot] Switch vulkan aot to use taichi::aot::ModuleData.
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 78 +++++++++++++++++++---
 taichi/backends/vulkan/aot_module_builder_impl.h   |  6 +-
 taichi/codegen/spirv/kernel_utils.h                |  1 +
 3 files changed, 73 insertions(+), 12 deletions(-)
0d58520fc [build] Disable LTO for mac. (#4027)
 cmake/TaichiCXXFlags.cmake | 3 +--
 1 file changed, 1 insertion(+), 2 deletions(-)
ff306c14c [vulkan] [aot] Throw error for templated kernels in vulkan aot.
 taichi/backends/vulkan/aot_module_builder_impl.cpp |  1 +
 tests/python/test_aot.py                           | 15 ++++++++++++++-
 2 files changed, 15 insertions(+), 1 deletion(-)
b1ef15b6b [vulkan] [aot] Enable aot tests for vulkan backend. (#4000)
 taichi/common/serialization.h |  1 +
 tests/python/test_aot.py      | 17 +++++++++--------
 2 files changed, 10 insertions(+), 8 deletions(-)
a156465f3 [refactor] [opengl] Get rid of some no-ops in linear seek
 taichi/backends/opengl/codegen_opengl.cpp | 64 +++++++++++++++++++------------
 1 file changed, 40 insertions(+), 24 deletions(-)
94b38bfa3 [opengl] Do not promote simple ExternalTensorShapeAlongAxisStmt into globals.
 taichi/backends/opengl/codegen_opengl.cpp | 21 ++++---
 taichi/ir/statements.cpp                  |  6 +-
 taichi/ir/statements.h                    |  7 +--
 taichi/transforms/die.cpp                 |  6 ++
 taichi/transforms/lower_ast.cpp           |  3 +-
 taichi/transforms/offload.cpp             | 96 +++++++++++++------------------
 6 files changed, 62 insertions(+), 77 deletions(-)
473a91cf1 [opengl] [aot] Convert opengl aot to dump ModuleData. (#3991)
 taichi/aot/module_data.h                           | 6 ++++++
 taichi/backends/opengl/aot_module_builder_impl.cpp | 9 +++------
 tests/python/test_aot.py                           | 2 +-
 3 files changed, 10 insertions(+), 7 deletions(-)
ba253fce9 [opt] Add more strict alias analysis for ExternalPtrStmt (#3992)
 taichi/analysis/alias_analysis.cpp         | 8 ++++++--
 tests/cpp/analysis/alias_analysis_test.cpp | 2 +-
 2 files changed, 7 insertions(+), 3 deletions(-)
551af9ccc [refactor] Move python/taichi/lang/meta.py to python/taichi/_kernels.py
 python/taichi/{lang/meta.py => _kernels.py} | 97 +++++++++++++++--------------
 python/taichi/lang/README.md                |  2 +-
 python/taichi/lang/__init__.py              |  8 ++-
 python/taichi/lang/_ndarray.py              | 22 ++++---
 python/taichi/lang/field.py                 | 15 +++--
 python/taichi/lang/matrix.py                | 21 ++++---
 python/taichi/lang/snode.py                 |  9 ++-
 python/taichi/ui/gui.py                     |  8 ++-
 8 files changed, 105 insertions(+), 77 deletions(-)
c04720aaf [refactor] Remove import taichi in taichi/lang/impl.py
 python/taichi/__init__.py                      |  1 -
 python/taichi/lang/__init__.py                 | 12 ++++------
 python/taichi/lang/{ndrange.py => _ndrange.py} |  0
 python/taichi/lang/ast/ast_transformer.py      |  8 +++----
 python/taichi/lang/expr.py                     |  2 +-
 python/taichi/lang/impl.py                     | 33 +++++++++++++++-----------
 6 files changed, 28 insertions(+), 28 deletions(-)
033351410 [perf] Avoid using property for simple attributes to reduce python overhead.
 python/taichi/lang/_ndarray.py | 33 ++++++++-------------------------
 python/taichi/lang/matrix.py   | 27 +++++----------------------
 2 files changed, 13 insertions(+), 47 deletions(-)
5ffe4d23b [opengl] Respect max_block_dim in ti.init
 taichi/backends/opengl/codegen_opengl.cpp |  6 +++++-
 tests/python/test_aot.py                  | 23 +++++++++++++++++++++++
 2 files changed, 28 insertions(+), 1 deletion(-)
f1dde0739 [opengl] Optimize range_for for ndarrays
 taichi/backends/opengl/codegen_opengl.cpp | 36 +++++++++++---
 taichi/ir/statements.cpp                  |  6 ++-
 taichi/ir/statements.h                    | 12 ++++-
 taichi/transforms/ir_printer.cpp          |  3 ++
 taichi/transforms/lower_ast.cpp           |  4 +-
 taichi/transforms/offload.cpp             | 83 +++++++++++++++++++++++--------
 tests/python/test_aot.py                  |  8 +--
 7 files changed, 116 insertions(+), 36 deletions(-)
a957e8c45 [refactor] Merge taichi/lang/linalg_impl.py into _funcs.py
 python/taichi/_funcs.py           | 340 +++++++++++++++++++++++++++++++++++++-
 python/taichi/lang/__init__.py    |  80 ---------
 python/taichi/lang/linalg_impl.py | 262 -----------------------------
 3 files changed, 339 insertions(+), 343 deletions(-)
52e76a789 [refactor] Remove import taichi in taichi/lang/quant_impl.py
 python/taichi/lang/quant_impl.py | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)
7a249cbc8 [refactor] Remove import taichi in taichi/lang/util.py
 python/taichi/lang/util.py | 84 +++++++++++++++++++++++-----------------------
 1 file changed, 42 insertions(+), 42 deletions(-)
573694635 [opengl] Reduce repeated read to args buffer.
 taichi/backends/opengl/codegen_opengl.cpp | 26 ++++++++++++++++----------
 1 file changed, 16 insertions(+), 10 deletions(-)
d992b52a5 [refactor] Enforce destruction order of OpenGlRuntime. (#3861)
 taichi/backends/opengl/opengl_api.cpp           | 6 +++++-
 taichi/backends/opengl/opengl_kernel_launcher.h | 2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)
345f0f040 [bug] Fix autodiff for ceil. (#3844)
 taichi/transforms/auto_diff.cpp |  3 ++-
 tests/python/test_ad_basics.py  | 35 +++++++++++++++++++++++++++++++++++
 2 files changed, 37 insertions(+), 1 deletion(-)
38c25351e [opengl] Allocate new arg bufs per kernel launch (#3848)
 taichi/backends/opengl/opengl_api.cpp           | 34 ++++++++++++++++---------
 taichi/backends/opengl/opengl_api.h             |  2 +-
 taichi/backends/opengl/opengl_kernel_launcher.h |  1 +
 3 files changed, 24 insertions(+), 13 deletions(-)
f403b2516 [opengl] Only sync per ti.kernel when there's external array arg.
 taichi/backends/opengl/opengl_api.cpp | 29 ++++++++++++++++-------------
 1 file changed, 16 insertions(+), 13 deletions(-)
ac446e0cf [refactor] Rename is_external_array -> is_array and arr_bufs_ -> ext_arr_bufs_
 taichi/backends/cuda/codegen_cuda.cpp  |  2 +-
 taichi/backends/metal/kernel_utils.cpp |  2 +-
 taichi/backends/opengl/opengl_api.cpp  | 28 ++++++++++++++--------------
 taichi/backends/opengl/opengl_api.h    |  2 +-
 taichi/codegen/codegen_llvm.cpp        |  2 +-
 taichi/codegen/spirv/kernel_utils.cpp  |  2 +-
 taichi/program/callable.cpp            |  4 ++--
 taichi/program/callable.h              | 10 +++++-----
 taichi/program/kernel.cpp              |  8 ++++----
 taichi/python/export_lang.cpp          |  5 ++---
 tests/cpp/ir/ir_builder_test.cpp       |  2 +-
 tests/cpp/transforms/inlining_test.cpp |  2 +-
 12 files changed, 34 insertions(+), 35 deletions(-)
0ef63c554 [opengl] Only bind buffers per ti.kernel.
 taichi/backends/opengl/opengl_api.cpp | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)
eb1be507f [refactor] Move CompiledFieldData to aot namespace. (#3797)
 taichi/backends/opengl/aot_data.h                  | 22 +---------------------
 taichi/backends/vulkan/aot_module_builder_impl.cpp |  2 +-
 taichi/backends/vulkan/aot_utils.h                 |  3 ++-
 taichi/codegen/spirv/kernel_utils.h                | 20 --------------------
 taichi/program/aot_module_builder.h                | 22 ++++++++++++++++++++++
 5 files changed, 26 insertions(+), 43 deletions(-)
b984d89d9 [docs] Update README.md to include command to install nightly. (#3809)
 README.md | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
ef855abb4 [bug] Fix typo in opengl codegen. (#3801)
 taichi/backends/opengl/codegen_opengl.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
e66f2b2c2 [bug] Use NdarrayRwKeys for ndarray host reader & writer caching. (#3805)
 taichi/program/ndarray.h                     |  3 +++
 taichi/program/ndarray_rw_accessors_bank.cpp | 12 ++++------
 taichi/program/ndarray_rw_accessors_bank.h   | 34 +++++++++++++++++++++++++++-
 taichi/program/program.cpp                   | 28 ++++++++++++-----------
 tests/python/test_ndarray.py                 | 12 ++++++++++
 5 files changed, 68 insertions(+), 21 deletions(-)
e9042ec75 [bug] Create core folder if it doesn't exist. (#3799)
 setup.py | 1 +
 1 file changed, 1 insertion(+)
9f0d9f505 [bug] [opengl] Avoid using new as variable name in generated glsl. (#3786)
 .../opengl/shaders/atomics_macro_f32.glsl.h        | 64 ++++++++++++----------
 .../opengl/shaders/atomics_macro_f64.glsl.h        | 40 +++++++-------
 2 files changed, 54 insertions(+), 50 deletions(-)
c7b447247 [bug] Enable int32 atomic ops for opengl backend. (#3760)
 taichi/backends/opengl/codegen_opengl.cpp |   2 +-
 tests/python/test_aot.py                  | 145 ++++++++++++++++++++++++++++++
 2 files changed, 146 insertions(+), 1 deletion(-)
b53450fae [opengl] Don't serialize ext_arr_access in aot. (#3749)
 taichi/backends/opengl/opengl_api.h | 1 -
 1 file changed, 1 deletion(-)
da3c4c545 [refactor] Move ti.randn out of taichi.lang. (#3742)
 python/taichi/__init__.py                       |  1 +
 python/taichi/_funcs.py                         | 38 +++++++++++++++++++++++++
 python/taichi/lang/__init__.py                  | 18 +-----------
 python/taichi/lang/_random.py                   | 19 -------------
 python/taichi/lang/ast/ast_transformer_utils.py |  3 +-
 5 files changed, 41 insertions(+), 38 deletions(-)
7bb852e6d [bug] Temporarily remove runtime_ usage in aot_module_builder. (#3746)
 taichi/backends/vulkan/aot_module_builder_impl.cpp | 1 -
 1 file changed, 1 deletion(-)
70e36519f [misc] Update title check to be more robust. (#3747)
 misc/ci_check_pr_title.py | 3 ++-
 misc/prtags.json          | 4 +++-
 2 files changed, 5 insertions(+), 2 deletions(-)
88d81df68 [refactor] Merge taichi.misc into taichi.tools.
 python/taichi/__init__.py             |  2 +-
 python/taichi/lang/__init__.py        |  2 +-
 python/taichi/lang/impl.py            |  2 +-
 python/taichi/lang/kernel_impl.py     |  2 +-
 python/taichi/lang/matrix.py          |  2 +-
 python/taichi/lang/snode.py           |  2 +-
 python/taichi/misc/__init__.py        |  3 ---
 python/taichi/snode/fields_builder.py |  2 +-
 python/taichi/tools/__init__.py       | 23 ++++++++++++++++++++---
 python/taichi/{misc => tools}/util.py | 18 ------------------
 python/taichi/ui/gui.py               |  2 +-
 11 files changed, 28 insertions(+), 32 deletions(-)
303f055ab [refactor] Merge taichi.lang.types into taichi.types.
 python/taichi/__init__.py                                |  4 ++--
 python/taichi/aot/module.py                              |  4 ++--
 python/taichi/lang/__init__.py                           |  8 ++++----
 python/taichi/lang/impl.py                               |  2 +-
 python/taichi/lang/kernel_arguments.py                   |  2 +-
 python/taichi/lang/kernel_impl.py                        |  2 +-
 python/taichi/lang/matrix.py                             |  2 +-
 python/taichi/lang/mesh.py                               |  2 +-
 python/taichi/lang/meta.py                               |  2 +-
 python/taichi/lang/struct.py                             |  2 +-
 python/taichi/linalg/sparse_matrix.py                    |  2 +-
 python/taichi/linalg/sparse_solver.py                    |  2 +-
 python/taichi/type/__init__.py                           |  2 --
 python/taichi/types/__init__.py                          |  3 +++
 python/taichi/{type => types}/annotations.py             |  4 ++--
 python/taichi/{lang/types.py => types/compound_types.py} |  1 +
 python/taichi/{type => types}/primitive_types.py         | 12 ++++++------
 python/taichi/ui/scene.py                                |  4 ++--
 python/taichi/ui/staging_buffer.py                       |  4 ++--
 19 files changed, 33 insertions(+), 31 deletions(-)
94ed6ed9b [refactor] Rename CompiledProgram to CompiledTaichiKernel.
 taichi/backends/opengl/aot_data.h               |  4 +--
 taichi/backends/opengl/codegen_opengl.cpp       |  8 +++---
 taichi/backends/opengl/codegen_opengl.h         |  4 +--
 taichi/backends/opengl/opengl_api.cpp           | 35 ++++++++++++++-----------
 taichi/backends/opengl/opengl_api.h             |  8 +++---
 taichi/backends/opengl/opengl_kernel_launcher.h |  6 ++---
 6 files changed, 34 insertions(+), 31 deletions(-)
c1fb51bb8 [refactor] Add doc string for ndarray element_shapes & field_dim.
 python/taichi/aot/module.py           |  8 ++++----
 python/taichi/lang/kernel_impl.py     |  6 +++---
 python/taichi/type/annotations.py     | 20 +++++++++++---------
 taichi/backends/opengl/opengl_api.cpp |  6 +++---
 taichi/backends/opengl/opengl_api.h   |  4 ++--
 taichi/program/callable.cpp           |  4 ++--
 taichi/program/callable.h             | 10 +++++-----
 tests/python/test_ndarray.py          |  6 +++---
 8 files changed, 33 insertions(+), 31 deletions(-)
ac5bb2bc3 [misc] Use ccache & prefer Ninja over Make as cmake (#3712)
 CMakeLists.txt | 5 +++++
 setup.py       | 3 +++
 2 files changed, 8 insertions(+)
c9bad0d41 [refactor] [opengl] Properly save both scalar args and array args.
 taichi/backends/opengl/opengl_api.cpp |  5 ++++-
 taichi/backends/opengl/opengl_api.h   | 12 ++++++++++--
 2 files changed, 14 insertions(+), 3 deletions(-)
e742e6566 [refactor] [opengl] For each taichi kernel, save a {kernel_name, CompiledProgram} pair instead of a vector.
 taichi/backends/opengl/aot_data.h                  | 18 ++--------------
 taichi/backends/opengl/aot_module_builder_impl.cpp | 24 ++++++----------------
 2 files changed, 8 insertions(+), 34 deletions(-)
980ca9e10 [refactor] [opengl] Use CompiledOffloadedTask instead of CompiledKernel.
 taichi/backends/opengl/aot_module_builder_impl.cpp | 17 +++++++------
 taichi/backends/opengl/opengl_api.cpp              | 28 ++++++++++------------
 taichi/backends/opengl/opengl_api.h                | 16 ++++++-------
 3 files changed, 29 insertions(+), 32 deletions(-)
7b6356062 [refactor] [opengl] Remove dtype & total_size_hint in serialized aot file.
 taichi/backends/opengl/opengl_api.h | 10 ++--------
 1 file changed, 2 insertions(+), 8 deletions(-)
f1710f786 [Lang] Make example_any_arrays optional.
 python/taichi/aot/module.py | 35 +++++++++++++++++++++++++++++------
 1 file changed, 29 insertions(+), 6 deletions(-)
02f536d87 [Lang] Add optional element_shapes & field_dim annotation to ndarray.
 python/taichi/lang/kernel_impl.py |  6 ++++++
 python/taichi/type/annotations.py | 28 ++++++++++++++++++++++++++--
 tests/python/test_ndarray.py      | 30 ++++++++++++++++++++++++++++++
 3 files changed, 62 insertions(+), 2 deletions(-)
2b2a6d909 [refactor] Turn off empty root buffer warning for finalize_for_aot. (#3681)
 python/taichi/snode/fields_builder.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
3951c0874 [refactor] Remove ext_arr_map in favor of CompiledArrayData.
 taichi/backends/opengl/opengl_api.cpp | 20 ++++++++++----------
 taichi/backends/opengl/opengl_api.h   |  7 +++----
 2 files changed, 13 insertions(+), 14 deletions(-)
36ca6f1f1 [refactor] Remove unused functions in misc. (#3671)
 python/taichi/misc/__init__.py |  1 -
 python/taichi/misc/error.py    | 47 ----------------------------------
 python/taichi/misc/util.py     | 57 ------------------------------------------
 taichi/python/export_misc.cpp  | 33 ------------------------
 4 files changed, 138 deletions(-)
7aa0401ba [opengl] [refactor] Expose use_gles in CompileConfig. (#3662)
 python/taichi/lang/__init__.py        | 14 +++++++++-----
 python/taichi/testing.py              |  4 +++-
 taichi/backends/opengl/opengl_api.cpp | 23 +++++++++++++++--------
 taichi/backends/opengl/opengl_api.h   |  4 ++--
 taichi/program/compile_config.cpp     |  3 ---
 taichi/program/compile_config.h       |  3 ++-
 taichi/program/program.cpp            |  2 +-
 taichi/python/export_lang.cpp         |  1 +
 taichi/python/export_misc.cpp         |  3 ++-
 9 files changed, 35 insertions(+), 22 deletions(-)
db04b8bd7 [refactor] [opengl] Move ndarray aot information inside kernels. (#3658)
 python/taichi/aot/module.py                        | 41 +++------------------
 python/taichi/lang/kernel_arguments.py             |  2 +-
 taichi/backends/opengl/aot_data.h                  | 15 +-------
 taichi/backends/opengl/aot_module_builder_impl.cpp | 42 ++--------------------
 taichi/backends/opengl/aot_module_builder_impl.h   |  6 ----
 taichi/backends/opengl/opengl_api.cpp              | 11 ++++++
 taichi/backends/opengl/opengl_api.h                | 26 ++++++++++++--
 taichi/backends/opengl/opengl_utils.cpp            | 35 ++++++++++++++++++
 taichi/backends/opengl/opengl_utils.h              | 12 +++++++
 taichi/program/aot_module_builder.cpp              | 10 ------
 taichi/program/aot_module_builder.h                |  7 ----
 taichi/program/callable.cpp                        |  9 ++++-
 taichi/program/callable.h                          | 21 ++++++++---
 taichi/python/export_lang.cpp                      |  7 +++-
 tests/python/test_aot.py                           |  6 ----
 15 files changed, 121 insertions(+), 129 deletions(-)
863945a0d [ci] Run code format check for doc-only changes as well. (#3665)
 .github/workflows/testing.yml | 9 ---------
 1 file changed, 9 deletions(-)
44ebbf12f [refactor] Ignore filename prefix in opengl aot files. (#3648)
 taichi/backends/opengl/aot_module_builder_impl.cpp | 18 ++++++++----------
 tests/python/test_aot.py                           | 18 ++++++------------
 2 files changed, 14 insertions(+), 22 deletions(-)
fcf781137 [refactor] Move GUI from misc to ui.
 python/taichi/__init__.py      |   2 +-
 python/taichi/misc/__init__.py |   1 -
 python/taichi/misc/gui.py      | 871 ----------------------------------------
 python/taichi/ui/__init__.py   |   2 +
 python/taichi/ui/gui.py        | 893 ++++++++++++++++++++++++++++++++++++++---
 python/taichi/ui/imgui.py      |  91 +++++
 python/taichi/ui/ui.py         |   2 +-
 python/taichi/ui/window.py     |   2 +-
 8 files changed, 933 insertions(+), 931 deletions(-)
9e3f9f54f [refactor] Get rid of tools/messenger.py.
 python/taichi/tools/messenger.py | 81 ----------------------------------------
 1 file changed, 81 deletions(-)
b38930285 [refactor] Get rid of ti.task.
 python/taichi/core/util.py     |  7 -------
 python/taichi/main.py          | 20 --------------------
 python/taichi/misc/__init__.py |  1 -
 python/taichi/misc/task.py     | 36 ------------------------------------
 tests/python/test_cli.py       |  9 ---------
 5 files changed, 73 deletions(-)
f275e0993 [refactor] Remove primitive_types module in top level package.
 python/taichi/__init__.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)
c5a572908 [bug] Correctly support serializing maps & vectors to json.
 python/taichi/aot/module.py   |   4 +-
 taichi/common/serialization.h | 157 +++++++++++++++++++-----------------------
 2 files changed, 74 insertions(+), 87 deletions(-)
f8fa316ba [bug][opengl] Only add atomicAdd functions in generated code for arrs when they're used.
 taichi/backends/opengl/codegen_opengl.cpp | 41 ++++++++++++++++++++++++++++++-
 1 file changed, 40 insertions(+), 1 deletion(-)
083aba2ea [refactor] Do not expand to absolute path for saved shaders.
 python/taichi/aot/module.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
6132ebb06 [bug] Revert part of #3569 so that tests are not skipped. (#3620)
 .github/workflows/presubmit.yml | 55 +++++++++++++++++++++++++++++++++++------
 1 file changed, 48 insertions(+), 7 deletions(-)
be9c906b1 [opengl] Serialize ndarrays and ndarray-based kernels in AOT.
 python/taichi/aot/module.py                        | 57 ++++++++++++--
 taichi/backends/opengl/aot_data.h                  | 15 +++-
 taichi/backends/opengl/aot_module_builder_impl.cpp | 65 +++++++++------
 taichi/backends/opengl/aot_module_builder_impl.h   |  6 ++
 taichi/backends/opengl/opengl_api.h                |  5 +-
 taichi/program/aot_module_builder.cpp              | 10 +++
 taichi/program/aot_module_builder.h                | 16 ++++
 taichi/python/export_lang.cpp                      |  1 +
 tests/python/test_aot.py                           | 92 ++++++++++++++++++++++
 9 files changed, 230 insertions(+), 37 deletions(-)
03e71872f [opengl] Support taichi ndarray on opengl backend and enable tests.
 python/taichi/lang/__init__.py                  |  8 ++++
 taichi/backends/opengl/opengl_api.cpp           | 62 ++++++++++++++++---------
 taichi/backends/opengl/opengl_api.h             | 13 ++++--
 taichi/backends/opengl/opengl_kernel_launcher.h |  2 +-
 taichi/backends/opengl/opengl_program.cpp       | 15 +++++-
 taichi/backends/opengl/opengl_program.h         |  5 ++
 taichi/llvm/llvm_program.h                      |  2 +-
 taichi/program/ndarray.cpp                      | 23 ++++++---
 taichi/program/ndarray.h                        | 10 ++++
 taichi/program/program.h                        | 10 ++++
 taichi/program/program_impl.h                   |  8 ++++
 tests/python/test_aot.py                        |  6 ---
 tests/python/test_ast_refactor.py               |  3 +-
 tests/python/test_get_external_tensor_shape.py  |  3 +-
 tests/python/test_mpm88.py                      |  3 +-
 tests/python/test_ndarray.py                    | 58 ++++++++++++++++-------
 tests/python/test_type_check.py                 |  3 +-
 17 files changed, 166 insertions(+), 68 deletions(-)
3337cf300 [llvm] Make taichi's Ndarray carry a ptr to its DeviceAllocation.
 chi_examples/main.cpp                        |  9 ++--
 python/taichi/lang/kernel_impl.py            |  9 ++--
 taichi/backends/cuda/codegen_cuda.cpp        | 74 +++++++++++++++++++---------
 taichi/codegen/codegen_llvm.cpp              | 17 ++++++-
 taichi/program/context.h                     | 10 ++++
 taichi/program/kernel.cpp                    |  9 ++--
 taichi/program/kernel.h                      |  5 +-
 taichi/program/ndarray.cpp                   |  8 +++
 taichi/program/ndarray.h                     |  1 +
 taichi/program/ndarray_rw_accessors_bank.cpp | 24 ++++++---
 taichi/python/export_lang.cpp                |  1 +
 tests/cpp/ir/ir_builder_test.cpp             |  3 +-
 12 files changed, 126 insertions(+), 44 deletions(-)
9c8f0eb9d [bug] Fix missing tests/ folder in postsubmit & release workflows. (#3583)
 .github/workflows/postsubmit.yml | 3 +++
 .github/workflows/release.yml    | 1 +
 2 files changed, 4 insertions(+)
42bf407ae [refactor] Avoid copying examples/ folder when building taichi.
 .github/workflows/postsubmit.yml                                    | 4 ++--
 .github/workflows/presubmit.yml                                     | 4 ++--
 .github/workflows/release.yml                                       | 6 +++---
 .github/workflows/scripts/unix_test.sh                              | 2 +-
 {examples/chi_examples => chi_examples}/CMakeLists.txt              | 0
 {examples/chi_examples => chi_examples}/README.md                   | 0
 {examples/chi_examples => chi_examples}/main.cpp                    | 0
 python/.gitignore                                                   | 1 -
 {examples => python/taichi/examples}/algorithm/laplace.py           | 0
 {examples => python/taichi/examples}/algorithm/marching_squares.py  | 0
 {examples => python/taichi/examples}/algorithm/mciso_advanced.py    | 0
 {examples => python/taichi/examples}/algorithm/mgpcg.py             | 0
 {examples => python/taichi/examples}/algorithm/mgpcg_advanced.py    | 0
 {examples => python/taichi/examples}/algorithm/print_offset.py      | 0
 {examples => python/taichi/examples}/autodiff/minimization.py       | 0
 {examples => python/taichi/examples}/autodiff/regression.py         | 0
 {examples => python/taichi/examples}/autodiff/simple_derivative.py  | 0
 {examples => python/taichi/examples}/features/gui/fullscreen.py     | 0
 {examples => python/taichi/examples}/features/gui/gui_image_io.py   | 0
 {examples => python/taichi/examples}/features/gui/gui_widgets.py    | 0
 {examples => python/taichi/examples}/features/gui/keyboard.py       | 0
 {examples => python/taichi/examples}/features/io/export_mesh.py     | 0
 {examples => python/taichi/examples}/features/io/export_ply.py      | 0
 {examples => python/taichi/examples}/features/io/export_videos.py   | 0
 .../taichi/examples}/features/sparse/explicit_activation.py         | 0
 .../taichi/examples}/features/sparse/taichi_bitmasked.py            | 0
 .../taichi/examples}/features/sparse/taichi_dynamic.py              | 0
 .../taichi/examples}/features/sparse/taichi_sparse.py               | 0
 {examples => python/taichi/examples}/features/sparse/tutorial.py    | 0
 {examples => python/taichi/examples}/ggui_examples/fem128_ggui.py   | 0
 .../taichi/examples}/ggui_examples/fractal3d_ggui.py                | 0
 .../taichi/examples}/ggui_examples/mass_spring_3d_ggui.py           | 0
 .../taichi/examples}/ggui_examples/mass_spring_game_ggui.py         | 0
 {examples => python/taichi/examples}/ggui_examples/mpm128_ggui.py   | 0
 {examples => python/taichi/examples}/ggui_examples/mpm3d_ggui.py    | 0
 .../taichi/examples}/ggui_examples/stable_fluid_ggui.py             | 0
 {examples => python/taichi/examples}/minimal.py                     | 0
 {examples => python/taichi/examples}/rendering/cornell_box.py       | 0
 {examples => python/taichi/examples}/rendering/rasterizer.py        | 0
 {examples => python/taichi/examples}/rendering/sdf_renderer.py      | 0
 {examples => python/taichi/examples}/rendering/simple_uv.py         | 0
 {examples => python/taichi/examples}/rendering/taichi_logo.py       | 0
 {examples => python/taichi/examples}/simulation/ad_gravity.py       | 0
 {examples => python/taichi/examples}/simulation/comet.py            | 0
 {examples => python/taichi/examples}/simulation/euler.py            | 0
 {examples => python/taichi/examples}/simulation/fem128.py           | 0
 {examples => python/taichi/examples}/simulation/fem99.py            | 0
 {examples => python/taichi/examples}/simulation/fractal.py          | 0
 {examples => python/taichi/examples}/simulation/game_of_life.py     | 0
 .../taichi/examples}/simulation/implicit_mass_spring.py             | 0
 .../taichi/examples}/simulation/inital_value_problem.py             | 0
 {examples => python/taichi/examples}/simulation/mass_spring_game.py | 0
 {examples => python/taichi/examples}/simulation/mpm128.py           | 0
 {examples => python/taichi/examples}/simulation/mpm3d.py            | 0
 {examples => python/taichi/examples}/simulation/mpm88.py            | 0
 {examples => python/taichi/examples}/simulation/mpm99.py            | 0
 .../taichi/examples}/simulation/mpm_lagrangian_forces.py            | 0
 {examples => python/taichi/examples}/simulation/nbody.py            | 0
 {examples => python/taichi/examples}/simulation/odop_solar.py       | 0
 {examples => python/taichi/examples}/simulation/pbf2d.py            | 0
 {examples => python/taichi/examples}/simulation/physarum.py         | 0
 {examples => python/taichi/examples}/simulation/stable_fluid.py     | 0
 {examples => python/taichi/examples}/simulation/vortex_rings.py     | 0
 {examples => python/taichi/examples}/simulation/waterwave.py        | 0
 python/taichi/main.py                                               | 5 +----
 setup.py                                                            | 5 +----
 66 files changed, 10 insertions(+), 17 deletions(-)
20be5077d [Test] Remove ti test from taichi package.
 .github/workflows/postsubmit.yml                   |   4 +-
 .github/workflows/presubmit.yml                    |   6 +-
 .github/workflows/release.yml                      |   6 +-
 .github/workflows/scripts/unix_docker_test.sh      |   6 +-
 .github/workflows/scripts/unix_test.sh             |   8 +-
 MANIFEST.in                                        |   3 -
 ci/scripts/ubuntu_build_test.sh                    |   4 +-
 ci/scripts/ubuntu_build_test_cpu.sh                |   4 +-
 .../articles/contribution/contributor_guide.md     |  26 +--
 docs/lang/articles/contribution/dev_install.md     |   6 +-
 docs/lang/articles/contribution/utilities.md       |   4 +-
 docs/lang/articles/contribution/write_test.md      |   2 +-
 docs/lang/articles/misc/global_settings.md         |   2 +-
 python/taichi/main.py                              | 214 +-------------------
 python/taichi/testing.py                           |   4 +-
 setup.py                                           |   5 -
 tests/python/test_cli.py                           |  21 --
 tests/run_tests.py                                 | 223 +++++++++++++++++++++
 18 files changed, 268 insertions(+), 280 deletions(-)
26c805bf6 [lang] Limit torch based ndarray to cpu/cuda backend. (#3545)
 python/taichi/lang/kernel_impl.py              |  8 ++++++
 tests/python/test_aot.py                       |  6 ++++
 tests/python/test_ast_refactor.py              |  3 +-
 tests/python/test_get_external_tensor_shape.py |  3 +-
 tests/python/test_mpm88.py                     |  3 +-
 tests/python/test_ndarray.py                   | 38 +++++++++++++++++++-------
 tests/python/test_type_check.py                |  1 +
 7 files changed, 49 insertions(+), 13 deletions(-)
21f581ece [opengl] Use separate ssbo for external arrays.
 taichi/backends/opengl/codegen_opengl.cpp   |  80 +++++++++++++---------
 taichi/backends/opengl/opengl_api.cpp       | 101 ++++++++++++++--------------
 taichi/backends/opengl/opengl_api.h         |   1 +
 taichi/backends/opengl/opengl_kernel_util.h |   4 ++
 tests/python/test_aot.py                    |  64 ++++++++++++++++++
 5 files changed, 169 insertions(+), 81 deletions(-)
106070555 [refactor] Rename Context to RuntimeContext.
 taichi/backends/cc/cc_kernel.h            |  2 +-
 taichi/backends/cc/cc_program.cpp         |  6 +-
 taichi/backends/cc/cc_program.h           |  2 +-
 taichi/backends/cpu/codegen_cpu.cpp       |  2 +-
 taichi/backends/cuda/codegen_cuda.cpp     |  6 +-
 taichi/backends/metal/codegen_metal.cpp   |  3 +-
 taichi/backends/metal/kernel_manager.cpp  | 12 ++--
 taichi/backends/metal/kernel_manager.h    |  4 +-
 taichi/backends/metal/kernel_utils.cpp    |  2 +-
 taichi/backends/opengl/opengl_api.cpp     |  3 +-
 taichi/backends/opengl/opengl_api.h       |  2 +-
 taichi/backends/opengl/opengl_program.cpp |  4 +-
 taichi/backends/vulkan/codegen_vulkan.cpp |  2 +-
 taichi/backends/vulkan/kernel_utils.cpp   |  2 +-
 taichi/backends/vulkan/runtime.cpp        |  8 +--
 taichi/backends/vulkan/runtime.h          |  2 +-
 taichi/backends/wasm/codegen_wasm.cpp     |  2 +-
 taichi/codegen/codegen_llvm.cpp           | 18 +++---
 taichi/codegen/codegen_llvm.h             |  2 +-
 taichi/lang_util.h                        |  4 +-
 taichi/program/async_engine.cpp           |  2 +-
 taichi/program/async_engine.h             |  2 +-
 taichi/program/async_utils.cpp            |  2 +-
 taichi/program/async_utils.h              |  4 +-
 taichi/program/context.h                  |  7 ++-
 taichi/program/kernel.cpp                 |  7 ++-
 taichi/program/kernel.h                   | 11 ++--
 taichi/runtime/llvm/internal_functions.h  | 23 ++++----
 taichi/runtime/llvm/runtime.cpp           | 92 ++++++++++++++++---------------
 29 files changed, 125 insertions(+), 113 deletions(-)
6be60b983 [ci] Minor fix for windows release upload. (#3513)
 .github/workflows/release.yml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
28c450fd4 [docs] Remove ti format in doc. (#3479)
 docs/lang/articles/contribution/contributor_guide.md | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
acd685e98 [opengl] Unify windows path to posix format in python. (#3470)
 python/taichi/aot/module.py                        |  2 ++
 taichi/backends/opengl/aot_module_builder_impl.cpp | 11 ++---------
 tests/python/test_aot.py                           | 13 ++-----------
 3 files changed, 6 insertions(+), 20 deletions(-)
8351adf35 [opengl] Make windows path in saved aot json human readable. (#3460)
 taichi/backends/opengl/aot_module_builder_impl.cpp | 11 +++++++++--
 tests/python/test_aot.py                           | 14 ++++++++++++--
 2 files changed, 21 insertions(+), 4 deletions(-)
6f483b5cf [misc] Temporarily disable clang-tidy check. (#3458)
 .github/workflows/presubmit.yml | 30 ------------------------------
 1 file changed, 30 deletions(-)
b0f6c6781 [misc] Remove regex in TextSerializer. (#3454)
 taichi/common/serialization.h | 110 +++++++++++++++++++++++++++---------------
 tests/python/test_aot.py      |  96 ++++++++++++++++++++++++++++++++++++
 2 files changed, 168 insertions(+), 38 deletions(-)
733f1b423 [misc] Version bump: v0.8.5->v0.8.6. (#3457)
 setup.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
45c6ad483 [misc] Fix python wheel versioning. (#3450)
 CMakeLists.txt | 6 +++---
 setup.py       | 8 ++++++++
 2 files changed, 11 insertions(+), 3 deletions(-)
0c94c1ebe [misc] Version bump: v0.8.4->v0.8.5. (#3447)
 CMakeLists.txt | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
e77e53430 [gui] Show f16 image as f32. (#3433)
 python/taichi/misc/gui.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
3056cbce0 [OpenGL] Add mem_offset_in_parent to serialized file in AOT. (#3418)
 taichi/backends/opengl/aot_data.h                  |  2 ++
 taichi/backends/opengl/aot_module_builder_impl.cpp | 20 ++++++++++++++++-
 taichi/backends/opengl/aot_module_builder_impl.h   |  3 ++-
 taichi/backends/opengl/opengl_kernel_launcher.h    |  2 ++
 taichi/backends/opengl/struct_opengl.cpp           |  3 ++-
 taichi/program/aot_module_builder.cpp              | 26 ++++++++++++++++++++++
 taichi/program/aot_module_builder.h                |  4 ++++
 tests/python/test_aot.py                           | 17 ++++++++++++++
 8 files changed, 74 insertions(+), 3 deletions(-)
0ea71b1e6 [Doc] Update dev install about m1 prebuilt llvm. (#3419)
 docs/lang/articles/contribution/dev_install.md | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)
2ea70070c [opengl] Save opengl aot data in json format. (#3417)
 taichi/backends/opengl/aot_module_builder_impl.cpp | 33 ++++++++++-
 taichi/common/serialization.h                      | 69 +++++++++++++++-------
 tests/python/test_aot.py                           |  7 ++-
 3 files changed, 84 insertions(+), 25 deletions(-)
f665c28c2 [refactor] Remove handling for real types in set_arg_int. (#3388)
 taichi/program/kernel.cpp | 4 ----
 1 file changed, 4 deletions(-)
6682b9d39 [Lang] fp16 interacts with pytorch.
 python/taichi/lang/util.py | 22 ++++++++++------------
 tests/python/test_f16.py   | 40 ++++++++++++++++++++++++++++++++++++++++
 2 files changed, 50 insertions(+), 12 deletions(-)
81ba750ca [llvm] Basic f16 support
 python/taichi/lang/__init__.py        |   2 +-
 python/taichi/lang/impl.py            |   7 +-
 python/taichi/lang/util.py            |   4 +
 python/taichi/type/primitive_types.py |   7 +-
 taichi/backends/cuda/codegen_cuda.cpp |  16 ++-
 taichi/codegen/codegen_llvm.cpp       | 251 +++++++++++++++++++++++-----------
 taichi/ir/type_utils.cpp              |   5 +
 taichi/llvm/llvm_context.cpp          |   4 +
 taichi/program/kernel.cpp             |   6 +
 tests/cpp/ir/type_test.cpp            |   3 +
 tests/python/test_f16.py              | 180 ++++++++++++++++++++++++
 11 files changed, 400 insertions(+), 85 deletions(-)
470e47dcc [opengl] Only run preprocess_kernels when glslc is available. (#3341)
 python/taichi/aot/module.py | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)
31a64b8c9 [opengl] Expose allow_nv_shader_extension in compileconfig. (#3340)
 taichi/backends/opengl/aot_module_builder_impl.cpp | 13 ++++++-------
 taichi/backends/opengl/aot_module_builder_impl.h   |  4 +++-
 taichi/backends/opengl/opengl_program.cpp          |  5 ++---
 taichi/program/compile_config.cpp                  |  3 +++
 taichi/program/compile_config.h                    |  3 +++
 taichi/python/export_lang.cpp                      |  4 +++-
 6 files changed, 20 insertions(+), 12 deletions(-)
0a3ecf352 [ci] Update windows postsubmit job timeout to 90mins. (#3336)
 .github/workflows/postsubmit.yml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
c412184ca [docs] Only preview english doc. (#3338)
 docs/lang/articles/get-started.md | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)
ae55905ca [OpenGl] Support preprocessing glsl code in aot.
 python/taichi/aot/module.py                        | 24 +++++++++++
 taichi/backends/opengl/aot_module_builder_impl.cpp | 49 ++++++++++++++++++++++
 taichi/backends/opengl/aot_module_builder_impl.h   |  4 ++
 taichi/program/aot_module_builder.h                |  3 ++
 taichi/python/export_lang.cpp                      |  1 +
 tests/python/test_aot.py                           |  9 ++++
 6 files changed, 90 insertions(+)
5632d9482 [OpenGl] Set result_buffer for opengl aot.
 taichi/backends/opengl/opengl_program.cpp |  2 +-
 tests/python/test_aot.py                  | 16 ++++++++++++++++
 2 files changed, 17 insertions(+), 1 deletion(-)
37365e6fc [Doc] Update dev install about m1. (#3321)
 docs/lang/articles/contribution/dev_install.md | 13 ++++++++++++-
 docs/lang/articles/get-started.md              |  3 +--
 2 files changed, 13 insertions(+), 3 deletions(-)
a27036ff1 [OpenGl] Merge Retr SSBO into Args. (#3313)
 taichi/backends/opengl/codegen_opengl.cpp   | 14 ++++-----
 taichi/backends/opengl/opengl_api.cpp       | 48 +++++++++++++----------------
 taichi/backends/opengl/opengl_kernel_util.h | 12 +++++---
 3 files changed, 36 insertions(+), 38 deletions(-)
60458ba30 [opengl] Remove extra semicolon in glsl generated code. (#3309)
 taichi/backends/opengl/codegen_opengl.cpp | 22 +++++++++++-----------
 1 file changed, 11 insertions(+), 11 deletions(-)
e7f89e91b Merge GLBufId::Extr into Args. (#3306)
 taichi/backends/opengl/codegen_opengl.cpp   | 25 ++-------------
 taichi/backends/opengl/opengl_api.cpp       | 50 ++++++++++++++++-------------
 taichi/backends/opengl/opengl_api.h         |  1 -
 taichi/backends/opengl/opengl_kernel_util.h |  5 +--
 4 files changed, 30 insertions(+), 51 deletions(-)
14142b113 [opengl] Fix typo in printing glsl kernel. (#3308)
 taichi/backends/opengl/opengl_api.cpp | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
cfc4065d3 [bug] Fix silent int overflow in indice calculation. (#3177)
 taichi/backends/metal/struct_metal.cpp         | 10 +++++++++-
 taichi/backends/opengl/struct_opengl.cpp       |  2 +-
 taichi/ir/snode.cpp                            | 12 ++++++++++--
 taichi/transforms/demote_dense_struct_fors.cpp |  2 +-
 taichi/ui/common/field_info.cpp                |  2 +-
 5 files changed, 22 insertions(+), 6 deletions(-)
fcd5a8808 [ci] Fix ti testing with no supported arch. (#3236)
 python/taichi/testing.py | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)
6538f3413 [refactor] Get rid of unnecessary snodes map. (#3234)
 taichi/backends/cc/cc_program.cpp         |  1 -
 taichi/backends/cc/cc_program.h           |  1 -
 taichi/backends/metal/metal_program.cpp   |  1 -
 taichi/backends/metal/metal_program.h     |  1 -
 taichi/backends/opengl/opengl_program.cpp |  1 -
 taichi/backends/opengl/opengl_program.h   |  1 -
 taichi/backends/vulkan/vulkan_program.cpp |  1 -
 taichi/backends/vulkan/vulkan_program.h   |  1 -
 taichi/llvm/llvm_program.cpp              | 18 +++++++-----------
 taichi/llvm/llvm_program.h                |  1 -
 taichi/program/async_engine.cpp           |  3 +--
 taichi/program/async_engine.h             |  1 -
 taichi/program/program.cpp                |  4 ++--
 taichi/program/program.h                  |  3 ---
 taichi/program/program_impl.h             |  1 -
 taichi/program/state_flow_graph.cpp       |  7 +------
 taichi/program/state_flow_graph.h         |  3 +--
 17 files changed, 12 insertions(+), 37 deletions(-)
801f7bd5e [ci] Move pytest/pylint out of runtime dep. (#3169)
 python/taichi/main.py    | 4 ++--
 python/taichi/testing.py | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)
d17087560 [ci] Move code_format.py out of taichi package. (#3171)
 .github/workflows/presubmit.yml        |  2 +-
 {python/taichi => misc}/code_format.py |  2 +-
 python/taichi/main.py                  | 22 ++--------------------
 tests/python/test_cli.py               |  7 -------
 4 files changed, 4 insertions(+), 29 deletions(-)
36fb11f7e [ci] Get rid of requirements_lint.txt. (#3161)
 .github/workflows/presubmit.yml | 12 ++++++------
 requirements_dev.txt            |  1 +
 requirements_lint.txt           |  5 -----
 3 files changed, 7 insertions(+), 11 deletions(-)
764fc9041 [ci] Enable macos 10.14 in release.yml wip. (#3158)
 .github/workflows/release.yml | 68 ++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 67 insertions(+), 1 deletion(-)
bf06f0b5a [misc] Fix build on macos 10.14. (#3155)
 taichi/backends/metal/aot_module_builder_impl.cpp | 24 +++++++++++------------
 taichi/backends/metal/aot_module_builder_impl.h   |  3 +--
 taichi/backends/wasm/aot_module_builder_impl.cpp  |  6 ++----
 taichi/system/std_filesystem.h                    |  9 ---------
 taichi/transforms/whole_kernel_cse.cpp            |  3 ++-
 5 files changed, 17 insertions(+), 28 deletions(-)
b471b84e6 Revert "[Bug] Fix argument shadowed when there is a local variable with the same name (#3105)" (#3153)
 python/taichi/lang/ast_builder_utils.py |  1 -
 python/taichi/lang/stmt_builder.py      |  6 ------
 tests/python/test_kernel_arg_errors.py  | 13 -------------
 3 files changed, 20 deletions(-)
c12e0333b [refactor] Get rid of the indirection between KernelCodeGen::compile and KernelCodeGen::codegen.
 taichi/codegen/codegen.cpp   | 5 -----
 taichi/codegen/codegen.h     | 2 --
 taichi/llvm/llvm_program.cpp | 2 +-
 3 files changed, 1 insertion(+), 8 deletions(-)
a4dd16da6 [misc] Enable flushing when printing preprocessed ast.
 python/taichi/lang/ast/transformer.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
0598e7e2c [Bug] Throw proper error message when creating more than 32 snode trees in LLVM backend.
 taichi/inc/constants.h                      |  2 +-
 taichi/runtime/llvm/runtime.cpp             |  4 ++--
 taichi/system/snode_tree_buffer_manager.cpp |  3 +++
 taichi/system/snode_tree_buffer_manager.h   |  4 ++--
 tests/python/test_fields_builder.py         | 19 +++++++++++++++++++
 5 files changed, 27 insertions(+), 5 deletions(-)
64f6220c6 [Autodiff] Throw proper error message for unsupported ti.random. (#3131)
 taichi/transforms/auto_diff.cpp |  4 ++++
 tests/python/test_ad_basics.py  | 16 ++++++++++++++++
 2 files changed, 20 insertions(+)
ba1c1652d [ci] Fix sparse_solver for pylint. (#3132)
 python/taichi/linalg/sparse_solver.py | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)
435f3c004 [refactor] Enable pylint checking in ci and minor cleanup.
 .github/workflows/presubmit.yml | 12 +++++++++++-
 python/taichi/__init__.py       |  3 +--
 python/taichi/core/util.py      | 24 ------------------------
 requirements_lint.txt           |  5 +++++
 4 files changed, 17 insertions(+), 27 deletions(-)
9d58b9e80 [refactor] Move imports to the top level.
 python/taichi/cc_compose.py                    |  3 +--
 python/taichi/core/util.py                     | 17 +++++-------
 python/taichi/lang/__init__.py                 |  5 ++--
 python/taichi/lang/{ndarray.py => _ndarray.py} |  0
 python/taichi/lang/field.py                    | 24 +++++++----------
 python/taichi/lang/impl.py                     |  2 +-
 python/taichi/lang/kernel_arguments.py         | 12 +++++----
 python/taichi/lang/kernel_impl.py              | 23 +++++++---------
 python/taichi/lang/matrix.py                   | 15 +++++------
 python/taichi/lang/snode.py                    |  6 ++---
 python/taichi/main.py                          | 36 ++++++++++++--------------
 python/taichi/misc/gui.py                      | 28 ++++++++------------
 python/taichi/misc/image.py                    |  8 +++---
 python/taichi/tools/video.py                   |  6 ++---
 requirements_dev.txt                           |  1 +
 15 files changed, 82 insertions(+), 104 deletions(-)
c5358a0d4 [ci] Add back fixes for github actions windows image upgrade. (#3117)
 .github/workflows/postsubmit.yml       | 8 +++-----
 .github/workflows/scripts/unix_test.sh | 4 ++--
 2 files changed, 5 insertions(+), 7 deletions(-)
4d9fc56d2 [doc] Update dev install about develop/install. (#3113)
 docs/lang/articles/contribution/dev_install.md | 9 +++++++++
 1 file changed, 9 insertions(+)
a04eda5df [refactor] Make ext_arr/any_arr/template to taichi.type.annotations.
 python/taichi/aot/module.py            |  7 +--
 python/taichi/lang/__init__.py         |  4 +-
 python/taichi/lang/kernel_arguments.py | 86 ----------------------------------
 python/taichi/lang/kernel_impl.py      |  5 +-
 python/taichi/lang/meta.py             |  2 +-
 python/taichi/torch_io.py              |  2 +-
 python/taichi/type/__init__.py         |  1 +
 python/taichi/type/annotations.py      | 86 ++++++++++++++++++++++++++++++++++
 python/taichi/ui/canvas.py             |  2 +-
 python/taichi/ui/gui.py                |  2 +-
 python/taichi/ui/scene.py              |  2 +-
 python/taichi/ui/staging_buffer.py     |  2 +-
 python/taichi/ui/ui.py                 |  2 +-
 python/taichi/ui/utils.py              |  2 +-
 python/taichi/ui/window.py             |  2 +-
 15 files changed, 104 insertions(+), 103 deletions(-)
4e4819f14 [refactor] Make type annotations simple, remove dep on high level data structures.
 python/taichi/lang/kernel_arguments.py | 42 +-----------------------
 python/taichi/lang/kernel_impl.py      | 58 ++++++++++++++++++++++++++++++----
 2 files changed, 52 insertions(+), 48 deletions(-)
122abcd56 [refactor] Work around some cyclic imports.
 python/taichi/lang/__init__.py               | 39 ++++++++++++----------------
 python/taichi/lang/{random.py => _random.py} |  4 ++-
 python/taichi/lang/ast/checkers.py           |  7 +++--
 python/taichi/lang/ast/transformer.py        |  6 ++---
 python/taichi/lang/ast_builder_utils.py      |  2 +-
 python/taichi/lang/expr.py                   |  2 +-
 python/taichi/lang/field.py                  |  4 +--
 python/taichi/lang/kernel_arguments.py       |  2 +-
 python/taichi/lang/kernel_impl.py            |  8 +++---
 python/taichi/lang/linalg.py                 | 15 ++++++-----
 python/taichi/lang/matrix.py                 |  4 +--
 python/taichi/lang/ndarray.py                |  7 ++---
 python/taichi/lang/sparse_solver.py          |  8 +++---
 python/taichi/lang/stmt_builder.py           |  2 +-
 python/taichi/lang/types.py                  | 10 +++----
 15 files changed, 58 insertions(+), 62 deletions(-)
4fbe06061 [refactor] Remove importing outside top level.
 python/taichi/ad.py                 |  4 +++-
 python/taichi/diagnose.py           | 14 +++++++-------
 python/taichi/lang/shell.py         | 11 +++++------
 python/taichi/lang/sparse_matrix.py |  9 +++++----
 python/taichi/main.py               | 23 ++++-------------------
 python/taichi/misc/util.py          |  9 +++------
 python/taichi/testing.py            | 11 +++++------
 7 files changed, 32 insertions(+), 49 deletions(-)
3535c6487 [refactor] Stop overriding taichi.core from taichi/lang/impl.py.
 python/taichi/__init__.py      |  5 ++++-
 python/taichi/core/__init__.py |  4 ----
 python/taichi/lang/__init__.py |  3 ---
 python/taichi/lang/impl.py     | 17 +++++++++--------
 4 files changed, 13 insertions(+), 16 deletions(-)
684689f1b [ci] Copy paste linux & windows fixes from presubmit to release. (#3103)
 .github/workflows/release.yml | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)
f815bd9ce [Test] Allow `ti test` work with `-a cpu, cuda`. (#3066)
 python/taichi/lang/__init__.py       | 33 +++++++++++++++++++--------------
 python/taichi/testing.py             |  2 ++
 tests/python/test_customized_grad.py |  4 ++--
 3 files changed, 23 insertions(+), 16 deletions(-)
21ea0fee9 [refactor] Get rid of settings.py.
 misc/generate_ir_design_doc.py |  4 +-
 python/taichi/core/__init__.py |  1 -
 python/taichi/core/settings.py | 87 ------------------------------------------
 python/taichi/core/util.py     | 34 ++++++++++++-----
 python/taichi/lang/meta.py     |  4 +-
 python/taichi/main.py          | 41 +-------------------
 python/taichi/tools/video.py   |  2 +-
 7 files changed, 31 insertions(+), 142 deletions(-)
641a02074 [refactor] Get rid of build and load_module.
 python/taichi/core/__init__.py |  3 ---
 python/taichi/core/util.py     | 47 ------------------------------------------
 python/taichi/main.py          | 24 ---------------------
 3 files changed, 74 deletions(-)
79bb8ebbc [refactor] Move primitive_types.py to type folder.
 python/taichi/core/__init__.py                  |  5 +++-
 python/taichi/lang/kernel_arguments.py          |  2 +-
 python/taichi/lang/kernel_impl.py               |  2 +-
 python/taichi/type/__init__.py                  |  1 +
 python/taichi/{core => type}/primitive_types.py | 34 ++++++++++++-------------
 python/taichi/ui/scene.py                       |  2 +-
 python/taichi/ui/staging_buffer.py              |  2 +-
 python/taichi/ui/utils.py                       |  2 +-
 8 files changed, 27 insertions(+), 23 deletions(-)
72413ff84 [refactor] Move record.py out of ti.core.
 docs/lang/articles/misc/export_kernels.md |  2 +-
 misc/demo_record_kernel_group.py          |  4 ++--
 python/taichi/aot/__init__.py             |  1 +
 python/taichi/{core => aot}/record.py     |  8 ++++----
 python/taichi/core/__init__.py            |  1 -
 tests/python/test_aot.py                  | 28 ++++++++++++++++++++++++++++
 6 files changed, 36 insertions(+), 8 deletions(-)
64fb3457e [refactor] Move logging out of ti.core.
 python/taichi/__init__.py      |  1 +
 python/taichi/_logging.py      | 50 ++++++++++++++++++++++++++++++++++++++++++
 python/taichi/core/__init__.py |  1 -
 python/taichi/core/logging.py  | 50 ------------------------------------------
 tests/python/test_runtime.py   | 15 +++++++++++++
 5 files changed, 66 insertions(+), 51 deletions(-)
45191664a [ci] Try moving all torch tests to single thread.
 .github/workflows/presubmit.yml | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
4e298c170 [ci] Extend windows timeout. (#3068)
 .github/workflows/presubmit.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
c68babd45 [ci] Try fixing windows. (#3064)
 .github/workflows/presubmit.yml | 8 +++-----
 1 file changed, 3 insertions(+), 5 deletions(-)
ae08ddcf0 [Doc][autodiff] Add a section about customized gradient in autodiff. (#3054)
 .../advanced/differentiable_programming.md         | 65 ++++++++++++++++++++--
 ..._complex_kernels.py => test_customized_grad.py} |  0
 2 files changed, 59 insertions(+), 6 deletions(-)
3680e3411 [Autodiff] Rename complex_kernel and complex_kernel_grad. (#3035)
 python/taichi/__init__.py            |   9 ++-
 python/taichi/ad.py                  |  72 +++++++++++++++++++++
 python/taichi/lang/__init__.py       |  70 +-------------------
 python/taichi/lang/impl.py           |   2 +-
 python/taichi/lang/kernel_impl.py    |   2 +-
 python/taichi/lang/tape.py           |   2 +-
 tests/python/test_complex_kernels.py | 121 +++++++++++++++++++++++++++++------
 7 files changed, 186 insertions(+), 92 deletions(-)
a8c2ba53e [Doc] Update differentiable programming doc. (#2993)
 .../advanced/differentiable_programming.md         | 306 +++++++++++++++------
 examples/simulation/ad_gravity.py                  |  11 +-
 2 files changed, 226 insertions(+), 91 deletions(-)
3273881b8 [ci] Disable fail-fast matrix on release jobs. (#2982)
 .github/workflows/release.yml | 4 ++++
 1 file changed, 4 insertions(+)
9a2f1546d [misc] Remove unnecessary symlink step. (#2976)
 python/taichi/core/util.py | 6 ------
 1 file changed, 6 deletions(-)
474e44762 [ci] Releases must be done on buildbot-ubuntu machine. (#2977)
 .github/workflows/release.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
199f4c97b [ci] Fix OOM on nightly release. (#2975)
 .github/workflows/release.yml | 16 +++++++---------
 1 file changed, 7 insertions(+), 9 deletions(-)
ce8758097 [misc] Support clean command to setup.py.
 setup.cfg |  2 +-
 setup.py  | 35 +++++++++++++++++++++++++++++++++--
 2 files changed, 34 insertions(+), 3 deletions(-)
57e84de41 [misc] Fix some build warnings.
 taichi/backends/device.cpp               | 2 +-
 taichi/backends/metal/kernel_manager.cpp | 1 -
 2 files changed, 1 insertion(+), 2 deletions(-)
fab7c2814 [misc] Throw proper error if real function is not properly annotated. (#2943)
 python/taichi/lang/kernel_impl.py |  7 +++++++
 python/taichi/tools/patterns.py   |  7 +------
 tests/python/test_function.py     | 27 +++++++++++++++++++++++++++
 3 files changed, 35 insertions(+), 6 deletions(-)
a30850a6c Disable a few vulkan flaky tests. (#2926)
 tests/python/test_ad_basics.py           | 1 +
 tests/python/test_clear_all_gradients.py | 2 +-
 tests/python/test_element_wise.py        | 4 ++--
 tests/python/test_mpm88.py               | 2 +-
 tests/python/test_struct.py              | 2 +-
 5 files changed, 6 insertions(+), 5 deletions(-)
bb4886f71 [llvm] Remove duplicated set dim attribute for GlobalVariableExpression (#2929)
 taichi/backends/metal/metal_program.cpp   | 1 -
 taichi/backends/metal/metal_program.h     | 1 -
 taichi/backends/opengl/opengl_program.cpp | 1 -
 taichi/backends/opengl/opengl_program.h   | 1 -
 taichi/backends/vulkan/vulkan_program.cpp | 1 -
 taichi/backends/vulkan/vulkan_program.h   | 1 -
 taichi/llvm/llvm_program.cpp              | 8 --------
 taichi/llvm/llvm_program.h                | 7 -------
 taichi/program/program.cpp                | 5 +++--
 taichi/program/program_impl.h             | 1 -
 10 files changed, 3 insertions(+), 24 deletions(-)
fbdb8dcfc [ci] Enable tmate session if release test fails. (#2919)
 .github/workflows/release.yml | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)
538dceefd Enable deploy preview if changes are detected in docs. (#2913)
 netlify.toml | 8 ++++++++
 1 file changed, 8 insertions(+)
4f7843faa [refactor] Unify llvm_program_ and metal_program_ in Program class.
 taichi/program/kernel.cpp     |  9 ++++---
 taichi/program/program.cpp    | 62 +++++++++++++++++++------------------------
 taichi/program/program.h      | 19 ++++++++++---
 taichi/program/program_impl.h | 16 +++++++++++
 4 files changed, 66 insertions(+), 40 deletions(-)
0ffb94df7 [refactor] Let LlvmProgramImpl inherit ProgramImpl.
 taichi/backends/metal/metal_program.cpp | 43 +++++++++++++++----------
 taichi/backends/metal/metal_program.h   | 20 ++++++++----
 taichi/llvm/llvm_program.cpp            | 57 ++++++++++++++++-----------------
 taichi/llvm/llvm_program.h              | 24 ++++++++------
 taichi/program/program.cpp              | 10 ++++--
 taichi/program/program_impl.h           | 23 +++++++++----
 taichi/struct/struct_llvm.cpp           |  2 +-
 7 files changed, 105 insertions(+), 74 deletions(-)
3a76eee4d [refactor] Init ProgramImpl from MetalProgramImpl.
 taichi/backends/metal/metal_program.cpp |  7 +++---
 taichi/backends/metal/metal_program.h   | 16 ++++++++------
 taichi/program/program_impl.cpp         | 10 +++++++++
 taichi/program/program_impl.h           | 39 +++++++++++++++++++++++++++++++++
 4 files changed, 62 insertions(+), 10 deletions(-)
f141f8a98 [refactor] Get rid of some unnecessary get_current_program().
 taichi/backends/cuda/cuda_context.cpp |  2 +-
 taichi/backends/cuda/cuda_context.h   |  5 +++
 taichi/ir/frontend.cpp                | 30 -------------
 taichi/ir/frontend.h                  | 82 -----------------------------------
 taichi/llvm/llvm_program.cpp          |  1 +
 taichi/program/state_flow_graph.cpp   | 11 -----
 taichi/python/export_lang.cpp         | 13 ++++--
 7 files changed, 17 insertions(+), 127 deletions(-)
2dbfaf5d0 [ci] Enable CI on pushing to master. (#2865)
 .github/workflows/presubmit.yml | 4 ++++
 1 file changed, 4 insertions(+)
534562726 [ci] No need to specify arch on M1 CI. (#2845)
 .github/workflows/presubmit.yml        | 20 ++++++++++++--------
 tests/python/test_mpm_particle_list.py |  2 ++
 tests/python/test_sfg.py               |  2 ++
 3 files changed, 16 insertions(+), 8 deletions(-)
e203f0ce2 [ci] Enable verbose on M1 CI to collect more info on hanging jobs. (#2844)
 .github/workflows/presubmit.yml | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)
923040a22 [refactor] Move FrontendContext from global into Callable class.
 taichi/ir/frontend.h          |  4 +++-
 taichi/ir/frontend_ir.cpp     |  9 ++++++---
 taichi/ir/frontend_ir.h       |  7 +------
 taichi/program/callable.h     |  2 ++
 taichi/program/function.cpp   |  9 ++-------
 taichi/program/function.h     |  2 ++
 taichi/program/kernel.cpp     | 10 ++--------
 taichi/program/program.h      | 19 -------------------
 taichi/python/export_lang.cpp |  5 ++++-
 9 files changed, 22 insertions(+), 45 deletions(-)
d8a780075 [refactor] Decouple AsyncEngine with Program.
 taichi/program/async_engine.cpp     | 32 +++++++++++++++-----------------
 taichi/program/async_engine.h       |  5 +++--
 taichi/program/program.cpp          |  2 +-
 taichi/program/state_flow_graph.cpp | 16 +++++++++-------
 taichi/program/state_flow_graph.h   |  7 +++++--
 5 files changed, 33 insertions(+), 29 deletions(-)
fe397f103 [refactor] Decouple MemoryPool with Program.
 taichi/program/program.cpp    | 19 ++++++++-----------
 taichi/system/memory_pool.cpp | 14 ++++++--------
 taichi/system/memory_pool.h   |  7 ++-----
 3 files changed, 16 insertions(+), 24 deletions(-)
ab90995f1 [refactor] Decouple opengl codegen compile with Program.
 taichi/backends/opengl/codegen_opengl.cpp       | 11 ++++-------
 taichi/backends/opengl/codegen_opengl.h         |  3 +--
 taichi/backends/opengl/opengl_kernel_launcher.h |  1 +
 taichi/backends/opengl/struct_opengl.cpp        |  1 +
 taichi/program/program.cpp                      |  2 +-
 5 files changed, 8 insertions(+), 10 deletions(-)
9effb1f1b [refactor] Unify compile() for LlvmProgramImpl and MetalProgramImpl.
 taichi/backends/metal/metal_program.cpp |  8 +++++---
 taichi/backends/metal/metal_program.h   |  3 +--
 taichi/llvm/llvm_program.cpp            | 11 +++++++++++
 taichi/llvm/llvm_program.h              |  2 ++
 taichi/program/program.cpp              | 23 ++++++-----------------
 taichi/program/program.h                |  8 +++-----
 6 files changed, 28 insertions(+), 27 deletions(-)
9dffd066c [refactor] Initial MetalProgramImpl implementation.
 taichi/backends/metal/metal_program.cpp | 49 +++++++++++++++++++++++++++++++++
 taichi/backends/metal/metal_program.h   | 44 +++++++++++++++++++++++++++++
 taichi/program/program.cpp              | 39 +++++++-------------------
 taichi/program/program.h                |  7 ++---
 4 files changed, 105 insertions(+), 34 deletions(-)
3614096bf [refactor] Minor cleanup in program.cpp.
 taichi/program/program.cpp | 28 ++++++++++++++--------------
 taichi/program/program.h   | 12 ++++++------
 2 files changed, 20 insertions(+), 20 deletions(-)
51301ce64 [Refactor] Move snode_tree_buffer_manager and llvm_runtime to private.
 taichi/llvm/llvm_program.h | 15 +++++++++++++--
 taichi/program/kernel.cpp  |  3 +--
 taichi/program/kernel.h    |  4 ----
 taichi/program/program.cpp |  4 ++--
 4 files changed, 16 insertions(+), 10 deletions(-)
52b933e14 [Refactor] Move llvm_context_host/device to private.
 taichi/backends/cuda/codegen_cuda.cpp         | 3 ++-
 taichi/codegen/codegen_llvm.cpp               | 6 +-----
 taichi/llvm/llvm_program.h                    | 9 ++++-----
 taichi/program/program.cpp                    | 1 -
 tests/cpp/codegen/refine_coordinates_test.cpp | 2 +-
 5 files changed, 8 insertions(+), 13 deletions(-)
c80060114 [Refactor] Further cleanup Program constructor.
 taichi/llvm/llvm_program.cpp | 37 ++++++++++++++++++++++++++++++++++++-
 taichi/llvm/llvm_program.h   |  6 +++++-
 taichi/program/program.cpp   | 41 +++++++++--------------------------------
 3 files changed, 50 insertions(+), 34 deletions(-)
b66d82c25 [Refactor] Move check_runtime_error to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 49 ++++++++++++++++++++++++++++++++++++++++++++
 taichi/llvm/llvm_program.h   |  2 ++
 taichi/program/program.cpp   | 45 ++--------------------------------------
 3 files changed, 53 insertions(+), 43 deletions(-)
cf7dadb56 [Refactor] Simplify synchronize and materialize_runtime in Program.
 taichi/llvm/llvm_program.cpp | 12 +++++-------
 taichi/llvm/llvm_program.h   |  8 ++++----
 taichi/program/program.cpp   | 26 +++++++++++---------------
 taichi/program/program.h     |  3 ---
 4 files changed, 20 insertions(+), 29 deletions(-)
1f96eba6b [Refactor] Move a few helpers in LlvmProgramImpl to private.
 taichi/llvm/llvm_program.cpp                |  2 +
 taichi/llvm/llvm_program.h                  | 62 +++++++++++++++--------------
 taichi/program/program.cpp                  |  2 +-
 taichi/system/snode_tree_buffer_manager.cpp |  5 +--
 4 files changed, 37 insertions(+), 34 deletions(-)
14930645c [Refactor] Cleanup llvm specific apis in program.h
 taichi/backends/cpu/jit_cpu.cpp |  3 ++-
 taichi/codegen/codegen_llvm.cpp |  8 +++++---
 taichi/llvm/llvm_program.h      |  5 +++++
 taichi/program/kernel.cpp       |  2 +-
 taichi/program/program.cpp      |  8 --------
 taichi/program/program.h        | 14 --------------
 6 files changed, 13 insertions(+), 27 deletions(-)
fe83db77b [Refactor] Only prepare sandbox for cc backend. (#2775)
 python/taichi/core/util.py     | 34 +---------------------------------
 python/taichi/lang/__init__.py | 18 ++++++++++++++++++
 taichi/llvm/llvm_context.cpp   | 11 -----------
 taichi/python/export_lang.cpp  |  2 --
 4 files changed, 19 insertions(+), 46 deletions(-)
d70b50119 [Refactor] Add initialize_llvm_runtime_system to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp    | 145 +++++++++++++++++++++++++++++++++++++-
 taichi/llvm/llvm_program.h      |  15 ++++
 taichi/program/program.cpp      | 151 +++-------------------------------------
 taichi/program/program.h        |   5 --
 taichi/runtime/llvm/runtime.cpp |  11 +--
 5 files changed, 173 insertions(+), 154 deletions(-)
d6a3af3ef [Refactor] Add materialize_snode_tree to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp  | 38 ++++++++++++++++++++++++++++++++++++++
 taichi/llvm/llvm_program.h    | 17 ++++++++++++++++-
 taichi/program/program.cpp    | 34 +++-------------------------------
 taichi/program/program.h      |  8 ++------
 taichi/struct/struct.h        |  1 -
 taichi/struct/struct_llvm.cpp |  3 +--
 taichi/struct/struct_llvm.h   |  6 +++---
 7 files changed, 63 insertions(+), 44 deletions(-)
947c7e1f2 [Refactor] Move initialize_llvm_runtime_snodes to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 53 ++++++++++++++++++++++++++++++++++++++
 taichi/llvm/llvm_program.h   | 10 ++++++++
 taichi/program/program.cpp   | 61 ++++++--------------------------------------
 taichi/program/program.h     | 10 +-------
 4 files changed, 72 insertions(+), 62 deletions(-)
23369a6c3 [Refactor] Move clone_struct_compiler_initial_context to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp |  9 +++++++++
 taichi/llvm/llvm_program.h   |  5 +++++
 taichi/program/program.cpp   | 15 ++++-----------
 taichi/program/program.h     |  3 ---
 4 files changed, 18 insertions(+), 14 deletions(-)
6f4026ca6 [Refactor] Move is_cuda_no_unified_memory to CompileConfig.
 taichi/program/compile_config.h |  5 +++++
 taichi/program/program.cpp      | 11 +++--------
 2 files changed, 8 insertions(+), 8 deletions(-)
332c96cf9 [Refactor] Add maybe_initialize_cuda_llvm_context to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 7 +++++++
 taichi/llvm/llvm_program.h   | 2 ++
 taichi/program/program.cpp   | 7 +------
 taichi/program/program.h     | 2 ++
 4 files changed, 12 insertions(+), 6 deletions(-)
f846494c1 [Refactor] Add get_snode_num_dynamically_allocated to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 13 +++++++++++++
 taichi/llvm/llvm_program.h   |  2 ++
 taichi/program/program.cpp   | 10 ++--------
 3 files changed, 17 insertions(+), 8 deletions(-)
5afa96026 [Refactor] Move print_memory_profiler_info to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 72 ++++++++++++++++++++++++++++++++++++++++++++
 taichi/llvm/llvm_program.h   |  4 +++
 taichi/program/program.cpp   | 68 +----------------------------------------
 taichi/program/program.h     |  2 ++
 4 files changed, 79 insertions(+), 67 deletions(-)
85092fe96 [Refactor] Move print_list_manager_info to LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 22 ++++++++++++++++++++++
 taichi/llvm/llvm_program.h   |  2 ++
 taichi/program/program.cpp   | 26 ++------------------------
 taichi/program/program.h     |  2 --
 4 files changed, 26 insertions(+), 26 deletions(-)
55fe600eb [Refactor] Move runtime_query to LlvmProgramImpl.
 taichi/llvm/llvm_program.h | 17 +++++++++++
 taichi/program/program.cpp | 72 ++++++++++++++++++++++++----------------------
 taichi/program/program.h   | 18 ------------
 3 files changed, 54 insertions(+), 53 deletions(-)
e96227d1f [Refactor] Move get_llvm_context to LlvmProgramImpl.
 taichi/llvm/llvm_program.h | 8 ++++++++
 taichi/program/program.h   | 8 +++-----
 2 files changed, 11 insertions(+), 5 deletions(-)
b2fba24d6 [Refactor] Move preallocated_device_buffer into LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp |  2 ++
 taichi/llvm/llvm_program.h   |  2 ++
 taichi/program/program.cpp   | 19 +++++++++----------
 taichi/program/program.h     |  3 +--
 4 files changed, 14 insertions(+), 12 deletions(-)
45af89845 [Refactor] Move thread_pool into LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 1 +
 taichi/llvm/llvm_program.h   | 2 ++
 taichi/program/program.cpp   | 4 +---
 taichi/program/program.h     | 1 -
 4 files changed, 4 insertions(+), 4 deletions(-)
5b9113803 [Refactor] Move runtime_mem_info into LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp | 22 ++++++++++++++++-
 taichi/llvm/llvm_program.h   |  4 ++-
 taichi/program/program.cpp   | 59 +++++++++++++++-----------------------------
 taichi/program/program.h     |  1 -
 4 files changed, 44 insertions(+), 42 deletions(-)
f233cb634 [Refactor] Move llvm_runtime to LlvmProgramImpl.
 taichi/llvm/llvm_program.h |  1 +
 taichi/program/kernel.cpp  |  3 ++-
 taichi/program/program.cpp | 57 ++++++++++++++++++++++++++--------------------
 taichi/program/program.h   |  4 ++--
 4 files changed, 37 insertions(+), 28 deletions(-)
6ddd565b4 [Refactor] Move llvm_context_device to LlvmProgramImpl.
 taichi/backends/cuda/codegen_cuda.cpp |  3 ++-
 taichi/codegen/codegen_llvm.cpp       |  2 +-
 taichi/llvm/llvm_program.h            |  1 +
 taichi/program/program.cpp            | 20 +++++++++++---------
 taichi/program/program.h              |  7 +++----
 5 files changed, 18 insertions(+), 15 deletions(-)
894f569a3 [Refactor] Move llvm_context_host to LlvmProgramImpl.
 taichi/codegen/codegen_llvm.cpp               |  2 +-
 taichi/llvm/llvm_program.cpp                  |  2 ++
 taichi/llvm/llvm_program.h                    |  2 ++
 taichi/program/program.cpp                    | 18 +++++++++---------
 taichi/program/program.h                      |  9 ++++++---
 tests/cpp/codegen/refine_coordinates_test.cpp |  2 +-
 6 files changed, 21 insertions(+), 14 deletions(-)
4bb92467d [Refactor] Move snode_tree_buffer_manager into LlvmProgramImpl.
 taichi/llvm/llvm_program.cpp                | 47 +++++++++++++++++++++++++++++
 taichi/llvm/llvm_program.h                  | 25 +++++++++++++++
 taichi/program/program.cpp                  | 42 ++++++++------------------
 taichi/program/program.h                    |  7 +++--
 taichi/system/snode_tree_buffer_manager.cpp | 10 ++++--
 taichi/system/snode_tree_buffer_manager.h   |  9 +++---
 6 files changed, 100 insertions(+), 40 deletions(-)
87b56171d [Doc] Several dev install doc improvements. (#2741)
 docs/lang/articles/contribution/dev_install.md | 34 +++++++++++++++-----------
 requirements_dev.txt                           |  1 +
 2 files changed, 21 insertions(+), 14 deletions(-)
818fbba15 [ci] Fix clang-format version to 10 (#2739)
 .github/workflows/presubmit.yml                      | 2 +-
 docs/lang/articles/contribution/contributor_guide.md | 2 +-
 python/taichi/code_format.py                         | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)
e5248a3f0 [Doc] Fix --user in dev install instruction. (#2732)
 docs/lang/articles/contribution/dev_install.md | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)
4d5595721 Pin yapf version to 0.31.0. (#2710)
 .github/workflows/presubmit.yml                      | 2 +-
 docs/lang/articles/contribution/contributor_guide.md | 2 +-
 requirements.txt                                     | 2 +-
 requirements_dev.txt                                 | 2 +-
 4 files changed, 4 insertions(+), 4 deletions(-)
3f262f628 [Doc] Update developer install doc to use setup.py. (#2706)
 docs/lang/articles/contribution/dev_install.md | 302 +++++--------------------
 1 file changed, 62 insertions(+), 240 deletions(-)
366ac7000 [Doc] Add gdb debug instructions to dev utilities. (#2702)
 docs/lang/articles/contribution/utilities.md | 12 ++++++++++++
 1 file changed, 12 insertions(+)
bd9c60462 [Misc] Keep debug symbols/line numbers in taichi_core.so by setting DEBUG=1. (#2694)
 setup.py | 8 ++++++++
 1 file changed, 8 insertions(+)
d74dbd2fe [Refactor] Remove is_release() in the codebase. (#2691)
 python/taichi/core/util.py   | 157 ++++++-------------------------------------
 python/taichi/main.py        |  11 +--
 taichi/common/core.cpp       |   4 --
 taichi/common/core.h         |   2 -
 taichi/gui/gui.h             |   6 +-
 taichi/llvm/llvm_context.cpp |  94 +-------------------------
 6 files changed, 26 insertions(+), 248 deletions(-)
5b57b36bf [Refactor] Make is_release always True and delete runtime dep on TAICHI_REPO_DIR. (#2689)
 python/taichi/core/util.py    |  2 +-
 python/taichi/diagnose.py     |  1 -
 taichi/common/core.cpp        | 22 ++++++----------------
 taichi/common/core.h          | 18 ------------------
 taichi/python/export_misc.cpp |  1 -
 5 files changed, 7 insertions(+), 37 deletions(-)
ef18c7635 [CUDA] Save an extra host to device copy if arg_buffer is already on device. (#2688)
 taichi/backends/cuda/codegen_cuda.cpp            | 50 ++++++++++++++----------
 taichi/backends/cuda/cuda_driver.h               |  4 ++
 taichi/backends/cuda/cuda_driver_functions.inc.h |  1 +
 3 files changed, 35 insertions(+), 20 deletions(-)
12355316f [Refactor] Allow taichi_cpp_tests run in release mode as well. (#2686)
 .github/workflows/presubmit.yml | 12 ++++++------
 taichi/gui/gui.h                |  2 +-
 taichi/lang_util.cpp            | 15 +++++++++++++++
 taichi/lang_util.h              |  1 +
 taichi/llvm/llvm_context.cpp    |  4 ++--
 5 files changed, 25 insertions(+), 9 deletions(-)
caa2145c8 [Refactor] Re-enable gdb attach on crash. (#2687)
 taichi/common/core.cpp      | 24 ++++++++++++++++++++++++
 taichi/common/core.h        |  6 ++++++
 taichi/common/logging.cpp   | 12 +++++-------
 taichi/system/threading.cpp | 25 -------------------------
 taichi/system/threading.h   |  6 ------
 5 files changed, 35 insertions(+), 38 deletions(-)
9ea32c809 [Bug] Fix osx release workflow. (#2633)
 .github/workflows/release.yml | 34 +++++++++++++++-------------------
 python/build.py               |  2 +-
 setup.py                      |  1 -
 3 files changed, 16 insertions(+), 21 deletions(-)
4cfb1b121 [Bug] Fix racing in llvm bc generation. (#2569)
 CMakeLists.txt | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)
a2a45a98f [Refactor] Use setup.py from root dir. (#2540)
 .github/workflows/presubmit.yml |  39 ++++---
 .gitignore                      |   2 +-
 CMakeLists.txt                  |   8 +-
 MANIFEST.in                     |  14 +++
 misc/ci_setup.py                |   5 +-
 python/.gitignore               |   4 +-
 python/MANIFEST.in              |  12 ---
 python/build.py                 |  97 ++++--------------
 python/setup.cfg => setup.cfg   |   0
 setup.py                        | 219 ++++++++++++++++++++++++++++++++++------
 tests/{ => python}/conftest.py  |   0
 11 files changed, 257 insertions(+), 143 deletions(-)
b08bebfda [Refactor]Move llvm runtime build for archs to cmake from C++. (#2524)
 CMakeLists.txt                | 25 +++++++++++++++++++++++++
 cmake/TaichiCXXFlags.cmake    |  3 +++
 python/build.py               |  1 -
 taichi/llvm/llvm_context.cpp  |  7 -------
 taichi/python/export_lang.cpp |  2 --
 5 files changed, 28 insertions(+), 10 deletions(-)
